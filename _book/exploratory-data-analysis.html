<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 13 Exploratory data analysis | Telling Stories With Data</title>
<meta name="author" content="Rohan Alexander">
<meta name="description" content="Required material Read The Future of Data Analysis, Part 1 ‘General Considerations,’ (Tukey 1962). Key concepts and skills Quickly coming to terms with a new dataset by constructing graphs and...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 13 Exploratory data analysis | Telling Stories With Data">
<meta property="og:type" content="book">
<meta property="og:image" content="/tellingstorieswithdatapainting.png">
<meta property="og:description" content="Required material Read The Future of Data Analysis, Part 1 ‘General Considerations,’ (Tukey 1962). Key concepts and skills Quickly coming to terms with a new dataset by constructing graphs and...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 13 Exploratory data analysis | Telling Stories With Data">
<meta name="twitter:description" content="Required material Read The Future of Data Analysis, Part 1 ‘General Considerations,’ (Tukey 1962). Key concepts and skills Quickly coming to terms with a new dataset by constructing graphs and...">
<meta name="twitter:image" content="/tellingstorieswithdatapainting.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Atkinson%20Hyperlegible-0.4.0/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=IBM%20Plex%20Mono&amp;display=swap" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/mapdeck-binding-0.3.4/mapdeck.js"></script><script src="libs/mpadeck_functions-0.0.1/mapdeck_functions.js"></script><script src="libs/deckgl-8.1.6/deckgl.min.js"></script><script src="libs/legend-0.0.1/legend.js"></script><script src="libs/title-0.0.1/title.js"></script><script src="libs/mapdeck_location-0.0.1/mapdeck_location.js"></script><script src="libs/mapdeck_colours-0.0.1/mapdeck_colours.js"></script><script src="libs/mapdeck_coordinates-0.0.1/mapdeck_coordinates.js"></script><link href="libs/mapboxgl-1.10.0/mapbox-gl.css" rel="stylesheet">
<script src="libs/mapboxgl-1.10.0/mapbox-gl.js"></script><link href="libs/mapdeck-0.0.1/mapdeck.css" rel="stylesheet">
<script src="libs/mpadeck-binding-0.3.4/mapdeck.js"></script><script src="libs/scatterplot-1.0.0/scatterplot.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Telling Stories With Data</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="about-the-author.html">About the author</a></li>
<li class="book-part">Foundations</li>
<li><a class="" href="telling-stories-with-data.html"><span class="header-section-number">1</span> Telling stories with data</a></li>
<li><a class="" href="drinking-from-a-fire-hose.html"><span class="header-section-number">2</span> Drinking from a fire hose</a></li>
<li><a class="" href="r-essentials.html"><span class="header-section-number">3</span> R essentials</a></li>
<li><a class="" href="reproducible-workflows.html"><span class="header-section-number">4</span> Reproducible workflows</a></li>
<li class="book-part">Communication</li>
<li><a class="" href="on-writing.html"><span class="header-section-number">5</span> On writing</a></li>
<li><a class="" href="static-communication.html"><span class="header-section-number">6</span> Static communication</a></li>
<li><a class="" href="interactive-communication.html"><span class="header-section-number">7</span> Interactive communication</a></li>
<li class="book-part">Acquisition</li>
<li><a class="" href="gather-data.html"><span class="header-section-number">8</span> Gather data</a></li>
<li><a class="" href="hunt-data.html"><span class="header-section-number">9</span> Hunt data</a></li>
<li><a class="" href="farm-data.html"><span class="header-section-number">10</span> Farm data</a></li>
<li class="book-part">Preparation</li>
<li><a class="" href="clean-and-prepare.html"><span class="header-section-number">11</span> Clean and prepare</a></li>
<li><a class="" href="store-and-share.html"><span class="header-section-number">12</span> Store and share</a></li>
<li class="book-part">Modelling</li>
<li><a class="active" href="exploratory-data-analysis.html"><span class="header-section-number">13</span> Exploratory data analysis</a></li>
<li><a class="" href="ijalm.html"><span class="header-section-number">14</span> It’s Just A Linear Model</a></li>
<li><a class="" href="causality.html"><span class="header-section-number">15</span> Causality from observational data</a></li>
<li><a class="" href="mrp.html"><span class="header-section-number">16</span> Multilevel regression with post-stratification</a></li>
<li><a class="" href="text-as-data.html"><span class="header-section-number">17</span> Text as data</a></li>
<li class="book-part">Enrichment</li>
<li><a class="" href="using-the-cloud.html"><span class="header-section-number">18</span> Using the cloud</a></li>
<li><a class="" href="deploying-models.html"><span class="header-section-number">19</span> Deploying models</a></li>
<li><a class="" href="efficiency.html"><span class="header-section-number">20</span> Efficiency</a></li>
<li><a class="" href="concludingremarks.html"><span class="header-section-number">21</span> Concluding remarks</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="oh-you-think-and-shoulders-and-datasets.html"><span class="header-section-number">A</span> Oh you think and shoulders and datasets</a></li>
<li><a class="" href="papers.html"><span class="header-section-number">B</span> Papers</a></li>
<li><a class="" href="references-1.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rstudio/bookdown-demo">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="exploratory-data-analysis" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> Exploratory data analysis<a class="anchor" aria-label="anchor" href="#exploratory-data-analysis"><i class="fas fa-link"></i></a>
</h1>
<p><strong>Required material</strong></p>
<ul>
<li>Read <em>The Future of Data Analysis</em>, Part 1 ‘General Considerations,’ <span class="citation">(<a href="references-1.html#ref-tukey1962future" role="doc-biblioref">Tukey 1962</a>)</span>.</li>
</ul>
<!-- - DiCiccio, Thomas J., and Mary E. Thompson, 2004, 'A Conversation with Donald A. S. Fraser', *Statistical Science*, 19 (2) pp. 370-386, https://utstat.toronto.edu/craiu/DonFraser_SSInterview.pdf. --><!-- - Silge, Julia, 2018, 'Understanding PCA using Stack Overflow data', https://juliasilge.com/blog/stack-overflow-pca/. --><p><strong>Key concepts and skills</strong></p>
<ul>
<li>Quickly coming to terms with a new dataset by constructing graphs and tables.</li>
<li>Understanding the issues and features of the dataset and how this may affect analysis decisions.</li>
<li>Thinking about missing values and outliers.</li>
</ul>
<p><strong>Key libraries</strong></p>
<ul>
<li><code>broom</code></li>
<li><code>ggrepel</code></li>
<li><code>here</code></li>
<li><code>janitor</code></li>
<li><code>lubridate</code></li>
<li><code>opendatatoronto</code></li>
<li><code>tidymodels</code></li>
<li><code>tidyverse</code></li>
<li><code>visdat</code></li>
</ul>
<p><strong>Key functions</strong></p>
<ul>
<li><code>augment()</code></li>
<li><code><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/janitor/man/get_dupes.html">get_dupes()</a></code></li>
<li><code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else()</a></code></li>
<li><code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code></li>
<li><code>initial_split()</code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all()</a></code></li>
<li><code><a href="https://rdrr.io/r/base/names.html">names()</a></code></li>
<li><code><a href="https://rdrr.io/r/base/nrow.html">ncol()</a></code></li>
<li><code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code></li>
<li><code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10()</a></code></li>
<li><code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code></li>
<li><code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract()</a></code></li>
<li><code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code></li>
<li><code><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split()</a></code></li>
<li><code><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_starts()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code></li>
<li><code><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic()</a></code></li>
<li><code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal()</a></code></li>
<li><code><a href="https://docs.ropensci.org/visdat/reference/vis_dat.html">vis_dat()</a></code></li>
<li><code><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss()</a></code></li>
</ul>
<div id="introduction-10" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-10"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>The future of data analysis can involve great progress, the overcoming of real difficulties, and the provision of a great service to all fields of science and technology. Will it? That remains to us, to our willingness to take up the rocky road of real problems in preference to the smooth road of unreal assumptions, arbitrary criteria, and abstract results without real attachments. Who is for the challenge?</p>
<p><span class="citation"><a href="references-1.html#ref-tukey1962future" role="doc-biblioref">Tukey</a> (<a href="references-1.html#ref-tukey1962future" role="doc-biblioref">1962, 64</a>)</span>.</p>
</blockquote>
<p>Exploratory data analysis is never finished, you just die. It is the active process of exploring and becoming familiar with our data. Like a farmer with their hands in the earth, we need to know every contour and aspect of our data. We need to know how it changes, what it shows, hides, and what are its limits. Exploratory data analysis (EDA) is the unstructured process of doing this.</p>
<p>EDA is a means to an end. While it will inform the entire paper, especially the data section, it is not typically something that ends up in the final paper.
The way to proceed is to make a separate R Markdown file, and add code as well as brief notes on-the-go. Do not delete previous code, just add to it. By the end of it we will have created a useful notebook that captures our exploration of the dataset. This is a document that will guide the subsequent analysis and modelling.</p>
<p>EDA draws on a variety of skills and there are a lot of options for EDA <span class="citation">(<a href="references-1.html#ref-staniak2019landscape" role="doc-biblioref">Staniak and Biecek 2019</a>)</span>. Every tool should be considered. Look at the data and scroll through it. Make tables, plots, summary statistics, even some models. The key is to iterate, move quickly rather than perfectly, and come to a thorough understanding of the data.</p>
<p>In this chapter we will go through various examples of EDA including TTC subway delays, and Airbnb.
<!-- , and something else? --></p>
</div>
<div id="case-study-ttc-subway-delays" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> Case study: TTC subway delays<a class="anchor" aria-label="anchor" href="#case-study-ttc-subway-delays"><i class="fas fa-link"></i></a>
</h2>
<p>We can use <code>opendatatoronto</code> <span class="citation">(<a href="references-1.html#ref-citeSharla" role="doc-biblioref">Gelfand 2020</a>)</span> and <code>tidyverse</code> <span class="citation">(<a href="references-1.html#ref-citetidyverse" role="doc-biblioref">Wickham et al. 2019a</a>)</span> to obtain data about the Toronto subway system, and especially the delays that have occurred. The idea for this case study comes from Monica Alexander.</p>
<!-- We will eprovides an interface to all data available on the [Open Data Portal](https://open.toronto.ca/) provided by the City of Toronto. We are going to use that to take a quick lo ok at the subway delays. We're additionally going to especially draw on the , as well as the `ggrepel` [@citeggrepel], `janitor` [@janitor], `lubridate` [@GrolemundWickham2011], and `visdat` [@citevisdat] packages. -->
<!-- ```{r, echo = TRUE, warning = FALSE, message = FALSE} -->
<!-- library(opendatatoronto) -->
<!-- library(tidyverse) -->
<!-- library(ggrepel) -->
<!-- library(janitor) -->
<!-- library(lubridate) -->
<!-- library(visdat) -->
<!-- ``` -->
<p>To begin, we download the data on Toronto Transit Commission (TTC) subway delays in 2020. The data are available as a separate dataset for each month. We are interested in 2020, so we create a column that of the year, and then filter the resources to just those months that were in 2020. We download them using <code><a href="https://sharlagelfand.github.io/opendatatoronto//reference/get_resource.html">get_resource()</a></code>, iterating through each month using <code>map_dfr</code> from <code>purrr</code> <span class="citation">(<a href="references-1.html#ref-citepurrr" role="doc-biblioref">Henry and Wickham 2020</a>)</span> which brings each of the twelve datasets together, and then save them.
then save them.</p>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor">janitor</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sharlagelfand.github.io/opendatatoronto/">opendatatoronto</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="co"># We know this unique key by looking the 'id' of the interest.</span>
<span class="va">ttc_resources</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://sharlagelfand.github.io/opendatatoronto//reference/list_package_resources.html">list_package_resources</a></span><span class="op">(</span><span class="st">"996cfe8d-fb35-40ce-b569-698d51fc683b"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"20..?"</span><span class="op">)</span><span class="op">)</span> |&gt;  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span>

<span class="va">all_2020_ttc_data</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="va">ttc_resources</span><span class="op">$</span><span class="va">id</span>, <span class="va">get_resource</span><span class="op">)</span>

<span class="va">all_2020_ttc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="va">all_2020_ttc_data</span><span class="op">)</span>

<span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">all_2020_ttc_data</span>, <span class="st">"all_2020_ttc_data.csv"</span><span class="op">)</span>

<span class="va">all_2020_ttc_data</span></code></pre></div>
<p>The dataset has a variety of columns, and we can find out more about each of them by downloading the codebook. The reason for the delay is coded, and so we can also download the explanations. One particular variable of interest appears to be ‘min_delay,’ which gives the extent of the delay in minutes.</p>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Data codebook</span>
<span class="va">delay_data_codebook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sharlagelfand.github.io/opendatatoronto//reference/get_resource.html">get_resource</a></span><span class="op">(</span><span class="st">"54247e39-5a7d-40db-a137-82b2a9ab0708"</span><span class="op">)</span>
<span class="va">delay_data_codebook</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="va">delay_data_codebook</span><span class="op">)</span>
<span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">delay_data_codebook</span>, <span class="st">"delay_data_codebook.csv"</span><span class="op">)</span>

<span class="co"># Explanation for delay codes</span>
<span class="va">delay_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sharlagelfand.github.io/opendatatoronto//reference/get_resource.html">get_resource</a></span><span class="op">(</span><span class="st">"fece136b-224a-412a-b191-8d31eb00491e"</span><span class="op">)</span>
<span class="va">delay_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="va">delay_codes</span><span class="op">)</span>
<span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">delay_codes</span>, <span class="st">"delay_codes.csv"</span><span class="op">)</span></code></pre></div>
<p>There is no one way to explore a dataset while conducting EDA, but we are usually especially interested in:</p>
<ul>
<li>What should the variables look like? For instance, what is their type, what are the values, and what does the distribution of these look like?</li>
<li>What aspects are surprising, both in terms of data that are there that we do not expect, such as outliers, but also in terms of data that we may expect here but do not have such as missing data.</li>
<li>Developing a goal for our analysis. For instance, in this case, it might be understanding the factors such as stations and the time of day, that are associated with delays.</li>
</ul>
<p>It is important to document all aspects as we go through and make note of anything surprising. We are looking to create a record of the steps and assumptions that we made as we were going because these will be important when we come to modelling.</p>
<div id="checking-data" class="section level3" number="13.2.1">
<h3>
<span class="header-section-number">13.2.1</span> Checking data<a class="anchor" aria-label="anchor" href="#checking-data"><i class="fas fa-link"></i></a>
</h3>
<p>We should check that the variables are what they say they are. If they are not, then we need to work out what to do, for instance, should we recode them, or even remove them? It is also important to ensure that the class of the variables is as we expect, for instance variables that should be a factor are a factor and those that should be a character are a character. And also that we do not accidentally have, say, factors as numbers, or vice versa. One way to do this is to use <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code>, and another is to use <code><a href="https://rdrr.io/r/base/table.html">table()</a></code>.</p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">all_2020_ttc_data</span><span class="op">$</span><span class="va">day</span><span class="op">)</span>
<span class="co">#&gt; [1] "Wednesday" "Thursday"  "Friday"    "Saturday" </span>
<span class="co">#&gt; [5] "Sunday"    "Monday"    "Tuesday"</span>

<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">all_2020_ttc_data</span><span class="op">$</span><span class="va">line</span><span class="op">)</span>
<span class="co">#&gt;  [1] "SRT"                    "YU"                    </span>
<span class="co">#&gt;  [3] "BD"                     "SHP"                   </span>
<span class="co">#&gt;  [5] "YU/BD"                  "YU / BD"               </span>
<span class="co">#&gt;  [7] "999"                    NA                      </span>
<span class="co">#&gt;  [9] "29 DUFFERIN"            "95 YORK MILLS"         </span>
<span class="co">#&gt; [11] "35 JANE"                "YU-BD"                 </span>
<span class="co">#&gt; [13] "BLOOR - DANFORTH"       "YU/BD LINE"            </span>
<span class="co">#&gt; [15] "YUS"                    "YUS/BD"                </span>
<span class="co">#&gt; [17] "40 JUNCTION-DUNDAS WES" "71 RUNNYMEDE"          </span>
<span class="co">#&gt; [19] "BD/YU"                  "102 MARKHAM ROAD"      </span>
<span class="co">#&gt; [21] "YUS/DB"                 "YU &amp; BD"               </span>
<span class="co">#&gt; [23] "SHEP"</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">all_2020_ttc_data</span><span class="op">$</span><span class="va">day</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    Friday    Monday  Saturday    Sunday  Thursday   Tuesday </span>
<span class="co">#&gt;      2174      2222      1867      1647      2353      2190 </span>
<span class="co">#&gt; Wednesday </span>
<span class="co">#&gt;      2329</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">all_2020_ttc_data</span><span class="op">$</span><span class="va">line</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;       102 MARKHAM ROAD            29 DUFFERIN </span>
<span class="co">#&gt;                      1                      1 </span>
<span class="co">#&gt;                35 JANE 40 JUNCTION-DUNDAS WES </span>
<span class="co">#&gt;                      1                      1 </span>
<span class="co">#&gt;           71 RUNNYMEDE          95 YORK MILLS </span>
<span class="co">#&gt;                      1                      1 </span>
<span class="co">#&gt;                    999                     BD </span>
<span class="co">#&gt;                      2                   5473 </span>
<span class="co">#&gt;                  BD/YU       BLOOR - DANFORTH </span>
<span class="co">#&gt;                      1                      1 </span>
<span class="co">#&gt;                   SHEP                    SHP </span>
<span class="co">#&gt;                      1                    619 </span>
<span class="co">#&gt;                    SRT                     YU </span>
<span class="co">#&gt;                    644                   7620 </span>
<span class="co">#&gt;                YU / BD                YU &amp; BD </span>
<span class="co">#&gt;                     22                      2 </span>
<span class="co">#&gt;                  YU-BD                  YU/BD </span>
<span class="co">#&gt;                      1                    338 </span>
<span class="co">#&gt;             YU/BD LINE                    YUS </span>
<span class="co">#&gt;                      1                      2 </span>
<span class="co">#&gt;                 YUS/BD                 YUS/DB </span>
<span class="co">#&gt;                      1                      1</span></code></pre></div>
<p>It is clear that we have likely issues in terms of the lines. Some of them have a clear re-code, but not all. One option would be to drop them, but we would need to think about whether these errors might be correlated with something that is of interest, because if they were then we may be dropping important information. There is usually no one right answer, because it will usually depend on what we are using the data for. We would note the issue, as we continued with EDA and then decide later about what to do. For now, we will remove all the lines that are not the ones that we know to be correct.</p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> <span class="op">&lt;-</span> 
  <span class="va">all_2020_ttc_data</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">line</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BD"</span>, <span class="st">"YU"</span>, <span class="st">"SHP"</span>, <span class="st">"SRT"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Exploring missing data could be a course in itself, but the presence, or lack, of missing values can haunt an analysis. To get started we could look at known-unknowns, which are the NAs for each variable. And <code><a href="https://docs.ropensci.org/visdat/reference/vis_dat.html">vis_dat()</a></code> and <code><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss()</a></code> from <code>visdat</code> <span class="citation">(<a href="references-1.html#ref-citevisdat" role="doc-biblioref">N. Tierney 2017</a>)</span> can be useful to get a feel for how the missing values are distributed.</p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://visdat.njtierney.com/">visdat</a></span><span class="op">)</span>

<span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 10</span>
<span class="co">#&gt;    date  time   day station  code min_delay min_gap bound</span>
<span class="co">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;     &lt;int&gt;   &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1     0     0     0       0     0         0       0  3272</span>
<span class="co">#&gt; # … with 2 more variables: line &lt;int&gt;, vehicle &lt;int&gt;</span>

<span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_dat.html">vis_dat</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">all_2020_ttc_data</span>,
         palette <span class="op">=</span> <span class="st">"cb_safe"</span>
         <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="40-eda_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss</a></span><span class="op">(</span><span class="va">all_2020_ttc_data</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="40-eda_files/figure-html/unnamed-chunk-9-2.png" width="672"></div>
<p>In this case we have many missing values in ‘bound’ and two in ‘line.’ For these known-unknowns, we are interested in whether the they are missing at random. We want to, ideally, show that data happened to just drop out. This is unlikely, and so we are usually trying to look at what is systematic about how our data are missing.</p>
<p>Sometime data happen to be duplicated. If we did not notice this then our analysis would be wrong in ways that we’d not be able to consistently expect. There are a variety of ways to look for duplicated rows, but <code><a href="https://rdrr.io/pkg/janitor/man/get_dupes.html">get_dupes()</a></code> from <code>janitor</code> <span class="citation">(<a href="references-1.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span> is especially useful.</p>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/get_dupes.html">get_dupes</a></span><span class="op">(</span><span class="va">all_2020_ttc_data</span><span class="op">)</span>
<span class="co">#&gt; No variable names specified - using all columns.</span>
<span class="co">#&gt; # A tibble: 37 × 11</span>
<span class="co">#&gt;    date                time   day    station code  min_delay</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;time&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2020-02-10 00:00:00 06:00  Monday TORONT… MRO           0</span>
<span class="co">#&gt;  2 2020-02-10 00:00:00 06:00  Monday TORONT… MRO           0</span>
<span class="co">#&gt;  3 2020-02-10 00:00:00 06:00  Monday TORONT… MUO           0</span>
<span class="co">#&gt;  4 2020-02-10 00:00:00 06:00  Monday TORONT… MUO           0</span>
<span class="co">#&gt;  5 2020-03-10 00:00:00 23:00  Tuesd… YORK M… MUO           0</span>
<span class="co">#&gt;  6 2020-03-10 00:00:00 23:00  Tuesd… YORK M… MUO           0</span>
<span class="co">#&gt;  7 2020-03-26 00:00:00 13:20  Thurs… VAUGHA… MUNOA         3</span>
<span class="co">#&gt;  8 2020-03-26 00:00:00 13:20  Thurs… VAUGHA… MUNOA         3</span>
<span class="co">#&gt;  9 2020-03-26 00:00:00 18:32  Thurs… VAUGHA… MUNOA         3</span>
<span class="co">#&gt; 10 2020-03-26 00:00:00 18:32  Thurs… VAUGHA… MUNOA         3</span>
<span class="co">#&gt; # … with 27 more rows, and 5 more variables: min_gap &lt;dbl&gt;,</span>
<span class="co">#&gt; #   bound &lt;chr&gt;, line &lt;chr&gt;, vehicle &lt;dbl&gt;,</span>
<span class="co">#&gt; #   dupe_count &lt;int&gt;</span></code></pre></div>
<p>This dataset has many duplicates. Again, we are interested in whether there is something systematic going on. Remembering that during EDA we are trying to quickly come to terms with a dataset, one way forward is to flag this as an issue to come back to and explore later, and to just remove duplicates for now using <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></code>.</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> <span class="op">&lt;-</span> 
  <span class="va">all_2020_ttc_data</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The station names are a mess. We could try to quickly bring a little order to the chaos by just taking just the first word (or, the first two if it starts with ‘ST’).</p>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> <span class="op">&lt;-</span>
  <span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>station_clean <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_starts</a></span><span class="op">(</span><span class="va">station</span>, <span class="st">"ST"</span><span class="op">)</span>, 
                                 <span class="fu"><a href="https://stringr.tidyverse.org/reference/word.html">word</a></span><span class="op">(</span><span class="va">station</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, 
                                 <span class="fu"><a href="https://stringr.tidyverse.org/reference/word.html">word</a></span><span class="op">(</span><span class="va">station</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="visualizing-data" class="section level3" number="13.2.2">
<h3>
<span class="header-section-number">13.2.2</span> Visualizing data<a class="anchor" aria-label="anchor" href="#visualizing-data"><i class="fas fa-link"></i></a>
</h3>
<p>We need to see the data in its original state to understand it and we use bar charts, scatterplots, line plots and histograms extensively for this. During EDA we are not as concerned with whether the graph is aesthetically pleasing, but are instead trying to acquire a sense of the data as quickly as possible. We can start by looking at the distribution of ‘min_delay,’ which is one outcome of interest.</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">min_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="40-eda_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>
<p>The largely empty graph suggests the presence of outliers. There are a variety of ways to try to understand what could be going on, but one quick way to proceed it to use a log, remembering that we would expect values of 0 to drop away.</p>
<div class="sourceCode" id="cb410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">min_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="40-eda_files/figure-html/unnamed-chunk-14-1.png" width="672"></div>
<p>This initial exploration further hints at an issue that we might like to explore further. We will join this dataset with ‘delay_codes’ to understand what is going on.</p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> <span class="op">&lt;-</span>
  <span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="va">delay_codes</span> |&gt;
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">sub_rmenu_code</span>, 
             code_desc <span class="op">=</span> <span class="va">code_description_3</span><span class="op">)</span> |&gt;
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">code_desc</span><span class="op">)</span>,
    by <span class="op">=</span> <span class="st">"code"</span>
  <span class="op">)</span>

<span class="va">all_2020_ttc_data</span> <span class="op">&lt;-</span>
  <span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>code_srt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">line</span> <span class="op">==</span> <span class="st">"SRT"</span>, <span class="va">code</span>, <span class="st">"NA"</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>
    <span class="va">delay_codes</span> |&gt;
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>code_srt <span class="op">=</span> <span class="va">sub_rmenu_code</span>, code_desc_srt <span class="op">=</span> <span class="va">code_description_7</span><span class="op">)</span> |&gt;
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">code_srt</span>, <span class="va">code_desc_srt</span><span class="op">)</span>,
    by <span class="op">=</span> <span class="st">"code_srt"</span>
  <span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
    code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">code_srt</span> <span class="op">==</span> <span class="st">"NA"</span>, <span class="va">code</span>, <span class="va">code_srt</span><span class="op">)</span>,
    code_desc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">code_desc_srt</span><span class="op">)</span>, <span class="va">code_desc</span>, <span class="va">code_desc_srt</span><span class="op">)</span>
  <span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">code_srt</span>,<span class="op">-</span><span class="va">code_desc_srt</span><span class="op">)</span></code></pre></div>
<p>And so we can see that the 450 minute delay was due to ‘Transit Control Related Problems,’ the 446 minute delay was due to ‘Miscellaneous Other,’ they seem to be outliers, even among the outliers.</p>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">delay_codes</span> |&gt; 
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">sub_rmenu_code</span>, code_desc <span class="op">=</span> <span class="va">code_description_3</span><span class="op">)</span> |&gt;
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">code_desc</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">min_delay</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">time</span>, <span class="va">station</span>, <span class="va">line</span>, <span class="va">min_delay</span>, <span class="va">code</span>, <span class="va">code_desc</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("code", "code_desc")</span>
<span class="co">#&gt; # A tibble: 14,335 × 7</span>
<span class="co">#&gt;    date                time   station  line  min_delay code </span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;time&gt; &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;</span>
<span class="co">#&gt;  1 2020-02-13 00:00:00 05:30  ST GEOR… YU          450 TUCC </span>
<span class="co">#&gt;  2 2020-05-08 00:00:00 16:16  ST CLAI… YU          446 MUO  </span>
<span class="co">#&gt;  3 2020-01-22 00:00:00 05:57  KEELE S… BD          258 EUTR </span>
<span class="co">#&gt;  4 2020-03-19 00:00:00 11:26  ROYAL Y… BD          221 MUPR1</span>
<span class="co">#&gt;  5 2020-11-12 00:00:00 23:10  SHEPPAR… YU          197 PUCSC</span>
<span class="co">#&gt;  6 2020-12-13 00:00:00 21:37  MCCOWAN… SRT         167 PRSP </span>
<span class="co">#&gt;  7 2020-12-04 00:00:00 16:23  MCCOWAN… SRT         165 PRSP </span>
<span class="co">#&gt;  8 2020-01-18 00:00:00 05:48  SCARBOR… SRT         162 PRSL </span>
<span class="co">#&gt;  9 2020-02-22 00:00:00 05:16  SPADINA… YU          159 PUSWZ</span>
<span class="co">#&gt; 10 2020-09-03 00:00:00 14:35  CASTLE … BD          150 MUPR1</span>
<span class="co">#&gt; # … with 14,325 more rows, and 1 more variable:</span>
<span class="co">#&gt; #   code_desc &lt;chr&gt;</span></code></pre></div>
</div>
<div id="groups-of-small-counts" class="section level3" number="13.2.3">
<h3>
<span class="header-section-number">13.2.3</span> Groups of small counts<a class="anchor" aria-label="anchor" href="#groups-of-small-counts"><i class="fas fa-link"></i></a>
</h3>
<p>Another thing that we are looking for is various groupings of the data, especially where sub-groups may end up with only a small numbers of observations in them. This is because any analysis could be especially influenced by them. One quick way to do this is to group the data by a variable that is of interest, for instance ‘line,’ using color.</p>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_2020_ttc_data</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">min_delay</span>, y <span class="op">=</span> <span class="va">..density..</span>, fill <span class="op">=</span> <span class="va">line</span><span class="op">)</span>, 
                 position <span class="op">=</span> <span class="st">'dodge'</span>, 
                 bins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:delaydensity"></span>
<img src="40-eda_files/figure-html/delaydensity-1.png" alt="Density of the distribution of delay, in minutes" width="672"><p class="caption">
Figure 13.1: Density of the distribution of delay, in minutes
</p>
</div>
<p>Figure <a href="exploratory-data-analysis.html#fig:delaydensity">13.1</a> uses density so that we can look at the the distributions more comparably, but we should also be aware of differences in frequency (Figure <a href="exploratory-data-analysis.html#fig:delayfreq">13.2</a>). In this case, we will see that ‘SHP’ and ‘SRT’ have much smaller counts.</p>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_2020_ttc_data</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">min_delay</span>, fill <span class="op">=</span> <span class="va">line</span><span class="op">)</span>, 
                 position <span class="op">=</span> <span class="st">'dodge'</span>, 
                 bins <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:delayfreq"></span>
<img src="40-eda_files/figure-html/delayfreq-1.png" alt="Frequency of the distribution of delay, in minutes" width="672"><p class="caption">
Figure 13.2: Frequency of the distribution of delay, in minutes
</p>
</div>
<p>To group by another variable we can add facets (Figure <a href="exploratory-data-analysis.html#fig:delayfreqfacet">13.3</a>).</p>
<div class="sourceCode" id="cb415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_2020_ttc_data</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">min_delay</span>, color <span class="op">=</span> <span class="va">line</span><span class="op">)</span>, 
               bw <span class="op">=</span> <span class="fl">.08</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:delayfreqfacet"></span>
<img src="40-eda_files/figure-html/delayfreqfacet-1.png" alt="Frequency of the distribution of delay, in minutes, by day" width="672"><p class="caption">
Figure 13.3: Frequency of the distribution of delay, in minutes, by day
</p>
</div>
<p>We can now plot the top five stations by mean delay.</p>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">line</span>, <span class="va">station_clean</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">min_delay</span><span class="op">)</span>, n_obs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_obs</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">line</span>, <span class="op">-</span><span class="va">mean_delay</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">station_clean</span>, <span class="va">mean_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">line</span><span class="op">)</span>, 
               scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'line'. You can override</span>
<span class="co">#&gt; using the `.groups` argument.</span></code></pre></div>
<div class="inline-figure"><img src="40-eda_files/figure-html/unnamed-chunk-17-1.png" width="672"></div>
</div>
<div id="dates" class="section level3" number="13.2.4">
<h3>
<span class="header-section-number">13.2.4</span> Dates<a class="anchor" aria-label="anchor" href="#dates"><i class="fas fa-link"></i></a>
</h3>
<p>Dates are often difficult to work with because they are so prone to having issues. For this reason, it is especially important to consider them during EDA. We could create a graph by week, to see if there is any seasonality. When using dates, <code>lubridate</code> <span class="citation">(<a href="references-1.html#ref-GrolemundWickham2011" role="doc-biblioref">Grolemund and Wickham 2011</a>)</span> is especially useful. For instance, we can look at the average delay, of those that were delayed, by week drawing on <code><a href="https://lubridate.tidyverse.org/reference/week.html">week()</a></code> to construct the weeks (Figure <a href="exploratory-data-analysis.html#fig:delaybyweek">13.4</a>).</p>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>

<span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">min_delay</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/week.html">week</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">week</span>, <span class="va">line</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">min_delay</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">week</span>, <span class="va">mean_delay</span>, color <span class="op">=</span> <span class="va">line</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">line</span><span class="op">)</span>,
              scales <span class="op">=</span> <span class="st">"free_y"</span>
             <span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:delaybyweek"></span>
<img src="40-eda_files/figure-html/delaybyweek-1.png" alt="Average delay, in minutes, by week, for the Toronto subway" width="672"><p class="caption">
Figure 13.4: Average delay, in minutes, by week, for the Toronto subway
</p>
</div>
<p>Now let us look at the proportion of delays that were greater than 10 minutes (Figure <a href="exploratory-data-analysis.html#fig:longdelaybyweek">13.5</a>).</p>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>week <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/week.html">week</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">week</span>, <span class="va">line</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>prop_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">min_delay</span><span class="op">&gt;</span><span class="fl">10</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">week</span>, <span class="va">prop_delay</span>, color <span class="op">=</span> <span class="va">line</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">line</span><span class="op">)</span>,
              scales <span class="op">=</span> <span class="st">"free_y"</span>
             <span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:longdelaybyweek"></span>
<img src="40-eda_files/figure-html/longdelaybyweek-1.png" alt="Delays longer than ten minutes, by week, for the Toronto subway" width="672"><p class="caption">
Figure 13.5: Delays longer than ten minutes, by week, for the Toronto subway
</p>
</div>
<p>These figures, tables, and analysis have no place in a final paper. Instead, they allow us to become comfortable with the data. We note aspects about each that stand out, as well as the warnings and any implications or aspects to return to.</p>
</div>
<div id="relationships" class="section level3" number="13.2.5">
<h3>
<span class="header-section-number">13.2.5</span> Relationships<a class="anchor" aria-label="anchor" href="#relationships"><i class="fas fa-link"></i></a>
</h3>
<p>We are also interested in looking at the relationship between two variables. Scatter plots are especially useful here for continuous variables, and are a good precursor to modeling. For instance, we may be interested in the relationship between the delay and the gap (Figure <a href="exploratory-data-analysis.html#fig:delayvsgap">13.6</a>).</p>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">min_delay</span>, y <span class="op">=</span> <span class="va">min_gap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:delayvsgap"></span>
<img src="40-eda_files/figure-html/delayvsgap-1.png" alt="Relationship between delay and gap for the Toronto subway in 2020" width="672"><p class="caption">
Figure 13.6: Relationship between delay and gap for the Toronto subway in 2020
</p>
</div>
<p>The relationship between categorical variables takes more work, but we could also, for instance, look at the top five reasons for delay by station. In particular, we may be interested in whether they differ, and how any difference could be modeled (Figure <a href="exploratory-data-analysis.html#fig:categorical">13.7</a>).</p>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">line</span>, <span class="va">code_desc</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">min_delay</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">mean_delay</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">code_desc</span>,
             y <span class="op">=</span> <span class="va">mean_delay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">line</span><span class="op">)</span>, 
             scales <span class="op">=</span> <span class="st">"free_y"</span>,
             nrow <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:categorical"></span>
<img src="40-eda_files/figure-html/categorical-1.png" alt="Relationship between categorical variables for the Toronto subway in 2020" width="672"><p class="caption">
Figure 13.7: Relationship between categorical variables for the Toronto subway in 2020
</p>
</div>
<p>Principal components analysis (PCA) is another powerful exploratory tool. It allows us to pick up potential clusters and outliers that can help to inform modeling. To see this, we can look at the types of delay by station. The delay categories are messy and there a lot of them, but as we are trying to come to terms with the dataset, we will just take the first word.</p>
<div class="sourceCode" id="cb421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_2020_ttc_data</span> <span class="op">&lt;-</span>
  <span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>code_red <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_starts</a></span><span class="op">(</span><span class="va">code_desc</span>, <span class="st">"No"</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/word.html">word</a></span><span class="op">(</span><span class="va">code_desc</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,
    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_starts</a></span><span class="op">(</span><span class="va">code_desc</span>, <span class="st">"Operator"</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/word.html">word</a></span><span class="op">(</span><span class="va">code_desc</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/word.html">word</a></span><span class="op">(</span><span class="va">code_desc</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Let us also just restrict the analysis to causes that happen at least 50 times over 2019. To do the PCA, the dataframe also needs to be switched to wide format.</p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dwide</span> <span class="op">&lt;-</span>
  <span class="va">all_2020_ttc_data</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">line</span>, <span class="va">station_clean</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n_obs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n_obs</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">code_red</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>tot_delay <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">tot_delay</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tot_delay</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">line</span>, <span class="va">station_clean</span>, <span class="va">code_red</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n_delay <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">code_red</span>, values_from <span class="op">=</span> <span class="va">n_delay</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_all</a></span><span class="op">(</span>.funs <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'line', 'station_clean'. You can override using the `.groups` argument.</span>
<span class="co">#&gt; `mutate_all()` ignored the following grouping variables:</span>
<span class="co">#&gt; Columns `line`, `station_clean`</span>
<span class="co">#&gt; Use `mutate_at(df, vars(-group_cols()), myoperation)` to silence the message.</span>
<span class="co">#&gt; Warning: `funs()` was deprecated in dplyr 0.8.0.</span>
<span class="co">#&gt; Please use a list of either functions or lambdas: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Simple named list: </span>
<span class="co">#&gt;   list(mean = mean, median = median)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Auto named with `tibble::lst()`: </span>
<span class="co">#&gt;   tibble::lst(mean, median)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Using lambdas</span>
<span class="co">#&gt;   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</span>
<span class="co">#&gt; This warning is displayed once every 8 hours.</span>
<span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></code></pre></div>
<p>Now we can quickly do some PCA.</p>
<div class="sourceCode" id="cb423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delay_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">dwide</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dwide</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

<span class="va">df_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">delay_pca</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
<span class="va">df_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">dwide</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">line</span>, <span class="va">station_clean</span><span class="op">)</span>, <span class="va">df_out</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_out</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 32</span>
<span class="co">#&gt; # Groups:   line, station_clean [6]</span>
<span class="co">#&gt;   line  station_clean    PC1    PC2     PC3   PC4    PC5</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 BD    BATHURST       10.9   17.2   2.04   12.9   4.60 </span>
<span class="co">#&gt; 2 BD    BAY            14.6    6.54  4.76   14.4   0.406</span>
<span class="co">#&gt; 3 BD    BLOOR          22.8  -18.6  19.7    -7.37 -1.54 </span>
<span class="co">#&gt; 4 BD    BLOOR-DANFORTH 23.4  -20.2  20.4    -4.85 -0.429</span>
<span class="co">#&gt; 5 BD    BROADVIEW       9.29  22.0  -0.0365  6.72  4.31 </span>
<span class="co">#&gt; 6 BD    CASTLE         15.1    5.21  7.62   11.6  -1.17 </span>
<span class="co">#&gt; # … with 25 more variables: PC6 &lt;dbl&gt;, PC7 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC8 &lt;dbl&gt;, PC9 &lt;dbl&gt;, PC10 &lt;dbl&gt;, PC11 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC12 &lt;dbl&gt;, PC13 &lt;dbl&gt;, PC14 &lt;dbl&gt;, PC15 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC16 &lt;dbl&gt;, PC17 &lt;dbl&gt;, PC18 &lt;dbl&gt;, PC19 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC20 &lt;dbl&gt;, PC21 &lt;dbl&gt;, PC22 &lt;dbl&gt;, PC23 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC24 &lt;dbl&gt;, PC25 &lt;dbl&gt;, PC26 &lt;dbl&gt;, PC27 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC28 &lt;dbl&gt;, PC29 &lt;dbl&gt;, PC30 &lt;dbl&gt;</span></code></pre></div>
<p>We can plot the first two principal components, and add labels to some of the outlying stations.</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_out</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>,y<span class="op">=</span><span class="va">PC2</span>,color<span class="op">=</span><span class="va">line</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_out</span> |&gt; <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">PC2</span><span class="op">&gt;</span><span class="fl">100</span><span class="op">|</span><span class="va">PC1</span><span class="op">&lt;</span><span class="fl">100</span><span class="op">*</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, 
                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">station_clean</span><span class="op">)</span>
                  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="40-eda_files/figure-html/unnamed-chunk-21-1.png" width="672"></div>
<p>We could also plot the factor loadings. We se some evidence that perhaps one is to do with the public, compared with another to do with the operator.</p>
<div class="sourceCode" id="cb425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_out_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">delay_pca</span><span class="op">$</span><span class="va">rotation</span><span class="op">)</span>
<span class="va">df_out_r</span><span class="op">$</span><span class="va">feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dwide</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dwide</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>

<span class="va">df_out_r</span>
<span class="co">#&gt; # A tibble: 30 × 31</span>
<span class="co">#&gt;         PC1    PC2      PC3      PC4      PC5     PC6</span>
<span class="co">#&gt;       &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 -0.0279  0.125  -0.0576   0.0679  -0.0133   0.0307</span>
<span class="co">#&gt;  2 -0.108   0.343  -0.150    0.205   -0.100    0.317 </span>
<span class="co">#&gt;  3 -0.0196  0.0604 -0.0207   0.0195   0.0189   0.0574</span>
<span class="co">#&gt;  4 -0.0244  0.0752 -0.0325  -0.0237   0.00121 -0.0263</span>
<span class="co">#&gt;  5 -0.0128  0.0113 -0.00340 -0.00977 -0.0255   0.0186</span>
<span class="co">#&gt;  6 -0.231   0.650  -0.309    0.245    0.222   -0.309 </span>
<span class="co">#&gt;  7 -0.0871  0.233  -0.0904  -0.692   -0.311   -0.414 </span>
<span class="co">#&gt;  8 -0.00377 0.0193 -0.00201 -0.0140  -0.0424   0.0751</span>
<span class="co">#&gt;  9 -0.0167  0.120  -0.0367  -0.578    0.336    0.563 </span>
<span class="co">#&gt; 10 -0.0708  0.276  -0.118    0.116   -0.368    0.435 </span>
<span class="co">#&gt; # … with 20 more rows, and 25 more variables: PC7 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC8 &lt;dbl&gt;, PC9 &lt;dbl&gt;, PC10 &lt;dbl&gt;, PC11 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC12 &lt;dbl&gt;, PC13 &lt;dbl&gt;, PC14 &lt;dbl&gt;, PC15 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC16 &lt;dbl&gt;, PC17 &lt;dbl&gt;, PC18 &lt;dbl&gt;, PC19 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC20 &lt;dbl&gt;, PC21 &lt;dbl&gt;, PC22 &lt;dbl&gt;, PC23 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC24 &lt;dbl&gt;, PC25 &lt;dbl&gt;, PC26 &lt;dbl&gt;, PC27 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   PC28 &lt;dbl&gt;, PC29 &lt;dbl&gt;, PC30 &lt;dbl&gt;, feature &lt;chr&gt;</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df_out_r</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>,y<span class="op">=</span><span class="va">PC2</span>,label<span class="op">=</span><span class="va">feature</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Warning: ggrepel: 22 unlabeled data points (too many</span>
<span class="co">#&gt; overlaps). Consider increasing max.overlaps</span></code></pre></div>
<div class="inline-figure"><img src="40-eda_files/figure-html/unnamed-chunk-22-1.png" width="672"></div>
<!-- ## Case study - Opinions about a casino in Toronto -->
<!-- **This was written by [Michael Chong](https://michael-chong.github.io).** -->
<!-- ### Data preparation -->
<!-- Here we use the `opendatatoronto` package again. See the previous case study for a deeper explanation of how the code below works. -->
<!-- The dataset I'm extracting below are the results from a survey in 2012 regarding the establishment of a casino in Toronto. More info available by following [this link](https://open.toronto.ca/dataset/casino-survey-results/). In this analysis, we will be hoping to address the question: which demographic (age/gender) groups are more likely to be supportive of a new casino in Toronto? -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- # Get the data -->
<!-- casino_resource <-  -->
<!--   search_packages("casino survey")|> -->
<!--   list_package_resources() |> -->
<!--   filter(name == "toronto-casino-survey-results") |> -->
<!--   get_resource() -->
<!-- head(casino_resource) -->
<!-- ``` -->
<!-- The object `casino_resource` isn't quite useable yet, because it is (inconveniently) stored as a `list` of 2 data frames: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- # Check what kind of object the casino_resource object is -->
<!-- class(casino_resource) -->
<!-- ``` -->
<!-- If we just return the object, we can see that the second list item is empty, and we just want to keep the first one: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- casino_resource -->
<!-- ``` -->
<!-- So, let us only keep the first item by indexing the list with double square brackets: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- casino_data <- casino_resource[[1]] -->
<!-- ``` -->
<!-- Let us check out what the first couple rows of the dataframe looks like. By default, `head()` returns the first 6 rows: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- head(casino_data)  -->
<!-- ``` -->
<!-- Unfortunately the column names are not very informative. For simplicity, we will use the '.pdf' questionnaire that accompanies this dataset from the Toronto Open Data website. Alternatively, we could get and parse the 'readme' through the R package. [Here's a link to the questionnaire](https://ckan0.cf.opendata.inter.prod-toronto.ca/dataset/427ca4cd-168a-4a37-883d-4a574277caf5/resource/ae135d6a-6921-4905-bc79-516fcd428b7b/download/toronto-casino-survey-feedback-form.pdf).  -->
<!-- Question 1 indicates the level of support for a casino in Toronto. We will use this as the response variable. -->
<!-- Concerning potential predictor variables, most of the questions ask respondents about their opinions on different aspects of a potential casino development, which are not particularly useful towards our cause. The only demographic variables are `Age` and `Gender`, so let us choose these. -->
<!-- Here I'm also going to rename the columns so that my resulting data frame has columns 'opinion', 'age', and 'gender'. -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- # Narrow down the dataframe to our variables of interest -->
<!-- casino_data <-  -->
<!--   casino_data |> -->
<!--   select(Q1_A, Age, Gender) |> -->
<!--   rename(opinion = Q1_A, age = Age, gender = Gender) -->
<!-- # Look at first couple rows: -->
<!-- head(casino_data) -->
<!-- ``` -->
<!-- ### Some visual exploration (and more cleanup, of course) -->
<!-- Let us first do some quick exploration to get a feel for what's going on in the data. We will first calculate proportions of casino support for each age-gender combination: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- # Calculate proportions -->
<!-- casino_summary <- casino_data |> -->
<!--   group_by(age, gender, opinion) |> -->
<!--   summarise(n = n()) |> # Count the number in each group and response -->
<!--   group_by(age, gender) |> -->
<!--   mutate(prop = n/sum(n)) # Calculate proportions within each group -->
<!-- ``` -->
<!-- Some notes: -->
<!-- * we use `geom_col()` to make a bar chart, -->
<!-- * `facet_grid()` modifies the plot so that the plot has panels that correspond only to certain values of discrete variables (in this case, we will "facet" by `age` and `gender`). This is helpful in this case because we are interested in how the distribution of `opinion`s changes by `age` and `gender`. -->
<!-- ```{r, fig.height = 8} -->
<!-- ggplot(casino_summary) + -->
<!--   geom_col(aes(x = opinion, y = prop)) + # Specify a histogram of opinion responses -->
<!--   facet_grid(age~gender) + #Facet by age and gender -->
<!--   theme(axis.text.x = element_text(angle = 90)) # Rotate the x-axis labels to be readable -->
<!-- ``` -->
<!-- Some things to note: -->
<!-- * the x-axis labels are out of order in the sense that they are not in a monotone order of increasing/decreasing support -->
<!-- * there are `NA` values in `opinion`, `age`, and `gender`, as well as "Prefer not to disclose" responses -->
<!-- ### Getting the data into a more model-suitable format -->
<!-- First we need to get rid of responses that are not suitable. For simplicity we will assume that `NA` values and "Prefer not to disclose" responses occur randomly, and remove them from our dataset (note in reality this assumption might not hold up and we might want to be more careful). Let us check how many rows are in the original dataset: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- # nrow() returns the number of rows in a dataframe: -->
<!-- nrow(casino_data) -->
<!-- ``` -->
<!-- Now let us `dplyr::filter()` accordingly to omit the responses we do not want. In case you're unfamiliar, I'm going to make use of: -->
<!-- * `is.na()`, which returns `TRUE` if the argument is `NA`, -->
<!-- * the `!` operator, which flips `TRUE` and `FALSE`. So for instance, `!is.na(x)` will return `TRUE` if `x` is NOT `NA`, which is what we want to keep.  -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- casino_data <- casino_data |> -->
<!--   # Only keep rows with non-NA: -->
<!--   filter(!is.na(opinion), !is.na(age), !is.na(gender)) |> -->
<!--   # Only keep rows where age and gender are disclosed: -->
<!--   filter(age != "Prefer not to disclose", gender != "Prefer not to disclose") -->
<!-- ``` -->
<!-- Let us check how many rows of data we are left with: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- nrow(casino_data) -->
<!-- ``` -->
<!-- Now we need to convert the response variable into binary. To clean up the first problem (response variables out of order), we might as well take this opportunity to convert these into a format suitable for our model. In a logistic regression, we would like our response variable to be binary, but in this case we have 5 possible categories ranging from "Strongly Opposed" to "Strongly in Favour". We will recategorize them into a new 'supportive_or_not' variable as follows.  -->
<!-- * 'supportive = 1' if "Strongly in Favour" or "Somewhat in Favour" -->
<!-- * 'supportive = 0' if "Neutral or Mixed Feelings", "Somewhat Opposed", or "Strongly Opposed" -->
<!-- We do this with the `dplyr::mutate()` function, which creates new columns (possibly as functions of existing columns), and `dplyr::case_when()`, which provides a way to assign values conditional on if-statements. The syntax here is a little strange. On the LHS of the `~` is the "if" condition, and the RHS of the tilde is the value to return. For example, 'x == 0 ~ 3' would return 3 when 'x' is 0. -->
<!-- Another commonly used operator here is the `%in%` operator, which checks whether something is an element of a vector, for instance, e.g.: -->
<!-- * `1 %in% c(1, 3, 4)` returns `TRUE` -->
<!-- * `2 %in% c(1, 3, 4)` returns `FALSE` -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- # Store possible opinions in vectors -->
<!-- yes_opinions <- c("Strongly in Favour", "Somewhat in Favour") -->
<!-- no_opinions <- c("Neutral or Mixed Feelings", "Somewhat Opposed", "Strongly Opposed") -->
<!-- # Create `supportive` column: -->
<!-- casino_data <-  -->
<!--   casino_data |> -->
<!--   mutate(supportive = case_when( -->
<!--     opinion %in% yes_opinions ~ TRUE, # Assign TRUE -->
<!--     opinion %in% no_opinions ~ FALSE  # Assign FALSE -->
<!--   )) -->
<!-- ``` -->
<!-- Now we need to convert age to a numeric variable. Age in this survey is given in age groups. Let us instead map it to a numeric variable so that we can more easily talk about trends with age. We will map the youngest age to `1`, and so on: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- casino_data <-  -->
<!--   casino_data |> -->
<!--   mutate(age_group = case_when( -->
<!--     age == "Under 15" ~ 0, -->
<!--     age == "15-24" ~ 1, -->
<!--     age == "25-34" ~ 2, -->
<!--     age == "35-44" ~ 3, -->
<!--     age == "45-54" ~ 4, -->
<!--     age == "55-64" ~ 5, -->
<!--     age == "65 or older" ~ 6 -->
<!--   )) -->
<!-- ``` -->
<!-- Now let us make the same plot again, with our new processed data: -->
<!-- ```{r, fig.height = 9} -->
<!-- casino_summary2 <-  -->
<!--   casino_data |> -->
<!--   group_by(age_group, gender, supportive) |> -->
<!--   summarise(n = n()) |> # Count the number in each group and response -->
<!--   group_by(age_group, gender) |> -->
<!--   mutate(prop = n/sum(n)) # Calculate proportions within each group -->
<!-- ggplot(casino_summary2) + -->
<!--   facet_grid(age_group ~ gender) + -->
<!--   geom_col(aes(x = supportive, y = prop))  -->
<!-- ``` -->
<!-- We can sort of see some difference in the distribution between different panels. To formalize this, we can run a logistic regression. -->
<!-- ### Logistic Regression -->
<!-- Now, we are set up to feed it to the regression. We can do this with `glm()`, which allows us to fit generalized linear models. -->
<!-- We use `family = "binomial"` to specify a logistic regression, and our formula is `supportive ~ age_group + gender`, which indicates that `supportive` is the (binary) response variable since it is on the LHS, and `age_group` and `gender` are our predictor variables. -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- casino_glm <- glm(supportive ~ age_group + gender, data = casino_data, family = "binomial") -->
<!-- ``` -->
<!-- We can take a look at the results of running the GLM using `summary()`: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- summary(casino_glm) -->
<!-- ``` -->
<!-- Interpretation can be a little tricky. Here are some important things to note about our results: -->
<!-- Firstly, we have a numeric age group variable. Remember that we coded `age_group` as numbers 1 to 5. Because we've used age groups instead of age, we have to be careful with how we phrase our conclusion. The coefficient estimate corresponds to the effect of moving up a unit on the age group scale (e.g. from the 25-34 age group to the 35-44 age group), rather than 1 year in age (e.g. from age 28 to 29). -->
<!-- Secondly, the results are in log-odds ratios. The effect estimates are on the log-odds scale. This means the effect of -0.07983 for `age_group` is interpreted as: 'for each unit increase in `age_group`, we estimate a 0.07983 decrease in the log-odds of being supportive of a casino'. -->
<!-- We could exponentiate the coefficient estimate to make this at least a little easier to interpret. The number we get is interpreted as a factor for the odds. -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- exp(-0.07983) -->
<!-- ``` -->
<!-- So our (cleaner) interpretation is: 'the odds of an individuals of the same gender being pro-casino are predicted to change by a factor of 0.9232733 for each unit increase in `age_group`' -->
<!-- Finally, we have a baseline category. First, note that because we have categorical variables, the `gender` coefficients are relative to a "baseline" category. The value of `gender`  that does not appear in the table, `Female`, is implicitly used as our baseline gender category. Technical note: if the variable is stored as a `character` class, then `glm()` will choose the alphabetically first value to use as the baseline. -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- exp(0.70036) -->
<!-- ``` -->
<!-- So, the interpretation of the `genderMale` coefficient is: 'the odds of a male individual supporting a casino is 2.0144778 times higher than a female individual of the same `age_group`.' -->
<!-- We can make estimates in a variety of ways. First we will look at it manually. -->
<!-- Using the formula found in @islr [4.3.3], we can make estimates for an individual of certain characteristics. Suppose we wanted to predict the the probability of supporting a Toronto casino for an individual who was 36 and identified as transgender. Then: -->
<!-- * `age_group` takes a value of 3, since they are in the age group of 35-44 coded as 3, -->
<!-- * `genderTransgendered` takes a value of 1 -->
<!-- First, let us extract the coefficient estimates as a vector using `coefficients()`: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- coefs <- coefficients(casino_glm) -->
<!-- coefs -->
<!-- ``` -->
<!-- Since this vector is labeled, we can index it using square brackets and names. For instance: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- coefs["age_group"] -->
<!-- ``` -->
<!-- So first let us evaluate the exponent term $e^{\beta_0 + \cdots + \beta_p X_p}$: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- exp_term <- exp(coefs["(Intercept)"] + coefs["age_group"]*3 + coefs["genderTransgendered"]*1) -->
<!-- ``` -->
<!-- Now evaluate the expression that gives the probability of casino support: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- # The unname() command just takes off the label that it "inherited" from the coefs vector. -->
<!-- # (do not worry about it, does not affect any functionality) -->
<!-- unname(exp_term / (1 + exp_term)) -->
<!-- ``` -->
<!-- That works, but there are more stream-lined ways. Thankfully R comes with a convenient function to make prediction estimates from a `glm()`. We do this using the `predict()` function. First, we need to make a dataframe that has the relevant variables and values that we are interested in predicting. We will use the same values as before: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- prediction_df <- data.frame(age_group = 3, gender = "Transgendered") -->
<!-- ``` -->
<!-- The dataframe looks like this: -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- prediction_df -->
<!-- ``` -->
<!-- Then we feed it into the `predict()` function, along with our `glm` object. To get the probability, we need to specify `type = "response"`. -->
<!-- ```{r, eval = TRUE, include = TRUE} -->
<!-- predict(casino_glm, newdata = prediction_df, type = "response") -->
<!-- ``` -->
<!-- This matches the probability we got from doing this manually, yay! -->
<!-- ## Case study - Historical Canadian elections -->
<!-- https://twitter.com/semrasevi/status/1122889166008745985?s=21  -->
<!-- ```{r, include = TRUE, eval = FALSE} -->
<!-- library(tidyverse) -->
<!-- elections_data <- read_csv("inputs/federal_candidates-1.csv") -->
<!-- elections_data$Province |> table() -->
<!-- # There are inconsistencies in the province names -->
<!-- elections_data$Province[elections_data$Province == "Québec"] <- "Quebec" -->
<!-- elections_data <- elections_data |> -->
<!--   filter(!is.na(Province)) -->
<!-- # Check gender -->
<!-- elections_data$Gender |> table() -->
<!-- # Check occupation -->
<!-- elections_data$occupation |> table() -->
<!-- # Get a count of how many uniques there are -->
<!-- elections_data$occupation |> unique() |> length() -->
<!-- # Check party -->
<!-- elections_data$party_short |> table() -->
<!-- elections_data$party_short |> unique() |> length() -->
<!-- # Check incumbency -->
<!-- elections_data$incumbent_candidate |> table() -->
<!-- elections_data$party_short |> unique() |> length() -->
<!-- # Add year -->
<!-- elections_data <- -->
<!--   elections_data |> -->
<!--   mutate(year = year(edate)) -->
<!-- # Add a counter for year -->
<!-- elections_data <- -->
<!--   elections_data |> -->
<!--   mutate(counter = year - 1867) -->
<!-- #### Save #### -->
<!-- write_csv(elections_data, "outputs/elections.csv") -->
<!-- ``` -->
<!-- ```{r, include = TRUE, eval = FALSE} -->
<!-- library(lubridate) -->
<!-- library(tidyverse) -->
<!-- elections_data <- read_csv("outputs/elections.csv") -->
<!-- elections_data |> -->
<!--   ggplot(aes(x = edate)) + -->
<!--   geom_histogram() -->
<!-- elections_data |> -->
<!--   ggplot(aes(x = edate, y = Result, color = Gender)) + -->
<!--   geom_point() + -->
<!--   facet_wrap(vars(Province)) -->
<!-- elections_data |> -->
<!--   ggplot(aes(x = Province, fill = Gender)) + -->
<!--   geom_bar(position = "dodge") -->
<!-- # We discovered WW1! -->
<!-- ``` -->
<!-- ```{r, include = TRUE, eval = FALSE} -->
<!-- #### Set up workspace ### -->
<!-- library(broom) -->
<!-- library(tidyverse) -->
<!-- #### Read in data #### -->
<!-- elections_data <- read_csv("outputs/elections.csv") -->
<!-- #### Model #### -->
<!-- # Just gender -->
<!-- model1 <- lm(Result ~ Gender, data = elections_data) -->
<!-- tidy(model1) -->
<!-- # Gender and incumbent -->
<!-- model2 <- lm(Result ~ Gender + incumbent_candidate, data = elections_data) -->
<!-- tidy(model2) -->
<!-- # Gender and incumbent and province -->
<!-- model3 <- lm(Result ~ Gender + incumbent_candidate + Province, data = elections_data) -->
<!-- tidy(model3) -->
<!-- # Gender and incumbent and province and year -->
<!-- model4 <- lm(Result ~ Gender + incumbent_candidate + Province + year, data = elections_data) -->
<!-- model5 <- lm(Result ~ Gender + incumbent_candidate + Province + year*Gender, data = elections_data) -->
<!-- tidy(model4) -->
<!-- tidy(model5) -->
<!-- # CHange the year into a counter that increments one for each year -->
<!-- model6 <- lm(Result ~ Gender + incumbent_candidate + Province + counter + counter*Gender, data = elections_data) -->
<!-- tidy(model6) -->
<!-- ``` -->
</div>
</div>
<div id="case-study-airbnb-listing-in-toronto" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> Case study: Airbnb listing in Toronto<a class="anchor" aria-label="anchor" href="#case-study-airbnb-listing-in-toronto"><i class="fas fa-link"></i></a>
</h2>
<!-- - Kommenda, Niko, Helen Pidd and Libby Brooks, 2020, 'Revealed: the areas in the UK with one Airbnb for every four homes', *The Guardian*, 20 February, https://www.theguardian.com/technology/2020/feb/20/revealed-the-areas-in-the-uk-with-one-airbnb-for-every-four-homes. -->
<p>In this case study we look at Airbnb listings in Toronto. The dataset is from Inside Airbnb <span class="citation">(<a href="references-1.html#ref-airbnbdata" role="doc-biblioref">Cox 2021</a>)</span> and we will read it from their website, and then save a local copy. We can give <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> a link to where the dataset is and it will download it. This helps with reproducibility because the source is clear. But, as that link could change at any time, longer-term reproducibility, as well as wanting to minimize the effect on the Inside Airbnb servers, suggest that we should also save a local copy of the data and then use that. As the original data is not ours, we should not make that public without first getting written permission. The ‘guess_max’ option in read_csv helps us avoid having to specify the column types. Usually <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> takes a best guess at the column types based on the first few rows. But sometimes those first ones are misleading and so ‘guess_max’ forces it to look at a larger number of rows to try to work out what is going on.</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">airbnb_data</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"http://data.insideairbnb.com/canada/on/toronto/2021-01-02/data/listings.csv.gz"</span>, 
           guess_max <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span>

<span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">airbnb_data</span>, <span class="st">"airbnb_data.csv"</span><span class="op">)</span>

<span class="va">airbnb_data</span></code></pre></div>
<div id="explore-individual-variables" class="section level3" number="13.3.1">
<h3>
<span class="header-section-number">13.3.1</span> Explore individual variables<a class="anchor" aria-label="anchor" href="#explore-individual-variables"><i class="fas fa-link"></i></a>
</h3>
<p>There are a large number of columns, so we will just select a few.</p>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">airbnb_data</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 74</span>

<span class="va">airbnb_data_selected</span> <span class="op">&lt;-</span> 
  <span class="va">airbnb_data</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">host_id</span>, 
         <span class="va">host_since</span>, 
         <span class="va">host_response_time</span>, 
         <span class="va">host_is_superhost</span>, 
         <span class="va">host_listings_count</span>,
         <span class="va">host_total_listings_count</span>,
         <span class="va">host_neighbourhood</span>, 
         <span class="va">host_listings_count</span>, 
         <span class="va">neighbourhood_cleansed</span>, 
         <span class="va">room_type</span>, 
         <span class="va">bathrooms</span>, 
         <span class="va">bedrooms</span>, 
         <span class="va">price</span>, 
         <span class="va">number_of_reviews</span>, 
         <span class="va">has_availability</span>, 
         <span class="va">review_scores_rating</span>, 
         <span class="va">review_scores_accuracy</span>, 
         <span class="va">review_scores_cleanliness</span>, 
         <span class="va">review_scores_checkin</span>, 
         <span class="va">review_scores_communication</span>, 
         <span class="va">review_scores_location</span>, 
         <span class="va">review_scores_value</span>
         <span class="op">)</span>

<span class="va">airbnb_data_selected</span>
<span class="co">#&gt; # A tibble: 18,265 × 21</span>
<span class="co">#&gt;    host_id host_since host_response_time host_is_superhost</span>
<span class="co">#&gt;      &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;              &lt;lgl&gt;            </span>
<span class="co">#&gt;  1    1565 2008-08-08 N/A                FALSE            </span>
<span class="co">#&gt;  2   22795 2009-06-22 N/A                FALSE            </span>
<span class="co">#&gt;  3   48239 2009-10-25 N/A                FALSE            </span>
<span class="co">#&gt;  4   93825 2010-03-15 N/A                FALSE            </span>
<span class="co">#&gt;  5  118124 2010-05-04 within a day       FALSE            </span>
<span class="co">#&gt;  6   22795 2009-06-22 N/A                FALSE            </span>
<span class="co">#&gt;  7  174063 2010-07-20 within an hour     TRUE             </span>
<span class="co">#&gt;  8  183071 2010-07-28 within an hour     TRUE             </span>
<span class="co">#&gt;  9  187320 2010-08-01 within a few hours TRUE             </span>
<span class="co">#&gt; 10  192364 2010-08-05 N/A                FALSE            </span>
<span class="co">#&gt; # … with 18,255 more rows, and 17 more variables:</span>
<span class="co">#&gt; #   host_listings_count &lt;dbl&gt;,</span>
<span class="co">#&gt; #   host_total_listings_count &lt;dbl&gt;,</span>
<span class="co">#&gt; #   host_neighbourhood &lt;chr&gt;, neighbourhood_cleansed &lt;chr&gt;,</span>
<span class="co">#&gt; #   room_type &lt;chr&gt;, bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;,</span>
<span class="co">#&gt; #   price &lt;chr&gt;, number_of_reviews &lt;dbl&gt;,</span>
<span class="co">#&gt; #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;, …</span></code></pre></div>
<p>First we might be interested in price. It is a character at the moment and so we need to convert it to a numeric. This is a common problem, and we need to be a little careful that it does not all just convert to NAs. In our case if we just force the price data to be a numeric then it will go to NA because there are a lot of characters where it is unclear what the numeric equivalent is, such as ‘$.’ So we need to remove those characters first.</p>
<div class="sourceCode" id="cb428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span><span class="op">$</span><span class="va">price</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "$469.00" "$96.00"  "$64.00"  "$70.00"  "$45.00" </span>
<span class="co">#&gt; [6] "$127.00"</span>

<span class="va">airbnb_data_selected</span><span class="op">$</span><span class="va">price</span> |&gt; <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;  [1] "$" "4" "6" "9" "." "0" "7" "5" "1" "2" "3" "8" ","</span>

<span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">price</span>, <span class="st">","</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 145 × 1</span>
<span class="co">#&gt;    price    </span>
<span class="co">#&gt;    &lt;chr&gt;    </span>
<span class="co">#&gt;  1 $1,724.00</span>
<span class="co">#&gt;  2 $1,000.00</span>
<span class="co">#&gt;  3 $1,100.00</span>
<span class="co">#&gt;  4 $1,450.00</span>
<span class="co">#&gt;  5 $1,019.00</span>
<span class="co">#&gt;  6 $1,000.00</span>
<span class="co">#&gt;  7 $1,300.00</span>
<span class="co">#&gt;  8 $2,142.00</span>
<span class="co">#&gt;  9 $2,000.00</span>
<span class="co">#&gt; 10 $1,200.00</span>
<span class="co">#&gt; # … with 135 more rows</span>

<span class="va">airbnb_data_selected</span> <span class="op">&lt;-</span> 
  <span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>price <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">price</span>, <span class="st">"\\$"</span><span class="op">)</span>,
         price <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">price</span>, <span class="st">","</span><span class="op">)</span>,
         price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>
         <span class="op">)</span></code></pre></div>
<p>Now we can have a look at the distribution of prices (Figure <a href="exploratory-data-analysis.html#fig:airbnbpricesfirst">13.8</a>).</p>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Price per night"</span>,
       y <span class="op">=</span> <span class="st">"Number of properties"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:airbnbpricesfirst"></span>
<img src="40-eda_files/figure-html/airbnbpricesfirst-1.png" alt="Distribution of prices of Toronto Airbnb rentals in January 2021" width="672"><p class="caption">
Figure 13.8: Distribution of prices of Toronto Airbnb rentals in January 2021
</p>
</div>
<p>It is clear that there are outliers, so again we might like to consider it on the log scale (Figure <a href="exploratory-data-analysis.html#fig:airbnbpriceslog">13.9</a>).</p>
<div class="sourceCode" id="cb430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">price</span> <span class="op">&gt;</span> <span class="fl">1000</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Price per night"</span>,
       y <span class="op">=</span> <span class="st">"Number of properties"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:airbnbpriceslog"></span>
<img src="40-eda_files/figure-html/airbnbpriceslog-1.png" alt="Distribution of log prices of Toronto Airbnb rentals in January 2021" width="672"><p class="caption">
Figure 13.9: Distribution of log prices of Toronto Airbnb rentals in January 2021
</p>
</div>
<p>If we focus on prices that are less than $1,000 then we see that the majority of properties have a nightly price less than $250. Interestingly it looks like there is some bunching of prices, possible around numbers ending in zero or nine. Let us just zoom in on prices between $90 and $210, out of interest, but change the bins to be smaller (Figure <a href="exploratory-data-analysis.html#fig:airbnbpricesbunch">13.10</a>).</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">price</span> <span class="op">&lt;</span> <span class="fl">1000</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Price per night"</span>,
       y <span class="op">=</span> <span class="st">"Number of properties"</span><span class="op">)</span>

<span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">price</span> <span class="op">&gt;</span> <span class="fl">90</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">price</span> <span class="op">&lt;</span> <span class="fl">210</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Price per night"</span>,
       y <span class="op">=</span> <span class="st">"Number of properties"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:airbnbpricesbunch"></span>
<img src="40-eda_files/figure-html/airbnbpricesbunch-1.png" alt="Distribution of prices less than $1000 for Toronto Airbnb rentals in January 2021 shows bunching" width="50%"><img src="40-eda_files/figure-html/airbnbpricesbunch-2.png" alt="Distribution of prices less than $1000 for Toronto Airbnb rentals in January 2021 shows bunching" width="50%"><p class="caption">
Figure 13.10: Distribution of prices less than $1000 for Toronto Airbnb rentals in January 2021 shows bunching
</p>
</div>
<p>For now, we will just remove all prices that are more than $999.</p>
<div class="sourceCode" id="cb432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> <span class="op">&lt;-</span> 
  <span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">price</span> <span class="op">&lt;</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<p>Superhosts are especially experienced Airbnb hosts, and we might be interested to learn more about them. For instance, a host either is or is not a superhost, and so we would not expect any NAs. But we can see that there are. It might be that the host removed a listing or similar. For now, we will remove them.</p>
<div class="sourceCode" id="cb433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">host_is_superhost</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 11 × 21</span>
<span class="co">#&gt;      host_id host_since host_response_time host_is_superhost</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;              &lt;lgl&gt;            </span>
<span class="co">#&gt;  1  23472830 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt;  2  31675651 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt;  3  75779190 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt;  4  47614482 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt;  5 201103629 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt;  6 111820893 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt;  7  23472830 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt;  8 196269219 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt;  9  23472830 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt; 10 266594170 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt; 11 118516038 NA         &lt;NA&gt;               NA               </span>
<span class="co">#&gt; # … with 17 more variables: host_listings_count &lt;dbl&gt;,</span>
<span class="co">#&gt; #   host_total_listings_count &lt;dbl&gt;,</span>
<span class="co">#&gt; #   host_neighbourhood &lt;chr&gt;, neighbourhood_cleansed &lt;chr&gt;,</span>
<span class="co">#&gt; #   room_type &lt;chr&gt;, bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;,</span>
<span class="co">#&gt; #   price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,</span>
<span class="co">#&gt; #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,</span>
<span class="co">#&gt; #   review_scores_accuracy &lt;dbl&gt;, …</span></code></pre></div>
<p>We will also want to create a binary variable from this. It is true/false at the moment, which is fine for the modelling, but there are a handful of situations where it will be easier if we have a 0/1. And for now we will just remove anyone with an NA for whether they are a super host.</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> <span class="op">&lt;-</span> 
  <span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">host_is_superhost</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>host_is_superhost_binary <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span>
    <span class="va">host_is_superhost</span> <span class="op">==</span> <span class="cn">TRUE</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p>On Airbnb, guests can give 1-5 star ratings across a variety of different aspects, including cleanliness, accuracy, value, and others. But when we look at the reviews in our dataset, it is less clear how this is being constructed, because it appears to be a rating between 20 and 100 and there are also NA values (Figure <a href="exploratory-data-analysis.html#fig:airbnbreviews">13.11</a>).</p>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">review_scores_rating</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Reviews scores rating"</span>,
       y <span class="op">=</span> <span class="st">"Number of properties"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:airbnbreviews"></span>
<img src="40-eda_files/figure-html/airbnbreviews-1.png" alt="Distribution of review scores rating for Toronto Airbnb rentals in January 2021" width="672"><p class="caption">
Figure 13.11: Distribution of review scores rating for Toronto Airbnb rentals in January 2021
</p>
</div>
<p>We would like to deal with the NAs in ‘review_scores_rating,’ but this is more complicated as there are a lot of them. It may be that this is just because they do not have any reviews.</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">review_scores_rating</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 4308</span>

<span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">review_scores_rating</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">number_of_reviews</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    0    1    2    3    4 </span>
<span class="co">#&gt; 4046  226   23   10    3</span></code></pre></div>
<p>So these properties do not have a review rating yet because they do not have enough reviews. It is a large proportion of the total, at almost a fifth of them so we might like to look at this in more detail using <code><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss()</a></code> from <code>visdat</code> <span class="citation">(<a href="references-1.html#ref-citevisdat" role="doc-biblioref">N. Tierney 2017</a>)</span>. We are interested to see whether there is something systematic happening with these properties. For instance, if the NAs were being driven by, say, some requirement of a minimum number of reviews, then we would expect they would all be missing.</p>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://visdat.njtierney.com/">visdat</a></span><span class="op">)</span>
<span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">review_scores_rating</span>, 
         <span class="va">review_scores_accuracy</span>, 
         <span class="va">review_scores_cleanliness</span>, 
         <span class="va">review_scores_checkin</span>, 
         <span class="va">review_scores_communication</span>, 
         <span class="va">review_scores_location</span>, 
         <span class="va">review_scores_value</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html">vis_miss</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="40-eda_files/figure-html/unnamed-chunk-31-1.png" width="672"></div>
<p>Given it looks convincing that in almost all cases, the different types of reviews are missing for the same observation. One approach would be to just focus on those that are not missing and the main review score. It is clear that almost all the reviews are more than 80. Let us just zoom in on that 60 to 80 range to check what the distribution looks like in that range (Figure <a href="exploratory-data-analysis.html#fig:airbnbreviewsselected">13.12</a>).</p>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">review_scores_rating</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">review_scores_rating</span> <span class="op">&gt;</span> <span class="fl">60</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">review_scores_rating</span> <span class="op">&lt;</span> <span class="fl">80</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">review_scores_rating</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average review score"</span>,
       y <span class="op">=</span> <span class="st">"Number of properties"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:airbnbreviewsselected"></span>
<img src="40-eda_files/figure-html/airbnbreviewsselected-1.png" alt="Distribution of review scores, between 60 and 80, for Toronto Airbnb rentals in January 2021" width="672"><p class="caption">
Figure 13.12: Distribution of review scores, between 60 and 80, for Toronto Airbnb rentals in January 2021
</p>
</div>
<p>For now, we will remove anyone with an NA in their main review score, even though this will remove roughly 20 per cent of observations. And we will also focus only on those hosts with a main review score of at least 70. If we ended up using this dataset for actual analysis, then we would want to justify this decision in an appendix or similar.</p>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> <span class="op">&lt;-</span> 
  <span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">review_scores_rating</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">review_scores_rating</span> <span class="op">&gt;=</span> <span class="fl">70</span><span class="op">)</span></code></pre></div>
<p>Another important factor is how quickly a host responds to an enquiry. Airbnb allows hosts up to 24 hours to respond, but encourages responses within an hour.</p>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">host_response_time</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 5 × 2</span>
<span class="co">#&gt;   host_response_time     n</span>
<span class="co">#&gt;   &lt;chr&gt;              &lt;int&gt;</span>
<span class="co">#&gt; 1 a few days or more   494</span>
<span class="co">#&gt; 2 N/A                 5708</span>
<span class="co">#&gt; 3 within a day         952</span>
<span class="co">#&gt; 4 within a few hours  1649</span>
<span class="co">#&gt; 5 within an hour      4668</span></code></pre></div>
<p>It is unclear a host could have a response time of NA. It may be that they are related to some other variable. Interestingly it seems like what looks like ‘NAs’ in ‘host_response_time’ variable are not coded as proper NAs, but are instead being treated as another category. We will recode them to be actual NAs and also change the variable to be a factor.</p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> <span class="op">&lt;-</span> 
  <span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>host_response_time <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">host_response_time</span> <span class="op">==</span> <span class="st">"N/A"</span>, <span class="cn">NA_character_</span>, <span class="va">host_response_time</span><span class="op">)</span>,
         host_response_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">host_response_time</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>There is clearly an issue with NAs as there are a lot of them. For instance, we might be interested to see if there is a relationship with the review score (Figure <a href="exploratory-data-analysis.html#fig:airbnbreviewsselectednasresponse">13.13</a>). There are a lot that have an overall review of 100.</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">host_response_time</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">review_scores_rating</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average review score"</span>,
       y <span class="op">=</span> <span class="st">"Number of properties"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:airbnbreviewsselectednasresponse"></span>
<img src="40-eda_files/figure-html/airbnbreviewsselectednasresponse-1.png" alt="Distribution of review scores for properties with NA response time, for Toronto Airbnb rentals in January 2021" width="672"><p class="caption">
Figure 13.13: Distribution of review scores for properties with NA response time, for Toronto Airbnb rentals in January 2021
</p>
</div>
<p>For now, we will remove anyone with a NA in their response time. This will again removes roughly another 20 per cent of the observations.</p>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> <span class="op">&lt;-</span> 
  <span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">host_response_time</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>There are two versions of a variable that suggest how many properties a host has on Airbnb. We might be interested to know whether there is a difference between them.</p>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>listings_count_is_same <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">host_listings_count</span> <span class="op">==</span> <span class="va">host_total_listings_count</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">listings_count_is_same</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 0 × 23</span>
<span class="co">#&gt; # … with 23 variables: host_id &lt;dbl&gt;, host_since &lt;date&gt;,</span>
<span class="co">#&gt; #   host_response_time &lt;fct&gt;, host_is_superhost &lt;lgl&gt;,</span>
<span class="co">#&gt; #   host_listings_count &lt;dbl&gt;,</span>
<span class="co">#&gt; #   host_total_listings_count &lt;dbl&gt;,</span>
<span class="co">#&gt; #   host_neighbourhood &lt;chr&gt;, neighbourhood_cleansed &lt;chr&gt;,</span>
<span class="co">#&gt; #   room_type &lt;chr&gt;, bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;,</span>
<span class="co">#&gt; #   price &lt;int&gt;, number_of_reviews &lt;dbl&gt;, …</span></code></pre></div>
<p>As there are no differences in this dataset, we can just remove one variable for now and have a look at the other one (Figure <a href="exploratory-data-analysis.html#fig:airbnbhostlisting">13.14</a>).</p>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> <span class="op">&lt;-</span> 
  <span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">host_listings_count</span><span class="op">)</span>

<span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">host_total_listings_count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:airbnbhostlisting"></span>
<img src="40-eda_files/figure-html/airbnbhostlisting-1.png" alt="Distribution of the number of properties a host has on Airbnb, for Toronto Airbnb rentals in January 2021" width="672"><p class="caption">
Figure 13.14: Distribution of the number of properties a host has on Airbnb, for Toronto Airbnb rentals in January 2021
</p>
</div>
<p>There are a large number who have somewhere in the 2-10 properties range, but the usual long tail. The number with 0 listings is unexpected and worth following up on. And there are a bunch with NA that we will need to deal with.</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">host_total_listings_count</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 21</span>
<span class="co">#&gt;   host_id host_since host_response_time host_is_superhost</span>
<span class="co">#&gt;     &lt;dbl&gt; &lt;date&gt;     &lt;fct&gt;              &lt;lgl&gt;            </span>
<span class="co">#&gt; 1 3783106 2012-10-06 within an hour     FALSE            </span>
<span class="co">#&gt; 2 3814089 2012-10-09 within an hour     FALSE            </span>
<span class="co">#&gt; 3 3827668 2012-10-10 within a day       FALSE            </span>
<span class="co">#&gt; 4 2499198 2012-05-30 within a day       FALSE            </span>
<span class="co">#&gt; 5 3268493 2012-08-15 within a day       FALSE            </span>
<span class="co">#&gt; 6 8675040 2013-09-06 within an hour     TRUE             </span>
<span class="co">#&gt; # … with 17 more variables:</span>
<span class="co">#&gt; #   host_total_listings_count &lt;dbl&gt;,</span>
<span class="co">#&gt; #   host_neighbourhood &lt;chr&gt;, neighbourhood_cleansed &lt;chr&gt;,</span>
<span class="co">#&gt; #   room_type &lt;chr&gt;, bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;,</span>
<span class="co">#&gt; #   price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,</span>
<span class="co">#&gt; #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,</span>
<span class="co">#&gt; #   review_scores_accuracy &lt;dbl&gt;, …</span></code></pre></div>
<p>There is nothing that immediately jumps out as odd about the people with zero listings, but there must be something going on. For now, we will focus on only those with one property.</p>
<div class="sourceCode" id="cb447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> <span class="op">&lt;-</span> 
  <span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">add_count</a></span><span class="op">(</span><span class="va">host_id</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span></code></pre></div>
</div>
<div id="explore-relationships-between-variables" class="section level3" number="13.3.2">
<h3>
<span class="header-section-number">13.3.2</span> Explore relationships between variables<a class="anchor" aria-label="anchor" href="#explore-relationships-between-variables"><i class="fas fa-link"></i></a>
</h3>
<p>We might like to make some graphs to see if there are any relationships that become clear. Some aspects that come to mind is looking at prices and reviews and super hosts, and number of properties and neighborhood.</p>
<p>Look at the relationship between price and reviews, and whether they are a super-host (Figure <a href="exploratory-data-analysis.html#fig:priceandreview">13.15</a>).</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt;
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">price</span>, y <span class="op">=</span> <span class="va">review_scores_rating</span>, color <span class="op">=</span> <span class="va">host_is_superhost</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Price per night"</span>,
       y <span class="op">=</span> <span class="st">"Average review score"</span>,
       color <span class="op">=</span> <span class="st">"Super host"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:priceandreview"></span>
<img src="40-eda_files/figure-html/priceandreview-1.png" alt="Relationship between price and review and whether a host is a super host, for Toronto Airbnb rentals in January 2021" width="672"><p class="caption">
Figure 13.15: Relationship between price and review and whether a host is a super host, for Toronto Airbnb rentals in January 2021
</p>
</div>
<p>One of the aspects that may make someone a super host is how quickly they respond to inquiries. One could imagine that being a superhost involves quickly saying yes or no to inquiries. Let us look at the data. First, we want to look at the possible values of superhost by their response times.</p>
<div class="sourceCode" id="cb449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">host_is_superhost</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
         proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">proportion</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 × 3</span>
<span class="co">#&gt;   host_is_superhost     n proportion</span>
<span class="co">#&gt;   &lt;lgl&gt;             &lt;int&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1 FALSE              1677       0.58</span>
<span class="co">#&gt; 2 TRUE               1234       0.42</span></code></pre></div>
<p>Fortunately, it looks like when we removed the reviews rows we removed any NAs from whether they were a super host, but if we go back and look into that we may need to check again.
We could build a table that looks at a hosts response time by whether they are a superhost using <code><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl()</a></code> from <code>janitor</code> <span class="citation">(<a href="references-1.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span>. It is clear that is a host does not respond within an hour then it is unlikely that they are a super host.</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">host_response_time</span>, <span class="va">host_is_superhost</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_percentages.html">adorn_percentages</a></span><span class="op">(</span><span class="st">"row"</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html">adorn_pct_formatting</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_ns.html">adorn_ns</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_title.html">adorn_title</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;                     host_is_superhost          </span>
<span class="co">#&gt;  host_response_time             FALSE      TRUE</span>
<span class="co">#&gt;  a few days or more         90% (223) 10%  (26)</span>
<span class="co">#&gt;        within a day         70% (348) 30% (149)</span>
<span class="co">#&gt;  within a few hours         55% (354) 45% (284)</span>
<span class="co">#&gt;      within an hour         49% (752) 51% (775)</span></code></pre></div>
<p>Finally, we could look at neighborhood. The data provider has attempted to clean the neighborhood variable for us, so will just use that variable for now. Although if we ended up using this variable for our actual analysis we would want to check they had not made any errors.</p>
<div class="sourceCode" id="cb451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">neighbourhood_cleansed</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_totals.html">adorn_totals</a></span><span class="op">(</span><span class="st">"row"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html">adorn_pct_formatting</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] 140</span></code></pre></div>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airbnb_data_selected</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">neighbourhood_cleansed</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html">adorn_pct_formatting</a></span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_totals.html">adorn_totals</a></span><span class="op">(</span><span class="st">"row"</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;             neighbourhood_cleansed   n percent</span>
<span class="co">#&gt;  Waterfront Communities-The Island 488   16.8%</span>
<span class="co">#&gt;                            Niagara 129    4.4%</span>
<span class="co">#&gt;                              Annex 102    3.5%</span>
<span class="co">#&gt;                              Total 719       -</span></code></pre></div>
</div>
<div id="explore-multiple-relationships-with-a-model" class="section level3" number="13.3.3">
<h3>
<span class="header-section-number">13.3.3</span> Explore multiple relationships with a model<a class="anchor" aria-label="anchor" href="#explore-multiple-relationships-with-a-model"><i class="fas fa-link"></i></a>
</h3>
<p>We will now run some models on our dataset. We will cover modeling in more detail in Chapter <a href="ijalm.html#ijalm">14</a>, but we can use models during EDA to help get a better sense of relationships that may exist between multiple variables in a dataset. For instance, we may like to see whether we can forecast whether someone is a super host, and the factors that go into explaining that. As the dependent variable is binary, this is a good opportunity to use logistic regression. We expect that better reviews will be associated with faster responses and higher reviews. Specifically, the model that we estimate is:</p>
<p><span class="math display">\[\mbox{Prob(Is super host} = 1) = \beta_0 + \beta_1 \mbox{Response time} + \beta_2 \mbox{Reviews} + \epsilon\]</span></p>
<p>We estimate the model using <code>glm</code> in the R language <span class="citation">(<a href="references-1.html#ref-citeR" role="doc-biblioref">R Core Team 2021</a>)</span>.</p>
<div class="sourceCode" id="cb453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logistic_reg_superhost_response_review</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">host_is_superhost</span> <span class="op">~</span> 
                                                <span class="va">host_response_time</span> <span class="op">+</span> 
                                                <span class="va">review_scores_rating</span>,
                                              data <span class="op">=</span> <span class="va">airbnb_data_selected</span>,
                                              family <span class="op">=</span> <span class="va">binomial</span>
                                              <span class="op">)</span></code></pre></div>
<p>We can have a quick look at the results using <code><a href="https://vincentarelbundock.github.io/modelsummary/reference/modelsummary.html">modelsummary()</a></code> from <code>modelsummary</code> <span class="citation">(<a href="references-1.html#ref-citemodelsummary" role="doc-biblioref">Arel-Bundock 2021a</a>)</span></p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/modelsummary/">modelsummary</a></span><span class="op">)</span>
<span class="fu"><a href="https://vincentarelbundock.github.io/modelsummary/reference/modelsummary.html">modelsummary</a></span><span class="op">(</span><span class="va">logistic_reg_superhost_response_review</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:center;">
−18.931
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(1.273)
</td>
</tr>
<tr>
<td style="text-align:left;">
host_response_timewithin a day
</td>
<td style="text-align:center;">
1.334
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.235)
</td>
</tr>
<tr>
<td style="text-align:left;">
host_response_timewithin a few hours
</td>
<td style="text-align:center;">
1.932
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.227)
</td>
</tr>
<tr>
<td style="text-align:left;">
host_response_timewithin an hour
</td>
<td style="text-align:center;">
2.213
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.219)
</td>
</tr>
<tr>
<td style="text-align:left;">
review_scores_rating
</td>
<td style="text-align:center;">
0.173
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.013)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
2911
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
3521.4
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
3551.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
−1755.698
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:center;">
75.649
</td>
</tr>
</tbody>
</table></div>
<!-- We might like to look at what our model predicts, compared with whether the person was actually a super host. We can do that in a variety of ways, but one way is to use `augment` from the `broom` package [@citebroom]. This will add the prediction and associated uncertainty to the data. For every row we will then have the probability that our model is estimating that they are a superhost. But ultimately, we need a binary forecast. There are a bunch of different options, but one is to just say that if the model estimates a probability of more than 0.5 then we bin it into a superhost, and other not. --><!-- ```{r, eval = TRUE, include = TRUE} --><!-- airbnb_data_filtered_logistic_fit_train <-  --><!--   augment(logistic_reg_superhost_response_review,  --><!--           data = airbnb_train |> select(host_is_superhost,  --><!--                                          host_is_superhost_binary, --><!--                                          host_response_time, --><!--                                          review_scores_rating --><!--                                          ), --><!--           type.predict = "response") |> # We use the "response" option here so that the function does the work of worrying about the exponential and log odds for us. Our result will be a probability. --><!--   select(-.hat, -.sigma, -.cooksd, -.std.resid) |>  --><!--   mutate(predict_host_is_superhost = if_else(.fitted > 0.5, 1, 0), # How do things change if we change the 0.5 cutoff? --><!--          host_is_superhost_binary = as.factor(host_is_superhost_binary), --><!--          predict_host_is_superhost_binary = as.factor(predict_host_is_superhost) --><!--          ) --><!-- ``` --><!-- We can look at how far off the model is. There are a bunch of ways of doing this, but one is to look at what probability the model has given each person. --><!-- ```{r, eval = TRUE, include = TRUE} --><!-- airbnb_data_filtered_logistic_fit_train |>  --><!--   ggplot(aes(x = .fitted, fill = host_is_superhost_binary)) + --><!--   geom_histogram(binwidth = 0.05, position = "dodge") + --><!--   theme_classic() + --><!--   labs(x = "Estimated probability that host is super host", --><!--        y = "Number", --><!--        fill = "Host is super host") + --><!--   scale_fill_brewer(palette = "Set1") --><!-- ``` --><!-- We can look at how the model probabilities change based on average review score, and their average time to respond. --><!-- ```{r, eval = TRUE, include = TRUE} --><!-- ggplot(airbnb_data_filtered_logistic_fit_train,  --><!--        aes(x = review_scores_rating,  --><!--            y = .fitted,  --><!--            color = host_response_time)) + --><!--   geom_line() + --><!--   geom_point() + --><!--   labs(x = "Average review score", --><!--        y = "Predicted probability of being a superhost", --><!--        color = "Host response time") + --><!--   theme_classic() + --><!--   scale_color_brewer(palette = "Set1") --><!-- ``` --><!-- This nice thing about this graph is that it illustrates nicely the effect of a host having an average response time of, say, 'within an hour' compared with 'within a few hours'.  --><!-- We can focus on how the model does in terms of raw classification using `confusionMatrix` from the caret package (Kuhn, 2020). This also gives a bunch of diagnostics (the help file explains what they are). In general, they suggest this isn't the best model that's ever existed. --><!-- ```{r, eval = TRUE, include = TRUE} --><!-- caret::confusionMatrix(data = airbnb_data_filtered_logistic_fit_train$predict_host_is_superhost_binary, --><!--                        reference = airbnb_data_filtered_logistic_fit_train$host_is_superhost_binary) --><!-- ``` --><!-- In any case, to this point we've been looking at how the model has done on the training set. It is also relevant how it does on the test set. Again, there are a bunch of ways to do this, but one is to again use the augment function, but to include a newdata argument. --><!-- ```{r, eval = TRUE, include = TRUE} --><!-- airbnb_data_filtered_logistic_fit_test <-  --><!--   augment(logistic_reg_superhost_response_review,  --><!--           data = airbnb_train |> select(host_is_superhost,  --><!--                                          host_is_superhost_binary, --><!--                                          host_response_time, --><!--                                          review_scores_rating --><!--                                          ), --><!--           newdata = airbnb_test |> select(host_is_superhost,  --><!--                                          host_is_superhost_binary, --><!--                                          host_response_time, --><!--                                          review_scores_rating --><!--                                          ), # I'm selecting just because the --><!--           # dataset is quite wide, and so this makes it easier to look at. --><!--           type.predict = "response") |>  --><!--   mutate(predict_host_is_superhost = if_else(.fitted > 0.5, 1, 0),  --><!--          host_is_superhost_binary = as.factor(host_is_superhost_binary), --><!--          predict_host_is_superhost_binary = as.factor(predict_host_is_superhost) --><!--          ) --><!-- ``` --><!-- We would expect the performance to be slightly worse on the test set. But it is actually fairly similar. --><!-- ```{r, eval = TRUE, include = TRUE} --><!-- caret::confusionMatrix(data = airbnb_data_filtered_logistic_fit_test$predict_host_is_superhost_binary, --><!--                        reference = airbnb_data_filtered_logistic_fit_test$host_is_superhost_binary) --><!-- ``` --><!-- We could compare the test with the training sets in terms of forecasts. --><!-- ```{r, eval = TRUE, include = TRUE} --><!-- training <- airbnb_data_filtered_logistic_fit_train |>  --><!--   select(host_is_superhost_binary, .fitted) |>  --><!--   mutate(type = "Training set") --><!-- test <- airbnb_data_filtered_logistic_fit_test |>  --><!--   select(host_is_superhost_binary, .fitted) |>  --><!--   mutate(type = "Test set") --><!-- both <- rbind(training, test) --><!-- rm(training, test) --><!-- both |>  --><!--   ggplot(aes(x = .fitted,  --><!--              fill = host_is_superhost_binary)) + --><!--   geom_histogram(binwidth = 0.05, position = "dodge") + --><!--   theme_minimal() + --><!--   labs(x = "Estimated probability that host is super host", --><!--        y = "Number", --><!--        fill = "Host is super host") + --><!--   scale_fill_brewer(palette = "Set1") + --><!--   facet_wrap(vars(type), --><!--              nrow = 2, --><!--              scales = "free_y") --><!-- ``` -->
</div>
</div>
<div id="exercises-and-tutorial-12" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> Exercises and tutorial<a class="anchor" aria-label="anchor" href="#exercises-and-tutorial-12"><i class="fas fa-link"></i></a>
</h2>
<div id="exercises-12" class="section level3" number="13.4.1">
<h3>
<span class="header-section-number">13.4.1</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-12"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>In your own words what is exploratory data analysis (this will be difficult, but please write only one nuanced paragraph)?</li>
<li>In Tukey’s words, what is exploratory data analysis (please write one paragraph)?</li>
<li>Who was Tukey (please write a paragraph or two)?</li>
<li>If you have a dataset called ‘my_data,’ which has two columns: ‘first_col’ and ‘second_col,’ then could you please write some rough R code that would generate a graph (the type of graph does not matter).</li>
<li>Consider a dataset that has 500 rows and 3 columns, so there are 1,500 cells. If 100 of the cells are missing data for at least one of the columns, then would you remove the whole row your dataset or try to run your analysis on the data as is, or some other procedure? What if your dataset had 10,000 rows instead, but the same number of missing cells?</li>
<li>Please note three ways of identifying unusual values.</li>
<li>What is the difference between a categorical and continuous variable?</li>
<li>What is the difference between a factor and an integer variable?</li>
<li>How can we think about who is systematically excluded from a dataset?</li>
<li>Using the <code>opendatatoronto</code> package, download the data on mayoral campaign contributions for 2014. (note: the 2014 file you will get from <code>get_resource</code>, so just keep the sheet that relates to the Mayor election).
<ol style="list-style-type: decimal">
<li>Clean up the data format (fixing the parsing issue and standardizing the column names using <code>janitor</code>)</li>
<li>Summarize the variables in the dataset. Are there missing values, and if so, should we be worried about them? Is every variable in the format it should be? If not, create new variable(s) that are in the right format.</li>
<li>Visually explore the distribution of values of the contributions. What contributions are notable outliers? Do they share a similar characteristic(s)? It may be useful to plot the distribution of contributions without these outliers to get a better sense of the majority of the data.</li>
<li>List the top five candidates in each of these categories: 1) total contributions; 2) mean contribution; and 3) number of contributions.</li>
<li>Repeat that process, but without contributions from the candidates themselves.</li>
<li>How many contributors gave money to more than one candidate?</li>
</ol>
</li>
<li>Name three geoms that produce graphs that have bars on them <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>.</li>
<li>Consider a dataset 10,000 observations and 27 variables. For each observation, there is at least one missing variable. Please discuss, in a paragraph or two, the steps that you would take to understand what is going on.</li>
<li>Known missing data, are those that leave holes in your dataset. But what about data that were never collected? Please look at <span class="citation"><a href="references-1.html#ref-mcclelland2019lock" role="doc-biblioref">McClelland</a> (<a href="references-1.html#ref-mcclelland2019lock" role="doc-biblioref">2019</a>)</span> and <span class="citation"><a href="references-1.html#ref-luscombe2020policing" role="doc-biblioref">Luscombe and McClelland</a> (<a href="references-1.html#ref-luscombe2020policing" role="doc-biblioref">2020</a>)</span>. Look into how they gathered their dataset and what it took to put this together. What is in the dataset and why? What is missing and why? How could this affect the results? How might similar biases enter into other datasets that you have used or read about?</li>
</ol>
</div>
<div id="tutorial-12" class="section level3" number="13.4.2">
<h3>
<span class="header-section-number">13.4.2</span> Tutorial<a class="anchor" aria-label="anchor" href="#tutorial-12"><i class="fas fa-link"></i></a>
</h3>
<p>Redo the Airbnb EDA but for Paris. Please submit a PDF.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="store-and-share.html"><span class="header-section-number">12</span> Store and share</a></div>
<div class="next"><a href="ijalm.html"><span class="header-section-number">14</span> It’s Just A Linear Model</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#exploratory-data-analysis"><span class="header-section-number">13</span> Exploratory data analysis</a></li>
<li><a class="nav-link" href="#introduction-10"><span class="header-section-number">13.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#case-study-ttc-subway-delays"><span class="header-section-number">13.2</span> Case study: TTC subway delays</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#checking-data"><span class="header-section-number">13.2.1</span> Checking data</a></li>
<li><a class="nav-link" href="#visualizing-data"><span class="header-section-number">13.2.2</span> Visualizing data</a></li>
<li><a class="nav-link" href="#groups-of-small-counts"><span class="header-section-number">13.2.3</span> Groups of small counts</a></li>
<li><a class="nav-link" href="#dates"><span class="header-section-number">13.2.4</span> Dates</a></li>
<li><a class="nav-link" href="#relationships"><span class="header-section-number">13.2.5</span> Relationships</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#case-study-airbnb-listing-in-toronto"><span class="header-section-number">13.3</span> Case study: Airbnb listing in Toronto</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#explore-individual-variables"><span class="header-section-number">13.3.1</span> Explore individual variables</a></li>
<li><a class="nav-link" href="#explore-relationships-between-variables"><span class="header-section-number">13.3.2</span> Explore relationships between variables</a></li>
<li><a class="nav-link" href="#explore-multiple-relationships-with-a-model"><span class="header-section-number">13.3.3</span> Explore multiple relationships with a model</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#exercises-and-tutorial-12"><span class="header-section-number">13.4</span> Exercises and tutorial</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#exercises-12"><span class="header-section-number">13.4.1</span> Exercises</a></li>
<li><a class="nav-link" href="#tutorial-12"><span class="header-section-number">13.4.2</span> Tutorial</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rstudio/bookdown-demo/blob/master/40-eda.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rstudio/bookdown-demo/edit/master/40-eda.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Telling Stories With Data</strong>" was written by Rohan Alexander. It was last built on 15 February, 2022.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
