<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Exploratory data analysis | Telling Stories With Data</title>
  <meta name="description" content="This book is about learning how to tell stories with data." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Exploratory data analysis | Telling Stories With Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is about learning how to tell stories with data." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Exploratory data analysis | Telling Stories With Data" />
  
  <meta name="twitter:description" content="This book is about learning how to tell stories with data." />
  

<meta name="author" content="Rohan Alexander" />


<meta name="date" content="2021-05-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="disseminating-and-protecting-data.html"/>
<link rel="next" href="its-just-a-linear-model.html"/>
<script src="libs/header-attrs-2.7.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/mapdeck-binding-0.3.4/mapdeck.js"></script>
<script src="libs/mpadeck_functions-0.0.1/mapdeck_functions.js"></script>
<script src="libs/deckgl-8.1.6/deckgl.min.js"></script>
<script src="libs/legend-0.0.1/legend.js"></script>
<script src="libs/title-0.0.1/title.js"></script>
<script src="libs/mapdeck_location-0.0.1/mapdeck_location.js"></script>
<script src="libs/mapdeck_colours-0.0.1/mapdeck_colours.js"></script>
<script src="libs/mapdeck_coordinates-0.0.1/mapdeck_coordinates.js"></script>
<link href="libs/mapboxgl-1.10.0/mapbox-gl.css" rel="stylesheet" />
<script src="libs/mapboxgl-1.10.0/mapbox-gl.js"></script>
<link href="libs/mapdeck-0.0.1/mapdeck.css" rel="stylesheet" />
<script src="libs/mpadeck-binding-0.3.4/mapdeck.js"></script>
<script src="libs/arc-1.0.0/arc.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Telling Stories With Data</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Essentials</b></span></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#welcome"><i class="fa fa-check"></i><b>1.1</b> Welcome</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#structure"><i class="fa fa-check"></i><b>1.2</b> Structure</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#on-telling-stories"><i class="fa fa-check"></i><b>1.3</b> On telling stories</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#telling-stories-with-data"><i class="fa fa-check"></i><b>1.4</b> Telling stories with data</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i><b>1.4.1</b> Software</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#assumed-background"><i class="fa fa-check"></i><b>1.4.2</b> Assumed background</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#structure-1"><i class="fa fa-check"></i><b>1.4.3</b> Structure</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.6</b> Contact</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html"><i class="fa fa-check"></i><b>2</b> Drinking from a fire hose</a>
<ul>
<li class="chapter" data-level="2.1" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#hello-world"><i class="fa fa-check"></i><b>2.1</b> Hello world</a></li>
<li class="chapter" data-level="2.2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#case-study---canadian-elections"><i class="fa fa-check"></i><b>2.2</b> Case study - Canadian elections</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#getting-started"><i class="fa fa-check"></i><b>2.2.1</b> Getting started</a></li>
<li class="chapter" data-level="2.2.2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#get-the-data"><i class="fa fa-check"></i><b>2.2.2</b> Get the data</a></li>
<li class="chapter" data-level="2.2.3" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#clean-the-data"><i class="fa fa-check"></i><b>2.2.3</b> Clean the data</a></li>
<li class="chapter" data-level="2.2.4" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#make-a-graph"><i class="fa fa-check"></i><b>2.2.4</b> Make a graph</a></li>
<li class="chapter" data-level="2.2.5" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#make-a-table"><i class="fa fa-check"></i><b>2.2.5</b> Make a table</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#case-study---toronto-homelessness"><i class="fa fa-check"></i><b>2.3</b> Case study - Toronto homelessness</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#getting-started-1"><i class="fa fa-check"></i><b>2.3.1</b> Getting started</a></li>
<li class="chapter" data-level="2.3.2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#get-the-data-1"><i class="fa fa-check"></i><b>2.3.2</b> Get the data</a></li>
<li class="chapter" data-level="2.3.3" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#make-a-graph-1"><i class="fa fa-check"></i><b>2.3.3</b> Make a graph</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-essentials.html"><a href="r-essentials.html"><i class="fa fa-check"></i><b>3</b> R Essentials</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-essentials.html"><a href="r-essentials.html#r-essentials-1"><i class="fa fa-check"></i><b>3.1</b> R essentials</a></li>
<li class="chapter" data-level="3.2" data-path="r-essentials.html"><a href="r-essentials.html#social-impact"><i class="fa fa-check"></i><b>3.2</b> Social impact</a></li>
<li class="chapter" data-level="3.3" data-path="r-essentials.html"><a href="r-essentials.html#r-r-studio-and-r-studio-cloud"><i class="fa fa-check"></i><b>3.3</b> R, R Studio, and R Studio Cloud</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r-essentials.html"><a href="r-essentials.html#r"><i class="fa fa-check"></i><b>3.3.1</b> R</a></li>
<li class="chapter" data-level="3.3.2" data-path="r-essentials.html"><a href="r-essentials.html#r-studio"><i class="fa fa-check"></i><b>3.3.2</b> R Studio</a></li>
<li class="chapter" data-level="3.3.3" data-path="r-essentials.html"><a href="r-essentials.html#r-studio-cloud"><i class="fa fa-check"></i><b>3.3.3</b> R Studio Cloud</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="r-essentials.html"><a href="r-essentials.html#tidyverse-i"><i class="fa fa-check"></i><b>3.4</b> Tidyverse I</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="r-essentials.html"><a href="r-essentials.html#the-pipe"><i class="fa fa-check"></i><b>3.4.1</b> The pipe</a></li>
<li class="chapter" data-level="3.4.2" data-path="r-essentials.html"><a href="r-essentials.html#selecting"><i class="fa fa-check"></i><b>3.4.2</b> Selecting</a></li>
<li class="chapter" data-level="3.4.3" data-path="r-essentials.html"><a href="r-essentials.html#filtering"><i class="fa fa-check"></i><b>3.4.3</b> Filtering</a></li>
<li class="chapter" data-level="3.4.4" data-path="r-essentials.html"><a href="r-essentials.html#arranging"><i class="fa fa-check"></i><b>3.4.4</b> Arranging</a></li>
<li class="chapter" data-level="3.4.5" data-path="r-essentials.html"><a href="r-essentials.html#grouping"><i class="fa fa-check"></i><b>3.4.5</b> Grouping</a></li>
<li class="chapter" data-level="3.4.6" data-path="r-essentials.html"><a href="r-essentials.html#mutating"><i class="fa fa-check"></i><b>3.4.6</b> Mutating</a></li>
<li class="chapter" data-level="3.4.7" data-path="r-essentials.html"><a href="r-essentials.html#summarise"><i class="fa fa-check"></i><b>3.4.7</b> Summarise</a></li>
<li class="chapter" data-level="3.4.8" data-path="r-essentials.html"><a href="r-essentials.html#counting"><i class="fa fa-check"></i><b>3.4.8</b> Counting</a></li>
<li class="chapter" data-level="3.4.9" data-path="r-essentials.html"><a href="r-essentials.html#proportions"><i class="fa fa-check"></i><b>3.4.9</b> Proportions</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="r-essentials.html"><a href="r-essentials.html#base"><i class="fa fa-check"></i><b>3.5</b> Base</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="r-essentials.html"><a href="r-essentials.html#class"><i class="fa fa-check"></i><b>3.5.1</b> Class</a></li>
<li class="chapter" data-level="3.5.2" data-path="r-essentials.html"><a href="r-essentials.html#simulating-data"><i class="fa fa-check"></i><b>3.5.2</b> Simulating data</a></li>
<li class="chapter" data-level="3.5.3" data-path="r-essentials.html"><a href="r-essentials.html#functions"><i class="fa fa-check"></i><b>3.5.3</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="r-essentials.html"><a href="r-essentials.html#ggplot"><i class="fa fa-check"></i><b>3.6</b> ggplot</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="r-essentials.html"><a href="r-essentials.html#main-features"><i class="fa fa-check"></i><b>3.6.1</b> Main features</a></li>
<li class="chapter" data-level="3.6.2" data-path="r-essentials.html"><a href="r-essentials.html#facets"><i class="fa fa-check"></i><b>3.6.2</b> Facets</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="r-essentials.html"><a href="r-essentials.html#tidyverse-ii"><i class="fa fa-check"></i><b>3.7</b> Tidyverse II</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="r-essentials.html"><a href="r-essentials.html#tibbles"><i class="fa fa-check"></i><b>3.7.1</b> Tibbles</a></li>
<li class="chapter" data-level="3.7.2" data-path="r-essentials.html"><a href="r-essentials.html#importing-data"><i class="fa fa-check"></i><b>3.7.2</b> Importing data</a></li>
<li class="chapter" data-level="3.7.3" data-path="r-essentials.html"><a href="r-essentials.html#joining-data"><i class="fa fa-check"></i><b>3.7.3</b> Joining data</a></li>
<li class="chapter" data-level="3.7.4" data-path="r-essentials.html"><a href="r-essentials.html#strings"><i class="fa fa-check"></i><b>3.7.4</b> Strings</a></li>
<li class="chapter" data-level="3.7.5" data-path="r-essentials.html"><a href="r-essentials.html#pivot"><i class="fa fa-check"></i><b>3.7.5</b> Pivot</a></li>
<li class="chapter" data-level="3.7.6" data-path="r-essentials.html"><a href="r-essentials.html#factors"><i class="fa fa-check"></i><b>3.7.6</b> Factors</a></li>
<li class="chapter" data-level="3.7.7" data-path="r-essentials.html"><a href="r-essentials.html#cases"><i class="fa fa-check"></i><b>3.7.7</b> Cases</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>4</b> Workflow</a>
<ul>
<li class="chapter" data-level="4.1" data-path="workflow.html"><a href="workflow.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="workflow.html"><a href="workflow.html#r-markdown"><i class="fa fa-check"></i><b>4.2</b> R Markdown</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="workflow.html"><a href="workflow.html#getting-started-2"><i class="fa fa-check"></i><b>4.2.1</b> Getting started</a></li>
<li class="chapter" data-level="4.2.2" data-path="workflow.html"><a href="workflow.html#basic-commands"><i class="fa fa-check"></i><b>4.2.2</b> Basic commands</a></li>
<li class="chapter" data-level="4.2.3" data-path="workflow.html"><a href="workflow.html#r-chunks"><i class="fa fa-check"></i><b>4.2.3</b> R chunks</a></li>
<li class="chapter" data-level="4.2.4" data-path="workflow.html"><a href="workflow.html#abstracts-and-pdf-outputs"><i class="fa fa-check"></i><b>4.2.4</b> Abstracts and PDF outputs</a></li>
<li class="chapter" data-level="4.2.5" data-path="workflow.html"><a href="workflow.html#references"><i class="fa fa-check"></i><b>4.2.5</b> References</a></li>
<li class="chapter" data-level="4.2.6" data-path="workflow.html"><a href="workflow.html#cross-references"><i class="fa fa-check"></i><b>4.2.6</b> Cross-references</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="workflow.html"><a href="workflow.html#r-projects"><i class="fa fa-check"></i><b>4.3</b> R projects</a></li>
<li class="chapter" data-level="4.4" data-path="workflow.html"><a href="workflow.html#git-and-github"><i class="fa fa-check"></i><b>4.4</b> Git and GitHub</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="workflow.html"><a href="workflow.html#introduction-2"><i class="fa fa-check"></i><b>4.4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.4.2" data-path="workflow.html"><a href="workflow.html#git"><i class="fa fa-check"></i><b>4.4.2</b> Git</a></li>
<li class="chapter" data-level="4.4.3" data-path="workflow.html"><a href="workflow.html#github"><i class="fa fa-check"></i><b>4.4.3</b> GitHub</a></li>
<li class="chapter" data-level="4.4.4" data-path="workflow.html"><a href="workflow.html#using-git-within-rstudio"><i class="fa fa-check"></i><b>4.4.4</b> Using Git within RStudio</a></li>
<li class="chapter" data-level="4.4.5" data-path="workflow.html"><a href="workflow.html#next-steps"><i class="fa fa-check"></i><b>4.4.5</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="workflow.html"><a href="workflow.html#using-r-in-practice"><i class="fa fa-check"></i><b>4.5</b> Using R in practice</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="workflow.html"><a href="workflow.html#introduction-3"><i class="fa fa-check"></i><b>4.5.1</b> Introduction</a></li>
<li class="chapter" data-level="4.5.2" data-path="workflow.html"><a href="workflow.html#getting-help"><i class="fa fa-check"></i><b>4.5.2</b> Getting help</a></li>
<li class="chapter" data-level="4.5.3" data-path="workflow.html"><a href="workflow.html#mentality"><i class="fa fa-check"></i><b>4.5.3</b> Mentality</a></li>
<li class="chapter" data-level="4.5.4" data-path="workflow.html"><a href="workflow.html#code-comments"><i class="fa fa-check"></i><b>4.5.4</b> Code comments</a></li>
<li class="chapter" data-level="4.5.5" data-path="workflow.html"><a href="workflow.html#learning-more"><i class="fa fa-check"></i><b>4.5.5</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="workflow.html"><a href="workflow.html#developing-research-questions"><i class="fa fa-check"></i><b>4.6</b> Developing research questions</a></li>
</ul></li>
<li class="part"><span><b>II Communicate</b></span></li>
<li class="chapter" data-level="5" data-path="static-communication.html"><a href="static-communication.html"><i class="fa fa-check"></i><b>5</b> Static communication</a>
<ul>
<li class="chapter" data-level="5.1" data-path="static-communication.html"><a href="static-communication.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="static-communication.html"><a href="static-communication.html#graphs"><i class="fa fa-check"></i><b>5.2</b> Graphs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="static-communication.html"><a href="static-communication.html#bar-chart"><i class="fa fa-check"></i><b>5.2.1</b> Bar chart</a></li>
<li class="chapter" data-level="5.2.2" data-path="static-communication.html"><a href="static-communication.html#scatter-plot"><i class="fa fa-check"></i><b>5.2.2</b> Scatter plot</a></li>
<li class="chapter" data-level="5.2.3" data-path="static-communication.html"><a href="static-communication.html#never-use-box-plots"><i class="fa fa-check"></i><b>5.2.3</b> Never use box plots</a></li>
<li class="chapter" data-level="5.2.4" data-path="static-communication.html"><a href="static-communication.html#other"><i class="fa fa-check"></i><b>5.2.4</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="static-communication.html"><a href="static-communication.html#tables"><i class="fa fa-check"></i><b>5.3</b> Tables</a></li>
<li class="chapter" data-level="5.4" data-path="static-communication.html"><a href="static-communication.html#maps"><i class="fa fa-check"></i><b>5.4</b> Maps</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="static-communication.html"><a href="static-communication.html#australian-polling-places"><i class="fa fa-check"></i><b>5.4.1</b> Australian polling places</a></li>
<li class="chapter" data-level="5.4.2" data-path="static-communication.html"><a href="static-communication.html#toronto-bike-parking"><i class="fa fa-check"></i><b>5.4.2</b> Toronto bike parking</a></li>
<li class="chapter" data-level="5.4.3" data-path="static-communication.html"><a href="static-communication.html#geocoding"><i class="fa fa-check"></i><b>5.4.3</b> Geocoding</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="static-communication.html"><a href="static-communication.html#writing"><i class="fa fa-check"></i><b>5.5</b> Writing</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="static-communication.html"><a href="static-communication.html#title-abstract-and-introduction"><i class="fa fa-check"></i><b>5.5.1</b> Title, abstract, and introduction</a></li>
<li class="chapter" data-level="5.5.2" data-path="static-communication.html"><a href="static-communication.html#figures-tables-equations-and-technical-terms"><i class="fa fa-check"></i><b>5.5.2</b> Figures, tables, equations, and technical terms</a></li>
<li class="chapter" data-level="5.5.3" data-path="static-communication.html"><a href="static-communication.html#on-brevity"><i class="fa fa-check"></i><b>5.5.3</b> On brevity</a></li>
<li class="chapter" data-level="5.5.4" data-path="static-communication.html"><a href="static-communication.html#other-1"><i class="fa fa-check"></i><b>5.5.4</b> Other</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-communication.html"><a href="interactive-communication.html"><i class="fa fa-check"></i><b>6</b> Interactive communication</a>
<ul>
<li class="chapter" data-level="6.1" data-path="interactive-communication.html"><a href="interactive-communication.html#making-a-website"><i class="fa fa-check"></i><b>6.1</b> Making a website</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="interactive-communication.html"><a href="interactive-communication.html#introduction-5"><i class="fa fa-check"></i><b>6.1.1</b> Introduction</a></li>
<li class="chapter" data-level="6.1.2" data-path="interactive-communication.html"><a href="interactive-communication.html#postcards"><i class="fa fa-check"></i><b>6.1.2</b> Postcards</a></li>
<li class="chapter" data-level="6.1.3" data-path="interactive-communication.html"><a href="interactive-communication.html#distill"><i class="fa fa-check"></i><b>6.1.3</b> Distill</a></li>
<li class="chapter" data-level="6.1.4" data-path="interactive-communication.html"><a href="interactive-communication.html#blogdown"><i class="fa fa-check"></i><b>6.1.4</b> Blogdown</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="interactive-communication.html"><a href="interactive-communication.html#interactive-maps"><i class="fa fa-check"></i><b>6.2</b> Interactive maps</a></li>
<li class="chapter" data-level="6.3" data-path="interactive-communication.html"><a href="interactive-communication.html#shiny"><i class="fa fa-check"></i><b>6.3</b> Shiny</a></li>
</ul></li>
<li class="part"><span><b>III Hunt gather and farm</b></span></li>
<li class="chapter" data-level="7" data-path="gather-data.html"><a href="gather-data.html"><i class="fa fa-check"></i><b>7</b> Gather data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="gather-data.html"><a href="gather-data.html#apis"><i class="fa fa-check"></i><b>7.1</b> APIs</a></li>
<li class="chapter" data-level="7.2" data-path="gather-data.html"><a href="gather-data.html#case-study---arxiv"><i class="fa fa-check"></i><b>7.2</b> Case study - arXiv</a></li>
<li class="chapter" data-level="7.3" data-path="gather-data.html"><a href="gather-data.html#case-study---rtweet"><i class="fa fa-check"></i><b>7.3</b> Case study - rtweet</a></li>
<li class="chapter" data-level="7.4" data-path="gather-data.html"><a href="gather-data.html#case-study---spotifyr"><i class="fa fa-check"></i><b>7.4</b> Case study - spotifyr</a></li>
<li class="chapter" data-level="7.5" data-path="gather-data.html"><a href="gather-data.html#scraping"><i class="fa fa-check"></i><b>7.5</b> Scraping</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="gather-data.html"><a href="gather-data.html#introduction-6"><i class="fa fa-check"></i><b>7.5.1</b> Introduction</a></li>
<li class="chapter" data-level="7.5.2" data-path="gather-data.html"><a href="gather-data.html#getting-started-3"><i class="fa fa-check"></i><b>7.5.2</b> Getting started</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="gather-data.html"><a href="gather-data.html#case-study---rohans-books"><i class="fa fa-check"></i><b>7.6</b> Case study - Rohan’s books</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="gather-data.html"><a href="gather-data.html#introduction-7"><i class="fa fa-check"></i><b>7.6.1</b> Introduction</a></li>
<li class="chapter" data-level="7.6.2" data-path="gather-data.html"><a href="gather-data.html#gather"><i class="fa fa-check"></i><b>7.6.2</b> Gather</a></li>
<li class="chapter" data-level="7.6.3" data-path="gather-data.html"><a href="gather-data.html#clean"><i class="fa fa-check"></i><b>7.6.3</b> Clean</a></li>
<li class="chapter" data-level="7.6.4" data-path="gather-data.html"><a href="gather-data.html#explore"><i class="fa fa-check"></i><b>7.6.4</b> Explore</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="gather-data.html"><a href="gather-data.html#case-study---canadian-prime-ministers"><i class="fa fa-check"></i><b>7.7</b> Case study - Canadian Prime Ministers</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="gather-data.html"><a href="gather-data.html#introduction-8"><i class="fa fa-check"></i><b>7.7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.7.2" data-path="gather-data.html"><a href="gather-data.html#gather-1"><i class="fa fa-check"></i><b>7.7.2</b> Gather</a></li>
<li class="chapter" data-level="7.7.3" data-path="gather-data.html"><a href="gather-data.html#clean-1"><i class="fa fa-check"></i><b>7.7.3</b> Clean</a></li>
<li class="chapter" data-level="7.7.4" data-path="gather-data.html"><a href="gather-data.html#explore-1"><i class="fa fa-check"></i><b>7.7.4</b> Explore</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="gather-data.html"><a href="gather-data.html#pdfs"><i class="fa fa-check"></i><b>7.8</b> PDFs</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="gather-data.html"><a href="gather-data.html#introduction-9"><i class="fa fa-check"></i><b>7.8.1</b> Introduction</a></li>
<li class="chapter" data-level="7.8.2" data-path="gather-data.html"><a href="gather-data.html#getting-started-4"><i class="fa fa-check"></i><b>7.8.2</b> Getting started</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="gather-data.html"><a href="gather-data.html#case-study-us-total-fertility-rate-by-state-and-year-2000-2018"><i class="fa fa-check"></i><b>7.9</b> Case-study: US Total Fertility Rate, by state and year (2000-2018)</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="gather-data.html"><a href="gather-data.html#introduction-10"><i class="fa fa-check"></i><b>7.9.1</b> Introduction</a></li>
<li class="chapter" data-level="7.9.2" data-path="gather-data.html"><a href="gather-data.html#begin-with-an-end-in-mind"><i class="fa fa-check"></i><b>7.9.2</b> Begin with an end in mind</a></li>
<li class="chapter" data-level="7.9.3" data-path="gather-data.html"><a href="gather-data.html#start-simple-then-iterate."><i class="fa fa-check"></i><b>7.9.3</b> Start simple, then iterate.</a></li>
<li class="chapter" data-level="7.9.4" data-path="gather-data.html"><a href="gather-data.html#iterating"><i class="fa fa-check"></i><b>7.9.4</b> Iterating</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="gather-data.html"><a href="gather-data.html#case-study-kenyan-census-data"><i class="fa fa-check"></i><b>7.10</b> Case-study: Kenyan census data</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="gather-data.html"><a href="gather-data.html#set-up"><i class="fa fa-check"></i><b>7.10.1</b> Set-up</a></li>
<li class="chapter" data-level="7.10.2" data-path="gather-data.html"><a href="gather-data.html#extract"><i class="fa fa-check"></i><b>7.10.2</b> Extract</a></li>
<li class="chapter" data-level="7.10.3" data-path="gather-data.html"><a href="gather-data.html#clean-2"><i class="fa fa-check"></i><b>7.10.3</b> Clean</a></li>
<li class="chapter" data-level="7.10.4" data-path="gather-data.html"><a href="gather-data.html#check"><i class="fa fa-check"></i><b>7.10.4</b> Check</a></li>
<li class="chapter" data-level="7.10.5" data-path="gather-data.html"><a href="gather-data.html#tidy-up"><i class="fa fa-check"></i><b>7.10.5</b> Tidy-up</a></li>
<li class="chapter" data-level="7.10.6" data-path="gather-data.html"><a href="gather-data.html#make-monicas-dataset"><i class="fa fa-check"></i><b>7.10.6</b> Make Monica’s dataset</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="gather-data.html"><a href="gather-data.html#optical-character-recognition"><i class="fa fa-check"></i><b>7.11</b> Optical Character Recognition</a></li>
<li class="chapter" data-level="7.12" data-path="gather-data.html"><a href="gather-data.html#text"><i class="fa fa-check"></i><b>7.12</b> Text</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="gather-data.html"><a href="gather-data.html#introduction-11"><i class="fa fa-check"></i><b>7.12.1</b> Introduction</a></li>
<li class="chapter" data-level="7.12.2" data-path="gather-data.html"><a href="gather-data.html#getting-text-data"><i class="fa fa-check"></i><b>7.12.2</b> Getting text data</a></li>
<li class="chapter" data-level="7.12.3" data-path="gather-data.html"><a href="gather-data.html#preparing-text-datasets"><i class="fa fa-check"></i><b>7.12.3</b> Preparing text datasets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="hunt-data.html"><a href="hunt-data.html"><i class="fa fa-check"></i><b>8</b> Hunt data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="hunt-data.html"><a href="hunt-data.html#experiments-and-randomised-controlled-trials"><i class="fa fa-check"></i><b>8.1</b> Experiments and randomised controlled trials</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="hunt-data.html"><a href="hunt-data.html#introduction-12"><i class="fa fa-check"></i><b>8.1.1</b> Introduction</a></li>
<li class="chapter" data-level="8.1.2" data-path="hunt-data.html"><a href="hunt-data.html#motivation-and-notation"><i class="fa fa-check"></i><b>8.1.2</b> Motivation and notation</a></li>
<li class="chapter" data-level="8.1.3" data-path="hunt-data.html"><a href="hunt-data.html#randomised-sampling"><i class="fa fa-check"></i><b>8.1.3</b> Randomised sampling</a></li>
<li class="chapter" data-level="8.1.4" data-path="hunt-data.html"><a href="hunt-data.html#anova"><i class="fa fa-check"></i><b>8.1.4</b> ANOVA</a></li>
<li class="chapter" data-level="8.1.5" data-path="hunt-data.html"><a href="hunt-data.html#treatment-and-control"><i class="fa fa-check"></i><b>8.1.5</b> Treatment and control</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="hunt-data.html"><a href="hunt-data.html#case-study---fishers-tea-party"><i class="fa fa-check"></i><b>8.2</b> Case study - Fisher’s tea party</a></li>
<li class="chapter" data-level="8.3" data-path="hunt-data.html"><a href="hunt-data.html#case-study---tuskegee-syphilis-study"><i class="fa fa-check"></i><b>8.3</b> Case study - Tuskegee Syphilis Study</a></li>
<li class="chapter" data-level="8.4" data-path="hunt-data.html"><a href="hunt-data.html#case-study---the-oregon-health-insurance-experiment"><i class="fa fa-check"></i><b>8.4</b> Case study - The Oregon Health Insurance Experiment</a></li>
<li class="chapter" data-level="8.5" data-path="hunt-data.html"><a href="hunt-data.html#case-study---student-coaching-how-far-can-technology-go"><i class="fa fa-check"></i><b>8.5</b> Case study - Student Coaching: How Far Can Technology Go?</a></li>
<li class="chapter" data-level="8.6" data-path="hunt-data.html"><a href="hunt-data.html#case-study---civic-honesty-around-the-globe"><i class="fa fa-check"></i><b>8.6</b> Case study - Civic Honesty Around The Globe</a></li>
<li class="chapter" data-level="8.7" data-path="hunt-data.html"><a href="hunt-data.html#ab-testing"><i class="fa fa-check"></i><b>8.7</b> A/B testing</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="hunt-data.html"><a href="hunt-data.html#introduction-13"><i class="fa fa-check"></i><b>8.7.1</b> Introduction</a></li>
<li class="chapter" data-level="8.7.2" data-path="hunt-data.html"><a href="hunt-data.html#delivery"><i class="fa fa-check"></i><b>8.7.2</b> Delivery</a></li>
<li class="chapter" data-level="8.7.3" data-path="hunt-data.html"><a href="hunt-data.html#instrumentation"><i class="fa fa-check"></i><b>8.7.3</b> Instrumentation</a></li>
<li class="chapter" data-level="8.7.4" data-path="hunt-data.html"><a href="hunt-data.html#randomisation-unit"><i class="fa fa-check"></i><b>8.7.4</b> Randomisation unit</a></li>
<li class="chapter" data-level="8.7.5" data-path="hunt-data.html"><a href="hunt-data.html#partnerships"><i class="fa fa-check"></i><b>8.7.5</b> Partnerships</a></li>
<li class="chapter" data-level="8.7.6" data-path="hunt-data.html"><a href="hunt-data.html#speed-vs-quality"><i class="fa fa-check"></i><b>8.7.6</b> Speed vs quality</a></li>
<li class="chapter" data-level="8.7.7" data-path="hunt-data.html"><a href="hunt-data.html#conflicting-priorities"><i class="fa fa-check"></i><b>8.7.7</b> Conflicting priorities</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="hunt-data.html"><a href="hunt-data.html#case-study---upworthy"><i class="fa fa-check"></i><b>8.8</b> Case study - Upworthy</a></li>
<li class="chapter" data-level="8.9" data-path="hunt-data.html"><a href="hunt-data.html#sampling-and-survey-essentials"><i class="fa fa-check"></i><b>8.9</b> Sampling and survey essentials</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="hunt-data.html"><a href="hunt-data.html#introduction-14"><i class="fa fa-check"></i><b>8.9.1</b> Introduction</a></li>
<li class="chapter" data-level="8.9.2" data-path="hunt-data.html"><a href="hunt-data.html#simple-random-sampling"><i class="fa fa-check"></i><b>8.9.2</b> Simple random sampling</a></li>
<li class="chapter" data-level="8.9.3" data-path="hunt-data.html"><a href="hunt-data.html#stratified-and-cluster-sampling"><i class="fa fa-check"></i><b>8.9.3</b> Stratified and cluster sampling</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="hunt-data.html"><a href="hunt-data.html#implementing-surveys"><i class="fa fa-check"></i><b>8.10</b> Implementing surveys</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="hunt-data.html"><a href="hunt-data.html#google"><i class="fa fa-check"></i><b>8.10.1</b> Google</a></li>
<li class="chapter" data-level="8.10.2" data-path="hunt-data.html"><a href="hunt-data.html#facebook"><i class="fa fa-check"></i><b>8.10.2</b> Facebook</a></li>
<li class="chapter" data-level="8.10.3" data-path="hunt-data.html"><a href="hunt-data.html#survey-monkey"><i class="fa fa-check"></i><b>8.10.3</b> Survey Monkey</a></li>
<li class="chapter" data-level="8.10.4" data-path="hunt-data.html"><a href="hunt-data.html#mechanical-turk"><i class="fa fa-check"></i><b>8.10.4</b> Mechanical Turk</a></li>
<li class="chapter" data-level="8.10.5" data-path="hunt-data.html"><a href="hunt-data.html#prolific"><i class="fa fa-check"></i><b>8.10.5</b> Prolific</a></li>
<li class="chapter" data-level="8.10.6" data-path="hunt-data.html"><a href="hunt-data.html#qualtrics"><i class="fa fa-check"></i><b>8.10.6</b> Qualtrics</a></li>
<li class="chapter" data-level="8.10.7" data-path="hunt-data.html"><a href="hunt-data.html#other-2"><i class="fa fa-check"></i><b>8.10.7</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="hunt-data.html"><a href="hunt-data.html#next-steps-1"><i class="fa fa-check"></i><b>8.11</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="farm-data.html"><a href="farm-data.html"><i class="fa fa-check"></i><b>9</b> Farm data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="farm-data.html"><a href="farm-data.html#open-government-data"><i class="fa fa-check"></i><b>9.1</b> Open Government Data</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="farm-data.html"><a href="farm-data.html#canadian-census"><i class="fa fa-check"></i><b>9.1.1</b> Canadian Census</a></li>
<li class="chapter" data-level="9.1.2" data-path="farm-data.html"><a href="farm-data.html#city-of-toronto-open-data-portal"><i class="fa fa-check"></i><b>9.1.2</b> City of Toronto Open Data Portal</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="farm-data.html"><a href="farm-data.html#electoral-studies"><i class="fa fa-check"></i><b>9.2</b> Electoral Studies</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="farm-data.html"><a href="farm-data.html#canadian-electoral-study"><i class="fa fa-check"></i><b>9.2.1</b> Canadian Electoral Study</a></li>
<li class="chapter" data-level="9.2.2" data-path="farm-data.html"><a href="farm-data.html#australian-electoral-study"><i class="fa fa-check"></i><b>9.2.2</b> Australian Electoral Study</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Clean</b></span></li>
<li class="chapter" data-level="10" data-path="cleaning-and-preparing-data.html"><a href="cleaning-and-preparing-data.html"><i class="fa fa-check"></i><b>10</b> Cleaning and preparing data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="cleaning-and-preparing-data.html"><a href="cleaning-and-preparing-data.html#introduction-15"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="cleaning-and-preparing-data.html"><a href="cleaning-and-preparing-data.html#checks-and-tests"><i class="fa fa-check"></i><b>10.2</b> Checks and tests</a></li>
<li class="chapter" data-level="10.3" data-path="cleaning-and-preparing-data.html"><a href="cleaning-and-preparing-data.html#documentation"><i class="fa fa-check"></i><b>10.3</b> Documentation</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="storing-and-retrieving-data.html"><a href="storing-and-retrieving-data.html"><i class="fa fa-check"></i><b>11</b> Storing and retrieving data</a></li>
<li class="chapter" data-level="12" data-path="disseminating-and-protecting-data.html"><a href="disseminating-and-protecting-data.html"><i class="fa fa-check"></i><b>12</b> Disseminating and protecting data</a></li>
<li class="part"><span><b>V Model</b></span></li>
<li class="chapter" data-level="13" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>13</b> Exploratory data analysis</a>
<ul>
<li class="chapter" data-level="13.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-16"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#case-study---ttc-subway-delays"><i class="fa fa-check"></i><b>13.2</b> Case study - TTC subway delays</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-17"><i class="fa fa-check"></i><b>13.2.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#gather-the-data"><i class="fa fa-check"></i><b>13.2.2</b> Gather the data</a></li>
<li class="chapter" data-level="13.2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#sanity-checks"><i class="fa fa-check"></i><b>13.2.3</b> Sanity Checks</a></li>
<li class="chapter" data-level="13.2.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-values"><i class="fa fa-check"></i><b>13.2.4</b> Missing values</a></li>
<li class="chapter" data-level="13.2.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#duplicate-rows"><i class="fa fa-check"></i><b>13.2.5</b> Duplicate rows</a></li>
<li class="chapter" data-level="13.2.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-distributions"><i class="fa fa-check"></i><b>13.2.6</b> Visualizing distributions</a></li>
<li class="chapter" data-level="13.2.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#groups-and-small-counts"><i class="fa fa-check"></i><b>13.2.7</b> Groups and small counts</a></li>
<li class="chapter" data-level="13.2.8" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-time-series"><i class="fa fa-check"></i><b>13.2.8</b> Visualizing time series</a></li>
<li class="chapter" data-level="13.2.9" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-relationships"><i class="fa fa-check"></i><b>13.2.9</b> Visualizing relationships</a></li>
<li class="chapter" data-level="13.2.10" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#principal-components-analysis"><i class="fa fa-check"></i><b>13.2.10</b> Principal components analysis</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#case-study---opinions-about-a-casino-in-toronto"><i class="fa fa-check"></i><b>13.3</b> Case study - Opinions about a casino in Toronto</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-preparation"><i class="fa fa-check"></i><b>13.3.1</b> Data preparation</a></li>
<li class="chapter" data-level="13.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#some-visual-exploration-and-more-cleanup-of-course"><i class="fa fa-check"></i><b>13.3.2</b> Some visual exploration (and more cleanup, of course)</a></li>
<li class="chapter" data-level="13.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#getting-the-data-into-a-more-model-suitable-format"><i class="fa fa-check"></i><b>13.3.3</b> Getting the data into a more model-suitable format</a></li>
<li class="chapter" data-level="13.3.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#logistic-regression"><i class="fa fa-check"></i><b>13.3.4</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#case-study---airbnb-listing-in-toronto"><i class="fa fa-check"></i><b>13.4</b> Case study - Airbnb listing in Toronto</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#essentials"><i class="fa fa-check"></i><b>13.4.1</b> Essentials</a></li>
<li class="chapter" data-level="13.4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#set-up-1"><i class="fa fa-check"></i><b>13.4.2</b> Set up</a></li>
<li class="chapter" data-level="13.4.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#get-data"><i class="fa fa-check"></i><b>13.4.3</b> Get data</a></li>
<li class="chapter" data-level="13.4.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#clean-data-1"><i class="fa fa-check"></i><b>13.4.4</b> Clean data</a></li>
<li class="chapter" data-level="13.4.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#explore-data"><i class="fa fa-check"></i><b>13.4.5</b> Explore data</a></li>
<li class="chapter" data-level="13.4.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#model-data"><i class="fa fa-check"></i><b>13.4.6</b> Model data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html"><i class="fa fa-check"></i><b>14</b> It’s Just A Linear Model</a>
<ul>
<li class="chapter" data-level="14.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview"><i class="fa fa-check"></i><b>14.1</b> Overview</a></li>
<li class="chapter" data-level="14.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#simple-linear-regression"><i class="fa fa-check"></i><b>14.2</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview-1"><i class="fa fa-check"></i><b>14.2.1</b> Overview</a></li>
<li class="chapter" data-level="14.2.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-base-r"><i class="fa fa-check"></i><b>14.2.2</b> Implementation in base R</a></li>
<li class="chapter" data-level="14.2.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#tidy-up-with-broom"><i class="fa fa-check"></i><b>14.2.3</b> Tidy up with broom</a></li>
<li class="chapter" data-level="14.2.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#testing-hypothesis"><i class="fa fa-check"></i><b>14.2.4</b> Testing hypothesis</a></li>
<li class="chapter" data-level="14.2.5" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#on-p-values"><i class="fa fa-check"></i><b>14.2.5</b> On p-values</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#multiple-linear-regression"><i class="fa fa-check"></i><b>14.3</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#threats-to-validity-and-aspects-to-think-about"><i class="fa fa-check"></i><b>14.3.1</b> Threats to validity and aspects to think about</a></li>
<li class="chapter" data-level="14.3.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#more-credible-outputs"><i class="fa fa-check"></i><b>14.3.2</b> More credible outputs</a></li>
<li class="chapter" data-level="14.3.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-tidymodels"><i class="fa fa-check"></i><b>14.3.3</b> Implementation in <code>tidymodels</code></a></li>
<li class="chapter" data-level="14.3.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-rstanarm"><i class="fa fa-check"></i><b>14.3.4</b> Implementation in <code>rstanarm</code></a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#logistic-regression-2"><i class="fa fa-check"></i><b>14.4</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview-2"><i class="fa fa-check"></i><b>14.4.1</b> Overview</a></li>
<li class="chapter" data-level="14.4.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-base"><i class="fa fa-check"></i><b>14.4.2</b> Implementation in base</a></li>
<li class="chapter" data-level="14.4.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-tidymodels-1"><i class="fa fa-check"></i><b>14.4.3</b> Implementation in <code>tidymodels</code></a></li>
<li class="chapter" data-level="14.4.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-rstanarm-1"><i class="fa fa-check"></i><b>14.4.4</b> Implementation in <code>rstanarm</code></a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#poisson-regression"><i class="fa fa-check"></i><b>14.5</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview-3"><i class="fa fa-check"></i><b>14.5.1</b> Overview</a></li>
<li class="chapter" data-level="14.5.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-base-1"><i class="fa fa-check"></i><b>14.5.2</b> Implementation in base</a></li>
<li class="chapter" data-level="14.5.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-tidymodels-2"><i class="fa fa-check"></i><b>14.5.3</b> Implementation in <code>tidymodels</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html"><i class="fa fa-check"></i><b>15</b> Causality from observational data</a>
<ul>
<li class="chapter" data-level="15.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-18"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#dags-and-trying-not-to-be-tricked-by-the-data"><i class="fa fa-check"></i><b>15.2</b> DAGs and trying not to be tricked by the data</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#dags-and-confounding"><i class="fa fa-check"></i><b>15.2.1</b> DAGs and confounding</a></li>
<li class="chapter" data-level="15.2.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#selection-and-measurement-bias"><i class="fa fa-check"></i><b>15.2.2</b> Selection and measurement bias</a></li>
<li class="chapter" data-level="15.2.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#two-common-paradoxes"><i class="fa fa-check"></i><b>15.2.3</b> Two common paradoxes</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#difference-in-differences"><i class="fa fa-check"></i><b>15.3</b> Difference in differences</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#matching-and-difference-in-differences"><i class="fa fa-check"></i><b>15.3.1</b> Matching and difference-in-differences</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974"><i class="fa fa-check"></i><b>15.4</b> Case study - Lower advertising revenue reduced French newspaper prices between 1960 and 1974</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-20"><i class="fa fa-check"></i><b>15.4.1</b> Introduction</a></li>
<li class="chapter" data-level="15.4.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#background"><i class="fa fa-check"></i><b>15.4.2</b> Background</a></li>
<li class="chapter" data-level="15.4.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#data"><i class="fa fa-check"></i><b>15.4.3</b> Data</a></li>
<li class="chapter" data-level="15.4.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#model"><i class="fa fa-check"></i><b>15.4.4</b> Model</a></li>
<li class="chapter" data-level="15.4.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#results"><i class="fa fa-check"></i><b>15.4.5</b> Results</a></li>
<li class="chapter" data-level="15.4.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#other-points"><i class="fa fa-check"></i><b>15.4.6</b> Other points</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---funding-of-clinical-trials-and-reported-drug-efficacy"><i class="fa fa-check"></i><b>15.5</b> Case study - Funding of Clinical Trials and Reported Drug Efficacy</a></li>
<li class="chapter" data-level="15.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#regression-discontinuity-design"><i class="fa fa-check"></i><b>15.6</b> Regression discontinuity design</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-21"><i class="fa fa-check"></i><b>15.6.1</b> Introduction</a></li>
<li class="chapter" data-level="15.6.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#simulated-example-1"><i class="fa fa-check"></i><b>15.6.2</b> Simulated example</a></li>
<li class="chapter" data-level="15.6.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#overlap"><i class="fa fa-check"></i><b>15.6.3</b> Overlap</a></li>
<li class="chapter" data-level="15.6.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#examples"><i class="fa fa-check"></i><b>15.6.4</b> Examples</a></li>
<li class="chapter" data-level="15.6.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#implementation"><i class="fa fa-check"></i><b>15.6.5</b> Implementation</a></li>
<li class="chapter" data-level="15.6.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#fuzzy-rdd"><i class="fa fa-check"></i><b>15.6.6</b> Fuzzy RDD</a></li>
<li class="chapter" data-level="15.6.7" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#threats-to-validity"><i class="fa fa-check"></i><b>15.6.7</b> Threats to validity</a></li>
<li class="chapter" data-level="15.6.8" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#weaknesses"><i class="fa fa-check"></i><b>15.6.8</b> Weaknesses</a></li>
</ul></li>
<li class="chapter" data-level="15.7" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---stiers-hooghe-and-dassonneville-2020"><i class="fa fa-check"></i><b>15.7</b> Case study - Stiers, Hooghe, and Dassonneville, 2020</a></li>
<li class="chapter" data-level="15.8" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---caughey-and-sekhon.-2011"><i class="fa fa-check"></i><b>15.8</b> Case study - Caughey, and Sekhon., 2011</a></li>
<li class="chapter" data-level="15.9" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#instrumental-variables"><i class="fa fa-check"></i><b>15.9</b> Instrumental variables</a>
<ul>
<li class="chapter" data-level="15.9.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-22"><i class="fa fa-check"></i><b>15.9.1</b> Introduction</a></li>
<li class="chapter" data-level="15.9.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#history"><i class="fa fa-check"></i><b>15.9.2</b> History</a></li>
<li class="chapter" data-level="15.9.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#simulated-example-2"><i class="fa fa-check"></i><b>15.9.3</b> Simulated example</a></li>
<li class="chapter" data-level="15.9.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#implementation-1"><i class="fa fa-check"></i><b>15.9.4</b> Implementation</a></li>
<li class="chapter" data-level="15.9.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#assumptions-1"><i class="fa fa-check"></i><b>15.9.5</b> Assumptions</a></li>
<li class="chapter" data-level="15.9.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#conclusion"><i class="fa fa-check"></i><b>15.9.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="15.10" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---effect-of-police-on-crime"><i class="fa fa-check"></i><b>15.10</b> Case study - Effect of Police on Crime</a>
<ul>
<li class="chapter" data-level="15.10.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#overview-4"><i class="fa fa-check"></i><b>15.10.1</b> Overview</a></li>
<li class="chapter" data-level="15.10.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#data-1"><i class="fa fa-check"></i><b>15.10.2</b> Data</a></li>
<li class="chapter" data-level="15.10.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#model-1"><i class="fa fa-check"></i><b>15.10.3</b> Model</a></li>
<li class="chapter" data-level="15.10.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#discussion"><i class="fa fa-check"></i><b>15.10.4</b> Discussion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html"><i class="fa fa-check"></i><b>16</b> Multilevel regression with post-stratification</a>
<ul>
<li class="chapter" data-level="16.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#introduction-23"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#simulation---toddler-bedtimes"><i class="fa fa-check"></i><b>16.2</b> Simulation - Toddler bedtimes</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#construct-a-population"><i class="fa fa-check"></i><b>16.2.1</b> Construct a population</a></li>
<li class="chapter" data-level="16.2.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#get-a-biased-sample-from-it"><i class="fa fa-check"></i><b>16.2.2</b> Get a biased sample from it</a></li>
<li class="chapter" data-level="16.2.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#model-the-sample"><i class="fa fa-check"></i><b>16.2.3</b> Model the sample</a></li>
<li class="chapter" data-level="16.2.4" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#get-a-post-stratification-dataset"><i class="fa fa-check"></i><b>16.2.4</b> Get a post-stratification dataset</a></li>
<li class="chapter" data-level="16.2.5" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratify-our-model-estimates"><i class="fa fa-check"></i><b>16.2.5</b> Post-stratify our model estimates</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#case-study---xbox-paper"><i class="fa fa-check"></i><b>16.3</b> Case study - Xbox paper</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#overview-5"><i class="fa fa-check"></i><b>16.3.1</b> Overview</a></li>
<li class="chapter" data-level="16.3.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#model-2"><i class="fa fa-check"></i><b>16.3.2</b> Model</a></li>
<li class="chapter" data-level="16.3.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratify"><i class="fa fa-check"></i><b>16.3.3</b> Post-stratify</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#simulation---australian-voting"><i class="fa fa-check"></i><b>16.4</b> Simulation - Australian voting</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#overview-6"><i class="fa fa-check"></i><b>16.4.1</b> Overview</a></li>
<li class="chapter" data-level="16.4.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#construct-a-survey"><i class="fa fa-check"></i><b>16.4.2</b> Construct a survey</a></li>
<li class="chapter" data-level="16.4.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#model-the-survey"><i class="fa fa-check"></i><b>16.4.3</b> Model the survey</a></li>
<li class="chapter" data-level="16.4.4" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratify-1"><i class="fa fa-check"></i><b>16.4.4</b> Post-stratify</a></li>
<li class="chapter" data-level="16.4.5" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#improving-the-model"><i class="fa fa-check"></i><b>16.4.5</b> Improving the model</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#forecasting-the-2020-us-election"><i class="fa fa-check"></i><b>16.5</b> Forecasting the 2020 US election</a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#survey-data"><i class="fa fa-check"></i><b>16.5.1</b> Survey data</a></li>
<li class="chapter" data-level="16.5.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratification-data"><i class="fa fa-check"></i><b>16.5.2</b> Post-stratification data</a></li>
<li class="chapter" data-level="16.5.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#model-3"><i class="fa fa-check"></i><b>16.5.3</b> Model</a></li>
<li class="chapter" data-level="16.5.4" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratify-2"><i class="fa fa-check"></i><b>16.5.4</b> Post-stratify</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#concluding-remarks-and-next-steps"><i class="fa fa-check"></i><b>16.6</b> Concluding remarks and next steps</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="text-as-data.html"><a href="text-as-data.html"><i class="fa fa-check"></i><b>17</b> Text as data</a>
<ul>
<li class="chapter" data-level="17.1" data-path="text-as-data.html"><a href="text-as-data.html#introduction-24"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="text-as-data.html"><a href="text-as-data.html#lasso-regression"><i class="fa fa-check"></i><b>17.2</b> Lasso regression</a></li>
<li class="chapter" data-level="17.3" data-path="text-as-data.html"><a href="text-as-data.html#topic-models"><i class="fa fa-check"></i><b>17.3</b> Topic models</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="text-as-data.html"><a href="text-as-data.html#overview-7"><i class="fa fa-check"></i><b>17.3.1</b> Overview</a></li>
<li class="chapter" data-level="17.3.2" data-path="text-as-data.html"><a href="text-as-data.html#document-generation-process"><i class="fa fa-check"></i><b>17.3.2</b> Document generation process</a></li>
<li class="chapter" data-level="17.3.3" data-path="text-as-data.html"><a href="text-as-data.html#analysis-process"><i class="fa fa-check"></i><b>17.3.3</b> Analysis process</a></li>
<li class="chapter" data-level="17.3.4" data-path="text-as-data.html"><a href="text-as-data.html#warnings-and-extensions"><i class="fa fa-check"></i><b>17.3.4</b> Warnings and extensions</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="text-as-data.html"><a href="text-as-data.html#word-embedding"><i class="fa fa-check"></i><b>17.4</b> Word embedding</a></li>
<li class="chapter" data-level="17.5" data-path="text-as-data.html"><a href="text-as-data.html#conclusion-1"><i class="fa fa-check"></i><b>17.5</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>VI Scale</b></span></li>
<li class="chapter" data-level="18" data-path="cloud.html"><a href="cloud.html"><i class="fa fa-check"></i><b>18</b> Cloud</a>
<ul>
<li class="chapter" data-level="18.1" data-path="cloud.html"><a href="cloud.html#introduction-25"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="cloud.html"><a href="cloud.html#google-colab"><i class="fa fa-check"></i><b>18.2</b> Google Colab</a></li>
<li class="chapter" data-level="18.3" data-path="cloud.html"><a href="cloud.html#aws"><i class="fa fa-check"></i><b>18.3</b> AWS</a></li>
<li class="chapter" data-level="18.4" data-path="cloud.html"><a href="cloud.html#google-compute-engine"><i class="fa fa-check"></i><b>18.4</b> Google Compute Engine</a></li>
<li class="chapter" data-level="18.5" data-path="cloud.html"><a href="cloud.html#azure"><i class="fa fa-check"></i><b>18.5</b> Azure</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="deploy.html"><a href="deploy.html"><i class="fa fa-check"></i><b>19</b> Deploy</a>
<ul>
<li class="chapter" data-level="19.1" data-path="deploy.html"><a href="deploy.html#introduction-26"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
<li class="chapter" data-level="19.2" data-path="deploy.html"><a href="deploy.html#packages"><i class="fa fa-check"></i><b>19.2</b> Packages</a></li>
<li class="chapter" data-level="19.3" data-path="deploy.html"><a href="deploy.html#shiny-1"><i class="fa fa-check"></i><b>19.3</b> Shiny</a></li>
<li class="chapter" data-level="19.4" data-path="deploy.html"><a href="deploy.html#plumber-and-model-apis"><i class="fa fa-check"></i><b>19.4</b> Plumber and model APIs</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="deploy.html"><a href="deploy.html#hello-toronto"><i class="fa fa-check"></i><b>19.4.1</b> Hello Toronto</a></li>
<li class="chapter" data-level="19.4.2" data-path="deploy.html"><a href="deploy.html#local-model"><i class="fa fa-check"></i><b>19.4.2</b> Local model</a></li>
<li class="chapter" data-level="19.4.3" data-path="deploy.html"><a href="deploy.html#cloud-model"><i class="fa fa-check"></i><b>19.4.3</b> Cloud model</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Assessment</b></span></li>
<li class="chapter" data-level="20" data-path="papers.html"><a href="papers.html"><i class="fa fa-check"></i><b>20</b> Papers</a>
<ul>
<li class="chapter" data-level="20.1" data-path="papers.html"><a href="papers.html#mandatory-minimums"><i class="fa fa-check"></i><b>20.1</b> ‘Mandatory Minimums’</a>
<ul>
<li class="chapter" data-level="20.1.1" data-path="papers.html"><a href="papers.html#task"><i class="fa fa-check"></i><b>20.1.1</b> Task</a></li>
<li class="chapter" data-level="20.1.2" data-path="papers.html"><a href="papers.html#guidance"><i class="fa fa-check"></i><b>20.1.2</b> Guidance</a></li>
<li class="chapter" data-level="20.1.3" data-path="papers.html"><a href="papers.html#check-offs-points"><i class="fa fa-check"></i><b>20.1.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.1.4" data-path="papers.html"><a href="papers.html#faq"><i class="fa fa-check"></i><b>20.1.4</b> FAQ</a></li>
<li class="chapter" data-level="20.1.5" data-path="papers.html"><a href="papers.html#rubric"><i class="fa fa-check"></i><b>20.1.5</b> Rubric</a></li>
<li class="chapter" data-level="20.1.6" data-path="papers.html"><a href="papers.html#previous-examples"><i class="fa fa-check"></i><b>20.1.6</b> Previous examples</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="papers.html"><a href="papers.html#these-numbers-mean-dial-it-up"><i class="fa fa-check"></i><b>20.2</b> ‘These numbers mean dial it up’</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="papers.html"><a href="papers.html#task-1"><i class="fa fa-check"></i><b>20.2.1</b> Task</a></li>
<li class="chapter" data-level="20.2.2" data-path="papers.html"><a href="papers.html#guidance-1"><i class="fa fa-check"></i><b>20.2.2</b> Guidance</a></li>
<li class="chapter" data-level="20.2.3" data-path="papers.html"><a href="papers.html#check-offs-points-1"><i class="fa fa-check"></i><b>20.2.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.2.4" data-path="papers.html"><a href="papers.html#faq-1"><i class="fa fa-check"></i><b>20.2.4</b> FAQ</a></li>
<li class="chapter" data-level="20.2.5" data-path="papers.html"><a href="papers.html#rubric-1"><i class="fa fa-check"></i><b>20.2.5</b> Rubric</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="papers.html"><a href="papers.html#the-short-list"><i class="fa fa-check"></i><b>20.3</b> ‘The Short List’</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="papers.html"><a href="papers.html#task-2"><i class="fa fa-check"></i><b>20.3.1</b> Task</a></li>
<li class="chapter" data-level="20.3.2" data-path="papers.html"><a href="papers.html#guidance-2"><i class="fa fa-check"></i><b>20.3.2</b> Guidance</a></li>
<li class="chapter" data-level="20.3.3" data-path="papers.html"><a href="papers.html#check-offs-points-2"><i class="fa fa-check"></i><b>20.3.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.3.4" data-path="papers.html"><a href="papers.html#faq-2"><i class="fa fa-check"></i><b>20.3.4</b> FAQ</a></li>
<li class="chapter" data-level="20.3.5" data-path="papers.html"><a href="papers.html#rubric-2"><i class="fa fa-check"></i><b>20.3.5</b> Rubric</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="papers.html"><a href="papers.html#two-cathedrals"><i class="fa fa-check"></i><b>20.4</b> ‘Two Cathedrals’</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="papers.html"><a href="papers.html#task-3"><i class="fa fa-check"></i><b>20.4.1</b> Task</a></li>
<li class="chapter" data-level="20.4.2" data-path="papers.html"><a href="papers.html#guidance-3"><i class="fa fa-check"></i><b>20.4.2</b> Guidance</a></li>
<li class="chapter" data-level="20.4.3" data-path="papers.html"><a href="papers.html#peer-review-submission"><i class="fa fa-check"></i><b>20.4.3</b> Peer review submission</a></li>
<li class="chapter" data-level="20.4.4" data-path="papers.html"><a href="papers.html#conduct-peer-review"><i class="fa fa-check"></i><b>20.4.4</b> Conduct peer-review</a></li>
<li class="chapter" data-level="20.4.5" data-path="papers.html"><a href="papers.html#check-offs-points-3"><i class="fa fa-check"></i><b>20.4.5</b> Check offs points</a></li>
<li class="chapter" data-level="20.4.6" data-path="papers.html"><a href="papers.html#faq-3"><i class="fa fa-check"></i><b>20.4.6</b> FAQ</a></li>
<li class="chapter" data-level="20.4.7" data-path="papers.html"><a href="papers.html#rubric-3"><i class="fa fa-check"></i><b>20.4.7</b> Rubric</a></li>
<li class="chapter" data-level="20.4.8" data-path="papers.html"><a href="papers.html#previous-examples-1"><i class="fa fa-check"></i><b>20.4.8</b> Previous examples</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="papers.html"><a href="papers.html#a-proportional-response"><i class="fa fa-check"></i><b>20.5</b> ‘A Proportional Response’</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="papers.html"><a href="papers.html#task-4"><i class="fa fa-check"></i><b>20.5.1</b> Task</a></li>
<li class="chapter" data-level="20.5.2" data-path="papers.html"><a href="papers.html#recommended-steps"><i class="fa fa-check"></i><b>20.5.2</b> Recommended steps</a></li>
<li class="chapter" data-level="20.5.3" data-path="papers.html"><a href="papers.html#check-offs-points-4"><i class="fa fa-check"></i><b>20.5.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.5.4" data-path="papers.html"><a href="papers.html#faq-4"><i class="fa fa-check"></i><b>20.5.4</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="papers.html"><a href="papers.html#mr-willis-of-ohio"><i class="fa fa-check"></i><b>20.6</b> ‘Mr Willis of Ohio’</a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="papers.html"><a href="papers.html#task-5"><i class="fa fa-check"></i><b>20.6.1</b> Task</a></li>
<li class="chapter" data-level="20.6.2" data-path="papers.html"><a href="papers.html#recommended-steps-1"><i class="fa fa-check"></i><b>20.6.2</b> Recommended steps</a></li>
<li class="chapter" data-level="20.6.3" data-path="papers.html"><a href="papers.html#check-offs-points-5"><i class="fa fa-check"></i><b>20.6.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.6.4" data-path="papers.html"><a href="papers.html#faq-5"><i class="fa fa-check"></i><b>20.6.4</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="papers.html"><a href="papers.html#five-votes-down"><i class="fa fa-check"></i><b>20.7</b> ‘Five Votes Down’</a>
<ul>
<li class="chapter" data-level="20.7.1" data-path="papers.html"><a href="papers.html#task-6"><i class="fa fa-check"></i><b>20.7.1</b> Task</a></li>
<li class="chapter" data-level="20.7.2" data-path="papers.html"><a href="papers.html#recommended-steps-2"><i class="fa fa-check"></i><b>20.7.2</b> Recommended steps</a></li>
<li class="chapter" data-level="20.7.3" data-path="papers.html"><a href="papers.html#check-offs-points-6"><i class="fa fa-check"></i><b>20.7.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.7.4" data-path="papers.html"><a href="papers.html#faq-6"><i class="fa fa-check"></i><b>20.7.4</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="20.8" data-path="papers.html"><a href="papers.html#whats-next"><i class="fa fa-check"></i><b>20.8</b> ‘What’s next?’</a>
<ul>
<li class="chapter" data-level="20.8.1" data-path="papers.html"><a href="papers.html#task-7"><i class="fa fa-check"></i><b>20.8.1</b> Task</a></li>
<li class="chapter" data-level="20.8.2" data-path="papers.html"><a href="papers.html#recommended-steps-3"><i class="fa fa-check"></i><b>20.8.2</b> Recommended steps</a></li>
<li class="chapter" data-level="20.8.3" data-path="papers.html"><a href="papers.html#check-offs-points-7"><i class="fa fa-check"></i><b>20.8.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.8.4" data-path="papers.html"><a href="papers.html#faq-7"><i class="fa fa-check"></i><b>20.8.4</b> FAQ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telling Stories With Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploratory-data-analysis" class="section level1" number="13">
<h1><span class="header-section-number">Chapter 13</span> Exploratory data analysis</h1>
<p><em>Last updated: 9 March 2021.</em></p>
<p><strong>Required reading</strong></p>
<ul>
<li>Barocas, Solon, and Danah Boyd, 2017, ‘Engaging the ethics of data science in practice,’ <em>Communications of the ACM</em>, 60.11 (2017): 23-25.</li>
<li>DiCiccio, Thomas J., and Mary E. Thompson, 2004, ‘A Conversation with Donald A. S. Fraser,’ <em>Statistical Science</em>, 19 (2) pp. 370-386, <a href="https://utstat.toronto.edu/craiu/DonFraser_SSInterview.pdf" class="uri">https://utstat.toronto.edu/craiu/DonFraser_SSInterview.pdf</a>.</li>
<li>Jordan, Michael I, 2019, ‘AI - The revolution hasn’t started yet,’ <em>Harvard Data Science Review</em>, 1 July, <a href="https://hdsr.mitpress.mit.edu/pub/wot7mkc1" class="uri">https://hdsr.mitpress.mit.edu/pub/wot7mkc1</a>.</li>
<li>Tukey, John W., 1961, ‘The Future of Data Analysis,’ <em>The annals of mathematical statistics</em>, Part 1 ‘General Considerations,’ <a href="https://projecteuclid.org/journals/annals-of-mathematical-statistics/volume-33/issue-1/The-Future-of-Data-Analysis/10.1214/aoms/1177704711.full" class="uri">https://projecteuclid.org/journals/annals-of-mathematical-statistics/volume-33/issue-1/The-Future-of-Data-Analysis/10.1214/aoms/1177704711.full</a>.</li>
<li>Wickham, Hadley, and Garrett Grolemund, 2017, <em>R for Data Science</em>, Chapters 3 and 7, <a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a>.</li>
</ul>
<p><strong>Recommended reading</strong></p>
<ul>
<li>Hall, Megan, 2019, ‘Exploratory Data Analysis Using Tidyverse,’ <a href="https://hockey-graphs.com/2019/10/08/exploratory-data-analysis-using-tidyverse/" class="uri">https://hockey-graphs.com/2019/10/08/exploratory-data-analysis-using-tidyverse/</a>.</li>
<li>Kommenda, Niko, Helen Pidd and Libby Brooks, 2020, ‘Revealed: the areas in the UK with one Airbnb for every four homes,’ <em>The Guardian</em>, 20 February, <a href="https://www.theguardian.com/technology/2020/feb/20/revealed-the-areas-in-the-uk-with-one-airbnb-for-every-four-homes" class="uri">https://www.theguardian.com/technology/2020/feb/20/revealed-the-areas-in-the-uk-with-one-airbnb-for-every-four-homes</a>.</li>
<li>Silge, Julia, 2018, ‘Understanding PCA using Stack Overflow data,’ <a href="https://juliasilge.com/blog/stack-overflow-pca/" class="uri">https://juliasilge.com/blog/stack-overflow-pca/</a>.</li>
<li>Soetewey, Antoine, 2020, ‘Descriptive statistics in R,’ <a href="https://www.statsandr.com/blog/descriptive-statistics-in-r/" class="uri">https://www.statsandr.com/blog/descriptive-statistics-in-r/</a>.</li>
<li>Stodulka, Jiri, 2019, ‘Toronto Crime and Folium,’ <a href="https://www.jiristodulka.com/post/toronto-crime/" class="uri">https://www.jiristodulka.com/post/toronto-crime/</a>.</li>
<li>Wong, Julia Carrie, 2020, ‘One year inside Trump’s monumental Facebook campaign,’ The Guardian, 29 January, <a href="https://www.theguardian.com/us-news/2020/jan/28/donald-trump-facebook-ad-campaign-2020-election" class="uri">https://www.theguardian.com/us-news/2020/jan/28/donald-trump-facebook-ad-campaign-2020-election</a>.</li>
</ul>
<p><strong>Key concepts/skills/etc</strong></p>
<ul>
<li>Quickly coming to terms with a new dataset by constructing graphs and tables.</li>
<li>Understanding the issues and features of the dataset and how this may affect your modelling decisions.</li>
<li>Thinking about missing values and outliers.</li>
</ul>
<p><strong>Key libraries</strong></p>
<ul>
<li><code>broom</code></li>
<li><code>ggrepel</code></li>
<li><code>here</code></li>
<li><code>janitor</code></li>
<li><code>lubridate</code></li>
<li><code>opendatatoronto</code></li>
<li><code>tidymodels</code></li>
<li><code>tidyverse</code></li>
<li><code>visdat</code></li>
</ul>
<p><strong>Key functions/etc</strong></p>
<ul>
<li><code>augment()</code></li>
<li><code>clean_names()</code></li>
<li><code>coord_flip()</code></li>
<li><code>count()</code></li>
<li><code>distinct()</code></li>
<li><code>facet_grid()</code></li>
<li><code>facet_wrap()</code></li>
<li><code>geom_bar()</code></li>
<li><code>geom_col()</code></li>
<li><code>geom_density()</code></li>
<li><code>geom_histogram()</code></li>
<li><code>geom_line()</code></li>
<li><code>geom_point()</code></li>
<li><code>geom_smooth()</code></li>
<li><code>geom_text_repel()</code></li>
<li><code>get_dupes()</code></li>
<li><code>glance()</code></li>
<li><code>if_else()</code></li>
<li><code>ifelse()</code></li>
<li><code>initial_split()</code></li>
<li><code>left_join()</code></li>
<li><code>mutate()</code></li>
<li><code>mutate_all()</code></li>
<li><code>names()</code></li>
<li><code>ncol()</code></li>
<li><code>nrow()</code></li>
<li><code>pivot_wider()</code></li>
<li><code>scale_color_brewer()</code></li>
<li><code>scale_fill_brewer()</code></li>
<li><code>scale_x_log10()</code></li>
<li><code>scale_y_log10()</code></li>
<li><code>str_detect()</code></li>
<li><code>str_extract()</code></li>
<li><code>str_remove()</code></li>
<li><code>str_split()</code></li>
<li><code>str_starts()</code></li>
<li><code>summarise()</code></li>
<li><code>summarise_all()</code></li>
<li><code>theme_classic()</code></li>
<li><code>theme_minimal()</code></li>
<li><code>vis_dat()</code></li>
<li><code>vis_miss()</code></li>
</ul>
<p><strong>Quiz</strong></p>
<ol style="list-style-type: decimal">
<li>In your own words what is exploratory data analysis (this will be difficult, but please write only one nuanced paragraph)?</li>
<li>In Tukey’s words, what is exploratory data analysis (please write one paragraph)?</li>
<li>Who was Tukey (please write a paragraph or two)?</li>
<li>What is Tukey’s link to DoSS (hint: he was an advisor on someone’s PhD - who was that person)?</li>
<li>Can you identify a female equivalent to Tukey who we (as historians of statistics) may have overlooked?</li>
<li>If you have a dataset called ‘my_data,’ which has two columns: ‘first_col’ and ‘second_col,’ then could you please write some rough R code that would generate a graph (the type of graph doesn’t matter).</li>
<li>Consider a dataset that has 500 rows and 3 columns, so there are 1,500 cells. If 100 of the cells are missing data for at least one of the columns, then would you remove the whole row your dataset or try to run your analysis on the data as is, or some other procedure? What if your dataset had 10,000 rows instead, but the same number of missing cells?</li>
<li>Please note three ways of identifying unusual values.</li>
<li>What is the difference between a categorical and continuous variable?</li>
<li>What is the difference between a factor and an integer variable?</li>
<li>How can we think about who is systematically excluded from a dataset?</li>
<li>Using the <code>opendatatoronto</code> package, download the data on mayoral campaign contributions for 2014. (note: the 2014 file you will get from <code>get_resource</code>, so just keep the sheet that relates to the Mayor election).
<ol style="list-style-type: decimal">
<li>Clean up the data format (fixing the parsing issue and standardizing the column names using <code>janitor</code>)</li>
<li>Summarize the variables in the dataset. Are there missing values, and if so, should we be worried about them? Is every variable in the format it should be? If not, create new variable(s) that are in the right format.</li>
<li>Visually explore the distribution of values of the contributions. What contributions are notable outliers? Do they share a similar characteristic(s)? It may be useful to plot the distribution of contributions without these outliers to get a better sense of the majority of the data.</li>
<li>List the top five candidates in each of these categories: 1) total contributions; 2) mean contribution; and 3) number of contributions.</li>
<li>Repeat that process, but without contributions from the candidates themselves.</li>
<li>How many contributors gave money to more than one candidate?</li>
</ol></li>
<li>Name three geoms that produce graphs that have bars on them <code>ggplot()</code>.</li>
<li>Consider a dataset 10,000 observations and 27 variables. For each observation, there is at least one missing variable. Please discuss, in a paragraph or two, the steps that you would take to understand what is going on.</li>
<li>Known missing data, are those that leave holes in your dataset. But what about data that were never collected? Please look at McClelland, Alexander, 2019, ‘“Lock This Whore Up”: Legal Violence and Flows of Information Precipitating Personal Violence against People Criminalised for HIV-Related Crimes in Canada,’ European Journal of Risk Regulation, 10 (1), pp. 132-147. Then look at Policing the Pandemic - <a href="https://www.policingthepandemic.ca/" class="uri">https://www.policingthepandemic.ca/</a>. Look into how they gathered their dataset and what it took to put this together. What is in the dataset and why? What is missing and why? How could this affect the results? How might similar biases enter into other datasets that you have used or read about?</li>
</ol>
<div id="introduction-16" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Introduction</h2>
<blockquote>
<p>The future of data analysis can involve great progress, the overcoming of real difficulties, and the provision of a great service to all fields of science and technology. Will it? That remains to us, to our willingness to take up the rocky road of real problems in preference to the smooth road of unreal assumptions, arbitrary criteria, and abstract results without real attachments. Who is for the challenge?</p>
<p><span class="citation"><a href="references-1.html#ref-tukey1962future" role="doc-biblioref">Tukey</a> (<a href="references-1.html#ref-tukey1962future" role="doc-biblioref">1962, 64</a>)</span>.</p>
</blockquote>
<p>Exploratory data analysis is never finished, you just die. It is the active process of exploring and becoming familiar with your data. Like a farmer with their hands in the earth, you need to know every contour and aspect of your data. You need to know how it changes, what it shows, hides, and what are its limits. Exploratory data analysis is the unstructured process of doing this.</p>
<p>That said, exploratory data analysis (EDA) is not something that ends up in your final paper. It is a means to an end and while it will inform your entire paper, especially the data section, it’s not typically something that belongs in a final draft. The best way to proceed is to make a separate .Rmd and add code and brief notes as you go. Don’t delete previous code, just add to it. When you run out of time, you’ll have a useful notebook that captures your exploration. This is a document for you and your collaborators and will guide all the subsequent modelling that you do.</p>
<p>EDA draws on everything that you know as an analyst. Every tool is fair game and should be considered. Look at the raw data, make some tables, some plots, some summary statistics, make some models. The key here is to iterate, move quickly not perfectly, and come to understand your data.</p>
<p>In this chapter we will working with real data that has many issues so that you can understand the main characteristics and potential issues. We will use the <code>opendatatoronto</code> package <span class="citation">(<a href="references-1.html#ref-citeSharla" role="doc-biblioref">Gelfand 2020</a>)</span>, among other sources.</p>
</div>
<div id="case-study---ttc-subway-delays" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Case study - TTC subway delays</h2>
<p><strong>This section was written with <a href="https://www.monicaalexander.com/">Monica Alexander</a>.</strong></p>
<div id="introduction-17" class="section level3" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Introduction</h3>
<p>The <code>opendatatoronto</code> package <span class="citation">(<a href="references-1.html#ref-citeSharla" role="doc-biblioref">Gelfand 2020</a>)</span> provides an interface to all data available on the <a href="https://open.toronto.ca/">Open Data Portal</a> provided by the City of Toronto. We are going to use that to take a quick look at the subway delays. We’re additionally going to especially draw on the <code>tidyverse</code> <span class="citation">(<a href="references-1.html#ref-citetidyverse" role="doc-biblioref">Wickham et al. 2019b</a>)</span>, as well as the <code>ggrepel</code> <span class="citation">(<a href="references-1.html#ref-citeggrepel" role="doc-biblioref">Slowikowski 2021</a>)</span>, <code>janitor</code> <span class="citation">(<a href="references-1.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span>, <code>lubridate</code> <span class="citation">(<a href="references-1.html#ref-GrolemundWickham2011" role="doc-biblioref">Grolemund and Wickham 2011</a>)</span>, and <code>visdat</code> <span class="citation">(<a href="references-1.html#ref-citevisdat" role="doc-biblioref">Tierney 2017</a>)</span> packages.</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="exploratory-data-analysis.html#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(opendatatoronto)</span>
<span id="cb441-2"><a href="exploratory-data-analysis.html#cb441-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb441-3"><a href="exploratory-data-analysis.html#cb441-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb441-4"><a href="exploratory-data-analysis.html#cb441-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb441-5"><a href="exploratory-data-analysis.html#cb441-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb441-6"><a href="exploratory-data-analysis.html#cb441-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span></code></pre></div>
</div>
<div id="gather-the-data" class="section level3" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Gather the data</h3>
<p>To begin with, use <code>opendatatoronto::list_packages()</code> to look at some of the datasets that available.</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="exploratory-data-analysis.html#cb442-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> opendatatoronto<span class="sc">::</span><span class="fu">list_packages</span>(<span class="at">limit =</span> <span class="dv">500</span>)</span>
<span id="cb442-2"><a href="exploratory-data-analysis.html#cb442-2" aria-hidden="true" tabindex="-1"></a>all_data</span></code></pre></div>
<pre><code>## # A tibble: 412 x 11
##    title    id      topics    civic_issues publisher  excerpt   dataset_category
##    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;           
##  1 Polls c… 7bce9b… City gov… &lt;NA&gt;         City Cler… &quot;Polls a… Table           
##  2 COVID-1… cd616c… Health    &lt;NA&gt;         Toronto P… &quot;This da… Map             
##  3 COVID-1… d3f21f… Health    &lt;NA&gt;         Toronto P… &quot;This da… Map             
##  4 Daily S… 8a6ece… City gov… Affordable … Shelter, … &quot;Daily o… Table           
##  5 Street … 99b1f3… City gov… &lt;NA&gt;         Transport… &quot;Informa… Map             
##  6 Automat… a15479… Transpor… Mobility     Transport… &quot;This da… Map             
##  7 BodySafe c4052f… City gov… &lt;NA&gt;         Toronto P… &quot;This da… Table           
##  8 Street … 1db347… City gov… Mobility     Transport… &quot;Transit… Map             
##  9 Street … 74f636… City gov… &lt;NA&gt;         Transport… &quot;Publica… Map             
## 10 Street … 821fed… City gov… &lt;NA&gt;         Transport… &quot;Public … Map             
## # … with 402 more rows, and 4 more variables: num_resources &lt;int&gt;,
## #   formats &lt;chr&gt;, refresh_rate &lt;chr&gt;, last_refreshed &lt;date&gt;</code></pre>
<p>We’ll download the data on TTC subway delays in 2019. There are multiple files for 2019 so we need to get them all and then make them into one big dataframe.</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="exploratory-data-analysis.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We know this number based on the &#39;id&#39; of the interest.</span></span>
<span id="cb444-2"><a href="exploratory-data-analysis.html#cb444-2" aria-hidden="true" tabindex="-1"></a>ttc_resources <span class="ot">&lt;-</span> </span>
<span id="cb444-3"><a href="exploratory-data-analysis.html#cb444-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_package_resources</span>(<span class="st">&quot;996cfe8d-fb35-40ce-b569-698d51fc683b&quot;</span>)</span>
<span id="cb444-4"><a href="exploratory-data-analysis.html#cb444-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-5"><a href="exploratory-data-analysis.html#cb444-5" aria-hidden="true" tabindex="-1"></a>ttc_resources <span class="ot">&lt;-</span> </span>
<span id="cb444-6"><a href="exploratory-data-analysis.html#cb444-6" aria-hidden="true" tabindex="-1"></a>  ttc_resources <span class="sc">%&gt;%</span> </span>
<span id="cb444-7"><a href="exploratory-data-analysis.html#cb444-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_extract</span>(name, <span class="st">&quot;201.?&quot;</span>))</span>
<span id="cb444-8"><a href="exploratory-data-analysis.html#cb444-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-9"><a href="exploratory-data-analysis.html#cb444-9" aria-hidden="true" tabindex="-1"></a>delay_2019_ids <span class="ot">&lt;-</span> </span>
<span id="cb444-10"><a href="exploratory-data-analysis.html#cb444-10" aria-hidden="true" tabindex="-1"></a>  ttc_resources <span class="sc">%&gt;%</span> </span>
<span id="cb444-11"><a href="exploratory-data-analysis.html#cb444-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2019</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb444-12"><a href="exploratory-data-analysis.html#cb444-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb444-13"><a href="exploratory-data-analysis.html#cb444-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb444-14"><a href="exploratory-data-analysis.html#cb444-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-15"><a href="exploratory-data-analysis.html#cb444-15" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb444-16"><a href="exploratory-data-analysis.html#cb444-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-17"><a href="exploratory-data-analysis.html#cb444-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(delay_2019_ids)) {</span>
<span id="cb444-18"><a href="exploratory-data-analysis.html#cb444-18" aria-hidden="true" tabindex="-1"></a>  delay_2019 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(delay_2019, <span class="fu">get_resource</span>(delay_2019_ids[i]))</span>
<span id="cb444-19"><a href="exploratory-data-analysis.html#cb444-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb444-20"><a href="exploratory-data-analysis.html#cb444-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-21"><a href="exploratory-data-analysis.html#cb444-21" aria-hidden="true" tabindex="-1"></a><span class="co"># make the column names nicer to work with</span></span>
<span id="cb444-22"><a href="exploratory-data-analysis.html#cb444-22" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(delay_2019)</span></code></pre></div>
<p>Let’s also download the delay code and readme, as reference. You’d probably want to save all this into an ‘inputs’ folder, as this is the raw data that would underpin any analysis.</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="exploratory-data-analysis.html#cb445-1" aria-hidden="true" tabindex="-1"></a>delay_codes <span class="ot">&lt;-</span> <span class="fu">get_resource</span>(<span class="st">&quot;fece136b-224a-412a-b191-8d31eb00491e&quot;</span>)</span>
<span id="cb445-2"><a href="exploratory-data-analysis.html#cb445-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-3"><a href="exploratory-data-analysis.html#cb445-3" aria-hidden="true" tabindex="-1"></a>delay_data_codebook <span class="ot">&lt;-</span> <span class="fu">get_resource</span>(<span class="st">&quot;54247e39-5a7d-40db-a137-82b2a9ab0708&quot;</span>)</span></code></pre></div>
<p>This dataset has a bunch of interesting variables. You can refer to the readme for descriptions. Our outcome of interest is <code>min_delay</code>, which give the delay in minutes.</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="exploratory-data-analysis.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(delay_2019)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   date                time  day    station   code  min_delay min_gap bound line 
##   &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1 2019-01-01 00:00:00 01:08 Tuesd… YORK MIL… PUSI          0       0 S     YU   
## 2 2019-01-01 00:00:00 02:14 Tuesd… ST ANDRE… PUMST         0       0 &lt;NA&gt;  YU   
## 3 2019-01-01 00:00:00 02:16 Tuesd… JANE STA… TUSC          0       0 W     BD   
## 4 2019-01-01 00:00:00 02:27 Tuesd… BLOOR ST… SUO           0       0 N     YU   
## 5 2019-01-01 00:00:00 03:03 Tuesd… DUPONT S… MUATC        11      16 N     YU   
## 6 2019-01-01 00:00:00 03:08 Tuesd… EGLINTON… EUATC        11      16 S     YU   
## # … with 1 more variable: vehicle &lt;dbl&gt;</code></pre>
<p>Next we’re going to highlight some tools that might be useful when you are getting used to a new dataset. There’s no one way to explore, but it’s important to keep in mind:</p>
<ul>
<li>what should your variables look like (type, values, distribution, etc);</li>
<li>what would be surprising (outliers etc); and</li>
<li>what is your end goal (here, it might be understanding factors associated with delays, e.g. stations, time of year, time of day, etc).</li>
</ul>
<p>In any data analysis project, if it turns out you have data issues, surprising values, missing data etc, it’s important you document anything you found and the subsequent steps or assumptions you made before moving onto your data analysis and modeling.</p>
<p>As always:</p>
<ol style="list-style-type: decimal">
<li>Start with an end in mind.</li>
<li>Be as lazy as possible.</li>
</ol>
</div>
<div id="sanity-checks" class="section level3" number="13.2.3">
<h3><span class="header-section-number">13.2.3</span> Sanity Checks</h3>
<p>We need to check that the variables are what they say they are. If they aren’t, the natural next question is to what to do with any issues. Should we recode them, or even remove them? It’s important to distinguish between factors and characters, as well as between factors and numerics.</p>
<p>For instance, have a look at the column that claims to be the days of week using <code>unique()</code>.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="exploratory-data-analysis.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(delay_2019<span class="sc">$</span>day)</span></code></pre></div>
<pre><code>## [1] &quot;Tuesday&quot;   &quot;Wednesday&quot; &quot;Thursday&quot;  &quot;Friday&quot;    &quot;Saturday&quot;  &quot;Sunday&quot;   
## [7] &quot;Monday&quot;</code></pre>
<p>Another function that that’s useful here is <code>table()</code>.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="exploratory-data-analysis.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(delay_2019<span class="sc">$</span>day)</span></code></pre></div>
<pre><code>## 
##    Friday    Monday  Saturday    Sunday  Thursday   Tuesday Wednesday 
##      2979      2970      2238      1978      3116      2939      3002</code></pre>
<p>Let’s now check the lines.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="exploratory-data-analysis.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(delay_2019<span class="sc">$</span>line)</span></code></pre></div>
<pre><code>##  [1] &quot;YU&quot;                     &quot;BD&quot;                     &quot;YU/BD&quot;                 
##  [4] &quot;SHP&quot;                    &quot;SRT&quot;                    NA                      
##  [7] &quot;YUS&quot;                    &quot;B/D&quot;                    &quot;BD LINE&quot;               
## [10] &quot;999&quot;                    &quot;YU/ BD&quot;                 &quot;YU &amp; BD&quot;               
## [13] &quot;BD/YU&quot;                  &quot;YU\\BD&quot;                 &quot;46 MARTIN GROVE&quot;       
## [16] &quot;RT&quot;                     &quot;BLOOR-DANFORTH&quot;         &quot;YU / BD&quot;               
## [19] &quot;134 PROGRESS&quot;           &quot;YU - BD&quot;                &quot;985 SHEPPARD EAST EXPR&quot;
## [22] &quot;22 COXWELL&quot;             &quot;100 FLEMINGDON PARK&quot;    &quot;YU LINE&quot;</code></pre>
<p>It looks like we have many issues here, and some of them have an obvious re-code, but some do not. Should we drop them? There’s no absolute right answer here, it depends on what you’re using the data for, but you need to be aware of these issues in the data.</p>
</div>
<div id="missing-values" class="section level3" number="13.2.4">
<h3><span class="header-section-number">13.2.4</span> Missing values</h3>
<p>Exploring missing data is a course in itself, but the main point is that their presence (or lack thereof) will haunt your analysis. Insert joke about ghostbusters here.</p>
<p>To get started look at known-unknowns, which are the NAs for each variable.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="exploratory-data-analysis.html#cb454-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb454-2"><a href="exploratory-data-analysis.html#cb454-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="fu">list</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 10
##    date  time   day station  code min_delay min_gap bound  line vehicle
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;int&gt;     &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
## 1     0     0     0       0     0         0       0  4380    50       0</code></pre>
<p>The <code>visdat</code> package <span class="citation">(<a href="references-1.html#ref-citevisdat" role="doc-biblioref">Tierney 2017</a>)</span> is also useful here, particularly to see how missing values are distributed.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="exploratory-data-analysis.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_dat</span>(delay_2019)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-268-1.png" width="672" /></p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="exploratory-data-analysis.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(delay_2019)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-268-2.png" width="672" /></p>
<p>For these known-unknowns, what we are interested in is whether the they are missing at random. We want to, ideally, show that data happened to just drop out. Of course, this is unlikely the case, and so we are looking to see what is systematic about how our data are missing.</p>
</div>
<div id="duplicate-rows" class="section level3" number="13.2.5">
<h3><span class="header-section-number">13.2.5</span> Duplicate rows</h3>
<p>Sometime data happen to be duplicated. If we didn’t notice this then our analysis would be wrong in ways that we’d not be able to consistently expect. There are a variety of ways to look for duplicated rows, but the <code>janitor::get_dupes()</code> function from the <code>janitor</code> package <span class="citation">(<a href="references-1.html#ref-janitor" role="doc-biblioref">Firke 2020</a>)</span> is especially useful.</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="exploratory-data-analysis.html#cb458-1" aria-hidden="true" tabindex="-1"></a>janitor<span class="sc">::</span><span class="fu">get_dupes</span>(delay_2019)</span></code></pre></div>
<pre><code>## # A tibble: 158 x 11
##    date                time  day    station  code  min_delay min_gap bound line 
##    &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1 2019-01-01 00:00:00 08:18 Tuesd… DONLAND… MUESA         5      10 W     BD   
##  2 2019-01-01 00:00:00 08:18 Tuesd… DONLAND… MUESA         5      10 W     BD   
##  3 2019-02-01 00:00:00 05:51 Friday SCARB C… MRTO         10      15 S     SRT  
##  4 2019-02-01 00:00:00 05:51 Friday SCARB C… MRTO         10      15 S     SRT  
##  5 2019-02-01 00:00:00 06:45 Friday MIDLAND… MRWEA         3       8 S     SRT  
##  6 2019-02-01 00:00:00 06:45 Friday MIDLAND… MRWEA         3       8 S     SRT  
##  7 2019-02-01 00:00:00 06:55 Friday LAWRENC… ERDO          0       0 S     SRT  
##  8 2019-02-01 00:00:00 06:55 Friday LAWRENC… ERDO          0       0 S     SRT  
##  9 2019-02-01 00:00:00 07:16 Friday MCCOWAN… MRWEA         5      10 N     SRT  
## 10 2019-02-01 00:00:00 07:16 Friday MCCOWAN… MRWEA         5      10 N     SRT  
## # … with 148 more rows, and 2 more variables: vehicle &lt;dbl&gt;, dupe_count &lt;int&gt;</code></pre>
<p>Our delays dataset has quite a few duplicates. Again, we’re interested in whether there is something systematic going on. Remembering that we’re trying to quickly come to terms with dataset, one way forward is to flag this as an issue to come back to and explore later, and to just remove them for now.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="exploratory-data-analysis.html#cb460-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="ot">&lt;-</span> </span>
<span id="cb460-2"><a href="exploratory-data-analysis.html#cb460-2" aria-hidden="true" tabindex="-1"></a>  delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb460-3"><a href="exploratory-data-analysis.html#cb460-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
</div>
<div id="visualizing-distributions" class="section level3" number="13.2.6">
<h3><span class="header-section-number">13.2.6</span> Visualizing distributions</h3>
<p>You need to see your data in its most raw form to understand it, and histograms, barplots, and density plots are your friends here. We’re not looking for beauty here, we’re looking to get a look at the data as quickly as possible.</p>
<p>Let’s look at one outcome of interest: ‘min_delay.’ First of all let’s just look at a histogram of all the data.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="exploratory-data-analysis.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Removing the observations that have non-standardized lines</span></span>
<span id="cb461-2"><a href="exploratory-data-analysis.html#cb461-2" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="ot">&lt;-</span> </span>
<span id="cb461-3"><a href="exploratory-data-analysis.html#cb461-3" aria-hidden="true" tabindex="-1"></a>  delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb461-4"><a href="exploratory-data-analysis.html#cb461-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(line <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;BD&quot;</span>, <span class="st">&quot;YU&quot;</span>, <span class="st">&quot;SHP&quot;</span>, <span class="st">&quot;SRT&quot;</span>))</span>
<span id="cb461-5"><a href="exploratory-data-analysis.html#cb461-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-6"><a href="exploratory-data-analysis.html#cb461-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> delay_2019) <span class="sc">+</span> </span>
<span id="cb461-7"><a href="exploratory-data-analysis.html#cb461-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay))</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-271-1.png" width="672" /></p>
<p>Somewhat concerningly we have some evidence of outliers (given the large x-axis). There are a variety of ways to focus on what is going on, but a quick way is to plot it on a logged scale (remembering that we’d expect any values of 0 to drop away).</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="exploratory-data-analysis.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> delay_2019) <span class="sc">+</span> </span>
<span id="cb462-2"><a href="exploratory-data-analysis.html#cb462-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay)) <span class="sc">+</span> </span>
<span id="cb462-3"><a href="exploratory-data-analysis.html#cb462-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-272-1.png" width="672" /></p>
<p>This initial exploration is further hinting at an outlying delay time, so let’s take a look at the largest delays. We need to join this dataset with the ‘delay_codes’ dataset to see what the delay is, and this requires some wrangling because of slightly different codes.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="exploratory-data-analysis.html#cb463-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="ot">&lt;-</span> </span>
<span id="cb463-2"><a href="exploratory-data-analysis.html#cb463-2" aria-hidden="true" tabindex="-1"></a>  delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb463-3"><a href="exploratory-data-analysis.html#cb463-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delay_codes <span class="sc">%&gt;%</span> </span>
<span id="cb463-4"><a href="exploratory-data-analysis.html#cb463-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">code =</span> <span class="st">`</span><span class="at">SUB RMENU CODE</span><span class="st">`</span>, <span class="at">code_desc =</span> <span class="st">`</span><span class="at">CODE DESCRIPTION...3</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb463-5"><a href="exploratory-data-analysis.html#cb463-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(code, code_desc)</span>
<span id="cb463-6"><a href="exploratory-data-analysis.html#cb463-6" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb463-7"><a href="exploratory-data-analysis.html#cb463-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-8"><a href="exploratory-data-analysis.html#cb463-8" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="ot">&lt;-</span> </span>
<span id="cb463-9"><a href="exploratory-data-analysis.html#cb463-9" aria-hidden="true" tabindex="-1"></a>  delay_2019 <span class="sc">%&gt;%</span></span>
<span id="cb463-10"><a href="exploratory-data-analysis.html#cb463-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code_srt =</span> <span class="fu">ifelse</span>(line<span class="sc">==</span><span class="st">&quot;SRT&quot;</span>, code, <span class="st">&quot;NA&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb463-11"><a href="exploratory-data-analysis.html#cb463-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delay_codes <span class="sc">%&gt;%</span> </span>
<span id="cb463-12"><a href="exploratory-data-analysis.html#cb463-12" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">code_srt =</span> <span class="st">`</span><span class="at">SRT RMENU CODE</span><span class="st">`</span>, <span class="at">code_desc_srt =</span> <span class="st">`</span><span class="at">CODE DESCRIPTION...7</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb463-13"><a href="exploratory-data-analysis.html#cb463-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(code_srt, code_desc_srt)) <span class="sc">%&gt;%</span> </span>
<span id="cb463-14"><a href="exploratory-data-analysis.html#cb463-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code =</span> <span class="fu">ifelse</span>(code_srt<span class="sc">==</span><span class="st">&quot;NA&quot;</span>, code, code_srt),</span>
<span id="cb463-15"><a href="exploratory-data-analysis.html#cb463-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">code_desc =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(code_desc_srt), code_desc, code_desc_srt)) <span class="sc">%&gt;%</span> </span>
<span id="cb463-16"><a href="exploratory-data-analysis.html#cb463-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>code_srt, <span class="sc">-</span>code_desc_srt)</span></code></pre></div>
<p>And so we can see that the 455 minute delay was due to ‘Rail Related Problem’ and seems to very much be an outlier.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="exploratory-data-analysis.html#cb464-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb464-2"><a href="exploratory-data-analysis.html#cb464-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(delay_codes <span class="sc">%&gt;%</span> </span>
<span id="cb464-3"><a href="exploratory-data-analysis.html#cb464-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">code =</span> <span class="st">`</span><span class="at">SUB RMENU CODE</span><span class="st">`</span>, <span class="at">code_desc =</span> <span class="st">`</span><span class="at">CODE DESCRIPTION...3</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb464-4"><a href="exploratory-data-analysis.html#cb464-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(code, code_desc)) <span class="sc">%&gt;%</span> </span>
<span id="cb464-5"><a href="exploratory-data-analysis.html#cb464-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>min_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb464-6"><a href="exploratory-data-analysis.html#cb464-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, time, station, line, min_delay, code, code_desc)</span></code></pre></div>
<pre><code>## # A tibble: 18,697 x 7
##    date                time  station     line  min_delay code  code_desc        
##    &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;            
##  1 2019-06-25 00:00:00 18:48 WILSON TO … YU          455 PUTR  Rail Related Pro…
##  2 2019-02-12 00:00:00 20:28 LAWRENCE E… SRT         284 MRWEA Weather Reports …
##  3 2019-06-05 00:00:00 12:42 UNION TO S… YU          250 MUPLA Fire/Smoke Plan A
##  4 2019-10-22 00:00:00 14:22 LAWRENCE S… YU          228 PUTS  Structure Relate…
##  5 2019-09-26 00:00:00 11:38 YORK MILLS… YU          193 MUPR1 Priority One - T…
##  6 2019-06-08 00:00:00 08:51 SPADINA BD… BD          180 MUPLB Fire/Smoke Plan …
##  7 2019-12-02 00:00:00 06:59 DUNDAS WES… BD          176 MUPLB Fire/Smoke Plan …
##  8 2019-01-29 00:00:00 05:46 VICTORIA P… BD          174 MUWEA Weather Reports …
##  9 2019-02-22 00:00:00 17:32 ELLESMERE … SRT         168 PRW   Rail Defect/Fast…
## 10 2019-02-10 00:00:00 07:53 BAYVIEW ST… SHP         165 PUSI  Signals or Relat…
## # … with 18,687 more rows</code></pre>
</div>
<div id="groups-and-small-counts" class="section level3" number="13.2.7">
<h3><span class="header-section-number">13.2.7</span> Groups and small counts</h3>
<p>Another thing that we’re looking for is various groupings of the data, especially where sub-groups may end up with small numbers of observations in them (because any analysis could be easily influenced by them). A quick way to do this is to group the data by a variable that is of interest, for instance ‘line,’ using colour.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="exploratory-data-analysis.html#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> delay_2019) <span class="sc">+</span> </span>
<span id="cb466-2"><a href="exploratory-data-analysis.html#cb466-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay, <span class="at">y =</span> ..density.., <span class="at">fill =</span> line), </span>
<span id="cb466-3"><a href="exploratory-data-analysis.html#cb466-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">&#39;dodge&#39;</span>, </span>
<span id="cb466-4"><a href="exploratory-data-analysis.html#cb466-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb466-5"><a href="exploratory-data-analysis.html#cb466-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-275-1.png" width="672" /></p>
<p>That plot uses density so that we can look at the the distributions more comparably, but we should also be aware of differences in frequency. In this case, we’ll see that SHP and SRT have much smaller counts.</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="exploratory-data-analysis.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> delay_2019) <span class="sc">+</span> </span>
<span id="cb467-2"><a href="exploratory-data-analysis.html#cb467-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay, <span class="at">fill =</span> line), </span>
<span id="cb467-3"><a href="exploratory-data-analysis.html#cb467-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position =</span> <span class="st">&#39;dodge&#39;</span>, </span>
<span id="cb467-4"><a href="exploratory-data-analysis.html#cb467-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb467-5"><a href="exploratory-data-analysis.html#cb467-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-276-1.png" width="672" /></p>
<p>To group by a second variable it can be useful to use facets. They’re a little fiddly initially, but once you get used to them, they’re both quick and powerful.</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="exploratory-data-analysis.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> delay_2019) <span class="sc">+</span> </span>
<span id="cb468-2"><a href="exploratory-data-analysis.html#cb468-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay, <span class="at">color =</span> day), </span>
<span id="cb468-3"><a href="exploratory-data-analysis.html#cb468-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">bw =</span> .<span class="dv">08</span>) <span class="sc">+</span> </span>
<span id="cb468-4"><a href="exploratory-data-analysis.html#cb468-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb468-5"><a href="exploratory-data-analysis.html#cb468-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>line)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-277-1.png" width="672" /></p>
<p>As an aside, the station names are a mess. We could try to quickly bring a little order to the chaos by just taking just the first word (or, the first two if it starts with ‘ST’).</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="exploratory-data-analysis.html#cb469-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="ot">&lt;-</span> </span>
<span id="cb469-2"><a href="exploratory-data-analysis.html#cb469-2" aria-hidden="true" tabindex="-1"></a>  delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb469-3"><a href="exploratory-data-analysis.html#cb469-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">station_clean =</span> <span class="fu">ifelse</span>(<span class="fu">str_starts</span>(station, <span class="st">&quot;ST&quot;</span>), <span class="fu">word</span>(station, <span class="dv">1</span>,<span class="dv">2</span>), <span class="fu">word</span>(station, <span class="dv">1</span>)))</span></code></pre></div>
<p>We can now plot the top five stations by mean delay.</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="exploratory-data-analysis.html#cb470-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb470-2"><a href="exploratory-data-analysis.html#cb470-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(line, station_clean) <span class="sc">%&gt;%</span> </span>
<span id="cb470-3"><a href="exploratory-data-analysis.html#cb470-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(min_delay), <span class="at">n_obs =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb470-4"><a href="exploratory-data-analysis.html#cb470-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_obs<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb470-5"><a href="exploratory-data-analysis.html#cb470-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(line, <span class="sc">-</span>mean_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb470-6"><a href="exploratory-data-analysis.html#cb470-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb470-7"><a href="exploratory-data-analysis.html#cb470-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(station_clean, mean_delay)) <span class="sc">+</span> </span>
<span id="cb470-8"><a href="exploratory-data-analysis.html#cb470-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb470-9"><a href="exploratory-data-analysis.html#cb470-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb470-10"><a href="exploratory-data-analysis.html#cb470-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>line, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-279-1.png" width="672" /></p>
</div>
<div id="visualizing-time-series" class="section level3" number="13.2.8">
<h3><span class="header-section-number">13.2.8</span> Visualizing time series</h3>
<p>Dates are a pain to work with. They always go wrong and give issues, and so they are a critical aspect to explore during EDA. The daily plot of this data is, well, very messy (you can check for yourself). Instead, let’s look by week to see if there’s any seasonality. The <code>lubridate</code> package <span class="citation">(<a href="references-1.html#ref-GrolemundWickham2011" role="doc-biblioref">Grolemund and Wickham 2011</a>)</span> has a lot of helpful functions that deal with date variables. It’s essentially indispensable.</p>
<p>To get started, let’s look at mean delay (of those that were delayed more than zero minutes).</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="exploratory-data-analysis.html#cb471-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb471-2"><a href="exploratory-data-analysis.html#cb471-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(min_delay<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb471-3"><a href="exploratory-data-analysis.html#cb471-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">week</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb471-4"><a href="exploratory-data-analysis.html#cb471-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(week, line) <span class="sc">%&gt;%</span> </span>
<span id="cb471-5"><a href="exploratory-data-analysis.html#cb471-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(min_delay)) <span class="sc">%&gt;%</span> </span>
<span id="cb471-6"><a href="exploratory-data-analysis.html#cb471-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(week, mean_delay, <span class="at">color =</span> line)) <span class="sc">+</span> </span>
<span id="cb471-7"><a href="exploratory-data-analysis.html#cb471-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb471-8"><a href="exploratory-data-analysis.html#cb471-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb471-9"><a href="exploratory-data-analysis.html#cb471-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="sc">~</span>line)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-280-1.png" width="672" /></p>
<p>Now let’s look at the proportion of delays that were greater than 10 minutes.</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="exploratory-data-analysis.html#cb472-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb472-2"><a href="exploratory-data-analysis.html#cb472-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">week</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb472-3"><a href="exploratory-data-analysis.html#cb472-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(week, line) <span class="sc">%&gt;%</span> </span>
<span id="cb472-4"><a href="exploratory-data-analysis.html#cb472-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop_delay =</span> <span class="fu">sum</span>(min_delay<span class="sc">&gt;</span><span class="dv">10</span>)<span class="sc">/</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb472-5"><a href="exploratory-data-analysis.html#cb472-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(week, prop_delay, <span class="at">color =</span> line)) <span class="sc">+</span> </span>
<span id="cb472-6"><a href="exploratory-data-analysis.html#cb472-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb472-7"><a href="exploratory-data-analysis.html#cb472-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>() <span class="sc">+</span> </span>
<span id="cb472-8"><a href="exploratory-data-analysis.html#cb472-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="sc">~</span>line)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-281-1.png" width="672" /></p>
<p>Again, and it’s important to be clear here. These charts and tables and analyse have no place in a final report, but what they are doing is allowing you to become comfortable with the data. If you were doing this yourself, you should additionally be making notes about each plot and table as you go, noting the warnings and any implications or aspects to return to.</p>
</div>
<div id="visualizing-relationships" class="section level3" number="13.2.9">
<h3><span class="header-section-number">13.2.9</span> Visualizing relationships</h3>
<p>We are also interested in looking at the relationship between two variables. Scatter plots are especially useful here for continuous variables, and are a good precursor to modeling. We saw a little of that with ‘mean_delay’ and ‘week.’</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="exploratory-data-analysis.html#cb473-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="sc">%&gt;%</span></span>
<span id="cb473-2"><a href="exploratory-data-analysis.html#cb473-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> min_delay, <span class="at">y =</span> min_gap)) <span class="sc">+</span></span>
<span id="cb473-3"><a href="exploratory-data-analysis.html#cb473-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb473-4"><a href="exploratory-data-analysis.html#cb473-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb473-5"><a href="exploratory-data-analysis.html#cb473-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-282-1.png" width="672" /></p>
<p>The relationship between categorical variables takes more work, but we could also, for instance, look at the top five reasons for delay by station. In particular, we may be interested in whether they differ, and how any difference could be modelled.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="exploratory-data-analysis.html#cb474-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="sc">%&gt;%</span></span>
<span id="cb474-2"><a href="exploratory-data-analysis.html#cb474-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(line, code_desc) <span class="sc">%&gt;%</span></span>
<span id="cb474-3"><a href="exploratory-data-analysis.html#cb474-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_delay =</span> <span class="fu">mean</span>(min_delay)) <span class="sc">%&gt;%</span></span>
<span id="cb474-4"><a href="exploratory-data-analysis.html#cb474-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>mean_delay) <span class="sc">%&gt;%</span></span>
<span id="cb474-5"><a href="exploratory-data-analysis.html#cb474-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb474-6"><a href="exploratory-data-analysis.html#cb474-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> code_desc,</span>
<span id="cb474-7"><a href="exploratory-data-analysis.html#cb474-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> mean_delay)) <span class="sc">+</span></span>
<span id="cb474-8"><a href="exploratory-data-analysis.html#cb474-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb474-9"><a href="exploratory-data-analysis.html#cb474-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(line), </span>
<span id="cb474-10"><a href="exploratory-data-analysis.html#cb474-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,</span>
<span id="cb474-11"><a href="exploratory-data-analysis.html#cb474-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb474-12"><a href="exploratory-data-analysis.html#cb474-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-283-1.png" width="672" /></p>
</div>
<div id="principal-components-analysis" class="section level3" number="13.2.10">
<h3><span class="header-section-number">13.2.10</span> Principal components analysis</h3>
<p>Principal components analysis (PCA) is another powerful exploratory tool. It allows you to pick up potential clusters and/or outliers that can help to inform model building. To see this let’s do a quick (and imperfect) example looking at types of delays by station.</p>
<p>The delay categories are a bit of a mess, and there’s hundreds of them. As a simple start, remembering that our task is to come to terms with the dataset as quickly as possible, let’s just take the first word.</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="exploratory-data-analysis.html#cb475-1" aria-hidden="true" tabindex="-1"></a>delay_2019 <span class="ot">&lt;-</span> delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb475-2"><a href="exploratory-data-analysis.html#cb475-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code_red =</span> <span class="fu">case_when</span>(</span>
<span id="cb475-3"><a href="exploratory-data-analysis.html#cb475-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_starts</span>(code_desc, <span class="st">&quot;No&quot;</span>) <span class="sc">~</span> <span class="fu">word</span>(code_desc, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb475-4"><a href="exploratory-data-analysis.html#cb475-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_starts</span>(code_desc, <span class="st">&quot;Operator&quot;</span>) <span class="sc">~</span> <span class="fu">word</span>(code_desc, <span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb475-5"><a href="exploratory-data-analysis.html#cb475-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">word</span>(code_desc,<span class="dv">1</span>))</span>
<span id="cb475-6"><a href="exploratory-data-analysis.html#cb475-6" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>Let’s also just restrict the analysis to causes that happen at least 50 times over 2019. To do the PCA, the dataframe also needs to be switched to wide format.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="exploratory-data-analysis.html#cb476-1" aria-hidden="true" tabindex="-1"></a>dwide <span class="ot">&lt;-</span> delay_2019 <span class="sc">%&gt;%</span> </span>
<span id="cb476-2"><a href="exploratory-data-analysis.html#cb476-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(line, station_clean) <span class="sc">%&gt;%</span> </span>
<span id="cb476-3"><a href="exploratory-data-analysis.html#cb476-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_obs =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb476-4"><a href="exploratory-data-analysis.html#cb476-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_obs<span class="sc">&gt;</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb476-5"><a href="exploratory-data-analysis.html#cb476-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(code_red) <span class="sc">%&gt;%</span> </span>
<span id="cb476-6"><a href="exploratory-data-analysis.html#cb476-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_delay =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb476-7"><a href="exploratory-data-analysis.html#cb476-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(tot_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb476-8"><a href="exploratory-data-analysis.html#cb476-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tot_delay<span class="sc">&gt;</span><span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb476-9"><a href="exploratory-data-analysis.html#cb476-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(line, station_clean, code_red) <span class="sc">%&gt;%</span> </span>
<span id="cb476-10"><a href="exploratory-data-analysis.html#cb476-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_delay =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb476-11"><a href="exploratory-data-analysis.html#cb476-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> code_red, <span class="at">values_from =</span> n_delay) <span class="sc">%&gt;%</span> </span>
<span id="cb476-12"><a href="exploratory-data-analysis.html#cb476-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="at">.funs =</span> <span class="fu">funs</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .)))</span></code></pre></div>
<p>Now we can quickly do some PCA.</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="exploratory-data-analysis.html#cb477-1" aria-hidden="true" tabindex="-1"></a>delay_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(dwide[,<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dwide)])</span>
<span id="cb477-2"><a href="exploratory-data-analysis.html#cb477-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-3"><a href="exploratory-data-analysis.html#cb477-3" aria-hidden="true" tabindex="-1"></a>df_out <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(delay_pca<span class="sc">$</span>x)</span>
<span id="cb477-4"><a href="exploratory-data-analysis.html#cb477-4" aria-hidden="true" tabindex="-1"></a>df_out <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(dwide <span class="sc">%&gt;%</span> <span class="fu">select</span>(line, station_clean), df_out)</span>
<span id="cb477-5"><a href="exploratory-data-analysis.html#cb477-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_out)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 40
## # Groups:   line, station_clean [6]
##   line  station_clean    PC1     PC2    PC3    PC4    PC5      PC6   PC7   PC8
##   &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 BD    BATHURST        6.50   26.9   -2.71 -10.8  -8.40  -11.7    -3.33 -4.11
## 2 BD    BAY            24.8     7.63  -2.19  -7.05  0.714   3.90   -2.29 -4.14
## 3 BD    BLOOR         -62.4  -112.    57.3  -23.4  -5.09  -14.1    13.7   5.06
## 4 BD    BROADVIEW      -6.60   28.1   -1.06 -14.0  -6.49   -8.29   -6.29 -1.40
## 5 BD    CASTLE         23.8    11.8   -1.31  -7.93 -3.62   -3.37   -2.08 -3.48
## 6 BD    CHESTER        24.6    -1.87 -18.6    2.75  1.85    0.0736  3.79 -1.27
## # … with 30 more variables: PC9 &lt;dbl&gt;, PC10 &lt;dbl&gt;, PC11 &lt;dbl&gt;, PC12 &lt;dbl&gt;,
## #   PC13 &lt;dbl&gt;, PC14 &lt;dbl&gt;, PC15 &lt;dbl&gt;, PC16 &lt;dbl&gt;, PC17 &lt;dbl&gt;, PC18 &lt;dbl&gt;,
## #   PC19 &lt;dbl&gt;, PC20 &lt;dbl&gt;, PC21 &lt;dbl&gt;, PC22 &lt;dbl&gt;, PC23 &lt;dbl&gt;, PC24 &lt;dbl&gt;,
## #   PC25 &lt;dbl&gt;, PC26 &lt;dbl&gt;, PC27 &lt;dbl&gt;, PC28 &lt;dbl&gt;, PC29 &lt;dbl&gt;, PC30 &lt;dbl&gt;,
## #   PC31 &lt;dbl&gt;, PC32 &lt;dbl&gt;, PC33 &lt;dbl&gt;, PC34 &lt;dbl&gt;, PC35 &lt;dbl&gt;, PC36 &lt;dbl&gt;,
## #   PC37 &lt;dbl&gt;, PC38 &lt;dbl&gt;</code></pre>
<p>We can plot the first two principal components, and add labels to some of the outlying stations.</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="exploratory-data-analysis.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_out,<span class="fu">aes</span>(<span class="at">x=</span>PC1,<span class="at">y=</span>PC2,<span class="at">color=</span>line )) <span class="sc">+</span> </span>
<span id="cb479-2"><a href="exploratory-data-analysis.html#cb479-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb479-3"><a href="exploratory-data-analysis.html#cb479-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> df_out <span class="sc">%&gt;%</span> <span class="fu">filter</span>(PC2<span class="sc">&gt;</span><span class="dv">100</span><span class="sc">|</span>PC1<span class="sc">&lt;</span><span class="dv">100</span><span class="sc">*-</span><span class="dv">1</span>), </span>
<span id="cb479-4"><a href="exploratory-data-analysis.html#cb479-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> station_clean)</span>
<span id="cb479-5"><a href="exploratory-data-analysis.html#cb479-5" aria-hidden="true" tabindex="-1"></a>                  )</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-287-1.png" width="672" /></p>
<p>We could also plot the factor loadings. We se some evidence that perhaps one is to do with the public, compared with another to do with the operator.</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="exploratory-data-analysis.html#cb480-1" aria-hidden="true" tabindex="-1"></a>df_out_r <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(delay_pca<span class="sc">$</span>rotation)</span>
<span id="cb480-2"><a href="exploratory-data-analysis.html#cb480-2" aria-hidden="true" tabindex="-1"></a>df_out_r<span class="sc">$</span>feature <span class="ot">&lt;-</span> <span class="fu">colnames</span>(dwide[,<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(dwide)])</span>
<span id="cb480-3"><a href="exploratory-data-analysis.html#cb480-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4"><a href="exploratory-data-analysis.html#cb480-4" aria-hidden="true" tabindex="-1"></a>df_out_r</span></code></pre></div>
<pre><code>## # A tibble: 38 x 39
##         PC1      PC2        PC3       PC4      PC5      PC6      PC7     PC8
##       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 -0.0412   0.0638   0.0133    -0.0467    0.0246   0.0184  -0.00363  0.0198
##  2 -0.0332  -0.00469 -0.0414    -0.00751   0.0201  -0.0122  -0.0914  -0.0903
##  3 -0.135    0.207    0.0237    -0.144     0.135   -0.0381  -0.00931 -0.320 
##  4 -0.0652   0.0475  -0.0443    -0.0251   -0.00139 -0.0748  -0.144   -0.428 
##  5 -0.00443  0.00878 -0.0000499 -0.000830  0.00967  0.00954 -0.0160  -0.0144
##  6 -0.0268  -0.00722 -0.00439    0.000534 -0.0151  -0.0125  -0.00381 -0.0423
##  7 -0.0813   0.0960  -0.0462     0.0479   -0.0978  -0.0365  -0.0766   0.278 
##  8 -0.0117   0.0135   0.00548   -0.0294    0.0125   0.0377  -0.0790  -0.0321
##  9 -0.516    0.655   -0.0177    -0.162    -0.221   -0.287   -0.184    0.0465
## 10 -0.151    0.0826   0.0548     0.352    -0.397    0.281    0.110    0.477 
## # … with 28 more rows, and 31 more variables: PC9 &lt;dbl&gt;, PC10 &lt;dbl&gt;,
## #   PC11 &lt;dbl&gt;, PC12 &lt;dbl&gt;, PC13 &lt;dbl&gt;, PC14 &lt;dbl&gt;, PC15 &lt;dbl&gt;, PC16 &lt;dbl&gt;,
## #   PC17 &lt;dbl&gt;, PC18 &lt;dbl&gt;, PC19 &lt;dbl&gt;, PC20 &lt;dbl&gt;, PC21 &lt;dbl&gt;, PC22 &lt;dbl&gt;,
## #   PC23 &lt;dbl&gt;, PC24 &lt;dbl&gt;, PC25 &lt;dbl&gt;, PC26 &lt;dbl&gt;, PC27 &lt;dbl&gt;, PC28 &lt;dbl&gt;,
## #   PC29 &lt;dbl&gt;, PC30 &lt;dbl&gt;, PC31 &lt;dbl&gt;, PC32 &lt;dbl&gt;, PC33 &lt;dbl&gt;, PC34 &lt;dbl&gt;,
## #   PC35 &lt;dbl&gt;, PC36 &lt;dbl&gt;, PC37 &lt;dbl&gt;, PC38 &lt;dbl&gt;, feature &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="exploratory-data-analysis.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_out_r,<span class="fu">aes</span>(<span class="at">x=</span>PC1,<span class="at">y=</span>PC2,<span class="at">label=</span>feature )) <span class="sc">+</span> <span class="fu">geom_text_repel</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-288-1.png" width="672" /></p>
</div>
</div>
<div id="case-study---opinions-about-a-casino-in-toronto" class="section level2" number="13.3">
<h2><span class="header-section-number">13.3</span> Case study - Opinions about a casino in Toronto</h2>
<p><strong>This was written by <a href="https://michael-chong.github.io">Michael Chong</a>.</strong></p>
<div id="data-preparation" class="section level3" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Data preparation</h3>
<p>Here we use the <code>opendatatoronto</code> package again. See the previous case study for a deeper explanation of how the code below works.</p>
<p>The dataset I’m extracting below are the results from a survey in 2012 regarding the establishment of a casino in Toronto. More info available by following <a href="https://open.toronto.ca/dataset/casino-survey-results/">this link</a>. In this analysis, we’ll be hoping to address the question: which demographic (age/gender) groups are more likely to be supportive of a new casino in Toronto?</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="exploratory-data-analysis.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the data</span></span>
<span id="cb483-2"><a href="exploratory-data-analysis.html#cb483-2" aria-hidden="true" tabindex="-1"></a>casino_resource <span class="ot">&lt;-</span> </span>
<span id="cb483-3"><a href="exploratory-data-analysis.html#cb483-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">search_packages</span>(<span class="st">&quot;casino survey&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb483-4"><a href="exploratory-data-analysis.html#cb483-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list_package_resources</span>() <span class="sc">%&gt;%</span></span>
<span id="cb483-5"><a href="exploratory-data-analysis.html#cb483-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;toronto-casino-survey-results&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb483-6"><a href="exploratory-data-analysis.html#cb483-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_resource</span>()</span>
<span id="cb483-7"><a href="exploratory-data-analysis.html#cb483-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(casino_resource)</span></code></pre></div>
<pre><code>## $tblSurvey
## # A tibble: 17,766 x 94
##    SurveyID Q1_A   Q1_B1  Q1_B2  Q1_B3 Q2_A  Q2_B  Q3_A  Q3_B  Q3_C  Q3_D  Q3_E 
##       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1        1 Stron… Do no… Do no… Do n… Does… &quot;As … Not … Very… Not … Not … Not …
##  2        2 Stron… Econo… Jobs   Arts… Fits… &quot;Cos… Very… Very… Very… Very… Very…
##  3        3 Stron… There… If to… &lt;NA&gt;  Fits… &quot;Big… Very… Very… Very… Very… Very…
##  4        4 Somew… belie… money… evid… Does… &quot;My … Very… Very… Some… Some… Very…
##  5        5 Neutr… Like … Conce… &lt;NA&gt;  Neut… &quot;Aga… Very… Very… Very… Not … Very…
##  6        6 Stron… have … &lt;NA&gt;   &lt;NA&gt;  Does… &quot;Tor… Not … Not … Not … Not … Not …
##  7        7 Stron… The o… Peopl… We s… Does… &quot;#3 … Not … Not … Not … Not … Not …
##  8        8 Stron… It wi… Moral… &lt;NA&gt;  Does… &quot;Cas… Very… Very… Very… Very… Very…
##  9        9 Stron… It&#39;s … traff… heal… Does… &quot;No … Not … Very… Not … Not … Some…
## 10       10 Stron… Toron… Avoid… Prov… Fits… &quot;Tor… Very… Very… Very… Not … Very…
## # … with 17,756 more rows, and 82 more variables: Q3_F &lt;chr&gt;, Q3_G &lt;chr&gt;,
## #   Q3_H &lt;chr&gt;, Q3_I &lt;chr&gt;, Q3_J &lt;chr&gt;, Q3_K &lt;chr&gt;, Q3_L &lt;chr&gt;, Q3_M &lt;chr&gt;,
## #   Q3_N &lt;chr&gt;, Q3_O &lt;chr&gt;, Q3_P &lt;chr&gt;, Q3_Q &lt;chr&gt;, Q3_Q_Other &lt;chr&gt;,
## #   Q3_Comments &lt;chr&gt;, Q4_A &lt;chr&gt;, Q5 &lt;chr&gt;, Q6 &lt;chr&gt;, Q6_Comments &lt;chr&gt;,
## #   Q7_A_StandAlone &lt;chr&gt;, Q7_A_Integrated &lt;chr&gt;, Q7_A1 &lt;chr&gt;, Q7_A2 &lt;chr&gt;,
## #   Q7_A3 &lt;chr&gt;, Q7_A_A &lt;chr&gt;, Q7_A_B &lt;chr&gt;, Q7_A_C &lt;chr&gt;, Q7_A_D &lt;chr&gt;,
## #   Q7_A_E &lt;chr&gt;, Q7_A_F &lt;chr&gt;, Q7_A_G &lt;chr&gt;, Q7_A_H &lt;chr&gt;, Q7_A_I &lt;chr&gt;,
## #   Q7_A_J &lt;chr&gt;, Q7_A_J_Other &lt;chr&gt;, Q7_B_StandAlone &lt;chr&gt;,
## #   Q7_B_Integrated &lt;chr&gt;, Q7_B1 &lt;chr&gt;, Q7_B2 &lt;chr&gt;, Q7_B3 &lt;chr&gt;, Q7_B_A &lt;chr&gt;,
## #   Q7_B_B &lt;chr&gt;, Q7_B_C &lt;chr&gt;, Q7_B_D &lt;chr&gt;, Q7_B_E &lt;chr&gt;, Q7_B_F &lt;chr&gt;,
## #   Q7_B_G &lt;chr&gt;, Q7_B_H &lt;chr&gt;, Q7_B_I &lt;chr&gt;, Q7_B_J &lt;chr&gt;, Q7_B_J_Other &lt;chr&gt;,
## #   Q7_C_StandAlone &lt;chr&gt;, Q7_C_Integrated &lt;chr&gt;, Q7_C1 &lt;chr&gt;, Q7_C2 &lt;chr&gt;,
## #   Q7_C3 &lt;chr&gt;, Q7_C_A &lt;chr&gt;, Q7_C_B &lt;chr&gt;, Q7_C_C &lt;chr&gt;, Q7_C_D &lt;chr&gt;,
## #   Q7_C_E &lt;chr&gt;, Q7_C_F &lt;chr&gt;, Q7_C_G &lt;chr&gt;, Q7_C_H &lt;chr&gt;, Q7_C_I &lt;chr&gt;,
## #   Q7_C_J &lt;chr&gt;, Q7_C_J_Other &lt;chr&gt;, Q8_A1 &lt;chr&gt;, Q8_A2 &lt;chr&gt;, Q8_B1 &lt;chr&gt;,
## #   Q8_B2 &lt;chr&gt;, Q8_B3 &lt;chr&gt;, Q9 &lt;chr&gt;, Q9_Considerations &lt;chr&gt;, Q10 &lt;chr&gt;,
## #   Q11 &lt;chr&gt;, Age &lt;chr&gt;, Gender &lt;chr&gt;, PostalCode &lt;chr&gt;, GroupName &lt;chr&gt;,
## #   DateCreated &lt;dttm&gt;, ...93 &lt;lgl&gt;, ...94 &lt;lgl&gt;
## 
## $Sheet1
## # A tibble: 0 x 0</code></pre>
<p>The object <code>casino_resource</code> isn’t quite useable yet, because it’s (inconveniently) stored as a <code>list</code> of 2 data frames:</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="exploratory-data-analysis.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check what kind of object the casino_resource object is</span></span>
<span id="cb485-2"><a href="exploratory-data-analysis.html#cb485-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(casino_resource)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<p>If we just return the object, we can see that the second list item is empty, and we just want to keep the first one:</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="exploratory-data-analysis.html#cb487-1" aria-hidden="true" tabindex="-1"></a>casino_resource</span></code></pre></div>
<pre><code>## $tblSurvey
## # A tibble: 17,766 x 94
##    SurveyID Q1_A   Q1_B1  Q1_B2  Q1_B3 Q2_A  Q2_B  Q3_A  Q3_B  Q3_C  Q3_D  Q3_E 
##       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1        1 Stron… Do no… Do no… Do n… Does… &quot;As … Not … Very… Not … Not … Not …
##  2        2 Stron… Econo… Jobs   Arts… Fits… &quot;Cos… Very… Very… Very… Very… Very…
##  3        3 Stron… There… If to… &lt;NA&gt;  Fits… &quot;Big… Very… Very… Very… Very… Very…
##  4        4 Somew… belie… money… evid… Does… &quot;My … Very… Very… Some… Some… Very…
##  5        5 Neutr… Like … Conce… &lt;NA&gt;  Neut… &quot;Aga… Very… Very… Very… Not … Very…
##  6        6 Stron… have … &lt;NA&gt;   &lt;NA&gt;  Does… &quot;Tor… Not … Not … Not … Not … Not …
##  7        7 Stron… The o… Peopl… We s… Does… &quot;#3 … Not … Not … Not … Not … Not …
##  8        8 Stron… It wi… Moral… &lt;NA&gt;  Does… &quot;Cas… Very… Very… Very… Very… Very…
##  9        9 Stron… It&#39;s … traff… heal… Does… &quot;No … Not … Very… Not … Not … Some…
## 10       10 Stron… Toron… Avoid… Prov… Fits… &quot;Tor… Very… Very… Very… Not … Very…
## # … with 17,756 more rows, and 82 more variables: Q3_F &lt;chr&gt;, Q3_G &lt;chr&gt;,
## #   Q3_H &lt;chr&gt;, Q3_I &lt;chr&gt;, Q3_J &lt;chr&gt;, Q3_K &lt;chr&gt;, Q3_L &lt;chr&gt;, Q3_M &lt;chr&gt;,
## #   Q3_N &lt;chr&gt;, Q3_O &lt;chr&gt;, Q3_P &lt;chr&gt;, Q3_Q &lt;chr&gt;, Q3_Q_Other &lt;chr&gt;,
## #   Q3_Comments &lt;chr&gt;, Q4_A &lt;chr&gt;, Q5 &lt;chr&gt;, Q6 &lt;chr&gt;, Q6_Comments &lt;chr&gt;,
## #   Q7_A_StandAlone &lt;chr&gt;, Q7_A_Integrated &lt;chr&gt;, Q7_A1 &lt;chr&gt;, Q7_A2 &lt;chr&gt;,
## #   Q7_A3 &lt;chr&gt;, Q7_A_A &lt;chr&gt;, Q7_A_B &lt;chr&gt;, Q7_A_C &lt;chr&gt;, Q7_A_D &lt;chr&gt;,
## #   Q7_A_E &lt;chr&gt;, Q7_A_F &lt;chr&gt;, Q7_A_G &lt;chr&gt;, Q7_A_H &lt;chr&gt;, Q7_A_I &lt;chr&gt;,
## #   Q7_A_J &lt;chr&gt;, Q7_A_J_Other &lt;chr&gt;, Q7_B_StandAlone &lt;chr&gt;,
## #   Q7_B_Integrated &lt;chr&gt;, Q7_B1 &lt;chr&gt;, Q7_B2 &lt;chr&gt;, Q7_B3 &lt;chr&gt;, Q7_B_A &lt;chr&gt;,
## #   Q7_B_B &lt;chr&gt;, Q7_B_C &lt;chr&gt;, Q7_B_D &lt;chr&gt;, Q7_B_E &lt;chr&gt;, Q7_B_F &lt;chr&gt;,
## #   Q7_B_G &lt;chr&gt;, Q7_B_H &lt;chr&gt;, Q7_B_I &lt;chr&gt;, Q7_B_J &lt;chr&gt;, Q7_B_J_Other &lt;chr&gt;,
## #   Q7_C_StandAlone &lt;chr&gt;, Q7_C_Integrated &lt;chr&gt;, Q7_C1 &lt;chr&gt;, Q7_C2 &lt;chr&gt;,
## #   Q7_C3 &lt;chr&gt;, Q7_C_A &lt;chr&gt;, Q7_C_B &lt;chr&gt;, Q7_C_C &lt;chr&gt;, Q7_C_D &lt;chr&gt;,
## #   Q7_C_E &lt;chr&gt;, Q7_C_F &lt;chr&gt;, Q7_C_G &lt;chr&gt;, Q7_C_H &lt;chr&gt;, Q7_C_I &lt;chr&gt;,
## #   Q7_C_J &lt;chr&gt;, Q7_C_J_Other &lt;chr&gt;, Q8_A1 &lt;chr&gt;, Q8_A2 &lt;chr&gt;, Q8_B1 &lt;chr&gt;,
## #   Q8_B2 &lt;chr&gt;, Q8_B3 &lt;chr&gt;, Q9 &lt;chr&gt;, Q9_Considerations &lt;chr&gt;, Q10 &lt;chr&gt;,
## #   Q11 &lt;chr&gt;, Age &lt;chr&gt;, Gender &lt;chr&gt;, PostalCode &lt;chr&gt;, GroupName &lt;chr&gt;,
## #   DateCreated &lt;dttm&gt;, ...93 &lt;lgl&gt;, ...94 &lt;lgl&gt;
## 
## $Sheet1
## # A tibble: 0 x 0</code></pre>
<p>So, let’s only keep the first item by indexing the list with double square brackets:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="exploratory-data-analysis.html#cb489-1" aria-hidden="true" tabindex="-1"></a>casino_data <span class="ot">&lt;-</span> casino_resource[[<span class="dv">1</span>]]</span></code></pre></div>
<p>Let’s check out what the first couple rows of the dataframe looks like. By default, <code>head()</code> returns the first 6 rows:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="exploratory-data-analysis.html#cb490-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(casino_data) </span></code></pre></div>
<pre><code>## # A tibble: 6 x 94
##   SurveyID Q1_A   Q1_B1  Q1_B2  Q1_B3  Q2_A  Q2_B  Q3_A  Q3_B  Q3_C  Q3_D  Q3_E 
##      &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1        1 Stron… Do no… Do no… Do no… Does… &quot;As … Not … Very… Not … Not … Not …
## 2        2 Stron… Econo… Jobs   Arts … Fits… &quot;Cos… Very… Very… Very… Very… Very…
## 3        3 Stron… There… If to… &lt;NA&gt;   Fits… &quot;Big… Very… Very… Very… Very… Very…
## 4        4 Somew… belie… money… evide… Does… &quot;My … Very… Very… Some… Some… Very…
## 5        5 Neutr… Like … Conce… &lt;NA&gt;   Neut… &quot;Aga… Very… Very… Very… Not … Very…
## 6        6 Stron… have … &lt;NA&gt;   &lt;NA&gt;   Does… &quot;Tor… Not … Not … Not … Not … Not …
## # … with 82 more variables: Q3_F &lt;chr&gt;, Q3_G &lt;chr&gt;, Q3_H &lt;chr&gt;, Q3_I &lt;chr&gt;,
## #   Q3_J &lt;chr&gt;, Q3_K &lt;chr&gt;, Q3_L &lt;chr&gt;, Q3_M &lt;chr&gt;, Q3_N &lt;chr&gt;, Q3_O &lt;chr&gt;,
## #   Q3_P &lt;chr&gt;, Q3_Q &lt;chr&gt;, Q3_Q_Other &lt;chr&gt;, Q3_Comments &lt;chr&gt;, Q4_A &lt;chr&gt;,
## #   Q5 &lt;chr&gt;, Q6 &lt;chr&gt;, Q6_Comments &lt;chr&gt;, Q7_A_StandAlone &lt;chr&gt;,
## #   Q7_A_Integrated &lt;chr&gt;, Q7_A1 &lt;chr&gt;, Q7_A2 &lt;chr&gt;, Q7_A3 &lt;chr&gt;, Q7_A_A &lt;chr&gt;,
## #   Q7_A_B &lt;chr&gt;, Q7_A_C &lt;chr&gt;, Q7_A_D &lt;chr&gt;, Q7_A_E &lt;chr&gt;, Q7_A_F &lt;chr&gt;,
## #   Q7_A_G &lt;chr&gt;, Q7_A_H &lt;chr&gt;, Q7_A_I &lt;chr&gt;, Q7_A_J &lt;chr&gt;, Q7_A_J_Other &lt;chr&gt;,
## #   Q7_B_StandAlone &lt;chr&gt;, Q7_B_Integrated &lt;chr&gt;, Q7_B1 &lt;chr&gt;, Q7_B2 &lt;chr&gt;,
## #   Q7_B3 &lt;chr&gt;, Q7_B_A &lt;chr&gt;, Q7_B_B &lt;chr&gt;, Q7_B_C &lt;chr&gt;, Q7_B_D &lt;chr&gt;,
## #   Q7_B_E &lt;chr&gt;, Q7_B_F &lt;chr&gt;, Q7_B_G &lt;chr&gt;, Q7_B_H &lt;chr&gt;, Q7_B_I &lt;chr&gt;,
## #   Q7_B_J &lt;chr&gt;, Q7_B_J_Other &lt;chr&gt;, Q7_C_StandAlone &lt;chr&gt;,
## #   Q7_C_Integrated &lt;chr&gt;, Q7_C1 &lt;chr&gt;, Q7_C2 &lt;chr&gt;, Q7_C3 &lt;chr&gt;, Q7_C_A &lt;chr&gt;,
## #   Q7_C_B &lt;chr&gt;, Q7_C_C &lt;chr&gt;, Q7_C_D &lt;chr&gt;, Q7_C_E &lt;chr&gt;, Q7_C_F &lt;chr&gt;,
## #   Q7_C_G &lt;chr&gt;, Q7_C_H &lt;chr&gt;, Q7_C_I &lt;chr&gt;, Q7_C_J &lt;chr&gt;, Q7_C_J_Other &lt;chr&gt;,
## #   Q8_A1 &lt;chr&gt;, Q8_A2 &lt;chr&gt;, Q8_B1 &lt;chr&gt;, Q8_B2 &lt;chr&gt;, Q8_B3 &lt;chr&gt;, Q9 &lt;chr&gt;,
## #   Q9_Considerations &lt;chr&gt;, Q10 &lt;chr&gt;, Q11 &lt;chr&gt;, Age &lt;chr&gt;, Gender &lt;chr&gt;,
## #   PostalCode &lt;chr&gt;, GroupName &lt;chr&gt;, DateCreated &lt;dttm&gt;, ...93 &lt;lgl&gt;,
## #   ...94 &lt;lgl&gt;</code></pre>
<p>Unfortunately the column names aren’t very informative. For simplicity, we’ll use the ‘.pdf’ questionnaire that accompanies this dataset from the Toronto Open Data website. Alternatively, we could get and parse the ‘readme’ through the R package. <a href="https://ckan0.cf.opendata.inter.prod-toronto.ca/dataset/427ca4cd-168a-4a37-883d-4a574277caf5/resource/ae135d6a-6921-4905-bc79-516fcd428b7b/download/toronto-casino-survey-feedback-form.pdf">Here’s a link to the questionnaire</a>.</p>
<p>Question 1 indicates the level of support for a casino in Toronto. We’ll use this as the response variable.</p>
<p>Concerning potential predictor variables, most of the questions ask respondents about their opinions on different aspects of a potential casino development, which aren’t particularly useful towards our cause. The only demographic variables are <code>Age</code> and <code>Gender</code>, so let’s choose these.</p>
<p>Here I’m also going to rename the columns so that my resulting data frame has columns ‘opinion,’ ‘age,’ and ‘gender.’</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="exploratory-data-analysis.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Narrow down the dataframe to our variables of interest</span></span>
<span id="cb492-2"><a href="exploratory-data-analysis.html#cb492-2" aria-hidden="true" tabindex="-1"></a>casino_data <span class="ot">&lt;-</span> </span>
<span id="cb492-3"><a href="exploratory-data-analysis.html#cb492-3" aria-hidden="true" tabindex="-1"></a>  casino_data <span class="sc">%&gt;%</span></span>
<span id="cb492-4"><a href="exploratory-data-analysis.html#cb492-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Q1_A, Age, Gender) <span class="sc">%&gt;%</span></span>
<span id="cb492-5"><a href="exploratory-data-analysis.html#cb492-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">opinion =</span> Q1_A, <span class="at">age =</span> Age, <span class="at">gender =</span> Gender)</span>
<span id="cb492-6"><a href="exploratory-data-analysis.html#cb492-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-7"><a href="exploratory-data-analysis.html#cb492-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at first couple rows:</span></span>
<span id="cb492-8"><a href="exploratory-data-analysis.html#cb492-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(casino_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   opinion                   age   gender
##   &lt;chr&gt;                     &lt;chr&gt; &lt;chr&gt; 
## 1 Strongly Opposed          25-34 Male  
## 2 Strongly in Favour        35-44 Female
## 3 Strongly in Favour        55-64 Male  
## 4 Somewhat Opposed          25-34 Male  
## 5 Neutral or Mixed Feelings 25-34 Female
## 6 Strongly Opposed          45-54 Female</code></pre>
</div>
<div id="some-visual-exploration-and-more-cleanup-of-course" class="section level3" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> Some visual exploration (and more cleanup, of course)</h3>
<p>Let’s first do some quick exploration to get a feel for what’s going on in the data. We’ll first calculate proportions of casino support for each age-gender combination:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="exploratory-data-analysis.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate proportions</span></span>
<span id="cb494-2"><a href="exploratory-data-analysis.html#cb494-2" aria-hidden="true" tabindex="-1"></a>casino_summary <span class="ot">&lt;-</span> casino_data <span class="sc">%&gt;%</span></span>
<span id="cb494-3"><a href="exploratory-data-analysis.html#cb494-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, gender, opinion) <span class="sc">%&gt;%</span></span>
<span id="cb494-4"><a href="exploratory-data-analysis.html#cb494-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># Count the number in each group and response</span></span>
<span id="cb494-5"><a href="exploratory-data-analysis.html#cb494-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, gender) <span class="sc">%&gt;%</span></span>
<span id="cb494-6"><a href="exploratory-data-analysis.html#cb494-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="co"># Calculate proportions within each group</span></span></code></pre></div>
<p>Some notes:</p>
<ul>
<li>we use <code>geom_col()</code> to make a bar chart,</li>
<li><code>facet_grid()</code> modifies the plot so that the plot has panels that correspond only to certain values of discrete variables (in this case, we will “facet” by <code>age</code> and <code>gender</code>). This is helpful in this case because we are interested in how the distribution of <code>opinion</code>s changes by <code>age</code> and <code>gender</code>.</li>
</ul>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="exploratory-data-analysis.html#cb495-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(casino_summary) <span class="sc">+</span></span>
<span id="cb495-2"><a href="exploratory-data-analysis.html#cb495-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> opinion, <span class="at">y =</span> prop)) <span class="sc">+</span> <span class="co"># Specify a histogram of opinion responses</span></span>
<span id="cb495-3"><a href="exploratory-data-analysis.html#cb495-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(age<span class="sc">~</span>gender) <span class="sc">+</span> <span class="co">#Facet by age and gender</span></span>
<span id="cb495-4"><a href="exploratory-data-analysis.html#cb495-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="co"># Rotate the x-axis labels to be readable</span></span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-296-1.png" width="672" /></p>
<p>Some things to note:</p>
<ul>
<li>the x-axis labels are out of order in the sense that they are not in a monotone order of increasing/decreasing support</li>
<li>there are <code>NA</code> values in <code>opinion</code>, <code>age</code>, and <code>gender</code>, as well as “Prefer not to disclose” responses</li>
</ul>
</div>
<div id="getting-the-data-into-a-more-model-suitable-format" class="section level3" number="13.3.3">
<h3><span class="header-section-number">13.3.3</span> Getting the data into a more model-suitable format</h3>
<p>First we need to get rid of responses that aren’t suitable. For simplicity we’ll assume that <code>NA</code> values and “Prefer not to disclose” responses occur randomly, and remove them from our dataset (note in reality this assumption might not hold up and we might want to be more careful). Let’s check how many rows are in the original dataset:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="exploratory-data-analysis.html#cb496-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nrow() returns the number of rows in a dataframe:</span></span>
<span id="cb496-2"><a href="exploratory-data-analysis.html#cb496-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(casino_data)</span></code></pre></div>
<pre><code>## [1] 17766</code></pre>
<p>Now let’s <code>dplyr::filter()</code> accordingly to omit the responses we don’t want. In case you’re unfamiliar, I’m going to make use of:</p>
<ul>
<li><code>is.na()</code>, which returns <code>TRUE</code> if the argument is <code>NA</code>,</li>
<li>the <code>!</code> operator, which flips <code>TRUE</code> and <code>FALSE</code>. So for instance, <code>!is.na(x)</code> will return <code>TRUE</code> if <code>x</code> is NOT <code>NA</code>, which is what we want to keep.</li>
</ul>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="exploratory-data-analysis.html#cb498-1" aria-hidden="true" tabindex="-1"></a>casino_data <span class="ot">&lt;-</span> casino_data <span class="sc">%&gt;%</span></span>
<span id="cb498-2"><a href="exploratory-data-analysis.html#cb498-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep rows with non-NA:</span></span>
<span id="cb498-3"><a href="exploratory-data-analysis.html#cb498-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(opinion), <span class="sc">!</span><span class="fu">is.na</span>(age), <span class="sc">!</span><span class="fu">is.na</span>(gender)) <span class="sc">%&gt;%</span></span>
<span id="cb498-4"><a href="exploratory-data-analysis.html#cb498-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only keep rows where age and gender are disclosed:</span></span>
<span id="cb498-5"><a href="exploratory-data-analysis.html#cb498-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">!=</span> <span class="st">&quot;Prefer not to disclose&quot;</span>, gender <span class="sc">!=</span> <span class="st">&quot;Prefer not to disclose&quot;</span>)</span></code></pre></div>
<p>Let’s check how many rows of data we’re left with:</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb499-1"><a href="exploratory-data-analysis.html#cb499-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(casino_data)</span></code></pre></div>
<pre><code>## [1] 13658</code></pre>
<p>Now we need to convert the response variable into binary. To clean up the first problem (response variables out of order), we might as well take this opportunity to convert these into a format suitable for our model. In a logistic regression, we would like our response variable to be binary, but in this case we have 5 possible categories ranging from “Strongly Opposed” to “Strongly in Favour.” We’ll recategorize them into a new ‘supportive_or_not’ variable as follows.</p>
<ul>
<li>‘supportive = 1’ if “Strongly in Favour” or “Somewhat in Favour”</li>
<li>‘supportive = 0’ if “Neutral or Mixed Feelings,” “Somewhat Opposed,” or “Strongly Opposed”</li>
</ul>
<p>We do this with the <code>dplyr::mutate()</code> function, which creates new columns (possibly as functions of existing columns), and <code>dplyr::case_when()</code>, which provides a way to assign values conditional on if-statements. The syntax here is a little strange. On the LHS of the <code>~</code> is the “if” condition, and the RHS of the tilde is the value to return. For example, ‘x == 0 ~ 3’ would return 3 when ‘x’ is 0.</p>
<p>Another commonly used operator here is the <code>%in%</code> operator, which checks whether something is an element of a vector, for instance, e.g.:</p>
<ul>
<li><code>1 %in% c(1, 3, 4)</code> returns <code>TRUE</code></li>
<li><code>2 %in% c(1, 3, 4)</code> returns <code>FALSE</code></li>
</ul>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="exploratory-data-analysis.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store possible opinions in vectors</span></span>
<span id="cb501-2"><a href="exploratory-data-analysis.html#cb501-2" aria-hidden="true" tabindex="-1"></a>yes_opinions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Strongly in Favour&quot;</span>, <span class="st">&quot;Somewhat in Favour&quot;</span>)</span>
<span id="cb501-3"><a href="exploratory-data-analysis.html#cb501-3" aria-hidden="true" tabindex="-1"></a>no_opinions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Neutral or Mixed Feelings&quot;</span>, <span class="st">&quot;Somewhat Opposed&quot;</span>, <span class="st">&quot;Strongly Opposed&quot;</span>)</span>
<span id="cb501-4"><a href="exploratory-data-analysis.html#cb501-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-5"><a href="exploratory-data-analysis.html#cb501-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create `supportive` column:</span></span>
<span id="cb501-6"><a href="exploratory-data-analysis.html#cb501-6" aria-hidden="true" tabindex="-1"></a>casino_data <span class="ot">&lt;-</span> </span>
<span id="cb501-7"><a href="exploratory-data-analysis.html#cb501-7" aria-hidden="true" tabindex="-1"></a>  casino_data <span class="sc">%&gt;%</span></span>
<span id="cb501-8"><a href="exploratory-data-analysis.html#cb501-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">supportive =</span> <span class="fu">case_when</span>(</span>
<span id="cb501-9"><a href="exploratory-data-analysis.html#cb501-9" aria-hidden="true" tabindex="-1"></a>    opinion <span class="sc">%in%</span> yes_opinions <span class="sc">~</span> <span class="cn">TRUE</span>, <span class="co"># Assign TRUE</span></span>
<span id="cb501-10"><a href="exploratory-data-analysis.html#cb501-10" aria-hidden="true" tabindex="-1"></a>    opinion <span class="sc">%in%</span> no_opinions <span class="sc">~</span> <span class="cn">FALSE</span>  <span class="co"># Assign FALSE</span></span>
<span id="cb501-11"><a href="exploratory-data-analysis.html#cb501-11" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<p>Now we need to convert age to a numeric variable. Age in this survey is given in age groups. Let’s instead map it to a numeric variable so that we can more easily talk about trends with age. We’ll map the youngest age to <code>1</code>, and so on:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="exploratory-data-analysis.html#cb502-1" aria-hidden="true" tabindex="-1"></a>casino_data <span class="ot">&lt;-</span> </span>
<span id="cb502-2"><a href="exploratory-data-analysis.html#cb502-2" aria-hidden="true" tabindex="-1"></a>  casino_data <span class="sc">%&gt;%</span></span>
<span id="cb502-3"><a href="exploratory-data-analysis.html#cb502-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb502-4"><a href="exploratory-data-analysis.html#cb502-4" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">&quot;Under 15&quot;</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb502-5"><a href="exploratory-data-analysis.html#cb502-5" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">&quot;15-24&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb502-6"><a href="exploratory-data-analysis.html#cb502-6" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">&quot;25-34&quot;</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb502-7"><a href="exploratory-data-analysis.html#cb502-7" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">&quot;35-44&quot;</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb502-8"><a href="exploratory-data-analysis.html#cb502-8" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">&quot;45-54&quot;</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb502-9"><a href="exploratory-data-analysis.html#cb502-9" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">&quot;55-64&quot;</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb502-10"><a href="exploratory-data-analysis.html#cb502-10" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">&quot;65 or older&quot;</span> <span class="sc">~</span> <span class="dv">6</span></span>
<span id="cb502-11"><a href="exploratory-data-analysis.html#cb502-11" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<p>Now let’s make the same plot again, with our new processed data:</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb503-1"><a href="exploratory-data-analysis.html#cb503-1" aria-hidden="true" tabindex="-1"></a>casino_summary2 <span class="ot">&lt;-</span> </span>
<span id="cb503-2"><a href="exploratory-data-analysis.html#cb503-2" aria-hidden="true" tabindex="-1"></a>  casino_data <span class="sc">%&gt;%</span></span>
<span id="cb503-3"><a href="exploratory-data-analysis.html#cb503-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, gender, supportive) <span class="sc">%&gt;%</span></span>
<span id="cb503-4"><a href="exploratory-data-analysis.html#cb503-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> <span class="co"># Count the number in each group and response</span></span>
<span id="cb503-5"><a href="exploratory-data-analysis.html#cb503-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, gender) <span class="sc">%&gt;%</span></span>
<span id="cb503-6"><a href="exploratory-data-analysis.html#cb503-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="co"># Calculate proportions within each group</span></span>
<span id="cb503-7"><a href="exploratory-data-analysis.html#cb503-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb503-8"><a href="exploratory-data-analysis.html#cb503-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(casino_summary2) <span class="sc">+</span></span>
<span id="cb503-9"><a href="exploratory-data-analysis.html#cb503-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(age_group <span class="sc">~</span> gender) <span class="sc">+</span></span>
<span id="cb503-10"><a href="exploratory-data-analysis.html#cb503-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> supportive, <span class="at">y =</span> prop)) </span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-302-1.png" width="672" /></p>
<p>We can sort of see some difference in the distribution between different panels. To formalize this, we can run a logistic regression.</p>
</div>
<div id="logistic-regression" class="section level3" number="13.3.4">
<h3><span class="header-section-number">13.3.4</span> Logistic Regression</h3>
<p>Now, we’re set up to feed it to the regression. We can do this with <code>glm()</code>, which allows us to fit generalized linear models.</p>
<p>We use <code>family = "binomial"</code> to specify a logistic regression, and our formula is <code>supportive ~ age_group + gender</code>, which indicates that <code>supportive</code> is the (binary) response variable since it’s on the LHS, and <code>age_group</code> and <code>gender</code> are our predictor variables.</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="exploratory-data-analysis.html#cb504-1" aria-hidden="true" tabindex="-1"></a>casino_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(supportive <span class="sc">~</span> age_group <span class="sc">+</span> gender, <span class="at">data =</span> casino_data, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span></code></pre></div>
<p>We can take a look at the results of running the GLM using <code>summary()</code>:</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb505-1"><a href="exploratory-data-analysis.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(casino_glm)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = supportive ~ age_group + gender, family = &quot;binomial&quot;, 
##     data = casino_data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.0107  -0.8888  -0.6804   1.4249   1.8822  
## 
## Coefficients:
##                     Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)         -1.10594    0.05863 -18.862  &lt; 2e-16 ***
## age_group           -0.07983    0.01376  -5.801 6.59e-09 ***
## genderMale           0.70036    0.04027  17.390  &lt; 2e-16 ***
## genderTransgendered  0.69023    0.39276   1.757   0.0789 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 16010  on 13657  degrees of freedom
## Residual deviance: 15653  on 13654  degrees of freedom
## AIC: 15661
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Interpretation can be a little tricky. Here are some important things to note about our results:</p>
<p>Firstly, we have a numeric age group variable. Remember that we coded <code>age_group</code> as numbers 1 to 5. Because we’ve used age groups instead of age, we have to be careful with how we phrase our conclusion. The coefficient estimate corresponds to the effect of moving up a unit on the age group scale (e.g. from the 25-34 age group to the 35-44 age group), rather than 1 year in age (e.g. from age 28 to 29).</p>
<p>Secondly, the results are in log-odds ratios. The effect estimates are on the log-odds scale. This means the effect of -0.07983 for <code>age_group</code> is interpreted as: ‘for each unit increase in <code>age_group</code>, we estimate a 0.07983 decrease in the log-odds of being supportive of a casino.’</p>
<p>We could exponentiate the coefficient estimate to make this at least a little easier to interpret. The number we get is interpreted as a factor for the odds.</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb507-1"><a href="exploratory-data-analysis.html#cb507-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.07983</span>)</span></code></pre></div>
<pre><code>## [1] 0.9232733</code></pre>
<p>So our (cleaner) interpretation is: ‘the odds of an individuals of the same gender being pro-casino are predicted to change by a factor of 0.9232733 for each unit increase in <code>age_group</code>’</p>
<p>Finally, we have a baseline category. First, note that because we have categorical variables, the <code>gender</code> coefficients are relative to a “baseline” category. The value of <code>gender</code> that doesn’t appear in the table, <code>Female</code>, is implicitly used as our baseline gender category. Technical note: if the variable is stored as a <code>character</code> class, then <code>glm()</code> will choose the alphabetically first value to use as the baseline.</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb509-1"><a href="exploratory-data-analysis.html#cb509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">0.70036</span>)</span></code></pre></div>
<pre><code>## [1] 2.014478</code></pre>
<p>So, the interpretation of the <code>genderMale</code> coefficient is: ‘the odds of a male individual supporting a casino is 2.0144778 times higher than a female individual of the same <code>age_group</code>.’</p>
<p>We can make estimates in a variety of ways. First we’ll look at it manually.</p>
<p>Using the formula found in <span class="citation"><a href="references-1.html#ref-islr" role="doc-biblioref">James et al.</a> (<a href="references-1.html#ref-islr" role="doc-biblioref">2017, 4.3.3</a>)</span>, we can make estimates for an individual of certain characteristics. Suppose we wanted to predict the the probability of supporting a Toronto casino for an individual who was 36 and identified as transgender. Then:</p>
<ul>
<li><code>age_group</code> takes a value of 3, since they are in the age group of 35-44 coded as 3,</li>
<li><code>genderTransgendered</code> takes a value of 1</li>
</ul>
<p>First, let’s extract the coefficient estimates as a vector using <code>coefficients()</code>:</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="exploratory-data-analysis.html#cb511-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(casino_glm)</span>
<span id="cb511-2"><a href="exploratory-data-analysis.html#cb511-2" aria-hidden="true" tabindex="-1"></a>coefs</span></code></pre></div>
<pre><code>##         (Intercept)           age_group          genderMale genderTransgendered 
##         -1.10593925         -0.07983372          0.70036199          0.69022910</code></pre>
<p>Since this vector is labeled, we can index it using square brackets and names. For instance:</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb513-1"><a href="exploratory-data-analysis.html#cb513-1" aria-hidden="true" tabindex="-1"></a>coefs[<span class="st">&quot;age_group&quot;</span>]</span></code></pre></div>
<pre><code>##   age_group 
## -0.07983372</code></pre>
<p>So first let’s evaluate the exponent term <span class="math inline">\(e^{\beta_0 + \cdots + \beta_p X_p}\)</span>:</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="exploratory-data-analysis.html#cb515-1" aria-hidden="true" tabindex="-1"></a>exp_term <span class="ot">&lt;-</span> <span class="fu">exp</span>(coefs[<span class="st">&quot;(Intercept)&quot;</span>] <span class="sc">+</span> coefs[<span class="st">&quot;age_group&quot;</span>]<span class="sc">*</span><span class="dv">3</span> <span class="sc">+</span> coefs[<span class="st">&quot;genderTransgendered&quot;</span>]<span class="sc">*</span><span class="dv">1</span>)</span></code></pre></div>
<p>Now evaluate the expression that gives the probability of casino support:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="exploratory-data-analysis.html#cb516-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The unname() command just takes off the label that it &quot;inherited&quot; from the coefs vector.</span></span>
<span id="cb516-2"><a href="exploratory-data-analysis.html#cb516-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (don&#39;t worry about it, doesn&#39;t affect any functionality)</span></span>
<span id="cb516-3"><a href="exploratory-data-analysis.html#cb516-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unname</span>(exp_term <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> exp_term))</span></code></pre></div>
<pre><code>## [1] 0.3418161</code></pre>
<p>That works, but there are more stream-lined ways. Thankfully R comes with a convenient function to make prediction estimates from a <code>glm()</code>. We do this using the <code>predict()</code> function. First, we need to make a dataframe that has the relevant variables and values that we’re interested in predicting. We’ll use the same values as before:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb518-1"><a href="exploratory-data-analysis.html#cb518-1" aria-hidden="true" tabindex="-1"></a>prediction_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age_group =</span> <span class="dv">3</span>, <span class="at">gender =</span> <span class="st">&quot;Transgendered&quot;</span>)</span></code></pre></div>
<p>The dataframe looks like this:</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="exploratory-data-analysis.html#cb519-1" aria-hidden="true" tabindex="-1"></a>prediction_df</span></code></pre></div>
<pre><code>##   age_group        gender
## 1         3 Transgendered</code></pre>
<p>Then we feed it into the <code>predict()</code> function, along with our <code>glm</code> object. To get the probability, we need to specify <code>type = "response"</code>.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="exploratory-data-analysis.html#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(casino_glm, <span class="at">newdata =</span> prediction_df, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<pre><code>##         1 
## 0.3418161</code></pre>
<p>This matches the probability we got from doing this manually, yay!</p>
<!-- ## Case study - Historical Canadian elections -->
<!-- https://twitter.com/semrasevi/status/1122889166008745985?s=21  -->
<!-- ```{r, include = TRUE, eval = FALSE} -->
<!-- library(tidyverse) -->
<!-- elections_data <- read_csv("inputs/federal_candidates-1.csv") -->
<!-- elections_data$Province %>% table() -->
<!-- # There are inconsistencies in the province names -->
<!-- elections_data$Province[elections_data$Province == "Québec"] <- "Quebec" -->
<!-- elections_data <- elections_data %>% -->
<!--   filter(!is.na(Province)) -->
<!-- # Check gender -->
<!-- elections_data$Gender %>% table() -->
<!-- # Check occupation -->
<!-- elections_data$occupation %>% table() -->
<!-- # Get a count of how many uniques there are -->
<!-- elections_data$occupation %>% unique() %>% length() -->
<!-- # Check party -->
<!-- elections_data$party_short %>% table() -->
<!-- elections_data$party_short %>% unique() %>% length() -->
<!-- # Check incumbency -->
<!-- elections_data$incumbent_candidate %>% table() -->
<!-- elections_data$party_short %>% unique() %>% length() -->
<!-- # Add year -->
<!-- elections_data <- -->
<!--   elections_data %>% -->
<!--   mutate(year = year(edate)) -->
<!-- # Add a counter for year -->
<!-- elections_data <- -->
<!--   elections_data %>% -->
<!--   mutate(counter = year - 1867) -->
<!-- #### Save #### -->
<!-- write_csv(elections_data, "outputs/elections.csv") -->
<!-- ``` -->
<!-- ```{r, include = TRUE, eval = FALSE} -->
<!-- library(lubridate) -->
<!-- library(tidyverse) -->
<!-- elections_data <- read_csv("outputs/elections.csv") -->
<!-- elections_data %>% -->
<!--   ggplot(aes(x = edate)) + -->
<!--   geom_histogram() -->
<!-- elections_data %>% -->
<!--   ggplot(aes(x = edate, y = Result, color = Gender)) + -->
<!--   geom_point() + -->
<!--   facet_wrap(vars(Province)) -->
<!-- elections_data %>% -->
<!--   ggplot(aes(x = Province, fill = Gender)) + -->
<!--   geom_bar(position = "dodge") -->
<!-- # We discovered WW1! -->
<!-- ``` -->
<!-- ```{r, include = TRUE, eval = FALSE} -->
<!-- #### Set up workspace ### -->
<!-- library(broom) -->
<!-- library(tidyverse) -->
<!-- #### Read in data #### -->
<!-- elections_data <- read_csv("outputs/elections.csv") -->
<!-- #### Model #### -->
<!-- # Just gender -->
<!-- model1 <- lm(Result ~ Gender, data = elections_data) -->
<!-- tidy(model1) -->
<!-- # Gender and incumbent -->
<!-- model2 <- lm(Result ~ Gender + incumbent_candidate, data = elections_data) -->
<!-- tidy(model2) -->
<!-- # Gender and incumbent and province -->
<!-- model3 <- lm(Result ~ Gender + incumbent_candidate + Province, data = elections_data) -->
<!-- tidy(model3) -->
<!-- # Gender and incumbent and province and year -->
<!-- model4 <- lm(Result ~ Gender + incumbent_candidate + Province + year, data = elections_data) -->
<!-- model5 <- lm(Result ~ Gender + incumbent_candidate + Province + year*Gender, data = elections_data) -->
<!-- tidy(model4) -->
<!-- tidy(model5) -->
<!-- # CHange the year into a counter that increments one for each year -->
<!-- model6 <- lm(Result ~ Gender + incumbent_candidate + Province + counter + counter*Gender, data = elections_data) -->
<!-- tidy(model6) -->
<!-- ``` -->
</div>
</div>
<div id="case-study---airbnb-listing-in-toronto" class="section level2" number="13.4">
<h2><span class="header-section-number">13.4</span> Case study - Airbnb listing in Toronto</h2>
<div id="essentials" class="section level3" number="13.4.1">
<h3><span class="header-section-number">13.4.1</span> Essentials</h3>
<p>In this case study we look at Airbnb listings in Toronto.</p>
</div>
<div id="set-up-1" class="section level3" number="13.4.2">
<h3><span class="header-section-number">13.4.2</span> Set up</h3>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="exploratory-data-analysis.html#cb523-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom) <span class="co"># Helps with model outputs etc</span></span>
<span id="cb523-2"><a href="exploratory-data-analysis.html#cb523-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># Helps with specifying path names</span></span>
<span id="cb523-3"><a href="exploratory-data-analysis.html#cb523-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor) <span class="co"># Helps with initial data cleaning and pretty tables</span></span>
<span id="cb523-4"><a href="exploratory-data-analysis.html#cb523-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels) <span class="co"># Help with modelling</span></span>
<span id="cb523-5"><a href="exploratory-data-analysis.html#cb523-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb523-6"><a href="exploratory-data-analysis.html#cb523-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat) <span class="co"># Helps check missing values</span></span></code></pre></div>
</div>
<div id="get-data" class="section level3" number="13.4.3">
<h3><span class="header-section-number">13.4.3</span> Get data</h3>
<p>The dataset is from Inside Airbnb <span class="citation">(<a href="references-1.html#ref-airbnbdata" role="doc-biblioref">Cox 2021</a>)</span>. The <code>here</code> package will help <span class="citation">(<a href="references-1.html#ref-citehere" role="doc-biblioref">Müller 2017b</a>)</span>.</p>
<p>We can give <code>read_csv()</code> a link to where the dataset is and it will download it. This helps with reproducibility because the source is clear. But, as that link could change at any time, longer-term reproducibility, as well as wanting to minimise the effect on the Inside Airbnb servers, suggest that we should also save a local copy of the data and then use that. (As the original data is not ours, we should not make that public without first getting written permission.)</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="exploratory-data-analysis.html#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For reproducibility</span></span>
<span id="cb524-2"><a href="exploratory-data-analysis.html#cb524-2" aria-hidden="true" tabindex="-1"></a><span class="co"># airbnb_data_reduced &lt;- read_csv(&quot;http://data.insideairbnb.com/canada/on/toronto/2021-01-02/data/listings.csv.gz&quot;, guess_max = 20000)</span></span>
<span id="cb524-3"><a href="exploratory-data-analysis.html#cb524-3" aria-hidden="true" tabindex="-1"></a><span class="co"># write_csv(airbnb_data_reduced, &quot;week_6/data/airbnb_toronto_2019-12-07.csv&quot;)</span></span>
<span id="cb524-4"><a href="exploratory-data-analysis.html#cb524-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-5"><a href="exploratory-data-analysis.html#cb524-5" aria-hidden="true" tabindex="-1"></a><span class="co"># For actual work</span></span>
<span id="cb524-6"><a href="exploratory-data-analysis.html#cb524-6" aria-hidden="true" tabindex="-1"></a>airbnb_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;dont_push/airbnb_toronto_2021_january-listings.csv&quot;</span>), <span class="at">guess_max =</span> <span class="dv">20000</span>)</span>
<span id="cb524-7"><a href="exploratory-data-analysis.html#cb524-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-8"><a href="exploratory-data-analysis.html#cb524-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The guess_max option in read_csv helps us avoid having to specify the column types. Usually read_csv takes a best guess at the column types based on the first few rows. But sometimes those first ones are misleading and so guess_max forces it to look at a larger number of rows to try to work out what is going on.</span></span></code></pre></div>
</div>
<div id="clean-data-1" class="section level3" number="13.4.4">
<h3><span class="header-section-number">13.4.4</span> Clean data</h3>
<p>There are an enormous number of columns, so we’ll just select a few.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="exploratory-data-analysis.html#cb525-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(airbnb_data) <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span></code></pre></div>
<pre><code>## [1] 74</code></pre>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="exploratory-data-analysis.html#cb527-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="ot">&lt;-</span> </span>
<span id="cb527-2"><a href="exploratory-data-analysis.html#cb527-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data <span class="sc">%&gt;%</span> </span>
<span id="cb527-3"><a href="exploratory-data-analysis.html#cb527-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(host_id, </span>
<span id="cb527-4"><a href="exploratory-data-analysis.html#cb527-4" aria-hidden="true" tabindex="-1"></a>         host_since, </span>
<span id="cb527-5"><a href="exploratory-data-analysis.html#cb527-5" aria-hidden="true" tabindex="-1"></a>         host_response_time, </span>
<span id="cb527-6"><a href="exploratory-data-analysis.html#cb527-6" aria-hidden="true" tabindex="-1"></a>         host_is_superhost, </span>
<span id="cb527-7"><a href="exploratory-data-analysis.html#cb527-7" aria-hidden="true" tabindex="-1"></a>         host_listings_count,</span>
<span id="cb527-8"><a href="exploratory-data-analysis.html#cb527-8" aria-hidden="true" tabindex="-1"></a>         host_total_listings_count,</span>
<span id="cb527-9"><a href="exploratory-data-analysis.html#cb527-9" aria-hidden="true" tabindex="-1"></a>         host_neighbourhood, </span>
<span id="cb527-10"><a href="exploratory-data-analysis.html#cb527-10" aria-hidden="true" tabindex="-1"></a>         host_listings_count, </span>
<span id="cb527-11"><a href="exploratory-data-analysis.html#cb527-11" aria-hidden="true" tabindex="-1"></a>         neighbourhood_cleansed, </span>
<span id="cb527-12"><a href="exploratory-data-analysis.html#cb527-12" aria-hidden="true" tabindex="-1"></a>         room_type, </span>
<span id="cb527-13"><a href="exploratory-data-analysis.html#cb527-13" aria-hidden="true" tabindex="-1"></a>         bathrooms, </span>
<span id="cb527-14"><a href="exploratory-data-analysis.html#cb527-14" aria-hidden="true" tabindex="-1"></a>         bedrooms, </span>
<span id="cb527-15"><a href="exploratory-data-analysis.html#cb527-15" aria-hidden="true" tabindex="-1"></a>         price, </span>
<span id="cb527-16"><a href="exploratory-data-analysis.html#cb527-16" aria-hidden="true" tabindex="-1"></a>         number_of_reviews, </span>
<span id="cb527-17"><a href="exploratory-data-analysis.html#cb527-17" aria-hidden="true" tabindex="-1"></a>         has_availability, </span>
<span id="cb527-18"><a href="exploratory-data-analysis.html#cb527-18" aria-hidden="true" tabindex="-1"></a>         review_scores_rating, </span>
<span id="cb527-19"><a href="exploratory-data-analysis.html#cb527-19" aria-hidden="true" tabindex="-1"></a>         review_scores_accuracy, </span>
<span id="cb527-20"><a href="exploratory-data-analysis.html#cb527-20" aria-hidden="true" tabindex="-1"></a>         review_scores_cleanliness, </span>
<span id="cb527-21"><a href="exploratory-data-analysis.html#cb527-21" aria-hidden="true" tabindex="-1"></a>         review_scores_checkin, </span>
<span id="cb527-22"><a href="exploratory-data-analysis.html#cb527-22" aria-hidden="true" tabindex="-1"></a>         review_scores_communication, </span>
<span id="cb527-23"><a href="exploratory-data-analysis.html#cb527-23" aria-hidden="true" tabindex="-1"></a>         review_scores_location, </span>
<span id="cb527-24"><a href="exploratory-data-analysis.html#cb527-24" aria-hidden="true" tabindex="-1"></a>         review_scores_value</span>
<span id="cb527-25"><a href="exploratory-data-analysis.html#cb527-25" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>We might like to have a brief look at the dataset to see if anything weird is going on. There are a bunch of ways of doing this.</p>
<p>A few things jump out:</p>
<ol style="list-style-type: decimal">
<li>There are a character variables that should probably be numerics or dates/times: <code>host_response_time</code>, price, <code>weekly_price</code>, <code>monthly_price</code>, <code>cleaning_fee.</code></li>
<li>Weekly and monthly price is missing in an overwhelming number of observations.</li>
<li>Roughly a fifth of observations are missing a review score and there seems like there is some correlation between those review-type variables.</li>
<li>There are two variants of the neighbourhood name.</li>
<li>There are NAs in <code>host_is_superhost</code>.</li>
<li>The reviews seem really skewed.</li>
<li>There is someone who has 328 properties on Airbnb.</li>
</ol>
<div id="price" class="section level4" number="13.4.4.1">
<h4><span class="header-section-number">13.4.4.1</span> Price</h4>
<p>First we need to convert to a numeric. This is a common problem, and you need to be a little careful that it doesn’t all just convert to NAs. In our case if we just force the price data to be a numeric then it will go to NA because there are a lot of characters that R doesn’t know how to convert, e.g. what is the numeric for ‘$?’ So we need to remove those characters first.</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="exploratory-data-analysis.html#cb528-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected<span class="sc">$</span>price <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## [1] &quot;$469.00&quot; &quot;$96.00&quot;  &quot;$64.00&quot;  &quot;$70.00&quot;  &quot;$45.00&quot;  &quot;$127.00&quot;</code></pre>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="exploratory-data-analysis.html#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First work out what is going on</span></span>
<span id="cb530-2"><a href="exploratory-data-analysis.html#cb530-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected<span class="sc">$</span>price <span class="sc">%&gt;%</span> <span class="fu">str_split</span>(<span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;$&quot; &quot;4&quot; &quot;6&quot; &quot;9&quot; &quot;.&quot; &quot;0&quot; &quot;7&quot; &quot;5&quot; &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;8&quot; &quot;,&quot;</code></pre>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="exploratory-data-analysis.html#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It&#39;s clear that &#39;$&#39; needs to go. The only odd thing is &#39;,&#39; so take a look at those:</span></span>
<span id="cb532-2"><a href="exploratory-data-analysis.html#cb532-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb532-3"><a href="exploratory-data-analysis.html#cb532-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(price) <span class="sc">%&gt;%</span> </span>
<span id="cb532-4"><a href="exploratory-data-analysis.html#cb532-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(price, <span class="st">&quot;,&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 145 x 1
##    price    
##    &lt;chr&gt;    
##  1 $1,724.00
##  2 $1,000.00
##  3 $1,100.00
##  4 $1,450.00
##  5 $1,019.00
##  6 $1,000.00
##  7 $1,300.00
##  8 $2,142.00
##  9 $2,000.00
## 10 $1,200.00
## # … with 135 more rows</code></pre>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="exploratory-data-analysis.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It&#39;s clear that the data is just nicely formatted, but we need to remove the comma:</span></span>
<span id="cb534-2"><a href="exploratory-data-analysis.html#cb534-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="ot">&lt;-</span> </span>
<span id="cb534-3"><a href="exploratory-data-analysis.html#cb534-3" aria-hidden="true" tabindex="-1"></a>  airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb534-4"><a href="exploratory-data-analysis.html#cb534-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price =</span> <span class="fu">str_remove</span>(price, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">$&quot;</span>),</span>
<span id="cb534-5"><a href="exploratory-data-analysis.html#cb534-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">price =</span> <span class="fu">str_remove</span>(price, <span class="st">&quot;,&quot;</span>),</span>
<span id="cb534-6"><a href="exploratory-data-analysis.html#cb534-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">price =</span> <span class="fu">as.integer</span>(price)</span>
<span id="cb534-7"><a href="exploratory-data-analysis.html#cb534-7" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>Now we can have a look at prices.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="exploratory-data-analysis.html#cb535-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at distribution of price</span></span>
<span id="cb535-2"><a href="exploratory-data-analysis.html#cb535-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb535-3"><a href="exploratory-data-analysis.html#cb535-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb535-4"><a href="exploratory-data-analysis.html#cb535-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb535-5"><a href="exploratory-data-analysis.html#cb535-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb535-6"><a href="exploratory-data-analysis.html#cb535-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Price per night&quot;</span>,</span>
<span id="cb535-7"><a href="exploratory-data-analysis.html#cb535-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of properties&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-318-1.png" width="672" /></p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="exploratory-data-analysis.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  We use bins with a width of 10, so that&#39;s going to aggregate prices into 10s so that we don&#39;t get overwhelmed with bars.</span></span></code></pre></div>
<p>So we have some outliers. Let’s zoom in on prices that are more than $1,000.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="exploratory-data-analysis.html#cb537-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at distribution of high prices</span></span>
<span id="cb537-2"><a href="exploratory-data-analysis.html#cb537-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb537-3"><a href="exploratory-data-analysis.html#cb537-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&gt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb537-4"><a href="exploratory-data-analysis.html#cb537-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb537-5"><a href="exploratory-data-analysis.html#cb537-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb537-6"><a href="exploratory-data-analysis.html#cb537-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb537-7"><a href="exploratory-data-analysis.html#cb537-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Price per night&quot;</span>,</span>
<span id="cb537-8"><a href="exploratory-data-analysis.html#cb537-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of properties&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-319-1.png" width="672" /></p>
<p>Let’s look in more detail at those with a price more than $4,999.</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="exploratory-data-analysis.html#cb538-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb538-2"><a href="exploratory-data-analysis.html#cb538-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&gt;</span> <span class="dv">4999</span>)</span></code></pre></div>
<pre><code>## # A tibble: 11 x 21
##      host_id host_since host_response_time host_is_superhost host_listings_count
##        &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;              &lt;lgl&gt;                           &lt;dbl&gt;
##  1   9310264 2013-10-08 N/A                FALSE                               1
##  2  99076885 2016-10-10 N/A                FALSE                               1
##  3 119693302 2017-03-07 N/A                FALSE                               1
##  4 147240941 2017-08-22 N/A                FALSE                               2
##  5 174625477 2018-02-21 N/A                FALSE                               0
##  6  70349386 2016-05-04 N/A                FALSE                               1
##  7 215966560 2018-09-17 N/A                FALSE                               1
##  8  12931053 2014-03-08 within a few hours TRUE                                2
##  9 116137780 2017-02-12 N/A                FALSE                               6
## 10 113826425 2017-01-29 within a few hours FALSE                               3
## 11 184607983 2018-04-16 a few days or more FALSE                               1
## # … with 16 more variables: host_total_listings_count &lt;dbl&gt;,
## #   host_neighbourhood &lt;chr&gt;, neighbourhood_cleansed &lt;chr&gt;, room_type &lt;chr&gt;,
## #   bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;, price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,
## #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,
## #   review_scores_accuracy &lt;dbl&gt;, review_scores_cleanliness &lt;dbl&gt;,
## #   review_scores_checkin &lt;dbl&gt;, review_scores_communication &lt;dbl&gt;,
## #   review_scores_location &lt;dbl&gt;, review_scores_value &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="exploratory-data-analysis.html#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It&#39;s pretty clear that there is something odd going on with some of these, but some of them seem legit.</span></span></code></pre></div>
<p>Let’s look at the distribution of prices that are in a ‘reasonable’ range, which until Monica is a full professor, will be defined as a nightly price of less than $1,000.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="exploratory-data-analysis.html#cb541-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb541-2"><a href="exploratory-data-analysis.html#cb541-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&lt;</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb541-3"><a href="exploratory-data-analysis.html#cb541-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb541-4"><a href="exploratory-data-analysis.html#cb541-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb541-5"><a href="exploratory-data-analysis.html#cb541-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb541-6"><a href="exploratory-data-analysis.html#cb541-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Price per night&quot;</span>,</span>
<span id="cb541-7"><a href="exploratory-data-analysis.html#cb541-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of properties&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-321-1.png" width="672" /></p>
<p>Interestingly it looks like there is some bunching of prices, possible around numbers ending in zero or nine? Let’s just zoom in on prices between $90 and $210, out of interest, but change the bins to be smaller.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="exploratory-data-analysis.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at distribution of price again</span></span>
<span id="cb542-2"><a href="exploratory-data-analysis.html#cb542-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb542-3"><a href="exploratory-data-analysis.html#cb542-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb542-4"><a href="exploratory-data-analysis.html#cb542-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&lt;</span> <span class="dv">210</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb542-5"><a href="exploratory-data-analysis.html#cb542-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price)) <span class="sc">+</span></span>
<span id="cb542-6"><a href="exploratory-data-analysis.html#cb542-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb542-7"><a href="exploratory-data-analysis.html#cb542-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb542-8"><a href="exploratory-data-analysis.html#cb542-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Price per night&quot;</span>,</span>
<span id="cb542-9"><a href="exploratory-data-analysis.html#cb542-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of properties&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-322-1.png" width="672" /></p>
</div>
<div id="superhosts" class="section level4" number="13.4.4.2">
<h4><span class="header-section-number">13.4.4.2</span> Superhosts</h4>
<p>Airbnb <a href="https://www.airbnb.ca/help/article/828/what-is-a-superhost">says</a> that:</p>
<blockquote>
<p>Superhosts are experienced hosts who provide a shining example for other hosts, and extraordinary experiences for their guests.</p>
<p>Once a host reaches Superhost status, a badge superhost badge will automatically appear on their listing and profile to help you identify them.</p>
<p>We check Superhosts’ activity four times a year, to ensure that the program highlights the people who are most dedicated to providing outstanding hospitality.</p>
</blockquote>
<p>First we’ll look at the NAs in <code>host_is_superhost</code>.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="exploratory-data-analysis.html#cb543-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb543-2"><a href="exploratory-data-analysis.html#cb543-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(host_is_superhost))</span></code></pre></div>
<pre><code>## # A tibble: 11 x 21
##      host_id host_since host_response_time host_is_superhost host_listings_count
##        &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;              &lt;lgl&gt;                           &lt;dbl&gt;
##  1  23472830 NA         &lt;NA&gt;               NA                                 NA
##  2  31675651 NA         &lt;NA&gt;               NA                                 NA
##  3  75779190 NA         &lt;NA&gt;               NA                                 NA
##  4  47614482 NA         &lt;NA&gt;               NA                                 NA
##  5 201103629 NA         &lt;NA&gt;               NA                                 NA
##  6 111820893 NA         &lt;NA&gt;               NA                                 NA
##  7  23472830 NA         &lt;NA&gt;               NA                                 NA
##  8 196269219 NA         &lt;NA&gt;               NA                                 NA
##  9  23472830 NA         &lt;NA&gt;               NA                                 NA
## 10 266594170 NA         &lt;NA&gt;               NA                                 NA
## 11 118516038 NA         &lt;NA&gt;               NA                                 NA
## # … with 16 more variables: host_total_listings_count &lt;dbl&gt;,
## #   host_neighbourhood &lt;chr&gt;, neighbourhood_cleansed &lt;chr&gt;, room_type &lt;chr&gt;,
## #   bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;, price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,
## #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,
## #   review_scores_accuracy &lt;dbl&gt;, review_scores_cleanliness &lt;dbl&gt;,
## #   review_scores_checkin &lt;dbl&gt;, review_scores_communication &lt;dbl&gt;,
## #   review_scores_location &lt;dbl&gt;, review_scores_value &lt;dbl&gt;</code></pre>
<p>There are 285 of these and it’s clear that there is something odd going on - maybe the host removed the listing or similar?</p>
<p>We’ll also want to create a binary variable out of this. It’s true/false at the moment, which is fine for the modelling, but there are a handful of situations where it’ll be easier if we have a 0/1.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="exploratory-data-analysis.html#cb545-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="ot">&lt;-</span> </span>
<span id="cb545-2"><a href="exploratory-data-analysis.html#cb545-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb545-3"><a href="exploratory-data-analysis.html#cb545-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">host_is_superhost_binary =</span> <span class="fu">case_when</span>(</span>
<span id="cb545-4"><a href="exploratory-data-analysis.html#cb545-4" aria-hidden="true" tabindex="-1"></a>    host_is_superhost <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb545-5"><a href="exploratory-data-analysis.html#cb545-5" aria-hidden="true" tabindex="-1"></a>    host_is_superhost <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb545-6"><a href="exploratory-data-analysis.html#cb545-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">999</span></span>
<span id="cb545-7"><a href="exploratory-data-analysis.html#cb545-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb545-8"><a href="exploratory-data-analysis.html#cb545-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb545-9"><a href="exploratory-data-analysis.html#cb545-9" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected<span class="sc">$</span>host_is_superhost_binary[airbnb_data_selected<span class="sc">$</span>host_is_superhost_binary <span class="sc">==</span> <span class="dv">999</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
</div>
<div id="reviews" class="section level4" number="13.4.4.3">
<h4><span class="header-section-number">13.4.4.3</span> Reviews</h4>
<p>Airbnb <a href="https://www.airbnb.ca/help/article/1257/how-do-star-ratings-work-for-stays">says</a> that:</p>
<blockquote>
<p>In addition to written reviews, guests can submit an overall star rating and a set of category star ratings for their stay.</p>
<p>Hosts can view their star ratings on their Progress page, under Reviews. Hosts using professional hosting tools can find reviews and quality details on their Performance page, under Quality.</p>
<p>Guests can give ratings on:</p>
<ul>
<li>Overall experience. Overall, how was the stay?</li>
<li>Cleanliness. Did guests feel that the space was clean and tidy?</li>
<li>Accuracy. How accurately did the listing page represent the space? For example, guests should be able to find up-to-date info and photos in the listing description.</li>
<li>Value. Did the guest feel that the listing provided good value for the price?</li>
<li>Communication. How well did you communicate before and during the stay? Guests often care that their host responds quickly, reliably, and frequently to their messages and questions.</li>
<li>Check-in. How smoothly did check-in go?</li>
<li>Location. How did guests feel about the neighbourhood? This may mean that there’s an accurate description for proximity and access to transportation, shopping centres, city centre, etc., and a description that includes special considerations, like noise, and family safety.</li>
<li>Amenities. How did guests feel about the amenities that were available during their stay? Guests often care that all the amenities listed are available, working, and in good condition.</li>
</ul>
<p>In each category, hosts are able to see how often they get 5 stars, how guests rated nearby hosts, and, in some cases, tips to help improve the listing.</p>
<p>The number of stars displayed at the top of a listing page is an aggregate of the primary scores guests have given for that listing. At the bottom of a listing page, there’s an aggregate for each category rating. A host needs to receive star ratings from at least 3 guests before their aggregate score appears.</p>
</blockquote>
<p>TODO: I don’t understand how these review scores are being constructed. Airbnb says it’s a star rating, but how are they converting this into the 10 point scale, similarly, how are their constructing the overall one, which seems to be out of 100? There’s a lot of clumping around 20, 40, 60, 80, 100 - could they be averaging a five-star scale and then rebasing it to 100?</p>
<p>Now we’ll deal with the NAs in <code>review_scores_rating</code>. This one is more complicated as there are a lot of them.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="exploratory-data-analysis.html#cb546-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb546-2"><a href="exploratory-data-analysis.html#cb546-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(review_scores_rating))</span></code></pre></div>
<pre><code>## # A tibble: 4,368 x 22
##    host_id host_since host_response_time host_is_superhost host_listings_count
##      &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;              &lt;lgl&gt;                           &lt;dbl&gt;
##  1   48239 2009-10-25 N/A                FALSE                               1
##  2  187320 2010-08-01 within a few hours TRUE                               13
##  3  188183 2010-08-01 a few days or more FALSE                               1
##  4  187320 2010-08-01 within a few hours TRUE                               13
##  5  304551 2010-11-29 within an hour     TRUE                                6
##  6  545074 2011-04-29 N/A                FALSE                               2
##  7 1210571 2011-09-26 N/A                FALSE                               1
##  8 1411076 2011-11-15 N/A                FALSE                               1
##  9 1409872 2011-11-15 N/A                FALSE                               1
## 10 1664812 2012-01-28 N/A                FALSE                               1
## # … with 4,358 more rows, and 17 more variables:
## #   host_total_listings_count &lt;dbl&gt;, host_neighbourhood &lt;chr&gt;,
## #   neighbourhood_cleansed &lt;chr&gt;, room_type &lt;chr&gt;, bathrooms &lt;lgl&gt;,
## #   bedrooms &lt;dbl&gt;, price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,
## #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,
## #   review_scores_accuracy &lt;dbl&gt;, review_scores_cleanliness &lt;dbl&gt;,
## #   review_scores_checkin &lt;dbl&gt;, review_scores_communication &lt;dbl&gt;,
## #   review_scores_location &lt;dbl&gt;, review_scores_value &lt;dbl&gt;,
## #   host_is_superhost_binary &lt;dbl&gt;</code></pre>
<p>Now see if it’s just because they don’t have any reviews.</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="exploratory-data-analysis.html#cb548-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb548-2"><a href="exploratory-data-analysis.html#cb548-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(review_scores_rating)) <span class="sc">%&gt;%</span> </span>
<span id="cb548-3"><a href="exploratory-data-analysis.html#cb548-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(number_of_reviews) <span class="sc">%&gt;%</span> </span>
<span id="cb548-4"><a href="exploratory-data-analysis.html#cb548-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## .
##    0    1    2    3    4 
## 4105  227   23   10    3</code></pre>
<p>So it’s clear that in almost all these cases they don’t have a review yet because they don’t have enough reviews. However, it’s a large proportion of the total - almost a fifth of properties don’t have any reviews (hence an NA in review_scores_rating).</p>
<p>We can use <code>vis_miss</code> from the <code>visdat</code> package <span class="citation">(<a href="references-1.html#ref-citevisdat" role="doc-biblioref">Tierney 2017</a>)</span> to make sure that all components of the review are missing. If the NAs are being driven by the Airbnb requirement of at least three reviews then we would expect they would all be missing.</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="exploratory-data-analysis.html#cb550-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll just check whether this is the same for all of the different variants of reviews</span></span>
<span id="cb550-2"><a href="exploratory-data-analysis.html#cb550-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb550-3"><a href="exploratory-data-analysis.html#cb550-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(review_scores_rating, </span>
<span id="cb550-4"><a href="exploratory-data-analysis.html#cb550-4" aria-hidden="true" tabindex="-1"></a>         review_scores_accuracy, </span>
<span id="cb550-5"><a href="exploratory-data-analysis.html#cb550-5" aria-hidden="true" tabindex="-1"></a>         review_scores_cleanliness, </span>
<span id="cb550-6"><a href="exploratory-data-analysis.html#cb550-6" aria-hidden="true" tabindex="-1"></a>         review_scores_checkin, </span>
<span id="cb550-7"><a href="exploratory-data-analysis.html#cb550-7" aria-hidden="true" tabindex="-1"></a>         review_scores_communication, </span>
<span id="cb550-8"><a href="exploratory-data-analysis.html#cb550-8" aria-hidden="true" tabindex="-1"></a>         review_scores_location, </span>
<span id="cb550-9"><a href="exploratory-data-analysis.html#cb550-9" aria-hidden="true" tabindex="-1"></a>         review_scores_value) <span class="sc">%&gt;%</span> </span>
<span id="cb550-10"><a href="exploratory-data-analysis.html#cb550-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vis_miss</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-327-1.png" width="672" /></p>
<p>It looks pretty convincing that in almost all cases, all the different variants of reviews are missing. So let’s just focus on the main review.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="exploratory-data-analysis.html#cb551-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb551-2"><a href="exploratory-data-analysis.html#cb551-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(review_scores_rating)) <span class="sc">%&gt;%</span> </span>
<span id="cb551-3"><a href="exploratory-data-analysis.html#cb551-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> review_scores_rating)) <span class="sc">+</span></span>
<span id="cb551-4"><a href="exploratory-data-analysis.html#cb551-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb551-5"><a href="exploratory-data-analysis.html#cb551-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb551-6"><a href="exploratory-data-analysis.html#cb551-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Average review score&quot;</span>,</span>
<span id="cb551-7"><a href="exploratory-data-analysis.html#cb551-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of properties&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-328-1.png" width="672" /></p>
<p>It’s pretty clear that almost all the reviews are more than 80. Let’s just zoom in on that 60 to 80 range to check what the distribution looks like in that range.</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="exploratory-data-analysis.html#cb552-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span></span>
<span id="cb552-2"><a href="exploratory-data-analysis.html#cb552-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(review_scores_rating)) <span class="sc">%&gt;%</span> </span>
<span id="cb552-3"><a href="exploratory-data-analysis.html#cb552-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(review_scores_rating <span class="sc">&gt;</span> <span class="dv">60</span>) <span class="sc">%&gt;%</span></span>
<span id="cb552-4"><a href="exploratory-data-analysis.html#cb552-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(review_scores_rating <span class="sc">&lt;</span> <span class="dv">80</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb552-5"><a href="exploratory-data-analysis.html#cb552-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> review_scores_rating)) <span class="sc">+</span></span>
<span id="cb552-6"><a href="exploratory-data-analysis.html#cb552-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb552-7"><a href="exploratory-data-analysis.html#cb552-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb552-8"><a href="exploratory-data-analysis.html#cb552-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Average review score&quot;</span>,</span>
<span id="cb552-9"><a href="exploratory-data-analysis.html#cb552-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of properties&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-329-1.png" width="672" /></p>
</div>
<div id="response-time" class="section level4" number="13.4.4.4">
<h4><span class="header-section-number">13.4.4.4</span> Response time</h4>
<p>Airbnb <a href="https://www.airbnb.ca/help/article/75/how-much-time-does-a-host-have-to-respond-to-my-reservation-request">says</a> that:</p>
<blockquote>
<p>Hosts have 24 hours to officially accept or decline reservation requests. You’ll be updated by email about the status of your request.</p>
<p>More than half of all reservation requests are accepted within one hour of being received. The vast majority of hosts reply within 12 hours.</p>
<p>If a host confirms your request, your payment is processed and collected by Airbnb in full. If a host declines your request or the request expires, we don’t process your payment.</p>
</blockquote>
<p>TODO: I don’t understand how you can get a response time of NA? It must be related to some other variable.</p>
<p>Looking now at response time:</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="exploratory-data-analysis.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(airbnb_data_selected<span class="sc">$</span>host_response_time)</span></code></pre></div>
<pre><code>## 
## a few days or more                N/A       within a day within a few hours 
##                816               8469               1235               2062 
##     within an hour 
##               5672</code></pre>
<p>Interestingly it seems like what looks like ‘NAs’ in the <code>host_response_time</code> variable are not being coded as proper NAs, but are instead being treated as another category. We’ll recode them to be actual NAs.</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="exploratory-data-analysis.html#cb555-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected<span class="sc">$</span>host_response_time[airbnb_data_selected<span class="sc">$</span>host_response_time <span class="sc">==</span> <span class="st">&quot;N/A&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span></code></pre></div>
<p>So here we clearly have issues with NAs. We probably want to filter them away for this example because it’s just a quick example, but there are an awful lot of them (more than 20 per cent) so we’ll have a quick look at them in relation to the review score.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="exploratory-data-analysis.html#cb556-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb556-2"><a href="exploratory-data-analysis.html#cb556-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(host_response_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb556-3"><a href="exploratory-data-analysis.html#cb556-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> review_scores_rating)) <span class="sc">+</span></span>
<span id="cb556-4"><a href="exploratory-data-analysis.html#cb556-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-332-1.png" width="672" /></p>
<p>There seem to be an awful lot that have an overall review of 100. There are also an awful lot that have a review score of NA.</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="exploratory-data-analysis.html#cb557-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb557-2"><a href="exploratory-data-analysis.html#cb557-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(host_response_time)) <span class="sc">%&gt;%</span></span>
<span id="cb557-3"><a href="exploratory-data-analysis.html#cb557-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(review_scores_rating))</span></code></pre></div>
<pre><code>## # A tibble: 2,590 x 22
##    host_id host_since host_response_time host_is_superhost host_listings_count
##      &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;              &lt;lgl&gt;                           &lt;dbl&gt;
##  1   48239 2009-10-25 &lt;NA&gt;               FALSE                               1
##  2  545074 2011-04-29 &lt;NA&gt;               FALSE                               2
##  3 1210571 2011-09-26 &lt;NA&gt;               FALSE                               1
##  4 1411076 2011-11-15 &lt;NA&gt;               FALSE                               1
##  5 1409872 2011-11-15 &lt;NA&gt;               FALSE                               1
##  6 1664812 2012-01-28 &lt;NA&gt;               FALSE                               1
##  7 1828773 2012-02-28 &lt;NA&gt;               FALSE                               1
##  8 1923052 2012-03-14 &lt;NA&gt;               FALSE                               1
##  9 2432916 2012-05-22 &lt;NA&gt;               FALSE                               1
## 10 2577688 2012-06-07 &lt;NA&gt;               FALSE                               1
## # … with 2,580 more rows, and 17 more variables:
## #   host_total_listings_count &lt;dbl&gt;, host_neighbourhood &lt;chr&gt;,
## #   neighbourhood_cleansed &lt;chr&gt;, room_type &lt;chr&gt;, bathrooms &lt;lgl&gt;,
## #   bedrooms &lt;dbl&gt;, price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,
## #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,
## #   review_scores_accuracy &lt;dbl&gt;, review_scores_cleanliness &lt;dbl&gt;,
## #   review_scores_checkin &lt;dbl&gt;, review_scores_communication &lt;dbl&gt;,
## #   review_scores_location &lt;dbl&gt;, review_scores_value &lt;dbl&gt;,
## #   host_is_superhost_binary &lt;dbl&gt;</code></pre>
</div>
<div id="host-number-of-listings" class="section level4" number="13.4.4.5">
<h4><span class="header-section-number">13.4.4.5</span> Host number of listings</h4>
<p>There are two versions of a variable telling you how many properties a host has on Airbnb, so to start just check whether there’s a difference.</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="exploratory-data-analysis.html#cb559-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb559-2"><a href="exploratory-data-analysis.html#cb559-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">listings_count_is_same =</span> <span class="fu">if_else</span>(host_listings_count <span class="sc">==</span> host_total_listings_count, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb559-3"><a href="exploratory-data-analysis.html#cb559-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(listings_count_is_same <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## # A tibble: 0 x 23
## # … with 23 variables: host_id &lt;dbl&gt;, host_since &lt;date&gt;,
## #   host_response_time &lt;chr&gt;, host_is_superhost &lt;lgl&gt;,
## #   host_listings_count &lt;dbl&gt;, host_total_listings_count &lt;dbl&gt;,
## #   host_neighbourhood &lt;chr&gt;, neighbourhood_cleansed &lt;chr&gt;, room_type &lt;chr&gt;,
## #   bathrooms &lt;lgl&gt;, bedrooms &lt;dbl&gt;, price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,
## #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,
## #   review_scores_accuracy &lt;dbl&gt;, review_scores_cleanliness &lt;dbl&gt;,
## #   review_scores_checkin &lt;dbl&gt;, review_scores_communication &lt;dbl&gt;,
## #   review_scores_location &lt;dbl&gt;, review_scores_value &lt;dbl&gt;,
## #   host_is_superhost_binary &lt;dbl&gt;, listings_count_is_same &lt;dbl&gt;</code></pre>
<p>There are none in this dataset so we can just remove one column for now and have a quick look at the other one.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="exploratory-data-analysis.html#cb561-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="ot">&lt;-</span> </span>
<span id="cb561-2"><a href="exploratory-data-analysis.html#cb561-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb561-3"><a href="exploratory-data-analysis.html#cb561-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>host_listings_count)</span>
<span id="cb561-4"><a href="exploratory-data-analysis.html#cb561-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb561-5"><a href="exploratory-data-analysis.html#cb561-5" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb561-6"><a href="exploratory-data-analysis.html#cb561-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(host_total_listings_count)</span></code></pre></div>
<pre><code>## # A tibble: 49 x 2
##    host_total_listings_count     n
##                        &lt;dbl&gt; &lt;int&gt;
##  1                         0  2128
##  2                         1  7662
##  3                         2  2476
##  4                         3  1384
##  5                         4   802
##  6                         5   478
##  7                         6   385
##  8                         7   270
##  9                         8   291
## 10                         9   170
## # … with 39 more rows</code></pre>
<p>So there are a large number who have somewhere in the 2-10 properties range, but the usual long tail. The number with 0 listings is unexpected and worth following up on. And there are a bunch with NA that we’ll need to deal with.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="exploratory-data-analysis.html#cb563-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb563-2"><a href="exploratory-data-analysis.html#cb563-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(host_total_listings_count <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb563-3"><a href="exploratory-data-analysis.html#cb563-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 21
##   host_id host_since host_response_time host_is_superhost host_total_listings_c…
##     &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;              &lt;lgl&gt;                              &lt;dbl&gt;
## 1  140602 2010-06-08 &lt;NA&gt;               FALSE                                  0
## 2 1024550 2011-08-26 &lt;NA&gt;               FALSE                                  0
## 3 2647656 2012-06-15 &lt;NA&gt;               FALSE                                  0
## 4 3783106 2012-10-06 within an hour     FALSE                                  0
## 5 3814089 2012-10-09 within an hour     FALSE                                  0
## 6 3827668 2012-10-10 within a day       FALSE                                  0
## # … with 16 more variables: host_neighbourhood &lt;chr&gt;,
## #   neighbourhood_cleansed &lt;chr&gt;, room_type &lt;chr&gt;, bathrooms &lt;lgl&gt;,
## #   bedrooms &lt;dbl&gt;, price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,
## #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,
## #   review_scores_accuracy &lt;dbl&gt;, review_scores_cleanliness &lt;dbl&gt;,
## #   review_scores_checkin &lt;dbl&gt;, review_scores_communication &lt;dbl&gt;,
## #   review_scores_location &lt;dbl&gt;, review_scores_value &lt;dbl&gt;,
## #   host_is_superhost_binary &lt;dbl&gt;</code></pre>
<p>There’s nothing that immediately jumps out as odd about the people with zero listings, but there must be something going on.</p>
<p>Based on this dataset, there’s a third way of looking at the number of properties someone has and that’s to look at the number of times the unique ID occurs.</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="exploratory-data-analysis.html#cb565-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb565-2"><a href="exploratory-data-analysis.html#cb565-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(host_id) <span class="sc">%&gt;%</span> </span>
<span id="cb565-3"><a href="exploratory-data-analysis.html#cb565-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb565-4"><a href="exploratory-data-analysis.html#cb565-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##     host_id     n
##       &lt;dbl&gt; &lt;int&gt;
## 1  10202618    74
## 2   1919294    63
## 3 152088065    59
## 4 293274089    56
## 5    785826    54
## 6    846505    46</code></pre>
<p>Again this makes it clear that there are many with multiple properties listed.</p>
</div>
<div id="decisions" class="section level4" number="13.4.4.6">
<h4><span class="header-section-number">13.4.4.6</span> Decisions</h4>
<p>The purpose of this document is to just give a quick introduction to using real-world data, so we’ll just remove anything that is annoying, but if you’re using this for research then you’d need to justify these decisions and/or possibly make different ones.</p>
<p>Get rid of prices more than $999.</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="exploratory-data-analysis.html#cb567-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="ot">&lt;-</span> </span>
<span id="cb567-2"><a href="exploratory-data-analysis.html#cb567-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_selected <span class="sc">%&gt;%</span> </span>
<span id="cb567-3"><a href="exploratory-data-analysis.html#cb567-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(price <span class="sc">&lt;</span> <span class="dv">1000</span>)</span>
<span id="cb567-4"><a href="exploratory-data-analysis.html#cb567-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(airbnb_data_filtered)</span></code></pre></div>
<pre><code>## [1] 18120    21</code></pre>
<p>Get rid of anyone with an NA for whether they are a super host.</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="exploratory-data-analysis.html#cb569-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just remove host_is_superhost NAs for now.</span></span>
<span id="cb569-2"><a href="exploratory-data-analysis.html#cb569-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="ot">&lt;-</span> </span>
<span id="cb569-3"><a href="exploratory-data-analysis.html#cb569-3" aria-hidden="true" tabindex="-1"></a>  airbnb_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb569-4"><a href="exploratory-data-analysis.html#cb569-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(host_is_superhost))</span>
<span id="cb569-5"><a href="exploratory-data-analysis.html#cb569-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(airbnb_data_filtered)</span></code></pre></div>
<pre><code>## [1] 18109    21</code></pre>
<p>Get rid of anyone with an NA in their main review score - this removes roughly 20 per cent of observations.</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="exploratory-data-analysis.html#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll just get rid of them for now, but this is probably something that deserves more attention - possibly in an appendix or similar.</span></span>
<span id="cb571-2"><a href="exploratory-data-analysis.html#cb571-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="ot">&lt;-</span> </span>
<span id="cb571-3"><a href="exploratory-data-analysis.html#cb571-3" aria-hidden="true" tabindex="-1"></a>  airbnb_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb571-4"><a href="exploratory-data-analysis.html#cb571-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(review_scores_rating))</span>
<span id="cb571-5"><a href="exploratory-data-analysis.html#cb571-5" aria-hidden="true" tabindex="-1"></a><span class="co"># There are still some where the rest of the reviews are missing even though there is a main review score</span></span>
<span id="cb571-6"><a href="exploratory-data-analysis.html#cb571-6" aria-hidden="true" tabindex="-1"></a><span class="co"># There seem to be an awful lot that have an overall review of 100. Does that make sense?</span></span>
<span id="cb571-7"><a href="exploratory-data-analysis.html#cb571-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(airbnb_data_filtered)</span></code></pre></div>
<pre><code>## [1] 13801    21</code></pre>
<p>Get rid of anyone with a main review score less than 70.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="exploratory-data-analysis.html#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We&#39;ll just get rid of them for now, but this is probably something that deserves more attention - possibly in an appendix or similar.</span></span>
<span id="cb573-2"><a href="exploratory-data-analysis.html#cb573-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="ot">&lt;-</span> </span>
<span id="cb573-3"><a href="exploratory-data-analysis.html#cb573-3" aria-hidden="true" tabindex="-1"></a>  airbnb_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb573-4"><a href="exploratory-data-analysis.html#cb573-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(review_scores_rating <span class="sc">&gt;</span> <span class="dv">69</span>)</span>
<span id="cb573-5"><a href="exploratory-data-analysis.html#cb573-5" aria-hidden="true" tabindex="-1"></a><span class="co"># There are still some where the rest of the reviews are missing even though there is a main review score</span></span>
<span id="cb573-6"><a href="exploratory-data-analysis.html#cb573-6" aria-hidden="true" tabindex="-1"></a><span class="co"># There seem to be an awful lot that have an overall review of 100. Does that make sense?</span></span>
<span id="cb573-7"><a href="exploratory-data-analysis.html#cb573-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(airbnb_data_filtered)</span></code></pre></div>
<pre><code>## [1] 13471    21</code></pre>
<p>Get rid of anyone with a NA in their response time - this removes roughly another 20 per cent of the observations.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="exploratory-data-analysis.html#cb575-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="ot">&lt;-</span> </span>
<span id="cb575-2"><a href="exploratory-data-analysis.html#cb575-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb575-3"><a href="exploratory-data-analysis.html#cb575-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(host_response_time))</span>
<span id="cb575-4"><a href="exploratory-data-analysis.html#cb575-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(airbnb_data_filtered)</span></code></pre></div>
<pre><code>## [1] 7763   21</code></pre>
<p>TODO: We don’t have to do this next step as we’ve already got rid of them at some other point. So there’s something systematic going on and we should come back and look into it.</p>
<p>Get rid of anyone with a NA in their number of properties.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="exploratory-data-analysis.html#cb577-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="ot">&lt;-</span> </span>
<span id="cb577-2"><a href="exploratory-data-analysis.html#cb577-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb577-3"><a href="exploratory-data-analysis.html#cb577-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(host_total_listings_count))</span>
<span id="cb577-4"><a href="exploratory-data-analysis.html#cb577-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(airbnb_data_filtered)</span></code></pre></div>
<pre><code>## [1] 7763   21</code></pre>
<p>Get rid of anyone with a 100 for their review_scores_rating.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="exploratory-data-analysis.html#cb579-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="ot">&lt;-</span> </span>
<span id="cb579-2"><a href="exploratory-data-analysis.html#cb579-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb579-3"><a href="exploratory-data-analysis.html#cb579-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(review_scores_rating <span class="sc">!=</span> <span class="dv">100</span>)</span>
<span id="cb579-4"><a href="exploratory-data-analysis.html#cb579-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(airbnb_data_filtered)</span></code></pre></div>
<pre><code>## [1] 5648   21</code></pre>
<p>Only keep people with one property:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="exploratory-data-analysis.html#cb581-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="ot">&lt;-</span> </span>
<span id="cb581-2"><a href="exploratory-data-analysis.html#cb581-2" aria-hidden="true" tabindex="-1"></a>  airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb581-3"><a href="exploratory-data-analysis.html#cb581-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(host_id) <span class="sc">%&gt;%</span> </span>
<span id="cb581-4"><a href="exploratory-data-analysis.html#cb581-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb581-5"><a href="exploratory-data-analysis.html#cb581-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n)</span>
<span id="cb581-6"><a href="exploratory-data-analysis.html#cb581-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(airbnb_data_filtered)</span></code></pre></div>
<pre><code>## [1] 2304   21</code></pre>
</div>
</div>
<div id="explore-data" class="section level3" number="13.4.5">
<h3><span class="header-section-number">13.4.5</span> Explore data</h3>
<p>We might like to make some graphs to see if we can any relationships jump out. Some aspects that come to mind is looking at prices and reviews and super hosts, and number of properties and neighbourhood.</p>
<div id="price-and-reviews" class="section level4" number="13.4.5.1">
<h4><span class="header-section-number">13.4.5.1</span> Price and reviews</h4>
<p>Look at the relationship between price and reviews, and whether they are a super-host.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="exploratory-data-analysis.html#cb583-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at both price and reviews</span></span>
<span id="cb583-2"><a href="exploratory-data-analysis.html#cb583-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb583-3"><a href="exploratory-data-analysis.html#cb583-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> price, <span class="at">y =</span> review_scores_rating, <span class="at">color =</span> host_is_superhost)) <span class="sc">+</span></span>
<span id="cb583-4"><a href="exploratory-data-analysis.html#cb583-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="co"># Make the points smaller and more transparent as they overlap considerably.</span></span>
<span id="cb583-5"><a href="exploratory-data-analysis.html#cb583-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb583-6"><a href="exploratory-data-analysis.html#cb583-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Price per night&quot;</span>,</span>
<span id="cb583-7"><a href="exploratory-data-analysis.html#cb583-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Average review score&quot;</span>,</span>
<span id="cb583-8"><a href="exploratory-data-analysis.html#cb583-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Super host&quot;</span>) <span class="sc">+</span> <span class="co"># Probably should recode this to more meaningful than TRUE/FALSE.</span></span>
<span id="cb583-9"><a href="exploratory-data-analysis.html#cb583-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-346-1.png" width="672" /></p>
</div>
<div id="superhost-and-response-time" class="section level4" number="13.4.5.2">
<h4><span class="header-section-number">13.4.5.2</span> Superhost and response-time</h4>
<p>One of the aspects that may make someone a super host is how quickly they respond to enquiries. One could imagine that being a superhost involves quickly saying yes or no to enquiries. Let’s look at the data. First, we want to look at the possible values of superhost by their response times.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="exploratory-data-analysis.html#cb584-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb584-2"><a href="exploratory-data-analysis.html#cb584-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(host_is_superhost) <span class="sc">%&gt;%</span> </span>
<span id="cb584-3"><a href="exploratory-data-analysis.html#cb584-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb584-4"><a href="exploratory-data-analysis.html#cb584-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>()</span></code></pre></div>
<pre><code>##  host_is_superhost    n percent
##              FALSE 1224   53.1%
##               TRUE 1080   46.9%
##              Total 2304  100.0%</code></pre>
<p>Fortunately, it looks like when we removed the reviews rows we removed any NAs from whether they were a super host, but if we go back and look into that we may need to check again. The <code>tabyl</code> function within the janitor package (Firke, 2020) would list the NAs if there were any, but in case you don’t trust it, another way of check this is to try to filter to just the NAs.</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="exploratory-data-analysis.html#cb586-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb586-2"><a href="exploratory-data-analysis.html#cb586-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(host_is_superhost))</span></code></pre></div>
<pre><code>## # A tibble: 0 x 21
## # … with 21 variables: host_id &lt;dbl&gt;, host_since &lt;date&gt;,
## #   host_response_time &lt;chr&gt;, host_is_superhost &lt;lgl&gt;,
## #   host_total_listings_count &lt;dbl&gt;, host_neighbourhood &lt;chr&gt;,
## #   neighbourhood_cleansed &lt;chr&gt;, room_type &lt;chr&gt;, bathrooms &lt;lgl&gt;,
## #   bedrooms &lt;dbl&gt;, price &lt;int&gt;, number_of_reviews &lt;dbl&gt;,
## #   has_availability &lt;lgl&gt;, review_scores_rating &lt;dbl&gt;,
## #   review_scores_accuracy &lt;dbl&gt;, review_scores_cleanliness &lt;dbl&gt;,
## #   review_scores_checkin &lt;dbl&gt;, review_scores_communication &lt;dbl&gt;,
## #   review_scores_location &lt;dbl&gt;, review_scores_value &lt;dbl&gt;,
## #   host_is_superhost_binary &lt;dbl&gt;</code></pre>
<p>Now let’s look at the response time.</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="exploratory-data-analysis.html#cb588-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb588-2"><a href="exploratory-data-analysis.html#cb588-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(host_response_time) <span class="sc">%&gt;%</span> </span>
<span id="cb588-3"><a href="exploratory-data-analysis.html#cb588-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb588-4"><a href="exploratory-data-analysis.html#cb588-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>()</span></code></pre></div>
<pre><code>##  host_response_time    n percent
##  a few days or more  167    7.2%
##        within a day  378   16.4%
##  within a few hours  519   22.5%
##      within an hour 1240   53.8%
##               Total 2304  100.0%</code></pre>
<p>So a vast majority respond within an hour.</p>
<p>Finally, we can look at the cross-tab.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="exploratory-data-analysis.html#cb590-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb590-2"><a href="exploratory-data-analysis.html#cb590-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(host_response_time, host_is_superhost) <span class="sc">%&gt;%</span> </span>
<span id="cb590-3"><a href="exploratory-data-analysis.html#cb590-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb590-4"><a href="exploratory-data-analysis.html#cb590-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb590-5"><a href="exploratory-data-analysis.html#cb590-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_ns</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb590-6"><a href="exploratory-data-analysis.html#cb590-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_title</span>()</span></code></pre></div>
<pre><code>##                     host_is_superhost          
##  host_response_time             FALSE      TRUE
##  a few days or more         88% (147) 12%  (20)
##        within a day         67% (254) 33% (124)
##  within a few hours         51% (266) 49% (253)
##      within an hour         45% (557) 55% (683)</code></pre>
<p>So if someone doesn’t respond within an hour then it’s unlikely that they are a super host.</p>
</div>
<div id="neighbourhood" class="section level4" number="13.4.5.3">
<h4><span class="header-section-number">13.4.5.3</span> Neighbourhood</h4>
<p>Finally, let’s look at neighbourhood. The data provider has attempted to clean the neighbourhood variable for us, so we’ll just use this for now. If we were doing this analysis properly, we’d need to check whether they’d made any mistakes.</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="exploratory-data-analysis.html#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We expect something in the order of 100 to 150 neighbourhoods, with the top ten accounting for a large majority of listings.</span></span>
<span id="cb592-2"><a href="exploratory-data-analysis.html#cb592-2" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb592-3"><a href="exploratory-data-analysis.html#cb592-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(neighbourhood_cleansed) <span class="sc">%&gt;%</span> </span>
<span id="cb592-4"><a href="exploratory-data-analysis.html#cb592-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb592-5"><a href="exploratory-data-analysis.html#cb592-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb592-6"><a href="exploratory-data-analysis.html#cb592-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 140</code></pre>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="exploratory-data-analysis.html#cb594-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb594-2"><a href="exploratory-data-analysis.html#cb594-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(neighbourhood_cleansed) <span class="sc">%&gt;%</span> </span>
<span id="cb594-3"><a href="exploratory-data-analysis.html#cb594-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb594-4"><a href="exploratory-data-analysis.html#cb594-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb594-5"><a href="exploratory-data-analysis.html#cb594-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb594-6"><a href="exploratory-data-analysis.html#cb594-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb594-7"><a href="exploratory-data-analysis.html#cb594-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##             neighbourhood_cleansed   n percent
##  Waterfront Communities-The Island 409   17.8%
##                            Niagara 101    4.4%
##                              Total 510       -</code></pre>
</div>
</div>
<div id="model-data" class="section level3" number="13.4.6">
<h3><span class="header-section-number">13.4.6</span> Model data</h3>
<p>We will now run some models on our dataset. We will first split the data into test/training groups, we do this using functions from the tidymodels package <span class="citation">(<a href="references-1.html#ref-citeTidymodels" role="doc-biblioref">Kuhn and Wickham 2020</a>)</span> (which like the tidyverse package <span class="citation">(<a href="references-1.html#ref-citetidyverse" role="doc-biblioref">Wickham et al. 2019b</a>)</span> is a package of packages).</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="exploratory-data-analysis.html#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb596-2"><a href="exploratory-data-analysis.html#cb596-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb596-3"><a href="exploratory-data-analysis.html#cb596-3" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered_split <span class="ot">&lt;-</span> </span>
<span id="cb596-4"><a href="exploratory-data-analysis.html#cb596-4" aria-hidden="true" tabindex="-1"></a>  airbnb_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb596-5"><a href="exploratory-data-analysis.html#cb596-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">initial_split</span>(<span class="at">prop =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>)</span>
<span id="cb596-6"><a href="exploratory-data-analysis.html#cb596-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb596-7"><a href="exploratory-data-analysis.html#cb596-7" aria-hidden="true" tabindex="-1"></a>airbnb_train <span class="ot">&lt;-</span> <span class="fu">training</span>(airbnb_data_filtered_split)</span>
<span id="cb596-8"><a href="exploratory-data-analysis.html#cb596-8" aria-hidden="true" tabindex="-1"></a>airbnb_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(airbnb_data_filtered_split)</span>
<span id="cb596-9"><a href="exploratory-data-analysis.html#cb596-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb596-10"><a href="exploratory-data-analysis.html#cb596-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(airbnb_data_filtered_split)</span></code></pre></div>
<!-- ## Linear regression -->
<!-- We may like to look at the relationship between price and reviews using linear regression. We expect that better reviews will be associated with higher priced listings. Specifically, the model that we will estimate is: -->
<!-- $$\mbox{Price} = \beta_0 + \beta_1 \mbox{Reviews} + \epsilon$$ -->
<!-- ```{r, echo = TRUE} -->
<!-- price_reviews_linear_regression <- lm(price ~ review_scores_rating,  -->
<!--                                       data = airbnb_train) -->
<!-- tidy(price_reviews_linear_regression) -->
<!-- glance(price_reviews_linear_regression) -->
<!-- airbnb_data_filtered_linear_fit_train <-  -->
<!--   augment(price_reviews_linear_regression,  -->
<!--           data = airbnb_train %>% select(price, review_scores_rating)) -->
<!-- airbnb_data_filtered_linear_fit_test <-  -->
<!--   augment(price_reviews_linear_regression,  -->
<!--           data = airbnb_train %>% select(price, review_scores_rating), -->
<!--           newdata = airbnb_test %>% select(price, review_scores_rating)) -->
<!-- rmse(data = airbnb_data_filtered_linear_fit_train, -->
<!--      truth = price, -->
<!--      estimate = .fitted -->
<!--      ) -->
<!-- rmse(data = airbnb_data_filtered_linear_fit_test, -->
<!--      truth = price, -->
<!--      estimate = .fitted -->
<!--      ) -->
<!-- training <- airbnb_data_filtered_linear_fit_train %>%  -->
<!--   select(price, .fitted) %>%  -->
<!--   rename(fitted = .fitted) %>%  -->
<!--   mutate(type = "train") -->
<!-- test <- airbnb_data_filtered_linear_fit_test %>%  -->
<!--   select(price, .fitted) %>%  -->
<!--   rename(fitted = .fitted) %>%  -->
<!--   mutate(type = "test") -->
<!-- both <- rbind(training, test) -->
<!-- both %>%  -->
<!--   ggplot(aes(x = price, y = fitted)) + -->
<!--   geom_point() + -->
<!--   facet_wrap(vars(type)) -->
<!-- ``` -->
<!-- The poor old model is really struggling, which is to be expected given we've imposed a linear relationship and there is such little scope for reviews to mode (as they are bounded by 100). There are various things that we could do here. -->
<div id="logistic-regression-1" class="section level4" number="13.4.6.1">
<h4><span class="header-section-number">13.4.6.1</span> Logistic regression</h4>
<p>We may like to look at whether we can forecast whether someone is a super host, and the factors that go into explaining that. As the dependent variable is binary, this is a good opportunity to look at logistic regression. We expect that better reviews will be associated with faster responses and higher reviews. Specifically, the model that we estimate is:</p>
<p><span class="math display">\[\mbox{Prob(Is super host} = 1) = \beta_0 + \beta_1 \mbox{Response time} + \beta_2 \mbox{Reviews} + \epsilon\]</span></p>
<p>We estimate the model using <code>glm</code> in the R language <span class="citation">(<a href="references-1.html#ref-citeR" role="doc-biblioref">R Core Team 2020</a>)</span>.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="exploratory-data-analysis.html#cb597-1" aria-hidden="true" tabindex="-1"></a>logistic_reg_superhost_response_review <span class="ot">&lt;-</span> <span class="fu">glm</span>(host_is_superhost <span class="sc">~</span> </span>
<span id="cb597-2"><a href="exploratory-data-analysis.html#cb597-2" aria-hidden="true" tabindex="-1"></a>                                                host_response_time <span class="sc">+</span> </span>
<span id="cb597-3"><a href="exploratory-data-analysis.html#cb597-3" aria-hidden="true" tabindex="-1"></a>                                                review_scores_rating,</span>
<span id="cb597-4"><a href="exploratory-data-analysis.html#cb597-4" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">data =</span> airbnb_train,</span>
<span id="cb597-5"><a href="exploratory-data-analysis.html#cb597-5" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">family =</span> binomial</span>
<span id="cb597-6"><a href="exploratory-data-analysis.html#cb597-6" aria-hidden="true" tabindex="-1"></a>                                              )</span></code></pre></div>
<p>We can have a quick look at the results, for instance, the <code>summary</code> function. We could also use <code>tidy</code> or <code>glance</code> from the <code>broom</code> package <span class="citation">(<a href="references-1.html#ref-citebroom" role="doc-biblioref">D. Robinson, Hayes, and Couch 2020</a>)</span>. The details should be the same, but the <code>broom</code> functions are tibbles, which means that we can more easily deal with them within a tidy framework.</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="exploratory-data-analysis.html#cb598-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logistic_reg_superhost_response_review)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = host_is_superhost ~ host_response_time + review_scores_rating, 
##     family = binomial, data = airbnb_train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.8952  -0.8615  -0.0573   0.8621   4.0356  
## 
## Coefficients:
##                                       Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                          -40.77616    2.49677 -16.332  &lt; 2e-16 ***
## host_response_timewithin a day         1.03353    0.32344   3.195   0.0014 ** 
## host_response_timewithin a few hours   1.73271    0.31243   5.546 2.92e-08 ***
## host_response_timewithin an hour       2.00654    0.30004   6.688 2.27e-11 ***
## review_scores_rating                   0.40792    0.02564  15.910  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2385.4  on 1727  degrees of freedom
## Residual deviance: 1752.0  on 1723  degrees of freedom
## AIC: 1762
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="exploratory-data-analysis.html#cb600-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(logistic_reg_superhost_response_review)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   term                                 estimate std.error statistic  p.value
##   &lt;chr&gt;                                   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)                           -40.8      2.50      -16.3  5.89e-60
## 2 host_response_timewithin a day          1.03     0.323       3.20 1.40e- 3
## 3 host_response_timewithin a few hours    1.73     0.312       5.55 2.92e- 8
## 4 host_response_timewithin an hour        2.01     0.300       6.69 2.27e-11
## 5 review_scores_rating                    0.408    0.0256     15.9  5.39e-57</code></pre>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="exploratory-data-analysis.html#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(logistic_reg_superhost_response_review)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 8
##   null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs
##           &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;
## 1         2385.    1727  -876. 1762. 1789.    1752.        1723  1728</code></pre>
<p>We might like to look at what our model predicts, compared with whether the person was actually a super host. We can do that in a variety of ways, but one way is to use <code>augment</code> from the <code>broom</code> package <span class="citation">(<a href="references-1.html#ref-citebroom" role="doc-biblioref">D. Robinson, Hayes, and Couch 2020</a>)</span>. This will add the prediction and associated uncertainty to the data. For every row we will then have the probability that our model is estimating that they are a superhost. But ultimately, we need a binary forecast. There are a bunch of different options, but one is to just say that if the model estimates a probability of more than 0.5 then we bin it into a superhost, and other not.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="exploratory-data-analysis.html#cb604-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered_logistic_fit_train <span class="ot">&lt;-</span> </span>
<span id="cb604-2"><a href="exploratory-data-analysis.html#cb604-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(logistic_reg_superhost_response_review, </span>
<span id="cb604-3"><a href="exploratory-data-analysis.html#cb604-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> airbnb_train <span class="sc">%&gt;%</span> <span class="fu">select</span>(host_is_superhost, </span>
<span id="cb604-4"><a href="exploratory-data-analysis.html#cb604-4" aria-hidden="true" tabindex="-1"></a>                                         host_is_superhost_binary,</span>
<span id="cb604-5"><a href="exploratory-data-analysis.html#cb604-5" aria-hidden="true" tabindex="-1"></a>                                         host_response_time,</span>
<span id="cb604-6"><a href="exploratory-data-analysis.html#cb604-6" aria-hidden="true" tabindex="-1"></a>                                         review_scores_rating</span>
<span id="cb604-7"><a href="exploratory-data-analysis.html#cb604-7" aria-hidden="true" tabindex="-1"></a>                                         ),</span>
<span id="cb604-8"><a href="exploratory-data-analysis.html#cb604-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># We use the &quot;response&quot; option here so that the function does the work of worrying about the exponential and log odds for us. Our result will be a probability.</span></span>
<span id="cb604-9"><a href="exploratory-data-analysis.html#cb604-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.hat, <span class="sc">-</span>.sigma, <span class="sc">-</span>.cooksd, <span class="sc">-</span>.std.resid) <span class="sc">%&gt;%</span> </span>
<span id="cb604-10"><a href="exploratory-data-analysis.html#cb604-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predict_host_is_superhost =</span> <span class="fu">if_else</span>(.fitted <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># How do things change if we change the 0.5 cutoff?</span></span>
<span id="cb604-11"><a href="exploratory-data-analysis.html#cb604-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">host_is_superhost_binary =</span> <span class="fu">as.factor</span>(host_is_superhost_binary),</span>
<span id="cb604-12"><a href="exploratory-data-analysis.html#cb604-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">predict_host_is_superhost_binary =</span> <span class="fu">as.factor</span>(predict_host_is_superhost)</span>
<span id="cb604-13"><a href="exploratory-data-analysis.html#cb604-13" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>We can look at how far off the model is. There are a bunch of ways of doing this, but one is to look at what probability the model has given each person.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="exploratory-data-analysis.html#cb605-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered_logistic_fit_train <span class="sc">%&gt;%</span> </span>
<span id="cb605-2"><a href="exploratory-data-analysis.html#cb605-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">fill =</span> host_is_superhost_binary)) <span class="sc">+</span></span>
<span id="cb605-3"><a href="exploratory-data-analysis.html#cb605-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb605-4"><a href="exploratory-data-analysis.html#cb605-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb605-5"><a href="exploratory-data-analysis.html#cb605-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Estimated probability that host is super host&quot;</span>,</span>
<span id="cb605-6"><a href="exploratory-data-analysis.html#cb605-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number&quot;</span>,</span>
<span id="cb605-7"><a href="exploratory-data-analysis.html#cb605-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Host is super host&quot;</span>) <span class="sc">+</span></span>
<span id="cb605-8"><a href="exploratory-data-analysis.html#cb605-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-357-1.png" width="672" /></p>
<p>We can look at how the model probabilities change based on average review score, and their average time to respond.</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="exploratory-data-analysis.html#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airbnb_data_filtered_logistic_fit_train, </span>
<span id="cb606-2"><a href="exploratory-data-analysis.html#cb606-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> review_scores_rating, </span>
<span id="cb606-3"><a href="exploratory-data-analysis.html#cb606-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> .fitted, </span>
<span id="cb606-4"><a href="exploratory-data-analysis.html#cb606-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> host_response_time)) <span class="sc">+</span></span>
<span id="cb606-5"><a href="exploratory-data-analysis.html#cb606-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb606-6"><a href="exploratory-data-analysis.html#cb606-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb606-7"><a href="exploratory-data-analysis.html#cb606-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Average review score&quot;</span>,</span>
<span id="cb606-8"><a href="exploratory-data-analysis.html#cb606-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Predicted probability of being a superhost&quot;</span>,</span>
<span id="cb606-9"><a href="exploratory-data-analysis.html#cb606-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Host response time&quot;</span>) <span class="sc">+</span></span>
<span id="cb606-10"><a href="exploratory-data-analysis.html#cb606-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb606-11"><a href="exploratory-data-analysis.html#cb606-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-358-1.png" width="672" /></p>
<p>This nice thing about this graph is that it illustrates nicely the effect of a host having an average response time of, say, ‘within an hour’ compared with ‘within a few hours.’</p>
<p>We can focus on how the model does in terms of raw classification using <code>confusionMatrix</code> from the caret package (Kuhn, 2020). This also gives a bunch of diagnostics (the help file explains what they are). In general, they suggest this isn’t the best model that’s ever existed.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="exploratory-data-analysis.html#cb607-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="at">data =</span> airbnb_data_filtered_logistic_fit_train<span class="sc">$</span>predict_host_is_superhost_binary,</span>
<span id="cb607-2"><a href="exploratory-data-analysis.html#cb607-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">reference =</span> airbnb_data_filtered_logistic_fit_train<span class="sc">$</span>host_is_superhost_binary)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   0   1
##          0 687 178
##          1 243 620
##                                           
##                Accuracy : 0.7564          
##                  95% CI : (0.7354, 0.7764)
##     No Information Rate : 0.5382          
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.5127          
##                                           
##  Mcnemar&#39;s Test P-Value : 0.001814        
##                                           
##             Sensitivity : 0.7387          
##             Specificity : 0.7769          
##          Pos Pred Value : 0.7942          
##          Neg Pred Value : 0.7184          
##              Prevalence : 0.5382          
##          Detection Rate : 0.3976          
##    Detection Prevalence : 0.5006          
##       Balanced Accuracy : 0.7578          
##                                           
##        &#39;Positive&#39; Class : 0               
## </code></pre>
<p>In any case, to this point we’ve been looking at how the model has done on the training set. It’s also relevant how it does on the test set. Again, there are a bunch of ways to do this, but one is to again use the augment function, but to include a newdata argument.</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="exploratory-data-analysis.html#cb609-1" aria-hidden="true" tabindex="-1"></a>airbnb_data_filtered_logistic_fit_test <span class="ot">&lt;-</span> </span>
<span id="cb609-2"><a href="exploratory-data-analysis.html#cb609-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>(logistic_reg_superhost_response_review, </span>
<span id="cb609-3"><a href="exploratory-data-analysis.html#cb609-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> airbnb_train <span class="sc">%&gt;%</span> <span class="fu">select</span>(host_is_superhost, </span>
<span id="cb609-4"><a href="exploratory-data-analysis.html#cb609-4" aria-hidden="true" tabindex="-1"></a>                                         host_is_superhost_binary,</span>
<span id="cb609-5"><a href="exploratory-data-analysis.html#cb609-5" aria-hidden="true" tabindex="-1"></a>                                         host_response_time,</span>
<span id="cb609-6"><a href="exploratory-data-analysis.html#cb609-6" aria-hidden="true" tabindex="-1"></a>                                         review_scores_rating</span>
<span id="cb609-7"><a href="exploratory-data-analysis.html#cb609-7" aria-hidden="true" tabindex="-1"></a>                                         ),</span>
<span id="cb609-8"><a href="exploratory-data-analysis.html#cb609-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> airbnb_test <span class="sc">%&gt;%</span> <span class="fu">select</span>(host_is_superhost, </span>
<span id="cb609-9"><a href="exploratory-data-analysis.html#cb609-9" aria-hidden="true" tabindex="-1"></a>                                         host_is_superhost_binary,</span>
<span id="cb609-10"><a href="exploratory-data-analysis.html#cb609-10" aria-hidden="true" tabindex="-1"></a>                                         host_response_time,</span>
<span id="cb609-11"><a href="exploratory-data-analysis.html#cb609-11" aria-hidden="true" tabindex="-1"></a>                                         review_scores_rating</span>
<span id="cb609-12"><a href="exploratory-data-analysis.html#cb609-12" aria-hidden="true" tabindex="-1"></a>                                         ), <span class="co"># I&#39;m selecting just because the</span></span>
<span id="cb609-13"><a href="exploratory-data-analysis.html#cb609-13" aria-hidden="true" tabindex="-1"></a>          <span class="co"># dataset is quite wide, and so this makes it easier to look at.</span></span>
<span id="cb609-14"><a href="exploratory-data-analysis.html#cb609-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb609-15"><a href="exploratory-data-analysis.html#cb609-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predict_host_is_superhost =</span> <span class="fu">if_else</span>(.fitted <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb609-16"><a href="exploratory-data-analysis.html#cb609-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">host_is_superhost_binary =</span> <span class="fu">as.factor</span>(host_is_superhost_binary),</span>
<span id="cb609-17"><a href="exploratory-data-analysis.html#cb609-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">predict_host_is_superhost_binary =</span> <span class="fu">as.factor</span>(predict_host_is_superhost)</span>
<span id="cb609-18"><a href="exploratory-data-analysis.html#cb609-18" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<p>We would expect the performance to be slightly worse on the test set. But it’s actually fairly similar.</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="exploratory-data-analysis.html#cb610-1" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="at">data =</span> airbnb_data_filtered_logistic_fit_test<span class="sc">$</span>predict_host_is_superhost_binary,</span>
<span id="cb610-2"><a href="exploratory-data-analysis.html#cb610-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">reference =</span> airbnb_data_filtered_logistic_fit_test<span class="sc">$</span>host_is_superhost_binary)</span></code></pre></div>
<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction   0   1
##          0 227  60
##          1  67 222
##                                           
##                Accuracy : 0.7795          
##                  95% CI : (0.7434, 0.8127)
##     No Information Rate : 0.5104          
##     P-Value [Acc &gt; NIR] : &lt;2e-16          
##                                           
##                   Kappa : 0.5591          
##                                           
##  Mcnemar&#39;s Test P-Value : 0.5944          
##                                           
##             Sensitivity : 0.7721          
##             Specificity : 0.7872          
##          Pos Pred Value : 0.7909          
##          Neg Pred Value : 0.7682          
##              Prevalence : 0.5104          
##          Detection Rate : 0.3941          
##    Detection Prevalence : 0.4983          
##       Balanced Accuracy : 0.7797          
##                                           
##        &#39;Positive&#39; Class : 0               
## </code></pre>
<p>We could compare the test with the training sets in terms of forecasts.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="exploratory-data-analysis.html#cb612-1" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> airbnb_data_filtered_logistic_fit_train <span class="sc">%&gt;%</span> </span>
<span id="cb612-2"><a href="exploratory-data-analysis.html#cb612-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(host_is_superhost_binary, .fitted) <span class="sc">%&gt;%</span> </span>
<span id="cb612-3"><a href="exploratory-data-analysis.html#cb612-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Training set&quot;</span>)</span>
<span id="cb612-4"><a href="exploratory-data-analysis.html#cb612-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-5"><a href="exploratory-data-analysis.html#cb612-5" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> airbnb_data_filtered_logistic_fit_test <span class="sc">%&gt;%</span> </span>
<span id="cb612-6"><a href="exploratory-data-analysis.html#cb612-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(host_is_superhost_binary, .fitted) <span class="sc">%&gt;%</span> </span>
<span id="cb612-7"><a href="exploratory-data-analysis.html#cb612-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Test set&quot;</span>)</span>
<span id="cb612-8"><a href="exploratory-data-analysis.html#cb612-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-9"><a href="exploratory-data-analysis.html#cb612-9" aria-hidden="true" tabindex="-1"></a>both <span class="ot">&lt;-</span> <span class="fu">rbind</span>(training, test)</span>
<span id="cb612-10"><a href="exploratory-data-analysis.html#cb612-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(training, test)</span>
<span id="cb612-11"><a href="exploratory-data-analysis.html#cb612-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-12"><a href="exploratory-data-analysis.html#cb612-12" aria-hidden="true" tabindex="-1"></a>both <span class="sc">%&gt;%</span> </span>
<span id="cb612-13"><a href="exploratory-data-analysis.html#cb612-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .fitted, </span>
<span id="cb612-14"><a href="exploratory-data-analysis.html#cb612-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> host_is_superhost_binary)) <span class="sc">+</span></span>
<span id="cb612-15"><a href="exploratory-data-analysis.html#cb612-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.05</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb612-16"><a href="exploratory-data-analysis.html#cb612-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb612-17"><a href="exploratory-data-analysis.html#cb612-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Estimated probability that host is super host&quot;</span>,</span>
<span id="cb612-18"><a href="exploratory-data-analysis.html#cb612-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number&quot;</span>,</span>
<span id="cb612-19"><a href="exploratory-data-analysis.html#cb612-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Host is super host&quot;</span>) <span class="sc">+</span></span>
<span id="cb612-20"><a href="exploratory-data-analysis.html#cb612-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb612-21"><a href="exploratory-data-analysis.html#cb612-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(type),</span>
<span id="cb612-22"><a href="exploratory-data-analysis.html#cb612-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb612-23"><a href="exploratory-data-analysis.html#cb612-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-362-1.png" width="672" /></p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="disseminating-and-protecting-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="its-just-a-linear-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
