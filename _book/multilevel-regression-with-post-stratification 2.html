<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 Multilevel regression with post-stratification | Telling Stories With Data</title>
  <meta name="description" content="This book is about learning how to tell stories with data." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 Multilevel regression with post-stratification | Telling Stories With Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is about learning how to tell stories with data." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 Multilevel regression with post-stratification | Telling Stories With Data" />
  
  <meta name="twitter:description" content="This book is about learning how to tell stories with data." />
  

<meta name="author" content="Rohan Alexander" />


<meta name="date" content="2021-04-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="causality-from-observational-data.html"/>
<link rel="next" href="text-as-data.html"/>
<script src="libs/header-attrs-2.7.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Telling Stories With Data</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Essentials</b></span></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#welcome"><i class="fa fa-check"></i><b>1.1</b> Welcome</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#structure"><i class="fa fa-check"></i><b>1.2</b> Structure</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#on-telling-stories"><i class="fa fa-check"></i><b>1.3</b> On telling stories</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#telling-stories-with-data"><i class="fa fa-check"></i><b>1.4</b> Telling stories with data</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i><b>1.4.1</b> Software</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#assumed-background"><i class="fa fa-check"></i><b>1.4.2</b> Assumed background</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#structure-1"><i class="fa fa-check"></i><b>1.4.3</b> Structure</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.6</b> Contact</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html"><i class="fa fa-check"></i><b>2</b> Drinking from a fire hose</a>
<ul>
<li class="chapter" data-level="2.1" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#hello-world"><i class="fa fa-check"></i><b>2.1</b> Hello world</a></li>
<li class="chapter" data-level="2.2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#case-study---canadian-elections"><i class="fa fa-check"></i><b>2.2</b> Case study - Canadian elections</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#getting-started"><i class="fa fa-check"></i><b>2.2.1</b> Getting started</a></li>
<li class="chapter" data-level="2.2.2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#get-the-data"><i class="fa fa-check"></i><b>2.2.2</b> Get the data</a></li>
<li class="chapter" data-level="2.2.3" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#clean-the-data"><i class="fa fa-check"></i><b>2.2.3</b> Clean the data</a></li>
<li class="chapter" data-level="2.2.4" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#make-a-graph"><i class="fa fa-check"></i><b>2.2.4</b> Make a graph</a></li>
<li class="chapter" data-level="2.2.5" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#make-a-table"><i class="fa fa-check"></i><b>2.2.5</b> Make a table</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#case-study---toronto-homelessness"><i class="fa fa-check"></i><b>2.3</b> Case study - Toronto homelessness</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#getting-started-1"><i class="fa fa-check"></i><b>2.3.1</b> Getting started</a></li>
<li class="chapter" data-level="2.3.2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#get-the-data-1"><i class="fa fa-check"></i><b>2.3.2</b> Get the data</a></li>
<li class="chapter" data-level="2.3.3" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#make-a-graph-1"><i class="fa fa-check"></i><b>2.3.3</b> Make a graph</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-essentials.html"><a href="r-essentials.html"><i class="fa fa-check"></i><b>3</b> R Essentials</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-essentials.html"><a href="r-essentials.html#r-essentials-1"><i class="fa fa-check"></i><b>3.1</b> R essentials</a></li>
<li class="chapter" data-level="3.2" data-path="r-essentials.html"><a href="r-essentials.html#social-impact"><i class="fa fa-check"></i><b>3.2</b> Social impact</a></li>
<li class="chapter" data-level="3.3" data-path="r-essentials.html"><a href="r-essentials.html#r-r-studio-and-r-studio-cloud"><i class="fa fa-check"></i><b>3.3</b> R, R Studio, and R Studio Cloud</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r-essentials.html"><a href="r-essentials.html#r"><i class="fa fa-check"></i><b>3.3.1</b> R</a></li>
<li class="chapter" data-level="3.3.2" data-path="r-essentials.html"><a href="r-essentials.html#r-studio"><i class="fa fa-check"></i><b>3.3.2</b> R Studio</a></li>
<li class="chapter" data-level="3.3.3" data-path="r-essentials.html"><a href="r-essentials.html#r-studio-cloud"><i class="fa fa-check"></i><b>3.3.3</b> R Studio Cloud</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="r-essentials.html"><a href="r-essentials.html#tidyverse-i"><i class="fa fa-check"></i><b>3.4</b> Tidyverse I</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="r-essentials.html"><a href="r-essentials.html#the-pipe"><i class="fa fa-check"></i><b>3.4.1</b> The pipe</a></li>
<li class="chapter" data-level="3.4.2" data-path="r-essentials.html"><a href="r-essentials.html#selecting"><i class="fa fa-check"></i><b>3.4.2</b> Selecting</a></li>
<li class="chapter" data-level="3.4.3" data-path="r-essentials.html"><a href="r-essentials.html#filtering"><i class="fa fa-check"></i><b>3.4.3</b> Filtering</a></li>
<li class="chapter" data-level="3.4.4" data-path="r-essentials.html"><a href="r-essentials.html#arranging"><i class="fa fa-check"></i><b>3.4.4</b> Arranging</a></li>
<li class="chapter" data-level="3.4.5" data-path="r-essentials.html"><a href="r-essentials.html#grouping"><i class="fa fa-check"></i><b>3.4.5</b> Grouping</a></li>
<li class="chapter" data-level="3.4.6" data-path="r-essentials.html"><a href="r-essentials.html#mutating"><i class="fa fa-check"></i><b>3.4.6</b> Mutating</a></li>
<li class="chapter" data-level="3.4.7" data-path="r-essentials.html"><a href="r-essentials.html#summarise"><i class="fa fa-check"></i><b>3.4.7</b> Summarise</a></li>
<li class="chapter" data-level="3.4.8" data-path="r-essentials.html"><a href="r-essentials.html#counting"><i class="fa fa-check"></i><b>3.4.8</b> Counting</a></li>
<li class="chapter" data-level="3.4.9" data-path="r-essentials.html"><a href="r-essentials.html#proportions"><i class="fa fa-check"></i><b>3.4.9</b> Proportions</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="r-essentials.html"><a href="r-essentials.html#base"><i class="fa fa-check"></i><b>3.5</b> Base</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="r-essentials.html"><a href="r-essentials.html#class"><i class="fa fa-check"></i><b>3.5.1</b> Class</a></li>
<li class="chapter" data-level="3.5.2" data-path="r-essentials.html"><a href="r-essentials.html#simulating-data"><i class="fa fa-check"></i><b>3.5.2</b> Simulating data</a></li>
<li class="chapter" data-level="3.5.3" data-path="r-essentials.html"><a href="r-essentials.html#functions"><i class="fa fa-check"></i><b>3.5.3</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="r-essentials.html"><a href="r-essentials.html#ggplot"><i class="fa fa-check"></i><b>3.6</b> ggplot</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="r-essentials.html"><a href="r-essentials.html#main-features"><i class="fa fa-check"></i><b>3.6.1</b> Main features</a></li>
<li class="chapter" data-level="3.6.2" data-path="r-essentials.html"><a href="r-essentials.html#facets"><i class="fa fa-check"></i><b>3.6.2</b> Facets</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="r-essentials.html"><a href="r-essentials.html#tidyverse-ii"><i class="fa fa-check"></i><b>3.7</b> Tidyverse II</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="r-essentials.html"><a href="r-essentials.html#tibbles"><i class="fa fa-check"></i><b>3.7.1</b> Tibbles</a></li>
<li class="chapter" data-level="3.7.2" data-path="r-essentials.html"><a href="r-essentials.html#importing-data"><i class="fa fa-check"></i><b>3.7.2</b> Importing data</a></li>
<li class="chapter" data-level="3.7.3" data-path="r-essentials.html"><a href="r-essentials.html#joining-data"><i class="fa fa-check"></i><b>3.7.3</b> Joining data</a></li>
<li class="chapter" data-level="3.7.4" data-path="r-essentials.html"><a href="r-essentials.html#strings"><i class="fa fa-check"></i><b>3.7.4</b> Strings</a></li>
<li class="chapter" data-level="3.7.5" data-path="r-essentials.html"><a href="r-essentials.html#pivot"><i class="fa fa-check"></i><b>3.7.5</b> Pivot</a></li>
<li class="chapter" data-level="3.7.6" data-path="r-essentials.html"><a href="r-essentials.html#factors"><i class="fa fa-check"></i><b>3.7.6</b> Factors</a></li>
<li class="chapter" data-level="3.7.7" data-path="r-essentials.html"><a href="r-essentials.html#cases"><i class="fa fa-check"></i><b>3.7.7</b> Cases</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>4</b> Workflow</a>
<ul>
<li class="chapter" data-level="4.1" data-path="workflow.html"><a href="workflow.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="workflow.html"><a href="workflow.html#r-markdown"><i class="fa fa-check"></i><b>4.2</b> R Markdown</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="workflow.html"><a href="workflow.html#getting-started-2"><i class="fa fa-check"></i><b>4.2.1</b> Getting started</a></li>
<li class="chapter" data-level="4.2.2" data-path="workflow.html"><a href="workflow.html#basic-commands"><i class="fa fa-check"></i><b>4.2.2</b> Basic commands</a></li>
<li class="chapter" data-level="4.2.3" data-path="workflow.html"><a href="workflow.html#r-chunks"><i class="fa fa-check"></i><b>4.2.3</b> R chunks</a></li>
<li class="chapter" data-level="4.2.4" data-path="workflow.html"><a href="workflow.html#abstracts-and-pdf-outputs"><i class="fa fa-check"></i><b>4.2.4</b> Abstracts and PDF outputs</a></li>
<li class="chapter" data-level="4.2.5" data-path="workflow.html"><a href="workflow.html#references"><i class="fa fa-check"></i><b>4.2.5</b> References</a></li>
<li class="chapter" data-level="4.2.6" data-path="workflow.html"><a href="workflow.html#cross-references"><i class="fa fa-check"></i><b>4.2.6</b> Cross-references</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="workflow.html"><a href="workflow.html#r-projects"><i class="fa fa-check"></i><b>4.3</b> R projects</a></li>
<li class="chapter" data-level="4.4" data-path="workflow.html"><a href="workflow.html#git-and-github"><i class="fa fa-check"></i><b>4.4</b> Git and GitHub</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="workflow.html"><a href="workflow.html#introduction-2"><i class="fa fa-check"></i><b>4.4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.4.2" data-path="workflow.html"><a href="workflow.html#git"><i class="fa fa-check"></i><b>4.4.2</b> Git</a></li>
<li class="chapter" data-level="4.4.3" data-path="workflow.html"><a href="workflow.html#github"><i class="fa fa-check"></i><b>4.4.3</b> GitHub</a></li>
<li class="chapter" data-level="4.4.4" data-path="workflow.html"><a href="workflow.html#using-git-within-rstudio"><i class="fa fa-check"></i><b>4.4.4</b> Using Git within RStudio</a></li>
<li class="chapter" data-level="4.4.5" data-path="workflow.html"><a href="workflow.html#next-steps"><i class="fa fa-check"></i><b>4.4.5</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="workflow.html"><a href="workflow.html#using-r-in-practice"><i class="fa fa-check"></i><b>4.5</b> Using R in practice</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="workflow.html"><a href="workflow.html#introduction-3"><i class="fa fa-check"></i><b>4.5.1</b> Introduction</a></li>
<li class="chapter" data-level="4.5.2" data-path="workflow.html"><a href="workflow.html#getting-help"><i class="fa fa-check"></i><b>4.5.2</b> Getting help</a></li>
<li class="chapter" data-level="4.5.3" data-path="workflow.html"><a href="workflow.html#mentality"><i class="fa fa-check"></i><b>4.5.3</b> Mentality</a></li>
<li class="chapter" data-level="4.5.4" data-path="workflow.html"><a href="workflow.html#code-comments"><i class="fa fa-check"></i><b>4.5.4</b> Code comments</a></li>
<li class="chapter" data-level="4.5.5" data-path="workflow.html"><a href="workflow.html#learning-more"><i class="fa fa-check"></i><b>4.5.5</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="workflow.html"><a href="workflow.html#developing-research-questions"><i class="fa fa-check"></i><b>4.6</b> Developing research questions</a></li>
</ul></li>
<li class="part"><span><b>II Communicate</b></span></li>
<li class="chapter" data-level="5" data-path="static-communication.html"><a href="static-communication.html"><i class="fa fa-check"></i><b>5</b> Static communication</a>
<ul>
<li class="chapter" data-level="5.1" data-path="static-communication.html"><a href="static-communication.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="static-communication.html"><a href="static-communication.html#graphs"><i class="fa fa-check"></i><b>5.2</b> Graphs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="static-communication.html"><a href="static-communication.html#bar-chart"><i class="fa fa-check"></i><b>5.2.1</b> Bar chart</a></li>
<li class="chapter" data-level="5.2.2" data-path="static-communication.html"><a href="static-communication.html#scatter-plot"><i class="fa fa-check"></i><b>5.2.2</b> Scatter plot</a></li>
<li class="chapter" data-level="5.2.3" data-path="static-communication.html"><a href="static-communication.html#never-use-box-plots"><i class="fa fa-check"></i><b>5.2.3</b> Never use box plots</a></li>
<li class="chapter" data-level="5.2.4" data-path="static-communication.html"><a href="static-communication.html#other"><i class="fa fa-check"></i><b>5.2.4</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="static-communication.html"><a href="static-communication.html#tables"><i class="fa fa-check"></i><b>5.3</b> Tables</a></li>
<li class="chapter" data-level="5.4" data-path="static-communication.html"><a href="static-communication.html#maps"><i class="fa fa-check"></i><b>5.4</b> Maps</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="static-communication.html"><a href="static-communication.html#australian-polling-places"><i class="fa fa-check"></i><b>5.4.1</b> Australian polling places</a></li>
<li class="chapter" data-level="5.4.2" data-path="static-communication.html"><a href="static-communication.html#toronto-bike-parking"><i class="fa fa-check"></i><b>5.4.2</b> Toronto bike parking</a></li>
<li class="chapter" data-level="5.4.3" data-path="static-communication.html"><a href="static-communication.html#geocoding"><i class="fa fa-check"></i><b>5.4.3</b> Geocoding</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="static-communication.html"><a href="static-communication.html#writing"><i class="fa fa-check"></i><b>5.5</b> Writing</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="static-communication.html"><a href="static-communication.html#title-abstract-and-introduction"><i class="fa fa-check"></i><b>5.5.1</b> Title, abstract, and introduction</a></li>
<li class="chapter" data-level="5.5.2" data-path="static-communication.html"><a href="static-communication.html#figures-tables-equations-and-technical-terms"><i class="fa fa-check"></i><b>5.5.2</b> Figures, tables, equations, and technical terms</a></li>
<li class="chapter" data-level="5.5.3" data-path="static-communication.html"><a href="static-communication.html#on-brevity"><i class="fa fa-check"></i><b>5.5.3</b> On brevity</a></li>
<li class="chapter" data-level="5.5.4" data-path="static-communication.html"><a href="static-communication.html#other-1"><i class="fa fa-check"></i><b>5.5.4</b> Other</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-communication.html"><a href="interactive-communication.html"><i class="fa fa-check"></i><b>6</b> Interactive communication</a>
<ul>
<li class="chapter" data-level="6.1" data-path="interactive-communication.html"><a href="interactive-communication.html#making-a-website"><i class="fa fa-check"></i><b>6.1</b> Making a website</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="interactive-communication.html"><a href="interactive-communication.html#introduction-5"><i class="fa fa-check"></i><b>6.1.1</b> Introduction</a></li>
<li class="chapter" data-level="6.1.2" data-path="interactive-communication.html"><a href="interactive-communication.html#foundations"><i class="fa fa-check"></i><b>6.1.2</b> Foundations</a></li>
<li class="chapter" data-level="6.1.3" data-path="interactive-communication.html"><a href="interactive-communication.html#build-the-frame"><i class="fa fa-check"></i><b>6.1.3</b> Build the frame</a></li>
<li class="chapter" data-level="6.1.4" data-path="interactive-communication.html"><a href="interactive-communication.html#add-content"><i class="fa fa-check"></i><b>6.1.4</b> Add content</a></li>
<li class="chapter" data-level="6.1.5" data-path="interactive-communication.html"><a href="interactive-communication.html#making-your-website-public"><i class="fa fa-check"></i><b>6.1.5</b> Making your website public</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="interactive-communication.html"><a href="interactive-communication.html#interactive-maps"><i class="fa fa-check"></i><b>6.2</b> Interactive maps</a></li>
<li class="chapter" data-level="6.3" data-path="interactive-communication.html"><a href="interactive-communication.html#shiny"><i class="fa fa-check"></i><b>6.3</b> Shiny</a></li>
</ul></li>
<li class="part"><span><b>III Hunt gather and farm</b></span></li>
<li class="chapter" data-level="7" data-path="gather-data.html"><a href="gather-data.html"><i class="fa fa-check"></i><b>7</b> Gather data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="gather-data.html"><a href="gather-data.html#apis"><i class="fa fa-check"></i><b>7.1</b> APIs</a></li>
<li class="chapter" data-level="7.2" data-path="gather-data.html"><a href="gather-data.html#case-study---arxiv"><i class="fa fa-check"></i><b>7.2</b> Case study - arXiv</a></li>
<li class="chapter" data-level="7.3" data-path="gather-data.html"><a href="gather-data.html#case-study---rtweet"><i class="fa fa-check"></i><b>7.3</b> Case study - rtweet</a></li>
<li class="chapter" data-level="7.4" data-path="gather-data.html"><a href="gather-data.html#case-study---spotifyr"><i class="fa fa-check"></i><b>7.4</b> Case study - spotifyr</a></li>
<li class="chapter" data-level="7.5" data-path="gather-data.html"><a href="gather-data.html#scraping"><i class="fa fa-check"></i><b>7.5</b> Scraping</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="gather-data.html"><a href="gather-data.html#introduction-6"><i class="fa fa-check"></i><b>7.5.1</b> Introduction</a></li>
<li class="chapter" data-level="7.5.2" data-path="gather-data.html"><a href="gather-data.html#getting-started-3"><i class="fa fa-check"></i><b>7.5.2</b> Getting started</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="gather-data.html"><a href="gather-data.html#case-study---rohans-books"><i class="fa fa-check"></i><b>7.6</b> Case study - Rohan’s books</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="gather-data.html"><a href="gather-data.html#introduction-7"><i class="fa fa-check"></i><b>7.6.1</b> Introduction</a></li>
<li class="chapter" data-level="7.6.2" data-path="gather-data.html"><a href="gather-data.html#gather"><i class="fa fa-check"></i><b>7.6.2</b> Gather</a></li>
<li class="chapter" data-level="7.6.3" data-path="gather-data.html"><a href="gather-data.html#clean"><i class="fa fa-check"></i><b>7.6.3</b> Clean</a></li>
<li class="chapter" data-level="7.6.4" data-path="gather-data.html"><a href="gather-data.html#explore"><i class="fa fa-check"></i><b>7.6.4</b> Explore</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="gather-data.html"><a href="gather-data.html#case-study---canadian-prime-ministers"><i class="fa fa-check"></i><b>7.7</b> Case study - Canadian Prime Ministers</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="gather-data.html"><a href="gather-data.html#introduction-8"><i class="fa fa-check"></i><b>7.7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.7.2" data-path="gather-data.html"><a href="gather-data.html#gather-1"><i class="fa fa-check"></i><b>7.7.2</b> Gather</a></li>
<li class="chapter" data-level="7.7.3" data-path="gather-data.html"><a href="gather-data.html#clean-1"><i class="fa fa-check"></i><b>7.7.3</b> Clean</a></li>
<li class="chapter" data-level="7.7.4" data-path="gather-data.html"><a href="gather-data.html#explore-1"><i class="fa fa-check"></i><b>7.7.4</b> Explore</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="gather-data.html"><a href="gather-data.html#pdfs"><i class="fa fa-check"></i><b>7.8</b> PDFs</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="gather-data.html"><a href="gather-data.html#introduction-9"><i class="fa fa-check"></i><b>7.8.1</b> Introduction</a></li>
<li class="chapter" data-level="7.8.2" data-path="gather-data.html"><a href="gather-data.html#getting-started-4"><i class="fa fa-check"></i><b>7.8.2</b> Getting started</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="gather-data.html"><a href="gather-data.html#case-study-us-total-fertility-rate-by-state-and-year-2000-2018"><i class="fa fa-check"></i><b>7.9</b> Case-study: US Total Fertility Rate, by state and year (2000-2018)</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="gather-data.html"><a href="gather-data.html#introduction-10"><i class="fa fa-check"></i><b>7.9.1</b> Introduction</a></li>
<li class="chapter" data-level="7.9.2" data-path="gather-data.html"><a href="gather-data.html#begin-with-an-end-in-mind"><i class="fa fa-check"></i><b>7.9.2</b> Begin with an end in mind</a></li>
<li class="chapter" data-level="7.9.3" data-path="gather-data.html"><a href="gather-data.html#start-simple-then-iterate."><i class="fa fa-check"></i><b>7.9.3</b> Start simple, then iterate.</a></li>
<li class="chapter" data-level="7.9.4" data-path="gather-data.html"><a href="gather-data.html#iterating"><i class="fa fa-check"></i><b>7.9.4</b> Iterating</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="gather-data.html"><a href="gather-data.html#case-study-kenyan-census-data"><i class="fa fa-check"></i><b>7.10</b> Case-study: Kenyan census data</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="gather-data.html"><a href="gather-data.html#set-up"><i class="fa fa-check"></i><b>7.10.1</b> Set-up</a></li>
<li class="chapter" data-level="7.10.2" data-path="gather-data.html"><a href="gather-data.html#extract"><i class="fa fa-check"></i><b>7.10.2</b> Extract</a></li>
<li class="chapter" data-level="7.10.3" data-path="gather-data.html"><a href="gather-data.html#clean-2"><i class="fa fa-check"></i><b>7.10.3</b> Clean</a></li>
<li class="chapter" data-level="7.10.4" data-path="gather-data.html"><a href="gather-data.html#check"><i class="fa fa-check"></i><b>7.10.4</b> Check</a></li>
<li class="chapter" data-level="7.10.5" data-path="gather-data.html"><a href="gather-data.html#tidy-up"><i class="fa fa-check"></i><b>7.10.5</b> Tidy-up</a></li>
<li class="chapter" data-level="7.10.6" data-path="gather-data.html"><a href="gather-data.html#make-monicas-dataset"><i class="fa fa-check"></i><b>7.10.6</b> Make Monica’s dataset</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="gather-data.html"><a href="gather-data.html#optical-character-recognition"><i class="fa fa-check"></i><b>7.11</b> Optical Character Recognition</a></li>
<li class="chapter" data-level="7.12" data-path="gather-data.html"><a href="gather-data.html#text"><i class="fa fa-check"></i><b>7.12</b> Text</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="gather-data.html"><a href="gather-data.html#introduction-11"><i class="fa fa-check"></i><b>7.12.1</b> Introduction</a></li>
<li class="chapter" data-level="7.12.2" data-path="gather-data.html"><a href="gather-data.html#getting-text-data"><i class="fa fa-check"></i><b>7.12.2</b> Getting text data</a></li>
<li class="chapter" data-level="7.12.3" data-path="gather-data.html"><a href="gather-data.html#preparing-text-datasets"><i class="fa fa-check"></i><b>7.12.3</b> Preparing text datasets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="hunt-data.html"><a href="hunt-data.html"><i class="fa fa-check"></i><b>8</b> Hunt data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="hunt-data.html"><a href="hunt-data.html#experiments-and-randomised-controlled-trials"><i class="fa fa-check"></i><b>8.1</b> Experiments and randomised controlled trials</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="hunt-data.html"><a href="hunt-data.html#introduction-12"><i class="fa fa-check"></i><b>8.1.1</b> Introduction</a></li>
<li class="chapter" data-level="8.1.2" data-path="hunt-data.html"><a href="hunt-data.html#motivation-and-notation"><i class="fa fa-check"></i><b>8.1.2</b> Motivation and notation</a></li>
<li class="chapter" data-level="8.1.3" data-path="hunt-data.html"><a href="hunt-data.html#randomised-sampling"><i class="fa fa-check"></i><b>8.1.3</b> Randomised sampling</a></li>
<li class="chapter" data-level="8.1.4" data-path="hunt-data.html"><a href="hunt-data.html#anova"><i class="fa fa-check"></i><b>8.1.4</b> ANOVA</a></li>
<li class="chapter" data-level="8.1.5" data-path="hunt-data.html"><a href="hunt-data.html#treatment-and-control"><i class="fa fa-check"></i><b>8.1.5</b> Treatment and control</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="hunt-data.html"><a href="hunt-data.html#case-study---fishers-tea-party"><i class="fa fa-check"></i><b>8.2</b> Case study - Fisher’s tea party</a></li>
<li class="chapter" data-level="8.3" data-path="hunt-data.html"><a href="hunt-data.html#case-study---tuskegee-syphilis-study"><i class="fa fa-check"></i><b>8.3</b> Case study - Tuskegee Syphilis Study</a></li>
<li class="chapter" data-level="8.4" data-path="hunt-data.html"><a href="hunt-data.html#case-study---the-oregon-health-insurance-experiment"><i class="fa fa-check"></i><b>8.4</b> Case study - The Oregon Health Insurance Experiment</a></li>
<li class="chapter" data-level="8.5" data-path="hunt-data.html"><a href="hunt-data.html#case-study---student-coaching-how-far-can-technology-go"><i class="fa fa-check"></i><b>8.5</b> Case study - Student Coaching: How Far Can Technology Go?</a></li>
<li class="chapter" data-level="8.6" data-path="hunt-data.html"><a href="hunt-data.html#case-study---civic-honesty-around-the-globe"><i class="fa fa-check"></i><b>8.6</b> Case study - Civic Honesty Around The Globe</a></li>
<li class="chapter" data-level="8.7" data-path="hunt-data.html"><a href="hunt-data.html#ab-testing"><i class="fa fa-check"></i><b>8.7</b> A/B testing</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="hunt-data.html"><a href="hunt-data.html#introduction-13"><i class="fa fa-check"></i><b>8.7.1</b> Introduction</a></li>
<li class="chapter" data-level="8.7.2" data-path="hunt-data.html"><a href="hunt-data.html#delivery"><i class="fa fa-check"></i><b>8.7.2</b> Delivery</a></li>
<li class="chapter" data-level="8.7.3" data-path="hunt-data.html"><a href="hunt-data.html#instrumentation"><i class="fa fa-check"></i><b>8.7.3</b> Instrumentation</a></li>
<li class="chapter" data-level="8.7.4" data-path="hunt-data.html"><a href="hunt-data.html#randomisation-unit"><i class="fa fa-check"></i><b>8.7.4</b> Randomisation unit</a></li>
<li class="chapter" data-level="8.7.5" data-path="hunt-data.html"><a href="hunt-data.html#partnerships"><i class="fa fa-check"></i><b>8.7.5</b> Partnerships</a></li>
<li class="chapter" data-level="8.7.6" data-path="hunt-data.html"><a href="hunt-data.html#speed-vs-quality"><i class="fa fa-check"></i><b>8.7.6</b> Speed vs quality</a></li>
<li class="chapter" data-level="8.7.7" data-path="hunt-data.html"><a href="hunt-data.html#conflicting-priorities"><i class="fa fa-check"></i><b>8.7.7</b> Conflicting priorities</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="hunt-data.html"><a href="hunt-data.html#case-study---upworthy"><i class="fa fa-check"></i><b>8.8</b> Case study - Upworthy</a></li>
<li class="chapter" data-level="8.9" data-path="hunt-data.html"><a href="hunt-data.html#sampling-and-survey-essentials"><i class="fa fa-check"></i><b>8.9</b> Sampling and survey essentials</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="hunt-data.html"><a href="hunt-data.html#introduction-14"><i class="fa fa-check"></i><b>8.9.1</b> Introduction</a></li>
<li class="chapter" data-level="8.9.2" data-path="hunt-data.html"><a href="hunt-data.html#simple-random-sampling"><i class="fa fa-check"></i><b>8.9.2</b> Simple random sampling</a></li>
<li class="chapter" data-level="8.9.3" data-path="hunt-data.html"><a href="hunt-data.html#stratified-and-cluster-sampling"><i class="fa fa-check"></i><b>8.9.3</b> Stratified and cluster sampling</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="hunt-data.html"><a href="hunt-data.html#implementing-surveys"><i class="fa fa-check"></i><b>8.10</b> Implementing surveys</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="hunt-data.html"><a href="hunt-data.html#google"><i class="fa fa-check"></i><b>8.10.1</b> Google</a></li>
<li class="chapter" data-level="8.10.2" data-path="hunt-data.html"><a href="hunt-data.html#facebook"><i class="fa fa-check"></i><b>8.10.2</b> Facebook</a></li>
<li class="chapter" data-level="8.10.3" data-path="hunt-data.html"><a href="hunt-data.html#survey-monkey"><i class="fa fa-check"></i><b>8.10.3</b> Survey Monkey</a></li>
<li class="chapter" data-level="8.10.4" data-path="hunt-data.html"><a href="hunt-data.html#mechanical-turk"><i class="fa fa-check"></i><b>8.10.4</b> Mechanical Turk</a></li>
<li class="chapter" data-level="8.10.5" data-path="hunt-data.html"><a href="hunt-data.html#prolific"><i class="fa fa-check"></i><b>8.10.5</b> Prolific</a></li>
<li class="chapter" data-level="8.10.6" data-path="hunt-data.html"><a href="hunt-data.html#qualtrics"><i class="fa fa-check"></i><b>8.10.6</b> Qualtrics</a></li>
<li class="chapter" data-level="8.10.7" data-path="hunt-data.html"><a href="hunt-data.html#other-2"><i class="fa fa-check"></i><b>8.10.7</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="hunt-data.html"><a href="hunt-data.html#next-steps-1"><i class="fa fa-check"></i><b>8.11</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="farm-data.html"><a href="farm-data.html"><i class="fa fa-check"></i><b>9</b> Farm data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="farm-data.html"><a href="farm-data.html#open-government-data"><i class="fa fa-check"></i><b>9.1</b> Open Government Data</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="farm-data.html"><a href="farm-data.html#canadian-census"><i class="fa fa-check"></i><b>9.1.1</b> Canadian Census</a></li>
<li class="chapter" data-level="9.1.2" data-path="farm-data.html"><a href="farm-data.html#city-of-toronto-open-data-portal"><i class="fa fa-check"></i><b>9.1.2</b> City of Toronto Open Data Portal</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="farm-data.html"><a href="farm-data.html#electoral-studies"><i class="fa fa-check"></i><b>9.2</b> Electoral Studies</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="farm-data.html"><a href="farm-data.html#canadian-electoral-study"><i class="fa fa-check"></i><b>9.2.1</b> Canadian Electoral Study</a></li>
<li class="chapter" data-level="9.2.2" data-path="farm-data.html"><a href="farm-data.html#australian-electoral-study"><i class="fa fa-check"></i><b>9.2.2</b> Australian Electoral Study</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Clean</b></span></li>
<li class="chapter" data-level="10" data-path="cleaning-and-preparing-data.html"><a href="cleaning-and-preparing-data.html"><i class="fa fa-check"></i><b>10</b> Cleaning and preparing data</a></li>
<li class="chapter" data-level="11" data-path="storing-and-retrieving-data.html"><a href="storing-and-retrieving-data.html"><i class="fa fa-check"></i><b>11</b> Storing and retrieving data</a></li>
<li class="chapter" data-level="12" data-path="disseminating-and-protecting-data.html"><a href="disseminating-and-protecting-data.html"><i class="fa fa-check"></i><b>12</b> Disseminating and protecting data</a></li>
<li class="part"><span><b>V Model</b></span></li>
<li class="chapter" data-level="13" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>13</b> Exploratory data analysis</a>
<ul>
<li class="chapter" data-level="13.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-15"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#case-study---ttc-subway-delays"><i class="fa fa-check"></i><b>13.2</b> Case study - TTC subway delays</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-16"><i class="fa fa-check"></i><b>13.2.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#gather-the-data"><i class="fa fa-check"></i><b>13.2.2</b> Gather the data</a></li>
<li class="chapter" data-level="13.2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#sanity-checks"><i class="fa fa-check"></i><b>13.2.3</b> Sanity Checks</a></li>
<li class="chapter" data-level="13.2.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-values"><i class="fa fa-check"></i><b>13.2.4</b> Missing values</a></li>
<li class="chapter" data-level="13.2.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#duplicate-rows"><i class="fa fa-check"></i><b>13.2.5</b> Duplicate rows</a></li>
<li class="chapter" data-level="13.2.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-distributions"><i class="fa fa-check"></i><b>13.2.6</b> Visualizing distributions</a></li>
<li class="chapter" data-level="13.2.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#groups-and-small-counts"><i class="fa fa-check"></i><b>13.2.7</b> Groups and small counts</a></li>
<li class="chapter" data-level="13.2.8" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-time-series"><i class="fa fa-check"></i><b>13.2.8</b> Visualizing time series</a></li>
<li class="chapter" data-level="13.2.9" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-relationships"><i class="fa fa-check"></i><b>13.2.9</b> Visualizing relationships</a></li>
<li class="chapter" data-level="13.2.10" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#principal-components-analysis"><i class="fa fa-check"></i><b>13.2.10</b> Principal components analysis</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#case-study---opinions-about-a-casino-in-toronto"><i class="fa fa-check"></i><b>13.3</b> Case study - Opinions about a casino in Toronto</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-preparation"><i class="fa fa-check"></i><b>13.3.1</b> Data preparation</a></li>
<li class="chapter" data-level="13.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#some-visual-exploration-and-more-cleanup-of-course"><i class="fa fa-check"></i><b>13.3.2</b> Some visual exploration (and more cleanup, of course)</a></li>
<li class="chapter" data-level="13.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#getting-the-data-into-a-more-model-suitable-format"><i class="fa fa-check"></i><b>13.3.3</b> Getting the data into a more model-suitable format</a></li>
<li class="chapter" data-level="13.3.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#logistic-regression"><i class="fa fa-check"></i><b>13.3.4</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#case-study---airbnb-listing-in-toronto"><i class="fa fa-check"></i><b>13.4</b> Case study - Airbnb listing in Toronto</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#essentials"><i class="fa fa-check"></i><b>13.4.1</b> Essentials</a></li>
<li class="chapter" data-level="13.4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#set-up-1"><i class="fa fa-check"></i><b>13.4.2</b> Set up</a></li>
<li class="chapter" data-level="13.4.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#get-data"><i class="fa fa-check"></i><b>13.4.3</b> Get data</a></li>
<li class="chapter" data-level="13.4.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#clean-data-1"><i class="fa fa-check"></i><b>13.4.4</b> Clean data</a></li>
<li class="chapter" data-level="13.4.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#explore-data"><i class="fa fa-check"></i><b>13.4.5</b> Explore data</a></li>
<li class="chapter" data-level="13.4.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#model-data"><i class="fa fa-check"></i><b>13.4.6</b> Model data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html"><i class="fa fa-check"></i><b>14</b> It’s Just A Linear Model</a>
<ul>
<li class="chapter" data-level="14.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview"><i class="fa fa-check"></i><b>14.1</b> Overview</a></li>
<li class="chapter" data-level="14.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#simple-linear-regression"><i class="fa fa-check"></i><b>14.2</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview-1"><i class="fa fa-check"></i><b>14.2.1</b> Overview</a></li>
<li class="chapter" data-level="14.2.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-base-r"><i class="fa fa-check"></i><b>14.2.2</b> Implementation in base R</a></li>
<li class="chapter" data-level="14.2.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#tidy-up-with-broom"><i class="fa fa-check"></i><b>14.2.3</b> Tidy up with broom</a></li>
<li class="chapter" data-level="14.2.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#testing-hypothesis"><i class="fa fa-check"></i><b>14.2.4</b> Testing hypothesis</a></li>
<li class="chapter" data-level="14.2.5" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#on-p-values"><i class="fa fa-check"></i><b>14.2.5</b> On p-values</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#multiple-linear-regression"><i class="fa fa-check"></i><b>14.3</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#threats-to-validity-and-aspects-to-think-about"><i class="fa fa-check"></i><b>14.3.1</b> Threats to validity and aspects to think about</a></li>
<li class="chapter" data-level="14.3.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#more-credible-outputs"><i class="fa fa-check"></i><b>14.3.2</b> More credible outputs</a></li>
<li class="chapter" data-level="14.3.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-tidymodels"><i class="fa fa-check"></i><b>14.3.3</b> Implementation in <code>tidymodels</code></a></li>
<li class="chapter" data-level="14.3.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-rstanarm"><i class="fa fa-check"></i><b>14.3.4</b> Implementation in <code>rstanarm</code></a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#logistic-regression-2"><i class="fa fa-check"></i><b>14.4</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview-2"><i class="fa fa-check"></i><b>14.4.1</b> Overview</a></li>
<li class="chapter" data-level="14.4.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-base"><i class="fa fa-check"></i><b>14.4.2</b> Implementation in base</a></li>
<li class="chapter" data-level="14.4.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-tidymodels-1"><i class="fa fa-check"></i><b>14.4.3</b> Implementation in <code>tidymodels</code></a></li>
<li class="chapter" data-level="14.4.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-rstanarm-1"><i class="fa fa-check"></i><b>14.4.4</b> Implementation in <code>rstanarm</code></a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#poisson-regression"><i class="fa fa-check"></i><b>14.5</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview-3"><i class="fa fa-check"></i><b>14.5.1</b> Overview</a></li>
<li class="chapter" data-level="14.5.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-base-1"><i class="fa fa-check"></i><b>14.5.2</b> Implementation in base</a></li>
<li class="chapter" data-level="14.5.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-tidymodels-2"><i class="fa fa-check"></i><b>14.5.3</b> Implementation in <code>tidymodels</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html"><i class="fa fa-check"></i><b>15</b> Causality from observational data</a>
<ul>
<li class="chapter" data-level="15.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-17"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#dags-and-trying-not-to-be-tricked-by-the-data"><i class="fa fa-check"></i><b>15.2</b> DAGs and trying not to be tricked by the data</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#dags-and-confounding"><i class="fa fa-check"></i><b>15.2.1</b> DAGs and confounding</a></li>
<li class="chapter" data-level="15.2.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#selection-and-measurement-bias"><i class="fa fa-check"></i><b>15.2.2</b> Selection and measurement bias</a></li>
<li class="chapter" data-level="15.2.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#two-common-paradoxes"><i class="fa fa-check"></i><b>15.2.3</b> Two common paradoxes</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#difference-in-differences"><i class="fa fa-check"></i><b>15.3</b> Difference in differences</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#matching-and-difference-in-differences"><i class="fa fa-check"></i><b>15.3.1</b> Matching and difference-in-differences</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974"><i class="fa fa-check"></i><b>15.4</b> Case study - Lower advertising revenue reduced French newspaper prices between 1960 and 1974</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-19"><i class="fa fa-check"></i><b>15.4.1</b> Introduction</a></li>
<li class="chapter" data-level="15.4.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#background"><i class="fa fa-check"></i><b>15.4.2</b> Background</a></li>
<li class="chapter" data-level="15.4.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#data"><i class="fa fa-check"></i><b>15.4.3</b> Data</a></li>
<li class="chapter" data-level="15.4.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#model"><i class="fa fa-check"></i><b>15.4.4</b> Model</a></li>
<li class="chapter" data-level="15.4.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#results"><i class="fa fa-check"></i><b>15.4.5</b> Results</a></li>
<li class="chapter" data-level="15.4.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#other-points"><i class="fa fa-check"></i><b>15.4.6</b> Other points</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---funding-of-clinical-trials-and-reported-drug-efficacy"><i class="fa fa-check"></i><b>15.5</b> Case study - Funding of Clinical Trials and Reported Drug Efficacy</a></li>
<li class="chapter" data-level="15.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#regression-discontinuity-design"><i class="fa fa-check"></i><b>15.6</b> Regression discontinuity design</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-20"><i class="fa fa-check"></i><b>15.6.1</b> Introduction</a></li>
<li class="chapter" data-level="15.6.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#simulated-example-1"><i class="fa fa-check"></i><b>15.6.2</b> Simulated example</a></li>
<li class="chapter" data-level="15.6.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#overlap"><i class="fa fa-check"></i><b>15.6.3</b> Overlap</a></li>
<li class="chapter" data-level="15.6.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#examples"><i class="fa fa-check"></i><b>15.6.4</b> Examples</a></li>
<li class="chapter" data-level="15.6.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#implementation"><i class="fa fa-check"></i><b>15.6.5</b> Implementation</a></li>
<li class="chapter" data-level="15.6.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#fuzzy-rdd"><i class="fa fa-check"></i><b>15.6.6</b> Fuzzy RDD</a></li>
<li class="chapter" data-level="15.6.7" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#threats-to-validity"><i class="fa fa-check"></i><b>15.6.7</b> Threats to validity</a></li>
<li class="chapter" data-level="15.6.8" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#weaknesses"><i class="fa fa-check"></i><b>15.6.8</b> Weaknesses</a></li>
</ul></li>
<li class="chapter" data-level="15.7" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---stiers-hooghe-and-dassonneville-2020"><i class="fa fa-check"></i><b>15.7</b> Case study - Stiers, Hooghe, and Dassonneville, 2020</a></li>
<li class="chapter" data-level="15.8" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---caughey-and-sekhon.-2011"><i class="fa fa-check"></i><b>15.8</b> Case study - Caughey, and Sekhon., 2011</a></li>
<li class="chapter" data-level="15.9" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#instrumental-variables"><i class="fa fa-check"></i><b>15.9</b> Instrumental variables</a>
<ul>
<li class="chapter" data-level="15.9.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-21"><i class="fa fa-check"></i><b>15.9.1</b> Introduction</a></li>
<li class="chapter" data-level="15.9.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#history"><i class="fa fa-check"></i><b>15.9.2</b> History</a></li>
<li class="chapter" data-level="15.9.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#simulated-example-2"><i class="fa fa-check"></i><b>15.9.3</b> Simulated example</a></li>
<li class="chapter" data-level="15.9.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#implementation-1"><i class="fa fa-check"></i><b>15.9.4</b> Implementation</a></li>
<li class="chapter" data-level="15.9.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#assumptions-1"><i class="fa fa-check"></i><b>15.9.5</b> Assumptions</a></li>
<li class="chapter" data-level="15.9.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#conclusion"><i class="fa fa-check"></i><b>15.9.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="15.10" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---effect-of-police-on-crime"><i class="fa fa-check"></i><b>15.10</b> Case study - Effect of Police on Crime</a>
<ul>
<li class="chapter" data-level="15.10.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#overview-4"><i class="fa fa-check"></i><b>15.10.1</b> Overview</a></li>
<li class="chapter" data-level="15.10.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#data-1"><i class="fa fa-check"></i><b>15.10.2</b> Data</a></li>
<li class="chapter" data-level="15.10.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#model-1"><i class="fa fa-check"></i><b>15.10.3</b> Model</a></li>
<li class="chapter" data-level="15.10.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#discussion"><i class="fa fa-check"></i><b>15.10.4</b> Discussion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html"><i class="fa fa-check"></i><b>16</b> Multilevel regression with post-stratification</a>
<ul>
<li class="chapter" data-level="16.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#introduction-22"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#simulation---toddler-bedtimes"><i class="fa fa-check"></i><b>16.2</b> Simulation - Toddler bedtimes</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#construct-a-population"><i class="fa fa-check"></i><b>16.2.1</b> Construct a population</a></li>
<li class="chapter" data-level="16.2.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#get-a-biased-sample-from-it"><i class="fa fa-check"></i><b>16.2.2</b> Get a biased sample from it</a></li>
<li class="chapter" data-level="16.2.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#model-the-sample"><i class="fa fa-check"></i><b>16.2.3</b> Model the sample</a></li>
<li class="chapter" data-level="16.2.4" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#get-a-post-stratification-dataset"><i class="fa fa-check"></i><b>16.2.4</b> Get a post-stratification dataset</a></li>
<li class="chapter" data-level="16.2.5" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratify-our-model-estimates"><i class="fa fa-check"></i><b>16.2.5</b> Post-stratify our model estimates</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#case-study---xbox-paper"><i class="fa fa-check"></i><b>16.3</b> Case study - Xbox paper</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#overview-5"><i class="fa fa-check"></i><b>16.3.1</b> Overview</a></li>
<li class="chapter" data-level="16.3.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#model-2"><i class="fa fa-check"></i><b>16.3.2</b> Model</a></li>
<li class="chapter" data-level="16.3.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratify"><i class="fa fa-check"></i><b>16.3.3</b> Post-stratify</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#simulation---australian-voting"><i class="fa fa-check"></i><b>16.4</b> Simulation - Australian voting</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#overview-6"><i class="fa fa-check"></i><b>16.4.1</b> Overview</a></li>
<li class="chapter" data-level="16.4.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#construct-a-survey"><i class="fa fa-check"></i><b>16.4.2</b> Construct a survey</a></li>
<li class="chapter" data-level="16.4.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#model-the-survey"><i class="fa fa-check"></i><b>16.4.3</b> Model the survey</a></li>
<li class="chapter" data-level="16.4.4" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratify-1"><i class="fa fa-check"></i><b>16.4.4</b> Post-stratify</a></li>
<li class="chapter" data-level="16.4.5" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#improving-the-model"><i class="fa fa-check"></i><b>16.4.5</b> Improving the model</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#forecasting-the-2020-us-election"><i class="fa fa-check"></i><b>16.5</b> Forecasting the 2020 US election</a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#survey-data"><i class="fa fa-check"></i><b>16.5.1</b> Survey data</a></li>
<li class="chapter" data-level="16.5.2" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratification-data"><i class="fa fa-check"></i><b>16.5.2</b> Post-stratification data</a></li>
<li class="chapter" data-level="16.5.3" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#model-3"><i class="fa fa-check"></i><b>16.5.3</b> Model</a></li>
<li class="chapter" data-level="16.5.4" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#post-stratify-2"><i class="fa fa-check"></i><b>16.5.4</b> Post-stratify</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="multilevel-regression-with-post-stratification.html"><a href="multilevel-regression-with-post-stratification.html#concluding-remarks-and-next-steps"><i class="fa fa-check"></i><b>16.6</b> Concluding remarks and next steps</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="text-as-data.html"><a href="text-as-data.html"><i class="fa fa-check"></i><b>17</b> Text as data</a>
<ul>
<li class="chapter" data-level="17.1" data-path="text-as-data.html"><a href="text-as-data.html#introduction-23"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="text-as-data.html"><a href="text-as-data.html#lasso-regression"><i class="fa fa-check"></i><b>17.2</b> Lasso regression</a></li>
<li class="chapter" data-level="17.3" data-path="text-as-data.html"><a href="text-as-data.html#topic-models"><i class="fa fa-check"></i><b>17.3</b> Topic models</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="text-as-data.html"><a href="text-as-data.html#overview-7"><i class="fa fa-check"></i><b>17.3.1</b> Overview</a></li>
<li class="chapter" data-level="17.3.2" data-path="text-as-data.html"><a href="text-as-data.html#document-generation-process"><i class="fa fa-check"></i><b>17.3.2</b> Document generation process</a></li>
<li class="chapter" data-level="17.3.3" data-path="text-as-data.html"><a href="text-as-data.html#analysis-process"><i class="fa fa-check"></i><b>17.3.3</b> Analysis process</a></li>
<li class="chapter" data-level="17.3.4" data-path="text-as-data.html"><a href="text-as-data.html#warnings-and-extensions"><i class="fa fa-check"></i><b>17.3.4</b> Warnings and extensions</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="text-as-data.html"><a href="text-as-data.html#word-embedding"><i class="fa fa-check"></i><b>17.4</b> Word embedding</a></li>
<li class="chapter" data-level="17.5" data-path="text-as-data.html"><a href="text-as-data.html#conclusion-1"><i class="fa fa-check"></i><b>17.5</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>VI Scale</b></span></li>
<li class="chapter" data-level="18" data-path="cloud.html"><a href="cloud.html"><i class="fa fa-check"></i><b>18</b> Cloud</a>
<ul>
<li class="chapter" data-level="18.1" data-path="cloud.html"><a href="cloud.html#introduction-24"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="cloud.html"><a href="cloud.html#google-colab"><i class="fa fa-check"></i><b>18.2</b> Google Colab</a></li>
<li class="chapter" data-level="18.3" data-path="cloud.html"><a href="cloud.html#aws"><i class="fa fa-check"></i><b>18.3</b> AWS</a></li>
<li class="chapter" data-level="18.4" data-path="cloud.html"><a href="cloud.html#google-compute-engine"><i class="fa fa-check"></i><b>18.4</b> Google Compute Engine</a></li>
<li class="chapter" data-level="18.5" data-path="cloud.html"><a href="cloud.html#azure"><i class="fa fa-check"></i><b>18.5</b> Azure</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="deploy.html"><a href="deploy.html"><i class="fa fa-check"></i><b>19</b> Deploy</a>
<ul>
<li class="chapter" data-level="19.1" data-path="deploy.html"><a href="deploy.html#introduction-25"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
<li class="chapter" data-level="19.2" data-path="deploy.html"><a href="deploy.html#packages"><i class="fa fa-check"></i><b>19.2</b> Packages</a></li>
<li class="chapter" data-level="19.3" data-path="deploy.html"><a href="deploy.html#shiny-1"><i class="fa fa-check"></i><b>19.3</b> Shiny</a></li>
<li class="chapter" data-level="19.4" data-path="deploy.html"><a href="deploy.html#plumber-and-model-apis"><i class="fa fa-check"></i><b>19.4</b> Plumber and model APIs</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="deploy.html"><a href="deploy.html#hello-toronto"><i class="fa fa-check"></i><b>19.4.1</b> Hello Toronto</a></li>
<li class="chapter" data-level="19.4.2" data-path="deploy.html"><a href="deploy.html#local-model"><i class="fa fa-check"></i><b>19.4.2</b> Local model</a></li>
<li class="chapter" data-level="19.4.3" data-path="deploy.html"><a href="deploy.html#cloud-model"><i class="fa fa-check"></i><b>19.4.3</b> Cloud model</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Assessment</b></span></li>
<li class="chapter" data-level="20" data-path="papers.html"><a href="papers.html"><i class="fa fa-check"></i><b>20</b> Papers</a>
<ul>
<li class="chapter" data-level="20.1" data-path="papers.html"><a href="papers.html#mandatory-minimums"><i class="fa fa-check"></i><b>20.1</b> ‘Mandatory Minimums’</a>
<ul>
<li class="chapter" data-level="20.1.1" data-path="papers.html"><a href="papers.html#task"><i class="fa fa-check"></i><b>20.1.1</b> Task</a></li>
<li class="chapter" data-level="20.1.2" data-path="papers.html"><a href="papers.html#guidance"><i class="fa fa-check"></i><b>20.1.2</b> Guidance</a></li>
<li class="chapter" data-level="20.1.3" data-path="papers.html"><a href="papers.html#check-offs-points"><i class="fa fa-check"></i><b>20.1.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.1.4" data-path="papers.html"><a href="papers.html#faq"><i class="fa fa-check"></i><b>20.1.4</b> FAQ</a></li>
<li class="chapter" data-level="20.1.5" data-path="papers.html"><a href="papers.html#rubric"><i class="fa fa-check"></i><b>20.1.5</b> Rubric</a></li>
<li class="chapter" data-level="20.1.6" data-path="papers.html"><a href="papers.html#previous-examples"><i class="fa fa-check"></i><b>20.1.6</b> Previous examples</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="papers.html"><a href="papers.html#these-numbers-mean-dial-it-up"><i class="fa fa-check"></i><b>20.2</b> ‘These numbers mean dial it up’</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="papers.html"><a href="papers.html#task-1"><i class="fa fa-check"></i><b>20.2.1</b> Task</a></li>
<li class="chapter" data-level="20.2.2" data-path="papers.html"><a href="papers.html#guidance-1"><i class="fa fa-check"></i><b>20.2.2</b> Guidance</a></li>
<li class="chapter" data-level="20.2.3" data-path="papers.html"><a href="papers.html#check-offs-points-1"><i class="fa fa-check"></i><b>20.2.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.2.4" data-path="papers.html"><a href="papers.html#faq-1"><i class="fa fa-check"></i><b>20.2.4</b> FAQ</a></li>
<li class="chapter" data-level="20.2.5" data-path="papers.html"><a href="papers.html#rubric-1"><i class="fa fa-check"></i><b>20.2.5</b> Rubric</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="papers.html"><a href="papers.html#the-short-list"><i class="fa fa-check"></i><b>20.3</b> ‘The Short List’</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="papers.html"><a href="papers.html#task-2"><i class="fa fa-check"></i><b>20.3.1</b> Task</a></li>
<li class="chapter" data-level="20.3.2" data-path="papers.html"><a href="papers.html#guidance-2"><i class="fa fa-check"></i><b>20.3.2</b> Guidance</a></li>
<li class="chapter" data-level="20.3.3" data-path="papers.html"><a href="papers.html#check-offs-points-2"><i class="fa fa-check"></i><b>20.3.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.3.4" data-path="papers.html"><a href="papers.html#faq-2"><i class="fa fa-check"></i><b>20.3.4</b> FAQ</a></li>
<li class="chapter" data-level="20.3.5" data-path="papers.html"><a href="papers.html#rubric-2"><i class="fa fa-check"></i><b>20.3.5</b> Rubric</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="papers.html"><a href="papers.html#two-cathedrals"><i class="fa fa-check"></i><b>20.4</b> ‘Two Cathedrals’</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="papers.html"><a href="papers.html#task-3"><i class="fa fa-check"></i><b>20.4.1</b> Task</a></li>
<li class="chapter" data-level="20.4.2" data-path="papers.html"><a href="papers.html#guidance-3"><i class="fa fa-check"></i><b>20.4.2</b> Guidance</a></li>
<li class="chapter" data-level="20.4.3" data-path="papers.html"><a href="papers.html#peer-review-submission"><i class="fa fa-check"></i><b>20.4.3</b> Peer review submission</a></li>
<li class="chapter" data-level="20.4.4" data-path="papers.html"><a href="papers.html#conduct-peer-review"><i class="fa fa-check"></i><b>20.4.4</b> Conduct peer-review</a></li>
<li class="chapter" data-level="20.4.5" data-path="papers.html"><a href="papers.html#check-offs-points-3"><i class="fa fa-check"></i><b>20.4.5</b> Check offs points</a></li>
<li class="chapter" data-level="20.4.6" data-path="papers.html"><a href="papers.html#faq-3"><i class="fa fa-check"></i><b>20.4.6</b> FAQ</a></li>
<li class="chapter" data-level="20.4.7" data-path="papers.html"><a href="papers.html#rubric-3"><i class="fa fa-check"></i><b>20.4.7</b> Rubric</a></li>
<li class="chapter" data-level="20.4.8" data-path="papers.html"><a href="papers.html#previous-examples-1"><i class="fa fa-check"></i><b>20.4.8</b> Previous examples</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="papers.html"><a href="papers.html#a-proportional-response"><i class="fa fa-check"></i><b>20.5</b> ‘A Proportional Response’</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="papers.html"><a href="papers.html#task-4"><i class="fa fa-check"></i><b>20.5.1</b> Task</a></li>
<li class="chapter" data-level="20.5.2" data-path="papers.html"><a href="papers.html#recommended-steps"><i class="fa fa-check"></i><b>20.5.2</b> Recommended steps</a></li>
<li class="chapter" data-level="20.5.3" data-path="papers.html"><a href="papers.html#check-offs-points-4"><i class="fa fa-check"></i><b>20.5.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.5.4" data-path="papers.html"><a href="papers.html#faq-4"><i class="fa fa-check"></i><b>20.5.4</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="papers.html"><a href="papers.html#mr-willis-of-ohio"><i class="fa fa-check"></i><b>20.6</b> ‘Mr Willis of Ohio’</a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="papers.html"><a href="papers.html#task-5"><i class="fa fa-check"></i><b>20.6.1</b> Task</a></li>
<li class="chapter" data-level="20.6.2" data-path="papers.html"><a href="papers.html#recommended-steps-1"><i class="fa fa-check"></i><b>20.6.2</b> Recommended steps</a></li>
<li class="chapter" data-level="20.6.3" data-path="papers.html"><a href="papers.html#check-offs-points-5"><i class="fa fa-check"></i><b>20.6.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.6.4" data-path="papers.html"><a href="papers.html#faq-5"><i class="fa fa-check"></i><b>20.6.4</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="papers.html"><a href="papers.html#five-votes-down"><i class="fa fa-check"></i><b>20.7</b> ‘Five Votes Down’</a>
<ul>
<li class="chapter" data-level="20.7.1" data-path="papers.html"><a href="papers.html#task-6"><i class="fa fa-check"></i><b>20.7.1</b> Task</a></li>
<li class="chapter" data-level="20.7.2" data-path="papers.html"><a href="papers.html#recommended-steps-2"><i class="fa fa-check"></i><b>20.7.2</b> Recommended steps</a></li>
<li class="chapter" data-level="20.7.3" data-path="papers.html"><a href="papers.html#check-offs-points-6"><i class="fa fa-check"></i><b>20.7.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.7.4" data-path="papers.html"><a href="papers.html#faq-6"><i class="fa fa-check"></i><b>20.7.4</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="20.8" data-path="papers.html"><a href="papers.html#whats-next"><i class="fa fa-check"></i><b>20.8</b> ‘What’s next?’</a>
<ul>
<li class="chapter" data-level="20.8.1" data-path="papers.html"><a href="papers.html#task-7"><i class="fa fa-check"></i><b>20.8.1</b> Task</a></li>
<li class="chapter" data-level="20.8.2" data-path="papers.html"><a href="papers.html#recommended-steps-3"><i class="fa fa-check"></i><b>20.8.2</b> Recommended steps</a></li>
<li class="chapter" data-level="20.8.3" data-path="papers.html"><a href="papers.html#check-offs-points-7"><i class="fa fa-check"></i><b>20.8.3</b> Check offs points</a></li>
<li class="chapter" data-level="20.8.4" data-path="papers.html"><a href="papers.html#faq-7"><i class="fa fa-check"></i><b>20.8.4</b> FAQ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telling Stories With Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multilevel-regression-with-post-stratification" class="section level1" number="16">
<h1><span class="header-section-number">Chapter 16</span> Multilevel regression with post-stratification</h1>
<p><em>Last updated: 28 April 2021.</em></p>
<p><strong>Required reading</strong></p>
<ul>
<li>Alexander, Monica, 2019, ‘Analyzing name changes after marriage using a non-representative survey,’ 7 August, <a href="https://www.monicaalexander.com/posts/2019-08-07-mrp/" class="uri">https://www.monicaalexander.com/posts/2019-08-07-mrp/</a>.</li>
<li>Gelman, Andrew, Jennifer Hill and Aki Vehtari, 2020, <em>Regression and Other Stories</em>, Cambridge University Press, Chapter 17.</li>
<li>Hanretty, Chris, 2019, ‘An introduction to multilevel regression and post-stratification for estimating constituency opinion,’ <em>Political Studies Review</em>, <a href="https://doi.org/10.1177/1478929919864773" class="uri">https://doi.org/10.1177/1478929919864773</a>.</li>
<li>Kastellec, Jonathan, Jeffrey Lax, and Justin Phillips, 2016, ‘Estimating State Public Opinion With Multi-Level Regression and Poststratification using R,’ <a href="https://scholar.princeton.edu/sites/default/files/jkastellec/files/mrp_primer.pdf" class="uri">https://scholar.princeton.edu/sites/default/files/jkastellec/files/mrp_primer.pdf</a>.</li>
<li>Kennedy, Lauren, Katharine Khanna, Daniel Simpson, and Andrew Gelman, 2020, ‘Using sex and gender in survey adjustment,’ <a href="https://arxiv.org/abs/2009.14401" class="uri">https://arxiv.org/abs/2009.14401</a>.</li>
<li>Kennedy, Lauren, and Jonah Gabry, 2019, ‘MRP with rstanarm,’ rstanarm vignettes, 8 October, <a href="https://mc-stan.org/rstanarm/articles/mrp.html" class="uri">https://mc-stan.org/rstanarm/articles/mrp.html</a>.</li>
<li>Kennedy, Lauren, and Andrew Gelman, 2019, ‘Know your population and know your model: Using model-based regression and poststratification to generalize findings beyond the observed sample,’ <a href="https://arxiv.org/abs/1906.11323" class="uri">https://arxiv.org/abs/1906.11323</a>.</li>
<li>Wang, Wei, David Rothschild, Sharad Goel, and Andrew Gelman, 2015, ‘Forecasting elections with non-representative polls,’ <em>International Journal of Forecasting</em>, 31, no. 3, pages 980-991.</li>
<li>Wu, Changbao and Mary E. Thompson, 2020, <em>Sampling Theory and Practice</em>, Springer, Chapter 17.</li>
</ul>
<p><strong>Required viewing</strong></p>
<ul>
<li>Gelman, Andrew, 2020, ‘Statistical Models of Election Outcomes,’ <em>CPSR Summer Program in Quantitative Methods of Social Research</em>, <a href="https://youtu.be/7gjDnrbLQ4k" class="uri">https://youtu.be/7gjDnrbLQ4k</a>.</li>
</ul>
<p><strong>Required listening</strong></p>
<ul>
<li>Galef, Julia, 2020, ‘Episode 248: Are Democrats being irrational? (David Shor),’ <em>Rationally Speaking</em>, available at: <a href="http://rationallyspeakingpodcast.org/show/episode-248-are-democrats-being-irrational-david-shor.html" class="uri">http://rationallyspeakingpodcast.org/show/episode-248-are-democrats-being-irrational-david-shor.html</a>.</li>
</ul>
<p><strong>Recommended reading</strong></p>
<ul>
<li>Arnold, Jeffrey B., 2018, ‘Simon Jackman’s Bayesian Model Examples in Stan,’ Ch 13, 7 May, <a href="https://jrnold.github.io/bugs-examples-in-stan/campaign.html" class="uri">https://jrnold.github.io/bugs-examples-in-stan/campaign.html</a>.</li>
<li>Cohn, Nate, 2016, ‘We Gave Four Good Pollsters the Same Raw Data. They Had Four Different Results,’ <em>The New York Times</em>, The Upshot, 20 September, <a href="https://www.nytimes.com/interactive/2016/09/20/upshot/the-error-the-polling-world-rarely-talks-about.html" class="uri">https://www.nytimes.com/interactive/2016/09/20/upshot/the-error-the-polling-world-rarely-talks-about.html</a>.</li>
<li>Edelman, M., Vittert, L., &amp; Meng, X.-L., 2021, ‘An Interview with Murray Edelman on the History of the Exit Poll,’ <em>Harvard Data Science Review</em>, <a href="https://doi.org/10.1162/99608f92.3a25cd24" class="uri">https://doi.org/10.1162/99608f92.3a25cd24</a> <a href="https://hdsr.mitpress.mit.edu/pub/fekmqbv4/release/2" class="uri">https://hdsr.mitpress.mit.edu/pub/fekmqbv4/release/2</a>.</li>
<li>Gelman, Andrew, and Julia Azari, 2017, ‘19 things we learned from the 2016 election,’ <em>Statistics and Public Policy</em>, 4 (1), pp. 1-10.</li>
<li>Gelman, Andrew, Jessica Hullman, and Christopher Wlezien, 2020, ‘Information, incentives, and goals in election forecasts,’ 8 September, available at: <a href="http://www.stat.columbia.edu/~gelman/research/unpublished/forecast_incentives3.pdf" class="uri">http://www.stat.columbia.edu/~gelman/research/unpublished/forecast_incentives3.pdf</a></li>
<li>Gelman, Andrew, Merlin Heidemanns, and Elliott Morris, 2020, ‘2020 US POTUS model,’ The Economist, freely available: <a href="https://github.com/TheEconomist/us-potus-model" class="uri">https://github.com/TheEconomist/us-potus-model</a>.</li>
<li>Ghitza, Yair, and Andrew Gelman, 2013, ‘Deep Interactions with MRP: Election Turnout and Voting Patterns Among Small Electoral Subgroups,’ <em>American Journal of Political Science</em>, 57 (3), pp. 762-776.</li>
<li>Ghitza, Yair, and Andrew Gelman, 2020, ‘Voter Registration Databases and MRP: Toward the Use of Large-Scale Databases in Public Opinion Research,’ <em>Political Analysis</em>, pp. 1-25.</li>
<li>Imai, Kosuke, 2017, Quantitative Social Science: An Introduction, Princeton University Press, Ch 4.1, and 5.3.</li>
<li>Jackman, Simon, 2005, ‘Pooling the polls over an election campaign,’ <em>Australian Journal of Political Science</em>, 40 (4), pp. 499-517.</li>
<li>Jackman, Simon, Shaun Ratcliff and Luke Mansillo, 2019, ‘Small area estimates of public opinion: Model-assisted post-stratification of data from voter advice applications,’ 4 January, <a href="https://www.cambridge.org/core/membership/services/aop-file-manager/file/5c2f6ebb7cf9ee1118d11c0a/APMM-2019-Simon-Jackman.pdf" class="uri">https://www.cambridge.org/core/membership/services/aop-file-manager/file/5c2f6ebb7cf9ee1118d11c0a/APMM-2019-Simon-Jackman.pdf</a>.</li>
<li>Lauderdale, Ben, Delia Bailey, Jack Blumenau, and Doug Rivers, 2020, ‘Model-based pre-election polling for national and sub-national outcomes in the US and UK,’ <em>International Journal of Forecasting</em>, 36 (2), pp. 399-413.</li>
<li>Leigh, Andrew, and Justin Wolfers, 2006, ‘Competing approaches to forecasting elections: Economic models, opinion polling and prediction markets,’ Economic Record, 82 (258), pp.325-340.</li>
<li>Nickerson, David W., and Todd Rogers, 2014, ‘Political campaigns and big data,’ Journal of Economic Perspectives, 28 (2), pp. 51-74.</li>
<li>Shirani-Mehr, Houshmand, David Rothschild, Sharad Goel, and Andrew Gelman, 2018, ‘Disentangling bias and variance in election polls,’ Journal of the American Statistical Association, 113 (522), pp. 607-614.</li>
</ul>
<p><strong>Recommended viewing</strong></p>
<ul>
<li>Jackman, Simon, 2020, ‘The triumph of the quants?: Model-based poll aggregation for election forecasting,’ <em>Ihaka Lecture Series</em>, <a href="https://youtu.be/MvGYsKIsLFs" class="uri">https://youtu.be/MvGYsKIsLFs</a>.</li>
</ul>
<p><strong>Key libraries</strong></p>
<ul>
<li><code>brms</code></li>
<li><code>broom</code></li>
<li><code>gtsummary</code></li>
<li><code>haven</code></li>
<li><code>labelled</code></li>
<li><code>lme4</code></li>
<li><code>modelsummary</code></li>
<li><code>rstanarm</code></li>
<li><code>tidybayes</code></li>
<li><code>tidyverse</code></li>
</ul>
<p><strong>Quiz</strong></p>
<ol style="list-style-type: decimal">
<li>Your Mum asked you what you’ve been learning this term. You decide to tell her about multilevel regression with post-stratification (MRP). Please explain what MRP is. Your Mum has a university-education, but has not necessarily taken any statistics, so you will need to explain any technical terms that you use. [Please write two or three paragraphs; strong answers would be clear about both strengths and weaknesses.]</li>
<li>With respect to <span class="citation"><a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">Wang et al.</a> (<a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">2015</a>)</span>: Why is this paper interesting? What do you like about this paper? What do you wish it did better? To what extent can you reproduce this paper? [Please write one or two paragraphs about each aspect.]</li>
<li>With respect to <span class="citation"><a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">Wang et al.</a> (<a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">2015</a>)</span>, what is not a feature they mention election forecasts need?
<ol style="list-style-type: lower-alpha">
<li>Explainable.</li>
<li>Accurate.</li>
<li>Cost-effective.</li>
<li>Relevant.</li>
<li>Timely.</li>
</ol></li>
<li>With respect to <span class="citation"><a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">Wang et al.</a> (<a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">2015</a>)</span>, what is a weakness of MRP?
<ol style="list-style-type: lower-alpha">
<li>Detailed data requirement.</li>
<li>Allows use of biased data.</li>
<li>Expensive to conduct.</li>
</ol></li>
<li>With respect to <span class="citation"><a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">Wang et al.</a> (<a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">2015</a>)</span>, what is concerning about the Xbox sample?
<ol style="list-style-type: lower-alpha">
<li>Non-representative.</li>
<li>Small sample size.</li>
<li>Multiple responses from the same respondent.</li>
</ol></li>
<li>I am interested in studying how voting intentions in the 2020 US presidential election vary by an individual’s income. I set up a logistic regression model to study this relationship. In my study, some possible independent variables would be: [Please check all that apply.]
<ol style="list-style-type: lower-alpha">
<li>Whether the respondent is registered to vote (yes/no).</li>
<li>Whether the respondent is going to vote for Biden (yes/no).</li>
<li>The race of the respondent (white/not white).</li>
<li>The respondent’s marital status (married/not).</li>
</ol></li>
<li>Please think about <span class="citation"><a href="references-1.html#ref-cohn2016" role="doc-biblioref">Cohn</a> (<a href="references-1.html#ref-cohn2016" role="doc-biblioref">2016</a>)</span> Why is this type of exercise not carried out more? Why do you think that different groups, even with the same background and level of quantitative sophistication, could have such different estimates even when they use the same data? [Please write a paragraph or two about each aspect.]</li>
<li>When we think about multilevel regression with post-stratification, what are the key assumptions that we are making? [Please write one or two paragraphs about each aspect.]</li>
<li>I train a model based on a survey, and then post-stratify it using the 2020 ACS dataset. What are some of the practical considerations that I may have to contend when I am doing this? [Please write a paragraph each about at least three considerations.]</li>
<li>In a similar manner to <span class="citation"><a href="references-1.html#ref-ghitza2020voter" role="doc-biblioref">Ghitza and Gelman</a> (<a href="references-1.html#ref-ghitza2020voter" role="doc-biblioref">2020</a>)</span> pretend you’ve got access to a US voter file record from a private company. You train a model on the 2020 US CCES, and post-stratify it, on an individual-basis, based on that voter file.
<ol style="list-style-type: lower-alpha">
<li>Could you please put-together a datasheet for the voter file dataset following <span class="citation"><a href="references-1.html#ref-gebru2020datasheets" role="doc-biblioref">Gebru et al.</a> (<a href="references-1.html#ref-gebru2020datasheets" role="doc-biblioref">2020</a>)</span>? As a reminder, datasheets accompany datasets and document ‘motivation, composition, collection process, recommended uses,’ among other aspects.</li>
<li>Could you also please put together a model card for your model, following <span class="citation"><a href="references-1.html#ref-Mitchell_2019" role="doc-biblioref">Mitchell et al.</a> (<a href="references-1.html#ref-Mitchell_2019" role="doc-biblioref">2019</a>)</span>? As a reminder, model cards are deliberately straight-forward one- or two-page documents that report aspects such as: model details; intended use; metrics; training data; ethical considerations; as well as caveats and recommendations <span class="citation">(<a href="references-1.html#ref-Mitchell_2019" role="doc-biblioref">Mitchell et al. 2019</a>)</span>.</li>
<li>Could you please discuss three ethical aspects around the features that you are using in your model? [Please write a paragraph or two for each point.]</li>
<li>Could you please detail the protections that you would put in place in terms of the dataset, the model, and the predictions?</li>
</ol></li>
<li>If I have a model output from <code>lm()</code> called ‘my_model_output’ how can I use <code>modelsummary</code> to display the output (assume the package has been loaded) [please select all that apply]?
<ol style="list-style-type: lower-alpha">
<li><code>modelsummary::modelsummary(my_model_output)</code></li>
<li><code>modelsummary(my_model_output)</code></li>
<li><code>my_model_output %&gt;% modelsummary()</code></li>
<li><code>my_model_output %&gt;% modelsummary(statistic = NULL)</code></li>
</ol></li>
<li>Which of the following are examples of linear models [please select all that apply]?
<ol style="list-style-type: lower-alpha">
<li><code>lm(y ~ x_1 + x_2 + x_3, data = my_data)</code></li>
<li><code>lm(y ~ x_1 + x_2^2 + x_3, data = my_data)</code></li>
<li><code>lm(y ~ x_1 * x_2 + x_3, data = my_data)</code></li>
<li><code>lm(y ~ x_1 + x_1^2 + x_2 + x_3, data = my_data)</code></li>
</ol></li>
<li>Consider a situation in which you have a survey dataset with these age-groups: 18-29; 30-44; 45- 60; and 60+. And a post-stratification dataset with these age-groups: 18-24; 25-29; 30-34; 35-39; 40-44; 45-49; 50-54; 55-59; and 60+. What approach would you take to bringing these together? [Please write a paragraph.]</li>
<li>Consider a situation in which you again have a survey dataset with these age-groups: 18-29; 30-44; 45- 60; and 60+. But this time the post-stratification dataset has these age-groups: 18-34; 35-49; 50-64; and 65+. What approach would you take to bringing these together? [Please write a paragraph.]</li>
<li>Please consider <span class="citation"><a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">Kennedy et al.</a> (<a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">2020</a>)</span>. What are some statistical facets when considering a survey focused on gender, with a post-stratification survey that is not? [Please check all that apply.]
<ol style="list-style-type: lower-alpha">
<li>Impute all non-male as female</li>
<li>Estimate gender using auxiliary information</li>
<li>Impute population</li>
<li>Impute sample values</li>
<li>Model population distribution using auxiliary data</li>
<li>Remove all non-binary respondents</li>
<li>Remove respondents</li>
<li>Assume population distribution</li>
</ol></li>
<li>Please consider <span class="citation"><a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">Kennedy et al.</a> (<a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">2020</a>)</span>. What are some ethical facets when considering a survey focused on gender, with a post-stratification survey that is not? [Please check all that apply.]
<ol style="list-style-type: lower-alpha">
<li>Impute all non-male as female</li>
<li>Estimate gender using auxiliary information</li>
<li>Impute population</li>
<li>Impute sample values</li>
<li>Model population distribution using auxiliary data</li>
<li>Remove all non-binary respondents</li>
<li>Remove respondents</li>
<li>Assume population distribution</li>
</ol></li>
<li>Please consider <span class="citation"><a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">Kennedy et al.</a> (<a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">2020</a>)</span>. How do they define ethics?
<ol style="list-style-type: lower-alpha">
<li>Respecting the perspectives and dignity of individual survey respondents.</li>
<li>Generating estimates of the general population and for subpopulations of interest.</li>
<li>Using more complicated procedures only when they serve some useful function.</li>
</ol></li>
</ol>
<div id="introduction-22" class="section level2" number="16.1">
<h2><span class="header-section-number">16.1</span> Introduction</h2>
<blockquote>
<p>[The Presidential election of] 2016 was the largest analytics failure in US political history.</p>
<p>David Shor, 13 August 2020</p>
</blockquote>
<p>Multilevel regression with post-stratification (MRP) is a popular way to adjust non-representative samples to better analyse opinion and other survey responses.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> It uses a regression model to relate individual-level survey responses to various characteristics and then rebuilds the sample to better match the population. In this way MRP can not only allow a better understanding of responses, but also allow us to analyse data that may otherwise be unusable. However, it can be a challenge to get started with MRP as the terminology may be unfamiliar, and the data requirements can be onerous.</p>
<p>Let’s say that we have a biased survey. Maybe we conducted a survey about computers at an academic seminar, so folks with post-graduate degrees are likely over-represented. We are nonetheless interested in making claims about the population. Let’s say that we found 37.5 per cent of our respondents prefer Macs. One way forward is to just ignore the bias and say that ‘37.5 per cent of people prefer Macs.’ Another way is to say, well 50 per cent of our respondents with a post-graduate degree prefer Macs, and of those without a post-graduate degree, 25 per cent prefer Macs. If we knew what proportion of the broader population has post-graduate degree, let’s assume 10 per cent, then we could conduct re-weighting, or post-stratification, as follows: <span class="math inline">\(0.5 * 0.1 + 0.25 * 0.9 = 0.275\)</span>, and so our estimate is that 27.5 per cent of people prefer Macs. MRP is a third approach, and uses a model to help do that re-weighting. So we use logistic regression to estimate the relationship between preferring Macs and highest educational attainment in our survey. We then apply that relationship to population dataset.</p>
<p>MRP is a handy approach when dealing with survey data. <span class="citation"><a href="references-1.html#ref-hanretty2020" role="doc-biblioref">Hanretty</a> (<a href="references-1.html#ref-hanretty2020" role="doc-biblioref">2020</a>)</span> puts it well when he says ‘MRP is used because the alternatives are either very poor or very expensive.’ Essentially, it trains a model based on the survey, and then applies that trained model to another dataset. There are two main, related, advantages:</p>
<ol style="list-style-type: decimal">
<li>It can allow us to ‘re-weight’ in a way that includes uncertainty front-of-mind and isn’t as hamstrung by small samples. The alternative way to deal with having a small sample is to either go and gather more data or throw it away.</li>
<li>It can allow us to use broad surveys to speak to subsets. As <span class="citation"><a href="references-1.html#ref-hanretty2020" role="doc-biblioref">Hanretty</a> (<a href="references-1.html#ref-hanretty2020" role="doc-biblioref">2020</a>)</span> says ‘A poor alternative [to using MRP] is simply splitting a large sample into (much) smaller geographic subsamples. This is a poor alternative because there is no guarantee that a sample which is representative at the national level will be representative when it is broken down into smaller groups.’</li>
</ol>
<p>From a practical perspective, it tends to be less expensive to collect non-probability samples and so there are benefits of being able to use these types of data. That said, it is not a magic-bullet and the laws of statistics still apply. We will have larger uncertainty around our estimates and they will still be subject to all the usual biases. As <a href="https://jazzystats.com">Lauren Kennedy</a> points out, ‘MRP has traditionally been used in probability surveys and had potential for non-probability surveys, but we’re not sure of the limitations at the moment.’ It’s an exciting area of research in both academia and industry.</p>
<p>The workflow that you need for MRP is straight-forward, but the details and tiny decisions that have to be made at each step can become overwhelming. The point that you need to keep in mind is that you are trying to create a relationship between two datasets using a statistical model, and so you need to establish similarity between the two datasets in terms of their variables and levels. The steps are:</p>
<ol style="list-style-type: decimal">
<li>gather and prepare the survey dataset, thinking about what is needed for coherence with the post-stratification dataset;</li>
<li>gather and prepare the post-stratification dataset thinking about what is needed for coherence with the survey dataset;</li>
<li>model the variable of interest from the survey using independent variables and levels that are available in both the survey and the post-stratification datasets;</li>
<li>apply the model to the post-stratification data.</li>
</ol>
<p>In these notes, we begin with simulating a situation in which we pretend that we know the features of the population. We then move to a famous example of MRP that used survey data from the Xbox platform and exit poll data to forecast the 2012 US election. We will then move to examples from the Australian political situation. We will then discuss some features to be aware of when conducting MRP.</p>
</div>
<div id="simulation---toddler-bedtimes" class="section level2" number="16.2">
<h2><span class="header-section-number">16.2</span> Simulation - Toddler bedtimes</h2>
<div id="construct-a-population" class="section level3" number="16.2.1">
<h3><span class="header-section-number">16.2.1</span> Construct a population</h3>
<p>To get started we will simulate some data from a population that has various properties, take a biased sample, and then conduct MRP to demonstrate how we can get those properties back. We are going to have two ‘explanatory variables’ - age-group and toilet-trained - and one dependent variable - bedtime. Bed-time will increase as age-group increases, and will be later for children that are toilet-trained, compared with those that are not. To be clear, in this example we will ‘know’ the ‘true’ features of the population, but this isn’t something that occurs when we use real data - it is just to help you understand what MRP is doing. We’re going to rely heavily on the <code>tidyverse</code> package <span class="citation">(<a href="references-1.html#ref-citetidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="multilevel-regression-with-post-stratification.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment this (by deleting the #) if you need to install the packages</span></span>
<span id="cb1-2"><a href="multilevel-regression-with-post-stratification.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&#39;tidyverse&#39;)</span></span>
<span id="cb1-3"><a href="multilevel-regression-with-post-stratification.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="multilevel-regression-with-post-stratification.html#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="multilevel-regression-with-post-stratification.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This helps reproducibility</span></span>
<span id="cb1-6"><a href="multilevel-regression-with-post-stratification.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># It makes it more likely that you&#39;re able to get the same random numbers as in this example.</span></span>
<span id="cb1-7"><a href="multilevel-regression-with-post-stratification.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb1-8"><a href="multilevel-regression-with-post-stratification.html#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="multilevel-regression-with-post-stratification.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># One million people in our population.</span></span>
<span id="cb1-10"><a href="multilevel-regression-with-post-stratification.html#cb1-10" aria-hidden="true" tabindex="-1"></a>size_of_population <span class="ot">&lt;-</span> <span class="dv">1000000</span></span>
<span id="cb1-11"><a href="multilevel-regression-with-post-stratification.html#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="multilevel-regression-with-post-stratification.html#cb1-12" aria-hidden="true" tabindex="-1"></a>population_for_mrp_example <span class="ot">&lt;-</span> </span>
<span id="cb1-13"><a href="multilevel-regression-with-post-stratification.html#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">age_group =</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="co"># Draw from any of 1, 2, 3.</span></span>
<span id="cb1-14"><a href="multilevel-regression-with-post-stratification.html#cb1-14" aria-hidden="true" tabindex="-1"></a>                            <span class="at">size =</span> size_of_population,</span>
<span id="cb1-15"><a href="multilevel-regression-with-post-stratification.html#cb1-15" aria-hidden="true" tabindex="-1"></a>                            <span class="at">replace =</span> <span class="cn">TRUE</span> <span class="co"># After you draw a number, allow that number to be drawn again.</span></span>
<span id="cb1-16"><a href="multilevel-regression-with-post-stratification.html#cb1-16" aria-hidden="true" tabindex="-1"></a>                            ),</span>
<span id="cb1-17"><a href="multilevel-regression-with-post-stratification.html#cb1-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">toilet_trained =</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1-18"><a href="multilevel-regression-with-post-stratification.html#cb1-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">size =</span> size_of_population,</span>
<span id="cb1-19"><a href="multilevel-regression-with-post-stratification.html#cb1-19" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb1-20"><a href="multilevel-regression-with-post-stratification.html#cb1-20" aria-hidden="true" tabindex="-1"></a>                                 ),</span>
<span id="cb1-21"><a href="multilevel-regression-with-post-stratification.html#cb1-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">noise =</span> <span class="fu">rnorm</span>(size_of_population, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>), </span>
<span id="cb1-22"><a href="multilevel-regression-with-post-stratification.html#cb1-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">bed_time =</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> age_group <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> toilet_trained <span class="sc">+</span> noise, <span class="co"># Make bedtime a linear function of the variables that we just generated and a intercept (no special reason for that intercept to be five; it could be anything).</span></span>
<span id="cb1-23"><a href="multilevel-regression-with-post-stratification.html#cb1-23" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-24"><a href="multilevel-regression-with-post-stratification.html#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>noise) <span class="sc">%&gt;%</span> </span>
<span id="cb1-25"><a href="multilevel-regression-with-post-stratification.html#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">as_factor</span>(age_group),</span>
<span id="cb1-26"><a href="multilevel-regression-with-post-stratification.html#cb1-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">toilet_trained =</span> <span class="fu">as_factor</span>(toilet_trained)</span>
<span id="cb1-27"><a href="multilevel-regression-with-post-stratification.html#cb1-27" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb1-28"><a href="multilevel-regression-with-post-stratification.html#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="multilevel-regression-with-post-stratification.html#cb1-29" aria-hidden="true" tabindex="-1"></a>population_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb1-30"><a href="multilevel-regression-with-post-stratification.html#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   age_group toilet_trained bed_time
##   &lt;fct&gt;     &lt;fct&gt;             &lt;dbl&gt;
## 1 1         0                  5.74
## 2 2         1                  6.48
## 3 1         0                  6.53
## 4 1         1                  5.39
## 5 1         1                  8.40
## 6 3         0                  6.54</code></pre>
<p>At this point, Figure <a href="multilevel-regression-with-post-stratification.html#fig:bernie">16.1</a> provides invaluable advice (thank you to A Mahfouz).</p>
<div class="figure"><span id="fig:bernie"></span>
<img src="figures/bernie.png" alt="What does Bernie ask us to do?" width="90%" />
<p class="caption">
Figure 16.1: What does Bernie ask us to do?
</p>
</div>
<p>That is, as always, when we have a dataset, we first try to plot it to better understand what is going on (as there are a million points, I’ll just grab the first 1,000 so that it plots nicely).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="multilevel-regression-with-post-stratification.html#cb3-1" aria-hidden="true" tabindex="-1"></a>population_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="multilevel-regression-with-post-stratification.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="multilevel-regression-with-post-stratification.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> bed_time)) <span class="sc">+</span></span>
<span id="cb3-4"><a href="multilevel-regression-with-post-stratification.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> toilet_trained), </span>
<span id="cb3-5"><a href="multilevel-regression-with-post-stratification.html#cb3-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.4</span>, </span>
<span id="cb3-6"><a href="multilevel-regression-with-post-stratification.html#cb3-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">width =</span> <span class="fl">0.1</span>, </span>
<span id="cb3-7"><a href="multilevel-regression-with-post-stratification.html#cb3-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb3-8"><a href="multilevel-regression-with-post-stratification.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age-group&quot;</span>,</span>
<span id="cb3-9"><a href="multilevel-regression-with-post-stratification.html#cb3-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Bed time&quot;</span>,</span>
<span id="cb3-10"><a href="multilevel-regression-with-post-stratification.html#cb3-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Toilet trained&quot;</span>) <span class="sc">+</span></span>
<span id="cb3-11"><a href="multilevel-regression-with-post-stratification.html#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb3-12"><a href="multilevel-regression-with-post-stratification.html#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>And we can also work out what the ‘truth’ is for the information that we are interested in (remembering that we’d never actually know this when we move away from simulated examples).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="multilevel-regression-with-post-stratification.html#cb4-1" aria-hidden="true" tabindex="-1"></a>population_for_mrp_example_summarised <span class="ot">&lt;-</span> </span>
<span id="cb4-2"><a href="multilevel-regression-with-post-stratification.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  population_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="multilevel-regression-with-post-stratification.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, toilet_trained) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="multilevel-regression-with-post-stratification.html#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_bed_time =</span> <span class="fu">median</span>(bed_time)) </span>
<span id="cb4-5"><a href="multilevel-regression-with-post-stratification.html#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="multilevel-regression-with-post-stratification.html#cb4-6" aria-hidden="true" tabindex="-1"></a>population_for_mrp_example_summarised <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="multilevel-regression-with-post-stratification.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb4-8"><a href="multilevel-regression-with-post-stratification.html#cb4-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Age-group&quot;</span>, <span class="st">&quot;Is toilet trained&quot;</span>, <span class="st">&quot;Average bed time&quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Age-group</th>
<th align="left">Is toilet trained</th>
<th align="right">Average bed time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">0</td>
<td align="right">5.50</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1</td>
<td align="right">6.50</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">0</td>
<td align="right">6.00</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">1</td>
<td align="right">7.00</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">0</td>
<td align="right">6.50</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">1</td>
<td align="right">7.51</td>
</tr>
</tbody>
</table>
</div>
<div id="get-a-biased-sample-from-it" class="section level3" number="16.2.2">
<h3><span class="header-section-number">16.2.2</span> Get a biased sample from it</h3>
<p>Now we want to pretend that we have some survey that has a biased sample. We’ll allow that it over-samples children that are younger and those that are not toilet-trained. For instance, perhaps we gathered our sample based on the records of a paediatrician, so it’s more likely that they will see this biased sample of children. We are interested in knowing what proportion of children are toilet-trained at various age-groups.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="multilevel-regression-with-post-stratification.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Thanks to Monica Alexander</span></span>
<span id="cb5-2"><a href="multilevel-regression-with-post-stratification.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb5-3"><a href="multilevel-regression-with-post-stratification.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="multilevel-regression-with-post-stratification.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a weight for each &#39;type&#39; (has to sum to one)</span></span>
<span id="cb5-5"><a href="multilevel-regression-with-post-stratification.html#cb5-5" aria-hidden="true" tabindex="-1"></a>population_for_mrp_example <span class="ot">&lt;-</span> </span>
<span id="cb5-6"><a href="multilevel-regression-with-post-stratification.html#cb5-6" aria-hidden="true" tabindex="-1"></a>  population_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="multilevel-regression-with-post-stratification.html#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> </span>
<span id="cb5-8"><a href="multilevel-regression-with-post-stratification.html#cb5-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(toilet_trained <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> age_group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fl">0.7</span>,</span>
<span id="cb5-9"><a href="multilevel-regression-with-post-stratification.html#cb5-9" aria-hidden="true" tabindex="-1"></a>                     toilet_trained <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fl">0.1</span>,</span>
<span id="cb5-10"><a href="multilevel-regression-with-post-stratification.html#cb5-10" aria-hidden="true" tabindex="-1"></a>                     age_group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>) <span class="sc">~</span> <span class="fl">0.2</span></span>
<span id="cb5-11"><a href="multilevel-regression-with-post-stratification.html#cb5-11" aria-hidden="true" tabindex="-1"></a>                     ),</span>
<span id="cb5-12"><a href="multilevel-regression-with-post-stratification.html#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()</span>
<span id="cb5-13"><a href="multilevel-regression-with-post-stratification.html#cb5-13" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb5-14"><a href="multilevel-regression-with-post-stratification.html#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="multilevel-regression-with-post-stratification.html#cb5-15" aria-hidden="true" tabindex="-1"></a>get_these <span class="ot">&lt;-</span> </span>
<span id="cb5-16"><a href="multilevel-regression-with-post-stratification.html#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(</span>
<span id="cb5-17"><a href="multilevel-regression-with-post-stratification.html#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> population_for_mrp_example<span class="sc">$</span>id,</span>
<span id="cb5-18"><a href="multilevel-regression-with-post-stratification.html#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1000</span>,</span>
<span id="cb5-19"><a href="multilevel-regression-with-post-stratification.html#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob =</span> population_for_mrp_example<span class="sc">$</span>weight</span>
<span id="cb5-20"><a href="multilevel-regression-with-post-stratification.html#cb5-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-21"><a href="multilevel-regression-with-post-stratification.html#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="multilevel-regression-with-post-stratification.html#cb5-22" aria-hidden="true" tabindex="-1"></a>sample_for_mrp_example <span class="ot">&lt;-</span> </span>
<span id="cb5-23"><a href="multilevel-regression-with-post-stratification.html#cb5-23" aria-hidden="true" tabindex="-1"></a>  population_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb5-24"><a href="multilevel-regression-with-post-stratification.html#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> get_these) <span class="sc">%&gt;%</span> </span>
<span id="cb5-25"><a href="multilevel-regression-with-post-stratification.html#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>weight, <span class="sc">-</span>id)</span>
<span id="cb5-26"><a href="multilevel-regression-with-post-stratification.html#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="multilevel-regression-with-post-stratification.html#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up</span></span>
<span id="cb5-28"><a href="multilevel-regression-with-post-stratification.html#cb5-28" aria-hidden="true" tabindex="-1"></a>poststratification_dataset <span class="ot">&lt;-</span> </span>
<span id="cb5-29"><a href="multilevel-regression-with-post-stratification.html#cb5-29" aria-hidden="true" tabindex="-1"></a>  population_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb5-30"><a href="multilevel-regression-with-post-stratification.html#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>weight, <span class="sc">-</span>id)</span></code></pre></div>
<p>And we can plot those also.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="multilevel-regression-with-post-stratification.html#cb6-1" aria-hidden="true" tabindex="-1"></a>sample_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="multilevel-regression-with-post-stratification.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">toilet_trained =</span> <span class="fu">as_factor</span>(toilet_trained)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="multilevel-regression-with-post-stratification.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> bed_time)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="multilevel-regression-with-post-stratification.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">color =</span> toilet_trained), <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">height =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="multilevel-regression-with-post-stratification.html#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age-group&quot;</span>,</span>
<span id="cb6-6"><a href="multilevel-regression-with-post-stratification.html#cb6-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Bed time&quot;</span>,</span>
<span id="cb6-7"><a href="multilevel-regression-with-post-stratification.html#cb6-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Toilet trained&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-8"><a href="multilevel-regression-with-post-stratification.html#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb6-9"><a href="multilevel-regression-with-post-stratification.html#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>It’s pretty clear that our sample has a different bedtime than the overall population, but let’s just do the same exercise as before to look at the median, by age and toilet-trained status.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="multilevel-regression-with-post-stratification.html#cb7-1" aria-hidden="true" tabindex="-1"></a>sample_for_mrp_example_summarized <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="multilevel-regression-with-post-stratification.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  sample_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="multilevel-regression-with-post-stratification.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, toilet_trained) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="multilevel-regression-with-post-stratification.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">median_bed_time =</span> <span class="fu">median</span>(bed_time))</span>
<span id="cb7-5"><a href="multilevel-regression-with-post-stratification.html#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="multilevel-regression-with-post-stratification.html#cb7-6" aria-hidden="true" tabindex="-1"></a>sample_for_mrp_example_summarized <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="multilevel-regression-with-post-stratification.html#cb7-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb7-8"><a href="multilevel-regression-with-post-stratification.html#cb7-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Age-group&quot;</span>, <span class="st">&quot;Is toilet trained&quot;</span>, <span class="st">&quot;Average bed time&quot;</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Age-group</th>
<th align="left">Is toilet trained</th>
<th align="right">Average bed time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">0</td>
<td align="right">5.41</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1</td>
<td align="right">6.35</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">0</td>
<td align="right">5.89</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">1</td>
<td align="right">6.85</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">0</td>
<td align="right">6.49</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left">1</td>
<td align="right">7.62</td>
</tr>
</tbody>
</table>
</div>
<div id="model-the-sample" class="section level3" number="16.2.3">
<h3><span class="header-section-number">16.2.3</span> Model the sample</h3>
<p>We will quickly train a model based on the (biased) survey. We’ll use <code>modelsummary</code> <span class="citation">(<a href="references-1.html#ref-citemodelsummary" role="doc-biblioref">Arel-Bundock 2020</a>)</span> to format our estimates.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="multilevel-regression-with-post-stratification.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb8-2"><a href="multilevel-regression-with-post-stratification.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="multilevel-regression-with-post-stratification.html#cb8-3" aria-hidden="true" tabindex="-1"></a>mrp_example_model <span class="ot">&lt;-</span> </span>
<span id="cb8-4"><a href="multilevel-regression-with-post-stratification.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  sample_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="multilevel-regression-with-post-stratification.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(bed_time <span class="sc">~</span> age_group <span class="sc">+</span> toilet_trained, <span class="at">data =</span> .)</span>
<span id="cb8-6"><a href="multilevel-regression-with-post-stratification.html#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="multilevel-regression-with-post-stratification.html#cb8-7" aria-hidden="true" tabindex="-1"></a>mrp_example_model <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="multilevel-regression-with-post-stratification.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(<span class="at">fmt =</span> <span class="dv">2</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:center;">
5.47
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.04)
</td>
</tr>
<tr>
<td style="text-align:left;">
age_group2
</td>
<td style="text-align:center;">
0.54
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.09)
</td>
</tr>
<tr>
<td style="text-align:left;">
age_group3
</td>
<td style="text-align:center;">
1.15
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.09)
</td>
</tr>
<tr>
<td style="text-align:left;">
toilet_trained1
</td>
<td style="text-align:center;">
0.91
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.07)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
1000
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.373
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.371
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
2839.3
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
2863.8
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
-1414.630
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:center;">
197.594
</td>
</tr>
</tbody>
</table>
<p>This is the ‘multilevel regression’ part of the MRP (although this isn’t really a multilevel model just to keep things simple for now).</p>
</div>
<div id="get-a-post-stratification-dataset" class="section level3" number="16.2.4">
<h3><span class="header-section-number">16.2.4</span> Get a post-stratification dataset</h3>
<p>Now we will use a post-stratification dataset to get some estimates of the number in each cell. We typically use a larger dataset that may more closely reflection the population. In the US a popular choice is the ACS, while in other countries we typically have to use the census.</p>
<p>In this simulation example, I’ll just take a 10 per cent sample from the population and use that as our post-stratification dataset.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="multilevel-regression-with-post-stratification.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb9-2"><a href="multilevel-regression-with-post-stratification.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="multilevel-regression-with-post-stratification.html#cb9-3" aria-hidden="true" tabindex="-1"></a>poststratification_dataset <span class="ot">&lt;-</span> </span>
<span id="cb9-4"><a href="multilevel-regression-with-post-stratification.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  population_for_mrp_example <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="multilevel-regression-with-post-stratification.html#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="multilevel-regression-with-post-stratification.html#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>bed_time)</span>
<span id="cb9-7"><a href="multilevel-regression-with-post-stratification.html#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="multilevel-regression-with-post-stratification.html#cb9-8" aria-hidden="true" tabindex="-1"></a>poststratification_dataset <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="multilevel-regression-with-post-stratification.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   age_group toilet_trained weight    id
##   &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt; &lt;int&gt;
## 1 1         0                 0.7     1
## 2 2         1                 0.2     2
## 3 1         0                 0.7     3
## 4 1         1                 0.2     4
## 5 1         1                 0.2     5
## 6 3         0                 0.1     6</code></pre>
<p>In an ideal world we have individual-level data in our post-stratification dataset (that’s the case above). In that world we can apply our model to each individual. The more likely situation, in reality, is that we just have counts by groups, so we’re going to try to construct an estimate for each group.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="multilevel-regression-with-post-stratification.html#cb11-1" aria-hidden="true" tabindex="-1"></a>poststratification_dataset_grouped <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="multilevel-regression-with-post-stratification.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  poststratification_dataset <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="multilevel-regression-with-post-stratification.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, toilet_trained) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="multilevel-regression-with-post-stratification.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb11-5"><a href="multilevel-regression-with-post-stratification.html#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="multilevel-regression-with-post-stratification.html#cb11-6" aria-hidden="true" tabindex="-1"></a>poststratification_dataset_grouped <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="multilevel-regression-with-post-stratification.html#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
## # Groups:   age_group, toilet_trained [6]
##   age_group toilet_trained     n
##   &lt;fct&gt;     &lt;fct&gt;          &lt;int&gt;
## 1 1         0              16766
## 2 1         1              16649
## 3 2         0              16801
## 4 2         1              16617
## 5 3         0              16625
## 6 3         1              16542</code></pre>
</div>
<div id="post-stratify-our-model-estimates" class="section level3" number="16.2.5">
<h3><span class="header-section-number">16.2.5</span> Post-stratify our model estimates</h3>
<p>Now we create an estimate for each group, and add some confidence intervals.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="multilevel-regression-with-post-stratification.html#cb13-1" aria-hidden="true" tabindex="-1"></a>poststratification_dataset_grouped <span class="ot">&lt;-</span> </span>
<span id="cb13-2"><a href="multilevel-regression-with-post-stratification.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  mrp_example_model <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="multilevel-regression-with-post-stratification.html#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">newdata =</span> poststratification_dataset_grouped, <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="multilevel-regression-with-post-stratification.html#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="multilevel-regression-with-post-stratification.html#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(poststratification_dataset_grouped, .) <span class="co"># The dot modifies the behaviour of the pipe; it pipes to the dot instead of the first argument as normal.</span></span></code></pre></div>
<p>At this point we can have a look at our MRP estimates (circles) along with their confidence intervals, and compare them the raw estimates from the data (squares). In this case, because we know the truth, we can also compare them to the known truth (triangles) (but that’s not something we can do normally).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="multilevel-regression-with-post-stratification.html#cb14-1" aria-hidden="true" tabindex="-1"></a>poststratification_dataset_grouped <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="multilevel-regression-with-post-stratification.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="multilevel-regression-with-post-stratification.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> population_for_mrp_example_summarised,</span>
<span id="cb14-4"><a href="multilevel-regression-with-post-stratification.html#cb14-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> median_bed_time, <span class="at">color =</span> toilet_trained), </span>
<span id="cb14-5"><a href="multilevel-regression-with-post-stratification.html#cb14-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">17</span>) <span class="sc">+</span></span>
<span id="cb14-6"><a href="multilevel-regression-with-post-stratification.html#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> sample_for_mrp_example_summarized,</span>
<span id="cb14-7"><a href="multilevel-regression-with-post-stratification.html#cb14-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> age_group, <span class="at">y =</span> median_bed_time, <span class="at">color =</span> toilet_trained), </span>
<span id="cb14-8"><a href="multilevel-regression-with-post-stratification.html#cb14-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="multilevel-regression-with-post-stratification.html#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lwr, <span class="at">ymax=</span>upr, <span class="at">color =</span> toilet_trained)) <span class="sc">+</span></span>
<span id="cb14-10"><a href="multilevel-regression-with-post-stratification.html#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age-group&quot;</span>,</span>
<span id="cb14-11"><a href="multilevel-regression-with-post-stratification.html#cb14-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Bed time&quot;</span>,</span>
<span id="cb14-12"><a href="multilevel-regression-with-post-stratification.html#cb14-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Toilet trained&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-13"><a href="multilevel-regression-with-post-stratification.html#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb14-14"><a href="multilevel-regression-with-post-stratification.html#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
</div>
<div id="case-study---xbox-paper" class="section level2" number="16.3">
<h2><span class="header-section-number">16.3</span> Case study - Xbox paper</h2>
<div id="overview-5" class="section level3" number="16.3.1">
<h3><span class="header-section-number">16.3.1</span> Overview</h3>
<p>One famous MRP example is <span class="citation"><a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">Wang et al.</a> (<a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">2015</a>)</span>. They used data from the Xbox gaming platform to forecast the 2012 US Presidential Election.</p>
<p>Key facts about the set-up:</p>
<ul>
<li>Data are from an opt-in poll which was available on the Xbox gaming platform during the 45 days leading up to the 2012 US presidential election (Obama and Romney).</li>
<li>Each day there were three to five questions, including voter intention: ‘If the election were held today, who would you vote for?’</li>
<li>Respondents were allowed to answer at most once per day.</li>
<li>First-time respondents were asked to provide information about themselves, including their sex, race, age, education, state, party ID, political ideology, and who they voted for in the 2008 presidential election.</li>
<li>In total, 750,148 interviews were conducted, with 345,858 unique respondents - over 30,000 of whom completed five or more polls.</li>
<li>Young men dominate the Xbox population: 18-to-29-year-olds comprise 65 per cent of the Xbox dataset, compared to 19 per cent in the exit poll; and men make up 93 per cent of the Xbox sample but only 47 per cent of the electorate.</li>
</ul>
</div>
<div id="model-2" class="section level3" number="16.3.2">
<h3><span class="header-section-number">16.3.2</span> Model</h3>
<p>Given the structure of the US electorate, they use a two-stage modelling approach. The details don’t really matter too much, but essentially they model how likely a respondent is to vote for Obama, given various information such as state, education, sex, etc:</p>
<p><span class="math display">\[
\begin{align}
Pr\left(Y_i = \mbox{Obama} | Y_i\in\{\mbox{Obama, Romney}\}\right) = \\ 
\mbox{logit}^{-1}(\alpha_0 + \alpha_1(\mbox{state last vote share}) 
+ \alpha_{j[i]}^{\mbox{state}} + \\
\alpha_{j[i]}^{\mbox{edu}} + \alpha_{j[i]}^{\mbox{sex}} + ...) \\
\end{align}
\]</span></p>
<p>They run this in R using <code>glmer()</code> from ‘lme4’ <span class="citation">(<a href="references-1.html#ref-citelme" role="doc-biblioref">Bates et al. 2015</a>)</span>.</p>
</div>
<div id="post-stratify" class="section level3" number="16.3.3">
<h3><span class="header-section-number">16.3.3</span> Post-stratify</h3>
<p>Having a trained model that considers the effect of these various independent variables on support for the candidates, they now post-stratify, where each of these ‘cell-level estimates are weighted by the proportion of the electorate in each cell and aggregated to the appropriate level (i.e., state or national).’</p>
<p>This means that they need cross-tabulated population data. In general, the census would have worked, or one of the other large surveys available in the US, but the difficulty is that the variables need to be available on a cross-tab basis. As such, they use exit polls (not a viable option for most other countries).</p>
<p>They make state-specific estimates by post-stratifying to the features of each state (Figure <a href="multilevel-regression-with-post-stratification.html#fig:states">16.2</a>).</p>
<div class="figure"><span id="fig:states"></span>
<img src="figures/states.png" alt="Post-stratified estimates for each state based on the Xbox survey and MRP" width="100%" />
<p class="caption">
Figure 16.2: Post-stratified estimates for each state based on the Xbox survey and MRP
</p>
</div>
<p>Similarly, they can examine demographic-differences (Figure <a href="multilevel-regression-with-post-stratification.html#fig:demographics">16.3</a>).</p>
<div class="figure"><span id="fig:demographics"></span>
<img src="figures/demographics.png" alt="Post-stratified estimates on a demographic basis based on the Xbox survey and MRP" width="100%" />
<p class="caption">
Figure 16.3: Post-stratified estimates on a demographic basis based on the Xbox survey and MRP
</p>
</div>
<p>Finally, they convert their estimates into electoral college estimates (Figure <a href="multilevel-regression-with-post-stratification.html#fig:electoralcollege">16.4</a>).</p>
<div class="figure"><span id="fig:electoralcollege"></span>
<img src="figures/electoral_college.png" alt="Post-stratified estimates of electoral college outcomes based on the Xbox survey and MRP" width="100%" />
<p class="caption">
Figure 16.4: Post-stratified estimates of electoral college outcomes based on the Xbox survey and MRP
</p>
</div>
</div>
</div>
<div id="simulation---australian-voting" class="section level2" number="16.4">
<h2><span class="header-section-number">16.4</span> Simulation - Australian voting</h2>
<div id="overview-6" class="section level3" number="16.4.1">
<h3><span class="header-section-number">16.4.1</span> Overview</h3>
<p>As a reminder, the workflow that we use is:</p>
<ol style="list-style-type: decimal">
<li>read in the poll;</li>
<li>model the poll;</li>
<li>read in the post-stratification data; and</li>
<li>apply the model to the post-stratification data.</li>
</ol>
<p>In the earlier example, we didn’t really do too much in the modelling step, and despite the name ‘multilevel modelling with post-stratification,’ we didn’t actually use a multilevel model. There’s nothing that says you have to use a multilevel model, but a lot of situations will have circumstances such that it’s not likely to do any worse. To be clear, this means that although we have individual-level data, there is some grouping of the individuals that we’ll take advantage of. For instance, in the case of trying to model elections, usually districts/divisions/electorates/ridings/etc exist within provinces/states so it would likely make sense to, at least, include a coefficient that adjusts the intercept for each province.</p>
<p>In this section we’re simulate another dataset and then fit a few different models to it. We’re going to draw on the Australian elections set-up. In Australia we have a parliamentary system, with 151 seats in the parliament, one for each electorate. These electorates are grouped within six states and two territories. There are two major parties - the Australian Labor Party (ALP) and the Liberal Party (LP). Somewhat confusingly, the Liberal party are actually the conservative, right-wing party, while the Labor party are the progressive, left-wing, party.</p>
</div>
<div id="construct-a-survey" class="section level3" number="16.4.2">
<h3><span class="header-section-number">16.4.2</span> Construct a survey</h3>
<p>To move us slightly closer to reality, we are going to simulate a survey (rather than sample from a population as we did earlier) and then post-stratify it using real data. The dependent variable is ‘supports_ALP,’ which is a binary variable - either 0 or 1. We’ll just start with three independent variables here:</p>
<ul>
<li>‘gender,’ which is either ‘female’ or ‘male’ (as that is what is available from the Australian Bureau of Statistics);</li>
<li>‘age_group,’ which is one of four groups: ‘ages 18 to 29,’ ‘ages 30 to 44,’ ‘ages 45 to 59,’ ‘ages 60 plus’;</li>
<li>‘state,’ which is one of eight integers: 1 - 8 (inclusive).</li>
</ul>
<p>At this point, it’s worth briefly discussing the role of sex and gender in survey research, following <span class="citation"><a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">Kennedy et al.</a> (<a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">2020</a>)</span>. Sex is based on biological attributes, while gender is socially constructed. We are likely interested in the effect of gender on our dependent variable. Moving away from a non-binary concept of gender, in terms of official statistics, is only something that has happened recently. As a researcher one of the problems of insisting on a binary is that, as <span class="citation"><a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">Kennedy et al.</a> (<a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">2020, 2</a>)</span> say ‘…when measuring gender with simply two categories, there is a failure to capture the unique experiences of those who do not identify as either male or female, or for those whose gender does not align with their sex classification.’ A researcher has a variety of ways of proceeding, and <span class="citation"><a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">Kennedy et al.</a> (<a href="references-1.html#ref-kennedy2020using" role="doc-biblioref">2020</a>)</span> discuss these based on: ethics, accuracy, practicality, and flexibility. However, ‘there is no single good solution that can be applied to all situations. Instead, it is important to recognize that there is a compromise between ethical concerns, statistical concerns, and the most appropriate decision will be reflective of this’ [p. 16]. The most important consideration is to ensure appropriate ‘respect and consideration for the survey respondent.’</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="multilevel-regression-with-post-stratification.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-2"><a href="multilevel-regression-with-post-stratification.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb15-3"><a href="multilevel-regression-with-post-stratification.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="multilevel-regression-with-post-stratification.html#cb15-4" aria-hidden="true" tabindex="-1"></a>size_of_sample_for_australian_polling <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb15-5"><a href="multilevel-regression-with-post-stratification.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="multilevel-regression-with-post-stratification.html#cb15-6" aria-hidden="true" tabindex="-1"></a>sample_for_australian_polling <span class="ot">&lt;-</span> </span>
<span id="cb15-7"><a href="multilevel-regression-with-post-stratification.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">age_group =</span> </span>
<span id="cb15-8"><a href="multilevel-regression-with-post-stratification.html#cb15-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>), </span>
<span id="cb15-9"><a href="multilevel-regression-with-post-stratification.html#cb15-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> size_of_sample_for_australian_polling,</span>
<span id="cb15-10"><a href="multilevel-regression-with-post-stratification.html#cb15-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb15-11"><a href="multilevel-regression-with-post-stratification.html#cb15-11" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb15-12"><a href="multilevel-regression-with-post-stratification.html#cb15-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender =</span> </span>
<span id="cb15-13"><a href="multilevel-regression-with-post-stratification.html#cb15-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>),</span>
<span id="cb15-14"><a href="multilevel-regression-with-post-stratification.html#cb15-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> size_of_sample_for_australian_polling,</span>
<span id="cb15-15"><a href="multilevel-regression-with-post-stratification.html#cb15-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb15-16"><a href="multilevel-regression-with-post-stratification.html#cb15-16" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb15-17"><a href="multilevel-regression-with-post-stratification.html#cb15-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> </span>
<span id="cb15-18"><a href="multilevel-regression-with-post-stratification.html#cb15-18" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>),</span>
<span id="cb15-19"><a href="multilevel-regression-with-post-stratification.html#cb15-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> size_of_sample_for_australian_polling,</span>
<span id="cb15-20"><a href="multilevel-regression-with-post-stratification.html#cb15-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb15-21"><a href="multilevel-regression-with-post-stratification.html#cb15-21" aria-hidden="true" tabindex="-1"></a>                  ),</span>
<span id="cb15-22"><a href="multilevel-regression-with-post-stratification.html#cb15-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">noise =</span> <span class="fu">rnorm</span>(size_of_sample_for_australian_polling, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>), </span>
<span id="cb15-23"><a href="multilevel-regression-with-post-stratification.html#cb15-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">support_alp =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> age_group <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> gender <span class="sc">+</span> <span class="fl">0.01</span> <span class="sc">*</span> state <span class="sc">+</span> noise</span>
<span id="cb15-24"><a href="multilevel-regression-with-post-stratification.html#cb15-24" aria-hidden="true" tabindex="-1"></a>         ) </span>
<span id="cb15-25"><a href="multilevel-regression-with-post-stratification.html#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="multilevel-regression-with-post-stratification.html#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize the outcome variable</span></span>
<span id="cb15-27"><a href="multilevel-regression-with-post-stratification.html#cb15-27" aria-hidden="true" tabindex="-1"></a>sample_for_australian_polling <span class="ot">&lt;-</span> </span>
<span id="cb15-28"><a href="multilevel-regression-with-post-stratification.html#cb15-28" aria-hidden="true" tabindex="-1"></a>  sample_for_australian_polling <span class="sc">%&gt;%</span> </span>
<span id="cb15-29"><a href="multilevel-regression-with-post-stratification.html#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">support_alp =</span> </span>
<span id="cb15-30"><a href="multilevel-regression-with-post-stratification.html#cb15-30" aria-hidden="true" tabindex="-1"></a>           <span class="fu">if_else</span>(support_alp <span class="sc">&gt;</span> <span class="fu">median</span>(support_alp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb15-31"><a href="multilevel-regression-with-post-stratification.html#cb15-31" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;Supports ALP&#39;</span>, </span>
<span id="cb15-32"><a href="multilevel-regression-with-post-stratification.html#cb15-32" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;Does not&#39;</span>)</span>
<span id="cb15-33"><a href="multilevel-regression-with-post-stratification.html#cb15-33" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb15-34"><a href="multilevel-regression-with-post-stratification.html#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="multilevel-regression-with-post-stratification.html#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up the simulated data</span></span>
<span id="cb15-36"><a href="multilevel-regression-with-post-stratification.html#cb15-36" aria-hidden="true" tabindex="-1"></a>sample_for_australian_polling <span class="ot">&lt;-</span> </span>
<span id="cb15-37"><a href="multilevel-regression-with-post-stratification.html#cb15-37" aria-hidden="true" tabindex="-1"></a>  sample_for_australian_polling <span class="sc">%&gt;%</span> </span>
<span id="cb15-38"><a href="multilevel-regression-with-post-stratification.html#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-39"><a href="multilevel-regression-with-post-stratification.html#cb15-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-40"><a href="multilevel-regression-with-post-stratification.html#cb15-40" aria-hidden="true" tabindex="-1"></a>      age_group <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&#39;Ages 18 to 29&#39;</span>,</span>
<span id="cb15-41"><a href="multilevel-regression-with-post-stratification.html#cb15-41" aria-hidden="true" tabindex="-1"></a>      age_group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&#39;Ages 30 to 44&#39;</span>,</span>
<span id="cb15-42"><a href="multilevel-regression-with-post-stratification.html#cb15-42" aria-hidden="true" tabindex="-1"></a>      age_group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&#39;Ages 45 to 59&#39;</span>,</span>
<span id="cb15-43"><a href="multilevel-regression-with-post-stratification.html#cb15-43" aria-hidden="true" tabindex="-1"></a>      age_group <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&#39;Ages 60 plus&#39;</span>,</span>
<span id="cb15-44"><a href="multilevel-regression-with-post-stratification.html#cb15-44" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;Problem&#39;</span></span>
<span id="cb15-45"><a href="multilevel-regression-with-post-stratification.html#cb15-45" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-46"><a href="multilevel-regression-with-post-stratification.html#cb15-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-47"><a href="multilevel-regression-with-post-stratification.html#cb15-47" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&#39;Male&#39;</span>,</span>
<span id="cb15-48"><a href="multilevel-regression-with-post-stratification.html#cb15-48" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&#39;Female&#39;</span>,</span>
<span id="cb15-49"><a href="multilevel-regression-with-post-stratification.html#cb15-49" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;Problem&#39;</span></span>
<span id="cb15-50"><a href="multilevel-regression-with-post-stratification.html#cb15-50" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-51"><a href="multilevel-regression-with-post-stratification.html#cb15-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-52"><a href="multilevel-regression-with-post-stratification.html#cb15-52" aria-hidden="true" tabindex="-1"></a>      state <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&#39;Queensland&#39;</span>,</span>
<span id="cb15-53"><a href="multilevel-regression-with-post-stratification.html#cb15-53" aria-hidden="true" tabindex="-1"></a>      state <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&#39;New South Wales&#39;</span>,</span>
<span id="cb15-54"><a href="multilevel-regression-with-post-stratification.html#cb15-54" aria-hidden="true" tabindex="-1"></a>      state <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&#39;Australian Capital Territory&#39;</span>,</span>
<span id="cb15-55"><a href="multilevel-regression-with-post-stratification.html#cb15-55" aria-hidden="true" tabindex="-1"></a>      state <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">&#39;Victoria&#39;</span>,</span>
<span id="cb15-56"><a href="multilevel-regression-with-post-stratification.html#cb15-56" aria-hidden="true" tabindex="-1"></a>      state <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">&#39;Tasmania&#39;</span>,</span>
<span id="cb15-57"><a href="multilevel-regression-with-post-stratification.html#cb15-57" aria-hidden="true" tabindex="-1"></a>      state <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">&#39;Northern Territory&#39;</span>,</span>
<span id="cb15-58"><a href="multilevel-regression-with-post-stratification.html#cb15-58" aria-hidden="true" tabindex="-1"></a>      state <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">&#39;South Australia&#39;</span>,</span>
<span id="cb15-59"><a href="multilevel-regression-with-post-stratification.html#cb15-59" aria-hidden="true" tabindex="-1"></a>      state <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">&#39;Western Australia&#39;</span>,</span>
<span id="cb15-60"><a href="multilevel-regression-with-post-stratification.html#cb15-60" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;Problem&#39;</span></span>
<span id="cb15-61"><a href="multilevel-regression-with-post-stratification.html#cb15-61" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-62"><a href="multilevel-regression-with-post-stratification.html#cb15-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-63"><a href="multilevel-regression-with-post-stratification.html#cb15-63" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-64"><a href="multilevel-regression-with-post-stratification.html#cb15-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>noise)</span>
<span id="cb15-65"><a href="multilevel-regression-with-post-stratification.html#cb15-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-66"><a href="multilevel-regression-with-post-stratification.html#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy the class</span></span>
<span id="cb15-67"><a href="multilevel-regression-with-post-stratification.html#cb15-67" aria-hidden="true" tabindex="-1"></a>sample_for_australian_polling <span class="ot">&lt;-</span> </span>
<span id="cb15-68"><a href="multilevel-regression-with-post-stratification.html#cb15-68" aria-hidden="true" tabindex="-1"></a>  sample_for_australian_polling <span class="sc">%&gt;%</span> </span>
<span id="cb15-69"><a href="multilevel-regression-with-post-stratification.html#cb15-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(age_group, gender, state, support_alp), as_factor))</span>
<span id="cb15-70"><a href="multilevel-regression-with-post-stratification.html#cb15-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-71"><a href="multilevel-regression-with-post-stratification.html#cb15-71" aria-hidden="true" tabindex="-1"></a>sample_for_australian_polling <span class="sc">%&gt;%</span>   </span>
<span id="cb15-72"><a href="multilevel-regression-with-post-stratification.html#cb15-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   age_group     gender state           support_alp 
##   &lt;fct&gt;         &lt;fct&gt;  &lt;fct&gt;           &lt;fct&gt;       
## 1 Ages 18 to 29 Female South Australia Supports ALP
## 2 Ages 60 plus  Male   South Australia Supports ALP
## 3 Ages 30 to 44 Male   Victoria        Does not    
## 4 Ages 18 to 29 Male   Tasmania        Does not    
## 5 Ages 18 to 29 Female Victoria        Does not    
## 6 Ages 18 to 29 Male   Queensland      Supports ALP</code></pre>
<p>Finally, we want our survey to over-sample females, so we’ll just get rid of 300 males.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="multilevel-regression-with-post-stratification.html#cb17-1" aria-hidden="true" tabindex="-1"></a>sample_for_australian_polling <span class="ot">&lt;-</span> </span>
<span id="cb17-2"><a href="multilevel-regression-with-post-stratification.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  sample_for_australian_polling <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="multilevel-regression-with-post-stratification.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(gender) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="multilevel-regression-with-post-stratification.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1700</span>)</span></code></pre></div>
</div>
<div id="model-the-survey" class="section level3" number="16.4.3">
<h3><span class="header-section-number">16.4.3</span> Model the survey</h3>
<p>This polling data was generated to make both males and older people less likely to vote for the ALP; and females and younger people more likely to vote for the Labor Party. Females are over-sampled. As such, we should have an ALP skew on the dataset. We’re going to use the <code>gtsummary</code> package to quickly make a summary table <span class="citation">(<a href="references-1.html#ref-citegtsummary" role="doc-biblioref">Sjoberg et al. 2021</a>)</span>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="multilevel-regression-with-post-stratification.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb18-2"><a href="multilevel-regression-with-post-stratification.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="multilevel-regression-with-post-stratification.html#cb18-3" aria-hidden="true" tabindex="-1"></a>sample_for_australian_polling <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="multilevel-regression-with-post-stratification.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>()</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#oaligqhunl .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oaligqhunl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oaligqhunl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oaligqhunl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oaligqhunl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oaligqhunl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oaligqhunl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oaligqhunl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oaligqhunl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oaligqhunl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oaligqhunl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oaligqhunl .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#oaligqhunl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oaligqhunl .gt_from_md > :first-child {
  margin-top: 0;
}

#oaligqhunl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oaligqhunl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oaligqhunl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#oaligqhunl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oaligqhunl .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#oaligqhunl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oaligqhunl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oaligqhunl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oaligqhunl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oaligqhunl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oaligqhunl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#oaligqhunl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oaligqhunl .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#oaligqhunl .gt_left {
  text-align: left;
}

#oaligqhunl .gt_center {
  text-align: center;
}

#oaligqhunl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oaligqhunl .gt_font_normal {
  font-weight: normal;
}

#oaligqhunl .gt_font_bold {
  font-weight: bold;
}

#oaligqhunl .gt_font_italic {
  font-style: italic;
}

#oaligqhunl .gt_super {
  font-size: 65%;
}

#oaligqhunl .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="oaligqhunl" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>N = 1,700</strong><sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">age_group</td>
      <td class="gt_row gt_center"></td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Ages 18 to 29</td>
      <td class="gt_row gt_center">458 (27%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Ages 60 plus</td>
      <td class="gt_row gt_center">421 (25%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Ages 30 to 44</td>
      <td class="gt_row gt_center">401 (24%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Ages 45 to 59</td>
      <td class="gt_row gt_center">420 (25%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">gender</td>
      <td class="gt_row gt_center"></td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Female</td>
      <td class="gt_row gt_center">1,023 (60%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Male</td>
      <td class="gt_row gt_center">677 (40%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">state</td>
      <td class="gt_row gt_center"></td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">South Australia</td>
      <td class="gt_row gt_center">233 (14%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Victoria</td>
      <td class="gt_row gt_center">189 (11%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Tasmania</td>
      <td class="gt_row gt_center">229 (13%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Queensland</td>
      <td class="gt_row gt_center">214 (13%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Western Australia</td>
      <td class="gt_row gt_center">198 (12%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">New South Wales</td>
      <td class="gt_row gt_center">219 (13%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Australian Capital Territory</td>
      <td class="gt_row gt_center">237 (14%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Northern Territory</td>
      <td class="gt_row gt_center">181 (11%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">support_alp</td>
      <td class="gt_row gt_center"></td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Supports ALP</td>
      <td class="gt_row gt_center">896 (53%)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">Does not</td>
      <td class="gt_row gt_center">804 (47%)</td>
    </tr>
  </tbody>
  
  <tfoot>
    <tr class="gt_footnotes">
      <td colspan="2">
        <p class="gt_footnote">
          <sup class="gt_footnote_marks">
            <em>1</em>
          </sup>
           
          n (%)
          <br />
        </p>
      </td>
    </tr>
  </tfoot>
</table></div>
<p>Now we’d like to see if we can get our results back (we should find females less likely than males to vote for Australian Labor Party and that people are less likely to vote Australian Labor Party as they get older). Our model is:</p>
<p><span class="math display">\[
\mbox{ALP support}_j = \mbox{gender}_j + \mbox{age_group}_j + \epsilon_j
\]</span></p>
<p>This model says that the probability that some person, <span class="math inline">\(j\)</span>, will vote for the Australian Labor Party depends on their gender and their age-group. Based on our simulated data, we would like older age-groups to be less likely to vote for the Australian Labor Party and for males to be less likely to vote for the Australian Labor Party.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="multilevel-regression-with-post-stratification.html#cb19-1" aria-hidden="true" tabindex="-1"></a>alp_support <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a href="multilevel-regression-with-post-stratification.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(support_alp <span class="sc">~</span> gender <span class="sc">+</span> age_group <span class="sc">+</span> state, </span>
<span id="cb19-3"><a href="multilevel-regression-with-post-stratification.html#cb19-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> sample_for_australian_polling,</span>
<span id="cb19-4"><a href="multilevel-regression-with-post-stratification.html#cb19-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span></span>
<span id="cb19-5"><a href="multilevel-regression-with-post-stratification.html#cb19-5" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb19-6"><a href="multilevel-regression-with-post-stratification.html#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="multilevel-regression-with-post-stratification.html#cb19-7" aria-hidden="true" tabindex="-1"></a>alp_support <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="multilevel-regression-with-post-stratification.html#cb19-8" aria-hidden="true" tabindex="-1"></a>  modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(<span class="at">fmt =</span> <span class="dv">2</span>, <span class="at">exponentiate =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:center;">
1.44
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.18)
</td>
</tr>
<tr>
<td style="text-align:left;">
genderMale
</td>
<td style="text-align:center;">
3.22
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.12)
</td>
</tr>
<tr>
<td style="text-align:left;">
age_groupAges 60 plus
</td>
<td style="text-align:center;">
0.07
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.17)
</td>
</tr>
<tr>
<td style="text-align:left;">
age_groupAges 30 to 44
</td>
<td style="text-align:center;">
0.42
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.15)
</td>
</tr>
<tr>
<td style="text-align:left;">
age_groupAges 45 to 59
</td>
<td style="text-align:center;">
0.17
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.15)
</td>
</tr>
<tr>
<td style="text-align:left;">
stateVictoria
</td>
<td style="text-align:center;">
1.65
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.22)
</td>
</tr>
<tr>
<td style="text-align:left;">
stateTasmania
</td>
<td style="text-align:center;">
1.24
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.21)
</td>
</tr>
<tr>
<td style="text-align:left;">
stateQueensland
</td>
<td style="text-align:center;">
1.46
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.22)
</td>
</tr>
<tr>
<td style="text-align:left;">
stateWestern Australia
</td>
<td style="text-align:center;">
1.18
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.22)
</td>
</tr>
<tr>
<td style="text-align:left;">
stateNew South Wales
</td>
<td style="text-align:center;">
1.42
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.21)
</td>
</tr>
<tr>
<td style="text-align:left;">
stateAustralian Capital Territory
</td>
<td style="text-align:center;">
1.73
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.21)
</td>
</tr>
<tr>
<td style="text-align:left;">
stateNorthern Territory
</td>
<td style="text-align:center;">
1.49
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.23)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
1700
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
1959.7
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
2024.9
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
-967.836
</td>
</tr>
</tbody>
</table>
<p>Essentially we’ve got our inputs back. Our dependent variable is a binary, and so we used logistic regression so the results are a little more difficult to interpret.</p>
</div>
<div id="post-stratify-1" class="section level3" number="16.4.4">
<h3><span class="header-section-number">16.4.4</span> Post-stratify</h3>
<p>Now we’d like to see if we can use what we found in the poll to get an estimate for each state based on their demographic features.</p>
<p>First read in some real demographic data, on a state basis, from the ABS.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="multilevel-regression-with-post-stratification.html#cb20-1" aria-hidden="true" tabindex="-1"></a>post_strat_census_data <span class="ot">&lt;-</span> </span>
<span id="cb20-2"><a href="multilevel-regression-with-post-stratification.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">&quot;outputs/data/census_data.csv&quot;</span>)</span>
<span id="cb20-3"><a href="multilevel-regression-with-post-stratification.html#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="multilevel-regression-with-post-stratification.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(post_strat_census_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   state gender age_group  number cell_prop_of_division_total
##   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;       &lt;dbl&gt;                       &lt;dbl&gt;
## 1 ACT   Female ages18to29  34683                       0.125
## 2 ACT   Female ages30to44  42980                       0.155
## 3 ACT   Female ages45to59  33769                       0.122
## 4 ACT   Female ages60plus  30322                       0.109
## 5 ACT   Male   ages18to29  34163                       0.123
## 6 ACT   Male   ages30to44  41288                       0.149</code></pre>
<p>At this point, we’ve got a decision to make because we need the variables to be the same in the survey and the post-stratification dataset, but here the state abbreviations have been used, while in the survey, the full names were used. We’ll change the post-stratification dataset because the survey data has already modelled.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="multilevel-regression-with-post-stratification.html#cb22-1" aria-hidden="true" tabindex="-1"></a>post_strat_census_data <span class="ot">&lt;-</span> </span>
<span id="cb22-2"><a href="multilevel-regression-with-post-stratification.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  post_strat_census_data <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="multilevel-regression-with-post-stratification.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-4"><a href="multilevel-regression-with-post-stratification.html#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> </span>
<span id="cb22-5"><a href="multilevel-regression-with-post-stratification.html#cb22-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb22-6"><a href="multilevel-regression-with-post-stratification.html#cb22-6" aria-hidden="true" tabindex="-1"></a>        state <span class="sc">==</span> <span class="st">&#39;ACT&#39;</span> <span class="sc">~</span> <span class="st">&#39;Australian Capital Territory&#39;</span>,</span>
<span id="cb22-7"><a href="multilevel-regression-with-post-stratification.html#cb22-7" aria-hidden="true" tabindex="-1"></a>        state <span class="sc">==</span> <span class="st">&#39;NSW&#39;</span> <span class="sc">~</span> <span class="st">&#39;New South Wales&#39;</span>,</span>
<span id="cb22-8"><a href="multilevel-regression-with-post-stratification.html#cb22-8" aria-hidden="true" tabindex="-1"></a>        state <span class="sc">==</span> <span class="st">&#39;NT&#39;</span> <span class="sc">~</span> <span class="st">&#39;Northern Territory&#39;</span>,</span>
<span id="cb22-9"><a href="multilevel-regression-with-post-stratification.html#cb22-9" aria-hidden="true" tabindex="-1"></a>        state <span class="sc">==</span> <span class="st">&#39;QLD&#39;</span> <span class="sc">~</span> <span class="st">&#39;Queensland&#39;</span>,</span>
<span id="cb22-10"><a href="multilevel-regression-with-post-stratification.html#cb22-10" aria-hidden="true" tabindex="-1"></a>        state <span class="sc">==</span> <span class="st">&#39;SA&#39;</span> <span class="sc">~</span> <span class="st">&#39;South Australia&#39;</span>,</span>
<span id="cb22-11"><a href="multilevel-regression-with-post-stratification.html#cb22-11" aria-hidden="true" tabindex="-1"></a>        state <span class="sc">==</span> <span class="st">&#39;TAS&#39;</span> <span class="sc">~</span> <span class="st">&#39;Tasmania&#39;</span>,</span>
<span id="cb22-12"><a href="multilevel-regression-with-post-stratification.html#cb22-12" aria-hidden="true" tabindex="-1"></a>        state <span class="sc">==</span> <span class="st">&#39;VIC&#39;</span> <span class="sc">~</span> <span class="st">&#39;Victoria&#39;</span>,</span>
<span id="cb22-13"><a href="multilevel-regression-with-post-stratification.html#cb22-13" aria-hidden="true" tabindex="-1"></a>        state <span class="sc">==</span> <span class="st">&#39;WA&#39;</span> <span class="sc">~</span> <span class="st">&#39;Western Australia&#39;</span>,</span>
<span id="cb22-14"><a href="multilevel-regression-with-post-stratification.html#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Problem&quot;</span></span>
<span id="cb22-15"><a href="multilevel-regression-with-post-stratification.html#cb22-15" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb22-16"><a href="multilevel-regression-with-post-stratification.html#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> </span>
<span id="cb22-17"><a href="multilevel-regression-with-post-stratification.html#cb22-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb22-18"><a href="multilevel-regression-with-post-stratification.html#cb22-18" aria-hidden="true" tabindex="-1"></a>        age_group <span class="sc">==</span> <span class="st">&#39;ages18to29&#39;</span> <span class="sc">~</span> <span class="st">&#39;Ages 18 to 29&#39;</span>,</span>
<span id="cb22-19"><a href="multilevel-regression-with-post-stratification.html#cb22-19" aria-hidden="true" tabindex="-1"></a>        age_group <span class="sc">==</span> <span class="st">&#39;ages30to44&#39;</span> <span class="sc">~</span> <span class="st">&#39;Ages 30 to 44&#39;</span>,</span>
<span id="cb22-20"><a href="multilevel-regression-with-post-stratification.html#cb22-20" aria-hidden="true" tabindex="-1"></a>        age_group <span class="sc">==</span> <span class="st">&#39;ages45to59&#39;</span> <span class="sc">~</span> <span class="st">&#39;Ages 45 to 59&#39;</span>,</span>
<span id="cb22-21"><a href="multilevel-regression-with-post-stratification.html#cb22-21" aria-hidden="true" tabindex="-1"></a>        age_group <span class="sc">==</span> <span class="st">&#39;ages60plus&#39;</span> <span class="sc">~</span> <span class="st">&#39;Ages 60 plus&#39;</span>,</span>
<span id="cb22-22"><a href="multilevel-regression-with-post-stratification.html#cb22-22" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Problem&quot;</span></span>
<span id="cb22-23"><a href="multilevel-regression-with-post-stratification.html#cb22-23" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb22-24"><a href="multilevel-regression-with-post-stratification.html#cb22-24" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We’re just going to do some rough forecasts. For each gender and age-group we want the relevant coefficient in the example data and we can construct the estimates.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="multilevel-regression-with-post-stratification.html#cb23-1" aria-hidden="true" tabindex="-1"></a>post_strat_census_data <span class="ot">&lt;-</span> </span>
<span id="cb23-2"><a href="multilevel-regression-with-post-stratification.html#cb23-2" aria-hidden="true" tabindex="-1"></a>  alp_support <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="multilevel-regression-with-post-stratification.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">newdata =</span> post_strat_census_data, <span class="at">type =</span> <span class="st">&#39;response&#39;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="multilevel-regression-with-post-stratification.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="multilevel-regression-with-post-stratification.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(post_strat_census_data, .)</span>
<span id="cb23-6"><a href="multilevel-regression-with-post-stratification.html#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="multilevel-regression-with-post-stratification.html#cb23-7" aria-hidden="true" tabindex="-1"></a>post_strat_census_data <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="multilevel-regression-with-post-stratification.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alp_predict_prop =</span> fit<span class="sc">*</span>cell_prop_of_division_total) <span class="sc">%&gt;%</span> </span>
<span id="cb23-9"><a href="multilevel-regression-with-post-stratification.html#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="multilevel-regression-with-post-stratification.html#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">alp_predict =</span> <span class="fu">sum</span>(alp_predict_prop))</span></code></pre></div>
<pre><code>## # A tibble: 8 x 2
##   state                        alp_predict
##   &lt;chr&gt;                              &lt;dbl&gt;
## 1 Australian Capital Territory       0.551
## 2 New South Wales                    0.487
## 3 Northern Territory                 0.546
## 4 Queensland                         0.491
## 5 South Australia                    0.403
## 6 Tasmania                           0.429
## 7 Victoria                           0.521
## 8 Western Australia                  0.460</code></pre>
<p>We now have post-stratified estimates for each state Our model has a fair few weaknesses. For instance, small cell counts are going to be problematic. And our approach ignores uncertainty, but now that we have something working we can complicate it.</p>
</div>
<div id="improving-the-model" class="section level3" number="16.4.5">
<h3><span class="header-section-number">16.4.5</span> Improving the model</h3>
<p>We’d like to address some of the major issues with our approach, specifically being able to deal with small cell counts, and also taking better account of uncertainty. As we are dealing with survey data, prediction intervals or something similar are critical, and it’s not appropriate to only report central estimates. To do this we’ll use the same broad approach as before, but just improve the model. We’re going to change to a Bayesian model and use the <code>rstanarm</code> package <span class="citation">(<a href="references-1.html#ref-citerstanarm" role="doc-biblioref">Goodrich et al. 2020</a>)</span>.</p>
<p>Now, using the same basic model as before, but in a Bayesian setting.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="multilevel-regression-with-post-stratification.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb25-2"><a href="multilevel-regression-with-post-stratification.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="multilevel-regression-with-post-stratification.html#cb25-3" aria-hidden="true" tabindex="-1"></a>improved_alp_support <span class="ot">&lt;-</span> </span>
<span id="cb25-4"><a href="multilevel-regression-with-post-stratification.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  rstanarm<span class="sc">::</span><span class="fu">stan_glm</span>(support_alp <span class="sc">~</span> gender <span class="sc">+</span> age_group <span class="sc">+</span> state,</span>
<span id="cb25-5"><a href="multilevel-regression-with-post-stratification.html#cb25-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> sample_for_australian_polling,</span>
<span id="cb25-6"><a href="multilevel-regression-with-post-stratification.html#cb25-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb25-7"><a href="multilevel-regression-with-post-stratification.html#cb25-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb25-8"><a href="multilevel-regression-with-post-stratification.html#cb25-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb25-9"><a href="multilevel-regression-with-post-stratification.html#cb25-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cores =</span> <span class="dv">2</span>, </span>
<span id="cb25-10"><a href="multilevel-regression-with-post-stratification.html#cb25-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">seed =</span> <span class="dv">12345</span>)</span></code></pre></div>
<p>As before, we’d like an estimate for each state based on their demographic features. We’re just going to do some rough forecasts. For each gender and age-group we want the relevant coefficient in the example data and we can construct the estimates (this code is from <a href="https://www.monicaalexander.com/posts/2019-08-07-mrp/">Monica Alexander</a>). We’re going to use <code>tidybayes</code> for this <span class="citation">(<a href="references-1.html#ref-citetidybayes" role="doc-biblioref">Kay 2020</a>)</span>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="multilevel-regression-with-post-stratification.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb26-2"><a href="multilevel-regression-with-post-stratification.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="multilevel-regression-with-post-stratification.html#cb26-3" aria-hidden="true" tabindex="-1"></a>post_stratified_estimates <span class="ot">&lt;-</span> </span>
<span id="cb26-4"><a href="multilevel-regression-with-post-stratification.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  improved_alp_support <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="multilevel-regression-with-post-stratification.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_fitted_draws</span>(<span class="at">newdata =</span> post_strat_census_data) <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="multilevel-regression-with-post-stratification.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">alp_predict =</span> .value) <span class="sc">%&gt;%</span> </span>
<span id="cb26-7"><a href="multilevel-regression-with-post-stratification.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alp_predict_prop =</span> alp_predict<span class="sc">*</span>cell_prop_of_division_total) <span class="sc">%&gt;%</span> </span>
<span id="cb26-8"><a href="multilevel-regression-with-post-stratification.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, .draw) <span class="sc">%&gt;%</span> </span>
<span id="cb26-9"><a href="multilevel-regression-with-post-stratification.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">alp_predict =</span> <span class="fu">sum</span>(alp_predict_prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-10"><a href="multilevel-regression-with-post-stratification.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span> </span>
<span id="cb26-11"><a href="multilevel-regression-with-post-stratification.html#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(alp_predict), </span>
<span id="cb26-12"><a href="multilevel-regression-with-post-stratification.html#cb26-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower =</span> <span class="fu">quantile</span>(alp_predict, <span class="fl">0.025</span>), </span>
<span id="cb26-13"><a href="multilevel-regression-with-post-stratification.html#cb26-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">upper =</span> <span class="fu">quantile</span>(alp_predict, <span class="fl">0.975</span>))</span>
<span id="cb26-14"><a href="multilevel-regression-with-post-stratification.html#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="multilevel-regression-with-post-stratification.html#cb26-15" aria-hidden="true" tabindex="-1"></a>post_stratified_estimates</span></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##   state                         mean lower upper
##   &lt;chr&gt;                        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Australian Capital Territory 0.550 0.494 0.604
## 2 New South Wales              0.486 0.429 0.544
## 3 Northern Territory           0.544 0.483 0.607
## 4 Queensland                   0.491 0.432 0.548
## 5 South Australia              0.412 0.361 0.464
## 6 Tasmania                     0.429 0.372 0.487
## 7 Victoria                     0.519 0.453 0.583
## 8 Western Australia            0.460 0.401 0.520</code></pre>
<p>We now have post-stratified estimates for each division. Our new Bayesian approach will enable us to think more deeply about uncertainty. We could complicate this in a variety of ways including adding more coefficients (but remember that we’d need to get new cell counts), or adding some layers.</p>
<p>One interesting aspect is that our multilevel approach will allow us to deal with small cell counts by borrowing information from other cells. Even if we were to remove most of the, say, 18-to-29-year-old, male respondents from Tasmania our model would still provide estimates. It does this by pooling, in which the effect of these young, male, Tasmanians is partially determined by other cells that do have respondents.</p>
<p>There are many interesting aspects that we may like to communicate to others. For instance, we may like to show how the model is affecting the results. We can make a graph that compares the raw estimate with the model estimate.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="multilevel-regression-with-post-stratification.html#cb28-1" aria-hidden="true" tabindex="-1"></a>post_stratified_estimates <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="multilevel-regression-with-post-stratification.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">x =</span> forcats<span class="sc">::</span><span class="fu">fct_inorder</span>(state), <span class="at">color =</span> <span class="st">&quot;MRP estimate&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb28-3"><a href="multilevel-regression-with-post-stratification.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb28-4"><a href="multilevel-regression-with-post-stratification.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">width =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb28-5"><a href="multilevel-regression-with-post-stratification.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Proportion ALP support&quot;</span>,</span>
<span id="cb28-6"><a href="multilevel-regression-with-post-stratification.html#cb28-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;State&quot;</span>) <span class="sc">+</span> </span>
<span id="cb28-7"><a href="multilevel-regression-with-post-stratification.html#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-8"><a href="multilevel-regression-with-post-stratification.html#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-9"><a href="multilevel-regression-with-post-stratification.html#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-10"><a href="multilevel-regression-with-post-stratification.html#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb28-11"><a href="multilevel-regression-with-post-stratification.html#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Similarly, we may like to plot the distribution of the coefficients.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="multilevel-regression-with-post-stratification.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tidybayes::get_variables(improved_alp_support)</span></span>
<span id="cb29-2"><a href="multilevel-regression-with-post-stratification.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># improved_alp_support %&gt;%</span></span>
<span id="cb29-3"><a href="multilevel-regression-with-post-stratification.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   gather_draws(genderMale) %&gt;%</span></span>
<span id="cb29-4"><a href="multilevel-regression-with-post-stratification.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb29-5"><a href="multilevel-regression-with-post-stratification.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   # mutate(coefficient = stringr::str_replace_all(.variable, c(&quot;b_&quot; = &quot;&quot;))) %&gt;%</span></span>
<span id="cb29-6"><a href="multilevel-regression-with-post-stratification.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(coefficient = forcats::fct_recode(coefficient,</span></span>
<span id="cb29-7"><a href="multilevel-regression-with-post-stratification.html#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                                            Intercept = &quot;Intercept&quot;,</span></span>
<span id="cb29-8"><a href="multilevel-regression-with-post-stratification.html#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                                            `Is male` = &quot;genderMale&quot;,</span></span>
<span id="cb29-9"><a href="multilevel-regression-with-post-stratification.html#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                                            `Age 30-44` = &quot;age_groupages30to44&quot;,</span></span>
<span id="cb29-10"><a href="multilevel-regression-with-post-stratification.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                                            `Age 45-59` = &quot;age_groupages45to59&quot;,</span></span>
<span id="cb29-11"><a href="multilevel-regression-with-post-stratification.html#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                                            `Age 60+` = &quot;age_groupages60plus&quot;</span></span>
<span id="cb29-12"><a href="multilevel-regression-with-post-stratification.html#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                                            )) %&gt;% </span></span>
<span id="cb29-13"><a href="multilevel-regression-with-post-stratification.html#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-14"><a href="multilevel-regression-with-post-stratification.html#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># # both %&gt;% </span></span>
<span id="cb29-15"><a href="multilevel-regression-with-post-stratification.html#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y=fct_rev(coefficient), x = .value)) + </span></span>
<span id="cb29-16"><a href="multilevel-regression-with-post-stratification.html#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggridges::geom_density_ridges2(aes(height = ..density..),</span></span>
<span id="cb29-17"><a href="multilevel-regression-with-post-stratification.html#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  rel_min_height = 0.01, </span></span>
<span id="cb29-18"><a href="multilevel-regression-with-post-stratification.html#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  stat = &quot;density&quot;,</span></span>
<span id="cb29-19"><a href="multilevel-regression-with-post-stratification.html#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  scale=1.5) +</span></span>
<span id="cb29-20"><a href="multilevel-regression-with-post-stratification.html#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   xlab(&quot;Distribution of estimate&quot;) +</span></span>
<span id="cb29-21"><a href="multilevel-regression-with-post-stratification.html#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   ylab(&quot;Coefficient&quot;) +</span></span>
<span id="cb29-22"><a href="multilevel-regression-with-post-stratification.html#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_brewer(name = &quot;Dataset: &quot;, palette = &quot;Set1&quot;) +</span></span>
<span id="cb29-23"><a href="multilevel-regression-with-post-stratification.html#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb29-24"><a href="multilevel-regression-with-post-stratification.html#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(panel.grid.major = element_blank(),</span></span>
<span id="cb29-25"><a href="multilevel-regression-with-post-stratification.html#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co">#         panel.grid.minor = element_blank()) +</span></span>
<span id="cb29-26"><a href="multilevel-regression-with-post-stratification.html#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = &quot;bottom&quot;)</span></span></code></pre></div>
</div>
</div>
<div id="forecasting-the-2020-us-election" class="section level2" number="16.5">
<h2><span class="header-section-number">16.5</span> Forecasting the 2020 US election</h2>
<p>The US election has a lot of features that are unique to the US, but the model that we are going to build here is going to be fairly generic and, largely a generalization of the earlier model for the Australian election. One good thing about forecasting the US election is that there is a lot of data around. In this case we can use survey data from the <a href="https://www.voterstudygroup.org">Democracy Fund Voter Study Group</a>.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> They conducted polling in the lead-up to the US election and make this publicly available after registration. We will use the Integrated Public Use Microdata Series (IPUMS), to access the 2018 American Community Survey (ACS) as a post-stratification dataset. We will use state, age-group, gender, and education as explanatory variables.</p>
<div id="survey-data" class="section level3" number="16.5.1">
<h3><span class="header-section-number">16.5.1</span> Survey data</h3>
<p>The first step is that we need to actually get the survey data. Go to their website:<a href="https://www.voterstudygroup.org" class="uri">https://www.voterstudygroup.org</a> and then you’re looking for ‘Nationscape’ and then a button along the lines of ‘Get the latest Nationscape data.’ To get the dataset, you need to fill out a form, which they will process and then email you. There is a real person on the other side of this form, and so your request could take a few days.</p>
<p>Once you get access you’ll want to download the .dta files. Nationscape conducted many surveys and so there are many files. The filename is the reference date, and so ‘ns20200625’ refers to 25 June 2020, which is the one that I’ll use here. (This data is not mine to share, which is why I’ll refer)</p>
<p>We can read in ‘.dta’ files using the <code>haven</code> package <span class="citation">(<a href="references-1.html#ref-citehaven" role="doc-biblioref">Wickham and Miller 2020</a>)</span>. I’ve based this code on that written by Alen Mitrovski, Xiaoyan Yang, Matthew Wankiewicz, which is available here: <a href="https://github.com/matthewwankiewicz/US_election_forecast" class="uri">https://github.com/matthewwankiewicz/US_election_forecast</a>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="multilevel-regression-with-post-stratification.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb30-2"><a href="multilevel-regression-with-post-stratification.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb30-3"><a href="multilevel-regression-with-post-stratification.html#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="multilevel-regression-with-post-stratification.html#cb30-4" aria-hidden="true" tabindex="-1"></a>raw_nationscape_data <span class="ot">&lt;-</span> </span>
<span id="cb30-5"><a href="multilevel-regression-with-post-stratification.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_dta</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;dont_push/ns20200625.dta&quot;</span>))</span>
<span id="cb30-6"><a href="multilevel-regression-with-post-stratification.html#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="multilevel-regression-with-post-stratification.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The Stata format separates labels so reunite those</span></span>
<span id="cb30-8"><a href="multilevel-regression-with-post-stratification.html#cb30-8" aria-hidden="true" tabindex="-1"></a>raw_nationscape_data <span class="ot">&lt;-</span> </span>
<span id="cb30-9"><a href="multilevel-regression-with-post-stratification.html#cb30-9" aria-hidden="true" tabindex="-1"></a>  labelled<span class="sc">::</span><span class="fu">to_factor</span>(raw_nationscape_data)</span>
<span id="cb30-10"><a href="multilevel-regression-with-post-stratification.html#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="multilevel-regression-with-post-stratification.html#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Just keep relevant variables</span></span>
<span id="cb30-12"><a href="multilevel-regression-with-post-stratification.html#cb30-12" aria-hidden="true" tabindex="-1"></a>nationscape_data <span class="ot">&lt;-</span> </span>
<span id="cb30-13"><a href="multilevel-regression-with-post-stratification.html#cb30-13" aria-hidden="true" tabindex="-1"></a>  raw_nationscape_data <span class="sc">%&gt;%</span> </span>
<span id="cb30-14"><a href="multilevel-regression-with-post-stratification.html#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vote_2020,</span>
<span id="cb30-15"><a href="multilevel-regression-with-post-stratification.html#cb30-15" aria-hidden="true" tabindex="-1"></a>         gender,</span>
<span id="cb30-16"><a href="multilevel-regression-with-post-stratification.html#cb30-16" aria-hidden="true" tabindex="-1"></a>         education,</span>
<span id="cb30-17"><a href="multilevel-regression-with-post-stratification.html#cb30-17" aria-hidden="true" tabindex="-1"></a>         state,</span>
<span id="cb30-18"><a href="multilevel-regression-with-post-stratification.html#cb30-18" aria-hidden="true" tabindex="-1"></a>         age)</span>
<span id="cb30-19"><a href="multilevel-regression-with-post-stratification.html#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="multilevel-regression-with-post-stratification.html#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co"># For simplicity, remove anyone undecided or planning to vote for someone other than Biden/Trump and make vote a binary variable: 1 for Biden, 0 for Trump.</span></span>
<span id="cb30-21"><a href="multilevel-regression-with-post-stratification.html#cb30-21" aria-hidden="true" tabindex="-1"></a>nationscape_data <span class="ot">&lt;-</span> </span>
<span id="cb30-22"><a href="multilevel-regression-with-post-stratification.html#cb30-22" aria-hidden="true" tabindex="-1"></a>  nationscape_data <span class="sc">%&gt;%</span> </span>
<span id="cb30-23"><a href="multilevel-regression-with-post-stratification.html#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(vote_2020 <span class="sc">==</span> <span class="st">&quot;Joe Biden&quot;</span> <span class="sc">|</span> vote_2020 <span class="sc">==</span> <span class="st">&quot;Donald Trump&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-24"><a href="multilevel-regression-with-post-stratification.html#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vote_biden =</span> <span class="fu">if_else</span>(vote_2020 <span class="sc">==</span> <span class="st">&quot;Joe Biden&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-25"><a href="multilevel-regression-with-post-stratification.html#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>vote_2020)</span>
<span id="cb30-26"><a href="multilevel-regression-with-post-stratification.html#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="multilevel-regression-with-post-stratification.html#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dependent variables by grouping the existing variables</span></span>
<span id="cb30-28"><a href="multilevel-regression-with-post-stratification.html#cb30-28" aria-hidden="true" tabindex="-1"></a>nationscape_data <span class="ot">&lt;-</span> </span>
<span id="cb30-29"><a href="multilevel-regression-with-post-stratification.html#cb30-29" aria-hidden="true" tabindex="-1"></a>  nationscape_data <span class="sc">%&gt;%</span> </span>
<span id="cb30-30"><a href="multilevel-regression-with-post-stratification.html#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-31"><a href="multilevel-regression-with-post-stratification.html#cb30-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">case_when</span>( <span class="co"># case_when works in order and exits when there&#39;s a match</span></span>
<span id="cb30-32"><a href="multilevel-regression-with-post-stratification.html#cb30-32" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;=</span> <span class="dv">29</span> <span class="sc">~</span> <span class="st">&#39;age_18-29&#39;</span>,</span>
<span id="cb30-33"><a href="multilevel-regression-with-post-stratification.html#cb30-33" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="st">&#39;age_30-44&#39;</span>,</span>
<span id="cb30-34"><a href="multilevel-regression-with-post-stratification.html#cb30-34" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">&#39;age_45-59&#39;</span>,</span>
<span id="cb30-35"><a href="multilevel-regression-with-post-stratification.html#cb30-35" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">&#39;age_60_or_more&#39;</span>,</span>
<span id="cb30-36"><a href="multilevel-regression-with-post-stratification.html#cb30-36" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;Trouble&#39;</span></span>
<span id="cb30-37"><a href="multilevel-regression-with-post-stratification.html#cb30-37" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb30-38"><a href="multilevel-regression-with-post-stratification.html#cb30-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-39"><a href="multilevel-regression-with-post-stratification.html#cb30-39" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="st">&quot;Female&quot;</span> <span class="sc">~</span> <span class="st">&#39;female&#39;</span>,</span>
<span id="cb30-40"><a href="multilevel-regression-with-post-stratification.html#cb30-40" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="st">&quot;Male&quot;</span> <span class="sc">~</span> <span class="st">&#39;male&#39;</span>,</span>
<span id="cb30-41"><a href="multilevel-regression-with-post-stratification.html#cb30-41" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;Trouble&#39;</span></span>
<span id="cb30-42"><a href="multilevel-regression-with-post-stratification.html#cb30-42" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb30-43"><a href="multilevel-regression-with-post-stratification.html#cb30-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">education_level =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-44"><a href="multilevel-regression-with-post-stratification.html#cb30-44" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;3rd Grade or less&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb30-45"><a href="multilevel-regression-with-post-stratification.html#cb30-45" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;Middle School - Grades 4 - 8&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb30-46"><a href="multilevel-regression-with-post-stratification.html#cb30-46" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;Completed some high school&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb30-47"><a href="multilevel-regression-with-post-stratification.html#cb30-47" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;High school graduate&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb30-48"><a href="multilevel-regression-with-post-stratification.html#cb30-48" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;Other post high school vocational training&quot;</span> <span class="sc">~</span> <span class="st">&quot;Some post secondary&quot;</span>,</span>
<span id="cb30-49"><a href="multilevel-regression-with-post-stratification.html#cb30-49" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;Completed some college, but no degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Some post secondary&quot;</span>,</span>
<span id="cb30-50"><a href="multilevel-regression-with-post-stratification.html#cb30-50" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;Associate Degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Post secondary or higher&quot;</span>,</span>
<span id="cb30-51"><a href="multilevel-regression-with-post-stratification.html#cb30-51" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;College Degree (such as B.A., B.S.)&quot;</span> <span class="sc">~</span> <span class="st">&quot;Post secondary or higher&quot;</span>,</span>
<span id="cb30-52"><a href="multilevel-regression-with-post-stratification.html#cb30-52" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;Completed some graduate, but no degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Post secondary or higher&quot;</span>,</span>
<span id="cb30-53"><a href="multilevel-regression-with-post-stratification.html#cb30-53" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;Masters degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Graduate degree&quot;</span>,</span>
<span id="cb30-54"><a href="multilevel-regression-with-post-stratification.html#cb30-54" aria-hidden="true" tabindex="-1"></a>      education <span class="sc">==</span> <span class="st">&quot;Doctorate degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Graduate degree&quot;</span>,</span>
<span id="cb30-55"><a href="multilevel-regression-with-post-stratification.html#cb30-55" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;Trouble&#39;</span></span>
<span id="cb30-56"><a href="multilevel-regression-with-post-stratification.html#cb30-56" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb30-57"><a href="multilevel-regression-with-post-stratification.html#cb30-57" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-58"><a href="multilevel-regression-with-post-stratification.html#cb30-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>education, <span class="sc">-</span>age)</span>
<span id="cb30-59"><a href="multilevel-regression-with-post-stratification.html#cb30-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-60"><a href="multilevel-regression-with-post-stratification.html#cb30-60" aria-hidden="true" tabindex="-1"></a>tests <span class="ot">&lt;-</span> </span>
<span id="cb30-61"><a href="multilevel-regression-with-post-stratification.html#cb30-61" aria-hidden="true" tabindex="-1"></a>  nationscape_data <span class="sc">%&gt;%</span> </span>
<span id="cb30-62"><a href="multilevel-regression-with-post-stratification.html#cb30-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">test =</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(age_group, <span class="st">&#39;Trouble&#39;</span>),</span>
<span id="cb30-63"><a href="multilevel-regression-with-post-stratification.html#cb30-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">test =</span> <span class="fu">if_else</span>(test <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, </span>
<span id="cb30-64"><a href="multilevel-regression-with-post-stratification.html#cb30-64" aria-hidden="true" tabindex="-1"></a>                        stringr<span class="sc">::</span><span class="fu">str_detect</span>(education_level, <span class="st">&#39;Trouble&#39;</span>)),</span>
<span id="cb30-65"><a href="multilevel-regression-with-post-stratification.html#cb30-65" aria-hidden="true" tabindex="-1"></a>         <span class="at">test =</span> <span class="fu">if_else</span>(test <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, </span>
<span id="cb30-66"><a href="multilevel-regression-with-post-stratification.html#cb30-66" aria-hidden="true" tabindex="-1"></a>                        stringr<span class="sc">::</span><span class="fu">str_detect</span>(gender, <span class="st">&#39;Trouble&#39;</span>))</span>
<span id="cb30-67"><a href="multilevel-regression-with-post-stratification.html#cb30-67" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-68"><a href="multilevel-regression-with-post-stratification.html#cb30-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(test <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-69"><a href="multilevel-regression-with-post-stratification.html#cb30-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-70"><a href="multilevel-regression-with-post-stratification.html#cb30-70" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(tests) <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb30-71"><a href="multilevel-regression-with-post-stratification.html#cb30-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Check nationscape_data&quot;</span>)</span>
<span id="cb30-72"><a href="multilevel-regression-with-post-stratification.html#cb30-72" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-73"><a href="multilevel-regression-with-post-stratification.html#cb30-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(tests)</span>
<span id="cb30-74"><a href="multilevel-regression-with-post-stratification.html#cb30-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-75"><a href="multilevel-regression-with-post-stratification.html#cb30-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-76"><a href="multilevel-regression-with-post-stratification.html#cb30-76" aria-hidden="true" tabindex="-1"></a>nationscape_data <span class="sc">%&gt;%</span> </span>
<span id="cb30-77"><a href="multilevel-regression-with-post-stratification.html#cb30-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   gender state vote_biden age_group      education_level         
##   &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                   
## 1 female WI             0 age_45-59      Post secondary or higher
## 2 female VA             0 age_45-59      Post secondary or higher
## 3 female TX             0 age_60_or_more High school or less     
## 4 female WA             0 age_45-59      High school or less     
## 5 female MA             1 age_18-29      Some post secondary     
## 6 female TX             1 age_30-44      Some post secondary</code></pre>
<p>As we’ve seen, one of the most difficult aspects with MRP is ensuring consistency between the datasets. In this case, we need to do some work to make the variables consistent.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="multilevel-regression-with-post-stratification.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This code is very directly from Alen Mitrovski, Xiaoyan Yang, and Matthew Wankiewicz.</span></span>
<span id="cb32-2"><a href="multilevel-regression-with-post-stratification.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Format state names so the whole state name is written out, to match IPUMS data</span></span>
<span id="cb32-3"><a href="multilevel-regression-with-post-stratification.html#cb32-3" aria-hidden="true" tabindex="-1"></a>states_names_and_abbrevs <span class="ot">&lt;-</span> </span>
<span id="cb32-4"><a href="multilevel-regression-with-post-stratification.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">stateicp =</span> state.name, <span class="at">state =</span> state.abb)</span>
<span id="cb32-5"><a href="multilevel-regression-with-post-stratification.html#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="multilevel-regression-with-post-stratification.html#cb32-6" aria-hidden="true" tabindex="-1"></a>nationscape_data <span class="ot">&lt;-</span></span>
<span id="cb32-7"><a href="multilevel-regression-with-post-stratification.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  nationscape_data <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="multilevel-regression-with-post-stratification.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(states_names_and_abbrevs)</span>
<span id="cb32-9"><a href="multilevel-regression-with-post-stratification.html#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="multilevel-regression-with-post-stratification.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(states_names_and_abbrevs)</span>
<span id="cb32-11"><a href="multilevel-regression-with-post-stratification.html#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="multilevel-regression-with-post-stratification.html#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Make lowercase to match IPUMS data</span></span>
<span id="cb32-13"><a href="multilevel-regression-with-post-stratification.html#cb32-13" aria-hidden="true" tabindex="-1"></a>nationscape_data <span class="ot">&lt;-</span> </span>
<span id="cb32-14"><a href="multilevel-regression-with-post-stratification.html#cb32-14" aria-hidden="true" tabindex="-1"></a>  nationscape_data <span class="sc">%&gt;%</span> </span>
<span id="cb32-15"><a href="multilevel-regression-with-post-stratification.html#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stateicp =</span> <span class="fu">tolower</span>(stateicp))</span>
<span id="cb32-16"><a href="multilevel-regression-with-post-stratification.html#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="multilevel-regression-with-post-stratification.html#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs with DC</span></span>
<span id="cb32-18"><a href="multilevel-regression-with-post-stratification.html#cb32-18" aria-hidden="true" tabindex="-1"></a>nationscape_data<span class="sc">$</span>stateicp <span class="ot">&lt;-</span> </span>
<span id="cb32-19"><a href="multilevel-regression-with-post-stratification.html#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(nationscape_data<span class="sc">$</span>stateicp, <span class="st">&quot;district of columbia&quot;</span>)</span>
<span id="cb32-20"><a href="multilevel-regression-with-post-stratification.html#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="multilevel-regression-with-post-stratification.html#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy the class</span></span>
<span id="cb32-22"><a href="multilevel-regression-with-post-stratification.html#cb32-22" aria-hidden="true" tabindex="-1"></a>nationscape_data <span class="ot">&lt;-</span> </span>
<span id="cb32-23"><a href="multilevel-regression-with-post-stratification.html#cb32-23" aria-hidden="true" tabindex="-1"></a>  nationscape_data <span class="sc">%&gt;%</span> </span>
<span id="cb32-24"><a href="multilevel-regression-with-post-stratification.html#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(gender, stateicp, education_level, age_group), as_factor))</span>
<span id="cb32-25"><a href="multilevel-regression-with-post-stratification.html#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="multilevel-regression-with-post-stratification.html#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Save data</span></span>
<span id="cb32-27"><a href="multilevel-regression-with-post-stratification.html#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(nationscape_data, <span class="st">&quot;outputs/data/polling_data.csv&quot;</span>)</span>
<span id="cb32-28"><a href="multilevel-regression-with-post-stratification.html#cb32-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-29"><a href="multilevel-regression-with-post-stratification.html#cb32-29" aria-hidden="true" tabindex="-1"></a>nationscape_data <span class="sc">%&gt;%</span> </span>
<span id="cb32-30"><a href="multilevel-regression-with-post-stratification.html#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   gender state vote_biden age_group      education_level          stateicp     
##   &lt;fct&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;fct&gt;          &lt;fct&gt;                    &lt;fct&gt;        
## 1 female WI             0 age_45-59      Post secondary or higher wisconsin    
## 2 female VA             0 age_45-59      Post secondary or higher virginia     
## 3 female TX             0 age_60_or_more High school or less      texas        
## 4 female WA             0 age_45-59      High school or less      washington   
## 5 female MA             1 age_18-29      Some post secondary      massachusetts
## 6 female TX             1 age_30-44      Some post secondary      texas</code></pre>
</div>
<div id="post-stratification-data" class="section level3" number="16.5.2">
<h3><span class="header-section-number">16.5.2</span> Post-stratification data</h3>
<p>We have a lot of options for a dataset to post-stratify by and there are various considerations. We are after a dataset that is better quality (however that is to be defined), and likely larger. From a strictly data perspective, the best choice would probably be something like the Cooperative Congressional Election Study (CCES), however for whatever reason that is only released after the election and so it’s not a reasonable choice. <span class="citation"><a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">Wang et al.</a> (<a href="references-1.html#ref-wang2015forecasting" role="doc-biblioref">2015</a>)</span> use exit poll data, but again that’s only available after the election.</p>
<p>In most countries we’d be stuck using the census, which is of course quite large, but likely out-of-date. Luckily in the US we have the opportunity to use the American Community Survey (ACS) which asks analogous questions to a census, is conducted every month, and over the course of a year, we end up with a few million responses. In this case we’re going to access the ACS through IPUMS.</p>
<p>To do this go to the IPUMS website - <a href="https://ipums.org" class="uri">https://ipums.org</a> - and we’re looking for something like IPUMS USA and then ‘get data.’ Create an account, if you need to. That’ll take a while to process. But once you have an account, go to ‘Select Samples’ and de-select everything apart from the 2019 ACS. Then we need to get the variables that we’re interested in. From the household we want ‘STATEICP,’ then in person we want ‘SEX,’ ‘AGE,’ ‘EDUC.’ Once everything is selected, ‘view cart,’ and we want to be careful to change the ‘data format’ to ‘.dta’ (there’s nothing wrong with the other formats, but we’ve just already got code earlier to deal with that type). Briefly just check how many rows and columns you’re requesting. It should be around a million rows, and around ten to twenty columns. If it’s much more than 300MB then maybe just see if you’ve accidently selected something that you don’t need. Submit the request and within a day, you should get an email saying that your data can be downloaded. It should only take 30 minutes or so, but if you don’t get an email within a day then check again the size of the dataset, and customize the sample size to reduce the size initially.</p>
<p>In any case let’s tidy up the data.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="multilevel-regression-with-post-stratification.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, closely following code from Alen Mitrovski, Xiaoyan Yang, and Matthew Wankiewicz.</span></span>
<span id="cb34-2"><a href="multilevel-regression-with-post-stratification.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb34-3"><a href="multilevel-regression-with-post-stratification.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb34-4"><a href="multilevel-regression-with-post-stratification.html#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="multilevel-regression-with-post-stratification.html#cb34-5" aria-hidden="true" tabindex="-1"></a>raw_poststrat_data <span class="ot">&lt;-</span> </span>
<span id="cb34-6"><a href="multilevel-regression-with-post-stratification.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_dta</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;dont_push/usa_00004.dta&quot;</span>))</span>
<span id="cb34-7"><a href="multilevel-regression-with-post-stratification.html#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="multilevel-regression-with-post-stratification.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The Stata format separates labels so reunite those</span></span>
<span id="cb34-9"><a href="multilevel-regression-with-post-stratification.html#cb34-9" aria-hidden="true" tabindex="-1"></a>raw_poststrat_data <span class="ot">&lt;-</span> </span>
<span id="cb34-10"><a href="multilevel-regression-with-post-stratification.html#cb34-10" aria-hidden="true" tabindex="-1"></a>  labelled<span class="sc">::</span><span class="fu">to_factor</span>(raw_poststrat_data)</span>
<span id="cb34-11"><a href="multilevel-regression-with-post-stratification.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw_poststrat_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 28
##   year  sample serial cbserial  hhwt cluster region stateicp strata gq    pernum
##   &lt;fct&gt; &lt;fct&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt;  &lt;dbl&gt;
## 1 2018  2018 …      2  2.02e12 392.  2.02e12 east … alabama  190001 othe…      1
## 2 2018  2018 …      7  2.02e12  94.1 2.02e12 east … alabama   40001 grou…      1
## 3 2018  2018 …     13  2.02e12  83.7 2.02e12 east … alabama  130301 othe…      1
## 4 2018  2018 …     18  2.02e12  57.5 2.02e12 east … alabama  100001 grou…      1
## 5 2018  2018 …     23  2.02e12 157.  2.02e12 east … alabama  190001 grou…      1
## 6 2018  2018 …     28  2.02e12 157.  2.02e12 east … alabama  220001 othe…      1
## # … with 17 more variables: perwt &lt;dbl&gt;, sex &lt;fct&gt;, age &lt;fct&gt;, marst &lt;fct&gt;,
## #   race &lt;fct&gt;, raced &lt;fct&gt;, hispan &lt;fct&gt;, hispand &lt;fct&gt;, bpl &lt;fct&gt;,
## #   bpld &lt;fct&gt;, citizen &lt;fct&gt;, educ &lt;fct&gt;, educd &lt;fct&gt;, empstat &lt;fct&gt;,
## #   empstatd &lt;fct&gt;, labforce &lt;fct&gt;, inctot &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="multilevel-regression-with-post-stratification.html#cb36-1" aria-hidden="true" tabindex="-1"></a>raw_poststrat_data<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(raw_poststrat_data<span class="sc">$</span>age)</span>
<span id="cb36-2"><a href="multilevel-regression-with-post-stratification.html#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="multilevel-regression-with-post-stratification.html#cb36-3" aria-hidden="true" tabindex="-1"></a>poststrat_data <span class="ot">&lt;-</span> </span>
<span id="cb36-4"><a href="multilevel-regression-with-post-stratification.html#cb36-4" aria-hidden="true" tabindex="-1"></a>  raw_poststrat_data <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="multilevel-regression-with-post-stratification.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(inctot <span class="sc">&lt;</span> <span class="dv">9999999</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="multilevel-regression-with-post-stratification.html#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="multilevel-regression-with-post-stratification.html#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> sex) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="multilevel-regression-with-post-stratification.html#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-9"><a href="multilevel-regression-with-post-stratification.html#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">case_when</span>( <span class="co"># case_when works in order and exits when there&#39;s a match</span></span>
<span id="cb36-10"><a href="multilevel-regression-with-post-stratification.html#cb36-10" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;=</span> <span class="dv">29</span> <span class="sc">~</span> <span class="st">&#39;age_18-29&#39;</span>,</span>
<span id="cb36-11"><a href="multilevel-regression-with-post-stratification.html#cb36-11" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;=</span> <span class="dv">44</span> <span class="sc">~</span> <span class="st">&#39;age_30-44&#39;</span>,</span>
<span id="cb36-12"><a href="multilevel-regression-with-post-stratification.html#cb36-12" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">&#39;age_45-59&#39;</span>,</span>
<span id="cb36-13"><a href="multilevel-regression-with-post-stratification.html#cb36-13" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">&#39;age_60_or_more&#39;</span>,</span>
<span id="cb36-14"><a href="multilevel-regression-with-post-stratification.html#cb36-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;Trouble&#39;</span></span>
<span id="cb36-15"><a href="multilevel-regression-with-post-stratification.html#cb36-15" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb36-16"><a href="multilevel-regression-with-post-stratification.html#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">education_level =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-17"><a href="multilevel-regression-with-post-stratification.html#cb36-17" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;nursery school, preschool&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-18"><a href="multilevel-regression-with-post-stratification.html#cb36-18" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;kindergarten&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-19"><a href="multilevel-regression-with-post-stratification.html#cb36-19" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 1&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-20"><a href="multilevel-regression-with-post-stratification.html#cb36-20" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 2&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-21"><a href="multilevel-regression-with-post-stratification.html#cb36-21" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 3&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-22"><a href="multilevel-regression-with-post-stratification.html#cb36-22" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 4&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-23"><a href="multilevel-regression-with-post-stratification.html#cb36-23" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 5&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-24"><a href="multilevel-regression-with-post-stratification.html#cb36-24" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 6&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-25"><a href="multilevel-regression-with-post-stratification.html#cb36-25" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 7&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-26"><a href="multilevel-regression-with-post-stratification.html#cb36-26" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 8&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-27"><a href="multilevel-regression-with-post-stratification.html#cb36-27" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 9&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-28"><a href="multilevel-regression-with-post-stratification.html#cb36-28" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 10&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-29"><a href="multilevel-regression-with-post-stratification.html#cb36-29" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;grade 11&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-30"><a href="multilevel-regression-with-post-stratification.html#cb36-30" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;12th grade, no diploma&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-31"><a href="multilevel-regression-with-post-stratification.html#cb36-31" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;regular high school diploma&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-32"><a href="multilevel-regression-with-post-stratification.html#cb36-32" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;ged or alternative credential&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-33"><a href="multilevel-regression-with-post-stratification.html#cb36-33" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;some college, but less than 1 year&quot;</span> <span class="sc">~</span> <span class="st">&quot;Some post secondary&quot;</span>,</span>
<span id="cb36-34"><a href="multilevel-regression-with-post-stratification.html#cb36-34" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;1 or more years of college credit, no degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Some post secondary&quot;</span>,</span>
<span id="cb36-35"><a href="multilevel-regression-with-post-stratification.html#cb36-35" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;associate&#39;s degree, type not specified&quot;</span> <span class="sc">~</span> <span class="st">&quot;Post secondary or higher&quot;</span>,</span>
<span id="cb36-36"><a href="multilevel-regression-with-post-stratification.html#cb36-36" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;bachelor&#39;s degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Post secondary or higher&quot;</span>,</span>
<span id="cb36-37"><a href="multilevel-regression-with-post-stratification.html#cb36-37" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;master&#39;s degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Graduate degree&quot;</span>,</span>
<span id="cb36-38"><a href="multilevel-regression-with-post-stratification.html#cb36-38" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;professional degree beyond a bachelor&#39;s degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Graduate degree&quot;</span>,</span>
<span id="cb36-39"><a href="multilevel-regression-with-post-stratification.html#cb36-39" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;doctoral degree&quot;</span> <span class="sc">~</span> <span class="st">&quot;Graduate degree&quot;</span>,</span>
<span id="cb36-40"><a href="multilevel-regression-with-post-stratification.html#cb36-40" aria-hidden="true" tabindex="-1"></a>      educd <span class="sc">==</span> <span class="st">&quot;no schooling completed&quot;</span> <span class="sc">~</span> <span class="st">&quot;High school or less&quot;</span>,</span>
<span id="cb36-41"><a href="multilevel-regression-with-post-stratification.html#cb36-41" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&#39;Trouble&#39;</span></span>
<span id="cb36-42"><a href="multilevel-regression-with-post-stratification.html#cb36-42" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb36-43"><a href="multilevel-regression-with-post-stratification.html#cb36-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-44"><a href="multilevel-regression-with-post-stratification.html#cb36-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-45"><a href="multilevel-regression-with-post-stratification.html#cb36-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Just keep relevant variables</span></span>
<span id="cb36-46"><a href="multilevel-regression-with-post-stratification.html#cb36-46" aria-hidden="true" tabindex="-1"></a>poststrat_data <span class="ot">&lt;-</span> </span>
<span id="cb36-47"><a href="multilevel-regression-with-post-stratification.html#cb36-47" aria-hidden="true" tabindex="-1"></a>  poststrat_data <span class="sc">%&gt;%</span> </span>
<span id="cb36-48"><a href="multilevel-regression-with-post-stratification.html#cb36-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(gender,</span>
<span id="cb36-49"><a href="multilevel-regression-with-post-stratification.html#cb36-49" aria-hidden="true" tabindex="-1"></a>         age_group,</span>
<span id="cb36-50"><a href="multilevel-regression-with-post-stratification.html#cb36-50" aria-hidden="true" tabindex="-1"></a>         education_level,</span>
<span id="cb36-51"><a href="multilevel-regression-with-post-stratification.html#cb36-51" aria-hidden="true" tabindex="-1"></a>         stateicp)</span>
<span id="cb36-52"><a href="multilevel-regression-with-post-stratification.html#cb36-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-53"><a href="multilevel-regression-with-post-stratification.html#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy the class</span></span>
<span id="cb36-54"><a href="multilevel-regression-with-post-stratification.html#cb36-54" aria-hidden="true" tabindex="-1"></a>poststrat_data <span class="ot">&lt;-</span> </span>
<span id="cb36-55"><a href="multilevel-regression-with-post-stratification.html#cb36-55" aria-hidden="true" tabindex="-1"></a>  poststrat_data <span class="sc">%&gt;%</span> </span>
<span id="cb36-56"><a href="multilevel-regression-with-post-stratification.html#cb36-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(gender, stateicp, education_level, age_group), as_factor))</span>
<span id="cb36-57"><a href="multilevel-regression-with-post-stratification.html#cb36-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-58"><a href="multilevel-regression-with-post-stratification.html#cb36-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Save data</span></span>
<span id="cb36-59"><a href="multilevel-regression-with-post-stratification.html#cb36-59" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(poststrat_data, <span class="st">&quot;outputs/data/us_poststrat.csv&quot;</span>)</span>
<span id="cb36-60"><a href="multilevel-regression-with-post-stratification.html#cb36-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-61"><a href="multilevel-regression-with-post-stratification.html#cb36-61" aria-hidden="true" tabindex="-1"></a>poststrat_data <span class="sc">%&gt;%</span> </span>
<span id="cb36-62"><a href="multilevel-regression-with-post-stratification.html#cb36-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   gender age_group      education_level     stateicp
##   &lt;fct&gt;  &lt;fct&gt;          &lt;fct&gt;               &lt;fct&gt;   
## 1 female age_18-29      Some post secondary alabama 
## 2 female age_60_or_more Some post secondary alabama 
## 3 male   age_45-59      Some post secondary alabama 
## 4 male   age_30-44      High school or less alabama 
## 5 female age_60_or_more High school or less alabama 
## 6 male   age_30-44      High school or less alabama</code></pre>
<p>This dataset is on an individual level. So we’ll create counts of each sub-cell, and then proportions by state.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="multilevel-regression-with-post-stratification.html#cb38-1" aria-hidden="true" tabindex="-1"></a>poststrat_data_cells <span class="ot">&lt;-</span> </span>
<span id="cb38-2"><a href="multilevel-regression-with-post-stratification.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  poststrat_data <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="multilevel-regression-with-post-stratification.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stateicp, gender, age_group, education_level) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="multilevel-regression-with-post-stratification.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<p>Now we’d like to add proportions by state.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="multilevel-regression-with-post-stratification.html#cb39-1" aria-hidden="true" tabindex="-1"></a>poststrat_data_cells <span class="ot">&lt;-</span> </span>
<span id="cb39-2"><a href="multilevel-regression-with-post-stratification.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  poststrat_data_cells <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="multilevel-regression-with-post-stratification.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stateicp) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="multilevel-regression-with-post-stratification.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="multilevel-regression-with-post-stratification.html#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
</div>
<div id="model-3" class="section level3" number="16.5.3">
<h3><span class="header-section-number">16.5.3</span> Model</h3>
<p>We’re going to use logistic regression to estimate a model where the binary of support for Biden is explained by gender, age-group, education-level, and state. We’re going to do this in a Bayesian framework using <code>rstanarm</code> <span class="citation">(<a href="references-1.html#ref-citerstanarm" role="doc-biblioref">Goodrich et al. 2020</a>)</span>. There are a variety of reasons for using <code>rstanarm</code> here, but the main one is that Stan is pre-compiled which eases some of the computer set-up issues that we may otherwise have. A great further resource about implementing MRP with <code>rstanarm</code> is <span class="citation"><a href="references-1.html#ref-kennedygabry2020" role="doc-biblioref">Kennedy and Gabry</a> (<a href="references-1.html#ref-kennedygabry2020" role="doc-biblioref">2020</a>)</span>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="multilevel-regression-with-post-stratification.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb40-2"><a href="multilevel-regression-with-post-stratification.html#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="multilevel-regression-with-post-stratification.html#cb40-3" aria-hidden="true" tabindex="-1"></a>us_election_model <span class="ot">&lt;-</span> </span>
<span id="cb40-4"><a href="multilevel-regression-with-post-stratification.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  rstanarm<span class="sc">::</span><span class="fu">stan_glmer</span>(vote_biden <span class="sc">~</span> gender <span class="sc">+</span> age_group <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> stateicp) <span class="sc">+</span> education_level,</span>
<span id="cb40-5"><a href="multilevel-regression-with-post-stratification.html#cb40-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> nationscape_data,</span>
<span id="cb40-6"><a href="multilevel-regression-with-post-stratification.html#cb40-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>),</span>
<span id="cb40-7"><a href="multilevel-regression-with-post-stratification.html#cb40-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">prior =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb40-8"><a href="multilevel-regression-with-post-stratification.html#cb40-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb40-9"><a href="multilevel-regression-with-post-stratification.html#cb40-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cores =</span> <span class="dv">2</span>, </span>
<span id="cb40-10"><a href="multilevel-regression-with-post-stratification.html#cb40-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seed =</span> <span class="dv">853</span>)</span></code></pre></div>
<p>There are a variety of options here that we’ve largely unthinkingly set, and exploring the effect of these would be a good idea, but for now we can just have a quick look at the model.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="multilevel-regression-with-post-stratification.html#cb41-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">get_estimates</span>(us_election_model)</span></code></pre></div>
<pre><code>##                                 term    estimate conf.level    conf.low
## 1                        (Intercept)  0.27591651       0.95  0.10322566
## 8                         gendermale -0.54094841       0.95 -0.65227570
## 4            age_groupage_60_or_more  0.04886803       0.95 -0.10847716
## 2                 age_groupage_18-29  0.87817445       0.95  0.69830955
## 3                 age_groupage_30-44  0.12455081       0.95 -0.02530517
## 6 education_levelHigh school or less -0.35080948       0.95 -0.51262507
## 7 education_levelSome post secondary -0.14970941       0.95 -0.29927232
## 5     education_levelGraduate degree -0.21988079       0.95 -0.38172115
##      conf.high      pd rope.percentage      rhat      ess prior.distribution
## 1  0.447878764 0.99850         0.14900 1.0002399 2262.704             normal
## 8 -0.430121742 1.00000         0.00000 0.9996776 5264.121             normal
## 4  0.200831286 0.72600         0.94775 0.9998468 3726.472             normal
## 2  1.061899702 1.00000         0.00000 0.9997188 3931.709             normal
## 3  0.284994549 0.94125         0.76300 0.9995061 3567.152             normal
## 6 -0.204222132 1.00000         0.01675 0.9997706 3700.321             normal
## 7  0.006135831 0.96625         0.67125 1.0005471 4090.628             normal
## 5 -0.036764485 0.99100         0.32875 0.9999286 4589.040             normal
##   prior.location prior.scale
## 1              0           1
## 8              0           1
## 4              0           1
## 2              0           1
## 3              0           1
## 6              0           1
## 7              0           1
## 5              0           1</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="multilevel-regression-with-post-stratification.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The default usage of modelsummary requires statistics that we don&#39;t have.</span></span>
<span id="cb43-2"><a href="multilevel-regression-with-post-stratification.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment the following line if you want to look at what is available and specify your own:</span></span>
<span id="cb43-3"><a href="multilevel-regression-with-post-stratification.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># modelsummary::get_estimates(us_election_model)</span></span>
<span id="cb43-4"><a href="multilevel-regression-with-post-stratification.html#cb43-4" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(us_election_model,</span>
<span id="cb43-5"><a href="multilevel-regression-with-post-stratification.html#cb43-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">statistic =</span> <span class="fu">c</span>(<span class="st">&#39;conf.low&#39;</span>, <span class="st">&#39;conf.high&#39;</span>)</span>
<span id="cb43-6"><a href="multilevel-regression-with-post-stratification.html#cb43-6" aria-hidden="true" tabindex="-1"></a>                            )</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:center;">
0.276
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.103)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.448)
</td>
</tr>
<tr>
<td style="text-align:left;">
gendermale
</td>
<td style="text-align:center;">
-0.541
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(-0.652)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(-0.430)
</td>
</tr>
<tr>
<td style="text-align:left;">
age_groupage_60_or_more
</td>
<td style="text-align:center;">
0.049
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(-0.108)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.201)
</td>
</tr>
<tr>
<td style="text-align:left;">
age_groupage_18-29
</td>
<td style="text-align:center;">
0.878
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.698)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(1.062)
</td>
</tr>
<tr>
<td style="text-align:left;">
age_groupage_30-44
</td>
<td style="text-align:center;">
0.125
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(-0.025)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.285)
</td>
</tr>
<tr>
<td style="text-align:left;">
education_levelHigh school or less
</td>
<td style="text-align:center;">
-0.351
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(-0.513)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(-0.204)
</td>
</tr>
<tr>
<td style="text-align:left;">
education_levelSome post secondary
</td>
<td style="text-align:center;">
-0.150
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(-0.299)
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.006)
</td>
</tr>
<tr>
<td style="text-align:left;">
education_levelGraduate degree
</td>
<td style="text-align:center;">
-0.220
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(-0.382)
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(-0.037)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
5200
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.057
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Marg.
</td>
<td style="text-align:center;">
0.045
</td>
</tr>
<tr>
<td style="text-align:left;">
elpd
</td>
<td style="text-align:center;">
-3468.042
</td>
</tr>
<tr>
<td style="text-align:left;">
elpd.se
</td>
<td style="text-align:center;">
16.412
</td>
</tr>
<tr>
<td style="text-align:left;">
looic
</td>
<td style="text-align:center;">
6936.085
</td>
</tr>
<tr>
<td style="text-align:left;">
looic.se
</td>
<td style="text-align:center;">
32.824
</td>
</tr>
<tr>
<td style="text-align:left;">
waic
</td>
<td style="text-align:center;">
6935.994
</td>
</tr>
</tbody>
</table>
</div>
<div id="post-stratify-2" class="section level3" number="16.5.4">
<h3><span class="header-section-number">16.5.4</span> Post-stratify</h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="multilevel-regression-with-post-stratification.html#cb44-1" aria-hidden="true" tabindex="-1"></a>biden_support_by_state <span class="ot">&lt;-</span> </span>
<span id="cb44-2"><a href="multilevel-regression-with-post-stratification.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  us_election_model <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="multilevel-regression-with-post-stratification.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">add_fitted_draws</span>(<span class="at">newdata=</span>poststrat_data_cells) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="multilevel-regression-with-post-stratification.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">support_biden_predict =</span> .value) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="multilevel-regression-with-post-stratification.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">support_biden_predict_prop =</span> support_biden_predict<span class="sc">*</span>prop) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="multilevel-regression-with-post-stratification.html#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stateicp, .draw) <span class="sc">%&gt;%</span> </span>
<span id="cb44-7"><a href="multilevel-regression-with-post-stratification.html#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">support_biden_predict =</span> <span class="fu">sum</span>(support_biden_predict_prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="multilevel-regression-with-post-stratification.html#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stateicp) <span class="sc">%&gt;%</span> </span>
<span id="cb44-9"><a href="multilevel-regression-with-post-stratification.html#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(support_biden_predict), </span>
<span id="cb44-10"><a href="multilevel-regression-with-post-stratification.html#cb44-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower =</span> <span class="fu">quantile</span>(support_biden_predict, <span class="fl">0.025</span>), </span>
<span id="cb44-11"><a href="multilevel-regression-with-post-stratification.html#cb44-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">upper =</span> <span class="fu">quantile</span>(support_biden_predict, <span class="fl">0.975</span>))</span></code></pre></div>
<p>And we can have a look at our estimates, if we like.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="multilevel-regression-with-post-stratification.html#cb45-1" aria-hidden="true" tabindex="-1"></a>biden_support_by_state <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="multilevel-regression-with-post-stratification.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">x =</span> stateicp, <span class="at">color =</span> <span class="st">&quot;MRP estimate&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb45-3"><a href="multilevel-regression-with-post-stratification.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb45-4"><a href="multilevel-regression-with-post-stratification.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">width =</span> <span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb45-5"><a href="multilevel-regression-with-post-stratification.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> </span>
<span id="cb45-6"><a href="multilevel-regression-with-post-stratification.html#cb45-6" aria-hidden="true" tabindex="-1"></a>               nationscape_data <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="multilevel-regression-with-post-stratification.html#cb45-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(stateicp, vote_biden) <span class="sc">%&gt;%</span></span>
<span id="cb45-8"><a href="multilevel-regression-with-post-stratification.html#cb45-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb45-9"><a href="multilevel-regression-with-post-stratification.html#cb45-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(stateicp) <span class="sc">%&gt;%</span> </span>
<span id="cb45-10"><a href="multilevel-regression-with-post-stratification.html#cb45-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-11"><a href="multilevel-regression-with-post-stratification.html#cb45-11" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(vote_biden<span class="sc">==</span><span class="dv">1</span>), </span>
<span id="cb45-12"><a href="multilevel-regression-with-post-stratification.html#cb45-12" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> prop, <span class="at">x =</span> stateicp, <span class="at">color =</span> <span class="st">&#39;Nationscape raw data&#39;</span>)) <span class="sc">+</span></span>
<span id="cb45-13"><a href="multilevel-regression-with-post-stratification.html#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="sc">+</span></span>
<span id="cb45-14"><a href="multilevel-regression-with-post-stratification.html#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;State&#39;</span>,</span>
<span id="cb45-15"><a href="multilevel-regression-with-post-stratification.html#cb45-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;Estimated proportion support for Biden&#39;</span>,</span>
<span id="cb45-16"><a href="multilevel-regression-with-post-stratification.html#cb45-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&#39;Source&#39;</span>) <span class="sc">+</span></span>
<span id="cb45-17"><a href="multilevel-regression-with-post-stratification.html#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb45-18"><a href="multilevel-regression-with-post-stratification.html#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&#39;Set1&#39;</span>) <span class="sc">+</span></span>
<span id="cb45-19"><a href="multilevel-regression-with-post-stratification.html#cb45-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<!-- ## Case study - Self-reported abortion incidence in Uganda -->
<!-- **By Monica Alexander** -->
<!-- This document goes through a worked example of multilevel regression and post-stratification to get estimates of self-reported abortion incidence in Uganda. The data used are the 2018 PMA survey and the 2014 Census. Both datasets were obtained through IPUMS.  -->
<!-- ### Load in data and tidy up  -->
<!-- Load in the packages: -->
<!-- ```{r} -->
<!-- library(tidyverse) -->
<!-- library(here) -->
<!-- library(brms) -->
<!-- library(tidybayes) -->
<!-- ``` -->
<!-- #### PMA -->
<!-- Load in the PMA data and make an age category variable: -->
<!-- ```{r} -->
<!-- d <- read_csv(here::here("inputs/data/pma.csv")) -->
<!-- d <- d %>% filter(age>14, age<50) -->
<!-- age_groups <- seq(15, 45, by = 5) -->
<!-- d$age_group <- as.numeric(as.character(cut(d$age,  -->
<!--                                            breaks= c(age_groups, Inf),  -->
<!--                                            labels = age_groups,  -->
<!--                                            right = FALSE))) -->
<!-- d <- d %>% mutate(age_group = factor(age_group)) %>%  -->
<!--   mutate(age_group = fct_relevel(age_group, "35", after = 0)) -->
<!-- ``` -->
<!-- Create a new `region_2` variable with slightly bigger regions (that match the census data): -->
<!-- ```{r} -->
<!-- d <- d %>% mutate(region_2 = case_when(region == "north"|region== "karamoja"|region == "west nile" ~ "northern", -->
<!--                                        region == "eastern" ~ "eastern", -->
<!--                                        region == "central 1"|region == "central 2"|region == "east central"|region == "kampala" ~ "central", -->
<!--                                        region == "western"|region == "south west" ~ "western")) -->
<!-- ``` -->
<!-- #### Census -->
<!-- Load in the data, select the columns we want and make an age category variable: -->
<!-- ```{r} -->
<!-- dc <- haven::read_dta(here::here("inputs/data/uganda_census.dta")) -->
<!-- dc <- dc %>%  -->
<!--   select(regnug, perwt, age, marst, edattain) %>%  -->
<!--   mutate(regnug = as_factor(regnug), -->
<!--          marst = as_factor(marst), -->
<!--          edattain = as_factor(edattain)) -->
<!-- dc <- dc %>% filter(age>14, age<50) -->
<!-- dc$age_group <- as.numeric(as.character(cut(dc$age,  -->
<!--                                            breaks= c(age_groups, Inf),  -->
<!--                                            labels = age_groups,  -->
<!--                                            right = FALSE))) -->
<!-- dc <- dc %>% mutate(age_group = factor(age_group)) %>%  -->
<!--   mutate(age_group = fct_relevel(age_group, "35", after = 0)) -->
<!-- ``` -->
<!-- #### Recode education and marital status -->
<!-- The PMA and census have different education and marital status categories. Let's recode so they are the same: -->
<!-- ```{r} -->
<!-- # EDUCATION -->
<!-- #table(d$educattgen) -->
<!-- #table(dc$edattain) -->
<!-- d <- d %>% mutate(educ = case_when(educattgen=="never attended"~"less than primary", -->
<!--                                    educattgen=="primary/middle school" ~"primary", -->
<!--                                    educattgen=="secondary/post-primary"|educattgen=="tertiary/post-secondary" ~ "more than primary", -->
<!--                                    TRUE ~ "NA")) %>%  -->
<!--   filter(educ != "NA", marstat!="no response or missing") -->
<!-- dc <- dc %>% mutate(educ = case_when(edattain=="less than primary completed"~"less than primary", -->
<!--                                      edattain=="primary completed"~ "primary", -->
<!--                                      edattain=="secondary completed"|edattain=="university completed" ~ "more than primary", -->
<!--                                      TRUE ~ "NA")) %>%  -->
<!--   filter(educ !="NA") -->
<!-- ## MARITAL STATUS -->
<!-- #table(d$marstat) -->
<!-- #table(dc$marst) -->
<!-- d <- d %>% mutate(marital = case_when(marstat == "never married" ~ "single/never married", -->
<!--                                       marstat == "currently living with partner"| marstat == "currently married" ~ "married/in union", -->
<!--                                       marstat== "divorced or separated" ~ "divorced/separated", -->
<!--                                       marstat== "widow or widower"~ "widowed", -->
<!--                                       TRUE ~ "NA")) -->
<!-- dc <- dc %>% mutate(marital = case_when(marst == "single/never married" ~ "single/never married", -->
<!--                                         marst == "married/in union" ~ "married/in union", -->
<!--                                         marst== "separated/divorced/spouse absent" ~ "divorced/separated", -->
<!--                                         marst== "widowed"~ "widowed", -->
<!--                                       TRUE ~ "NA")) %>%  -->
<!--   filter(marital != "NA") -->
<!-- ``` -->
<!-- ### Plot data -->
<!-- Lets calculate the census population by key subgroups: -->
<!-- ```{r} -->
<!-- census_counts <- dc %>%  -->
<!--   group_by(regnug, marital, educ, age_group) %>%  -->
<!--   summarize(n = sum(perwt)) %>%  -->
<!--   filter(age_group!="45") %>%  -->
<!--   rename(region_2 = regnug) -->
<!-- ``` -->
<!-- We can get an idea of differences in population distributions by plotting the PMA and census proportions by different variables: -->
<!-- ```{r} -->
<!-- d %>%  -->
<!--   group_by(age_group) %>%  -->
<!--   tally() %>%  -->
<!--   mutate(pma = n/sum(n)) %>%  -->
<!--   left_join(census_counts %>%  -->
<!--               group_by(age_group) %>%  -->
<!--               summarize(n = sum(n)) %>%  -->
<!--               mutate(census = n/sum(n)) %>%  -->
<!--               select(-n)) %>%  -->
<!--   mutate(age_group = as.character(age_group)) %>%  -->
<!--   arrange(age_group) %>%  -->
<!--   pivot_longer(pma:census) %>%  -->
<!--   ggplot(aes(age_group, value, fill = name)) + geom_bar(stat = "identity", position = 'dodge')+ -->
<!--   theme_bw(base_size = 14) +  -->
<!--   labs( x = "age", y = "proportion", title = "Proportion by age group")+ -->
<!--   scale_fill_brewer(palette = "Set1", name = "source") -->
<!-- d %>%  -->
<!--   group_by(educ) %>%  -->
<!--   tally() %>%  -->
<!--   mutate(pma = n/sum(n)) %>%  -->
<!--   left_join(census_counts %>%  -->
<!--               group_by(educ) %>%  -->
<!--               summarize(n = sum(n)) %>%  -->
<!--               mutate(census = n/sum(n)) %>%  -->
<!--               select(-n)) %>%  -->
<!--   mutate(educ = fct_relevel(educ, "more than primary", after = 2)) %>%  -->
<!--   pivot_longer(pma:census) %>%  -->
<!--   ggplot(aes(educ, value, fill = name)) + geom_bar(stat = "identity", position = 'dodge')+ -->
<!--   theme_bw(base_size = 14) +  -->
<!--   labs( x = "education", y = "proportion", title = "Proportion by education")+ -->
<!--   scale_fill_brewer(palette = "Set1", name = "source") -->
<!-- d %>%  -->
<!--   group_by(region_2) %>%  -->
<!--   tally() %>%  -->
<!--   mutate(pma = n/sum(n)) %>%  -->
<!--   left_join(census_counts %>%  -->
<!--               group_by(region_2) %>%  -->
<!--               summarize(n = sum(n)) %>%  -->
<!--               mutate(census = n/sum(n)) %>%  -->
<!--               select(-n)) %>%  -->
<!--   pivot_longer(pma:census) %>%  -->
<!--   ggplot(aes(region_2, value, fill = name)) + geom_bar(stat = "identity", position = 'dodge')+ -->
<!--   theme_bw(base_size = 14) +  -->
<!--   labs( x = "region", y = "proportion", title = "Proportion by region")+ -->
<!--   scale_fill_brewer(palette = "Set1", name = "source") -->
<!-- d %>%  -->
<!--   group_by(marital) %>%  -->
<!--   tally() %>%  -->
<!--   mutate(pma = n/sum(n)) %>%  -->
<!--   left_join(census_counts %>%  -->
<!--               group_by(marital) %>%  -->
<!--               summarize(n = sum(n)) %>%  -->
<!--               mutate(census = n/sum(n)) %>%  -->
<!--               select(-n)) %>%  -->
<!--   pivot_longer(pma:census) %>%  -->
<!--   ggplot(aes(marital, value, fill = name)) + geom_bar(stat = "identity", position = 'dodge')+ -->
<!--   theme_bw(base_size = 14) +  -->
<!--   labs( x = "marital status", y = "proportion", title = "Proportion by marital status")+ -->
<!--   scale_fill_brewer(palette = "Set1", name = "source")+coord_flip() -->
<!-- ``` -->
<!-- ### Multilevel regression -->
<!-- Let's run a logistic regression of whether or not an individual reported ever having an abortion with covariates education, age group, and region modelled hierarchically -->
<!-- #### Run the model -->
<!-- ```{r} -->
<!-- mod <- brm(abortion ~ (1|region_2)+educ+ marital +age_group, data = d, family = "bernoulli", silent = TRUE, refresh = 0) -->
<!-- summary(mod) -->
<!-- # optional: cf to lme4 -->
<!-- #summary(lme4::glmer(abortion ~ (1|region_2)+marital+educ+ age_group, data = d, family = "binomial")) -->
<!-- ``` -->
<!-- #### Get estimated proportions of abortion incidence -->
<!-- Now we need to get the estimated proportions of abortion incidence by each subpopulation of interest. (i.e. by region, marital status, education and age group). First, initiate a tibble with all possible combinations: -->
<!-- ```{r} -->
<!-- regions <- unique(d$region_2) -->
<!-- marital_groups <- unique(d$marital) -->
<!-- educ_groups  <- unique(d$educ) -->
<!-- pred_df <- tibble(region_2 = NA, marital = NA, educ = NA, age_group = NA) %>%  -->
<!--   tidyr::complete(region_2 = regions,  -->
<!--                   marital = marital_groups, -->
<!--                   educ = educ_groups,  -->
<!--                   age_group = age_groups) %>%  -->
<!--   mutate_all(.funs = funs(as_factor(.))) %>%  -->
<!--   drop_na() %>%  -->
<!--   mutate(age_group = fct_relevel(age_group, "35", after = 0)) %>%  -->
<!--   filter(age_group != "45") -->
<!-- ``` -->
<!-- We can use the `fitted_draws` function to obtain posterior samples of the estimated proportion of women reporting an abortion by each group: -->
<!-- ```{r} -->
<!-- pred_probs_draws <- mod %>%  -->
<!--   fitted_draws(pred_df  %>%  -->
<!--                     select(region_2:age_group) %>%  -->
<!--                     mutate(age_group = factor(age_group, levels = age_groups[-length(age_groups)]))) -->
<!-- ``` -->
<!-- ### Post-stratify the predicted proportions -->
<!-- For the post-stratification, we need a data frame that tells us how many women in the census are in each subgroup of interest. Let's join the census counts to the `pred_probs_draws` table above, replacing any NAs with 0's: -->
<!-- ```{r} -->
<!-- pred_probs_draws <- pred_probs_draws %>%  -->
<!--   left_join(census_counts) %>%  -->
<!--   replace_na(replace = list(n = 0)) -->
<!-- ``` -->
<!-- For each group and draw, we can calculate the estimated number of women reporting an abortion: -->
<!-- ```{r} -->
<!-- pred_probs_draws <- pred_probs_draws %>%  -->
<!--   mutate(n_abo = n*.value) -->
<!-- ``` -->
<!-- We can now use this as a basis of getting estimates by any group of interest. For example, the national estimate and lower/upper bounds is -->
<!-- ```{r} -->
<!-- pred_probs_draws %>%  -->
<!--   group_by(.draw) %>%  -->
<!--   summarize(prop_abo = sum(n_abo)/sum(n)) %>%  -->
<!--   ungroup() %>%  -->
<!--   summarize(prop_abo_group = median(prop_abo),  -->
<!--             lower = quantile(prop_abo, 0.1), -->
<!--             upper = quantile(prop_abo, 0.9)) -->
<!-- ``` -->
<!-- By age group: -->
<!-- ```{r} -->
<!-- prop_by_age <- pred_probs_draws %>%  -->
<!--   group_by(.draw, age_group) %>%  -->
<!--   summarize(prop_abo = sum(n_abo)/sum(n)) %>%  -->
<!--   group_by(age_group) %>%  -->
<!--   summarize(prop_abo_group = median(prop_abo),  -->
<!--             lower = quantile(prop_abo, 0.1), -->
<!--             upper = quantile(prop_abo, 0.9)) -->
<!-- prop_by_age -->
<!-- ``` -->
<!-- By marital status: -->
<!-- ```{r} -->
<!-- prop_by_marital <- pred_probs_draws %>%  -->
<!--   group_by(.draw, marital) %>%  -->
<!--   summarize(prop_abo = sum(n_abo)/sum(n)) %>%  -->
<!--   group_by(marital) %>%  -->
<!--   summarize(prop_abo_group = median(prop_abo),  -->
<!--             lower = quantile(prop_abo, 0.1), -->
<!--             upper = quantile(prop_abo, 0.9)) -->
<!-- prop_by_marital -->
<!-- ``` -->
<!-- By education: -->
<!-- ```{r} -->
<!-- prop_by_educ <- pred_probs_draws %>%  -->
<!--   group_by(.draw, educ) %>%  -->
<!--   summarize(prop_abo = sum(n_abo)/sum(n)) %>%  -->
<!--   group_by(educ) %>%  -->
<!--   summarize(prop_abo_group = median(prop_abo),  -->
<!--             lower = quantile(prop_abo, 0.1), -->
<!--             upper = quantile(prop_abo, 0.9)) -->
<!-- prop_by_educ -->
<!-- ``` -->
<!-- By region: -->
<!-- ```{r} -->
<!-- prop_by_region <- pred_probs_draws %>%  -->
<!--   group_by(.draw, region_2) %>%  -->
<!--   summarize(prop_abo = sum(n_abo)/sum(n)) %>%  -->
<!--   group_by(region_2) %>%  -->
<!--   summarize(prop_abo_group = median(prop_abo),  -->
<!--             lower = quantile(prop_abo, 0.1), -->
<!--             upper = quantile(prop_abo, 0.9)) -->
<!-- prop_by_region -->
<!-- ``` -->
<!-- ### Plotting and comparing estimates -->
<!-- We can compare the MRP estimates with raw estimates from the PMA survey and also estimates using normal post-stratification -->
<!-- #### Calculating raw estimates and post-stratified estimates -->
<!-- Calculate the raw estimates from the survey: -->
<!-- ```{r} -->
<!-- pma_cells <- d %>%  -->
<!--   group_by(region_2, educ, marital, age_group) %>%  -->
<!--   summarize( -->
<!--             n_sample = n(), n_abo_sample = sum(abortion), -->
<!--             prop_abo = n_abo_sample/n_sample) -->
<!-- ``` -->
<!-- We can then combine these with census data to get post-stratified counts: -->
<!-- ```{r} -->
<!-- pma_cells <- pma_cells %>%  -->
<!--   left_join(census_counts) %>%  -->
<!--   mutate(n_abo = prop_abo*n) %>%  -->
<!--   replace_na(replace = list(n = 0,n_abo = 0)) %>%  -->
<!--   ungroup() -->
<!-- ``` -->
<!-- #### Join all estimates together -->
<!-- Calculate raw and post-stratified estimates by different subpopulations and join them to the MRP estimates. By age group: -->
<!-- ```{r} -->
<!-- prop_by_age <- prop_by_age %>%  -->
<!--   mutate(type = "mrp") %>%  -->
<!--   rename(point = prop_abo_group) %>%  -->
<!--   bind_rows(pma_cells %>% group_by(age_group) %>%summarize(poststrat = sum(n_abo)/sum(n)) %>%  -->
<!--   left_join(pma_cells %>% group_by(age_group) %>%summarize(raw = sum(n_abo_sample)/sum(n_sample))) %>%  -->
<!--   pivot_longer(-age_group, names_to = "type", values_to = "point")) %>%  -->
<!--   arrange(age_group) -->
<!-- ``` -->
<!-- By education: -->
<!-- ```{r} -->
<!-- prop_by_educ <- prop_by_educ %>%  -->
<!--   mutate(type = "mrp") %>%  -->
<!--   rename(point = prop_abo_group) %>%  -->
<!--   bind_rows(pma_cells %>% group_by(educ) %>%summarize(poststrat = sum(n_abo)/sum(n)) %>%  -->
<!--   left_join(pma_cells %>% group_by(educ) %>%summarize(raw = sum(n_abo_sample)/sum(n_sample))) %>%  -->
<!--   pivot_longer(-educ, names_to = "type", values_to = "point")) %>%  -->
<!--   arrange(educ) -->
<!-- ``` -->
<!-- By marital status: -->
<!-- ```{r} -->
<!-- prop_by_marital <- prop_by_marital %>%  -->
<!--   mutate(type = "mrp") %>%  -->
<!--   rename(point = prop_abo_group) %>%  -->
<!--   bind_rows(pma_cells %>% group_by(marital) %>%summarize(poststrat = sum(n_abo)/sum(n)) %>%  -->
<!--   left_join(pma_cells %>% group_by(marital) %>%summarize(raw = sum(n_abo_sample)/sum(n_sample))) %>%  -->
<!--   pivot_longer(-marital, names_to = "type", values_to = "point")) %>%  -->
<!--   arrange(marital) -->
<!-- ``` -->
<!-- By region: -->
<!-- ```{r} -->
<!-- prop_by_region <- prop_by_region %>%  -->
<!--   mutate(type = "mrp") %>%  -->
<!--   rename(point = prop_abo_group) %>%  -->
<!--   bind_rows(pma_cells %>% group_by(region_2) %>%summarize(poststrat = sum(n_abo)/sum(n)) %>%  -->
<!--   left_join(pma_cells %>% group_by(region_2) %>%summarize(raw = sum(n_abo_sample)/sum(n_sample))) %>%  -->
<!--   pivot_longer(-region_2, names_to = "type", values_to = "point")) %>%  -->
<!--   arrange(region_2) -->
<!-- ``` -->
<!-- #### Plot! -->
<!-- By age group: -->
<!-- ```{r} -->
<!-- prop_by_age %>%  -->
<!--   ggplot(aes(age_group, point, color = type)) + geom_point(size = 2) +  -->
<!--   geom_errorbar(aes(ymin = lower, ymax = upper), width = NA, alpha = 0.5) +  -->
<!--   theme_bw(base_size = 14) + -->
<!--   labs(title = "Abortion prevalence by age group", x = "age", y = "proportion of women reporting abortions") -->
<!-- ``` -->
<!-- By education:  -->
<!-- ```{r} -->
<!-- prop_by_educ %>%  -->
<!--   mutate(educ = fct_relevel(educ, "more than primary", after = 2)) %>%  -->
<!--   ggplot(aes(educ, point, color = type)) + geom_point(size = 2) +  -->
<!--   geom_errorbar(aes(ymin = lower, ymax = upper), width = NA, alpha = 0.5) +  -->
<!--   theme_bw(base_size = 14) + -->
<!--   labs(title = "Abortion prevalence by education", x = "education level", y = "proportion of women reporting abortions") -->
<!-- ``` -->
<!-- By marital status -->
<!-- ```{r} -->
<!-- prop_by_marital %>%  -->
<!--   mutate(marital = factor(marital, c("single/never married", "married/in union", "divorced/separated", "widowed"))) %>%  -->
<!--   ggplot(aes(marital, point, color = type)) + geom_point(size = 2) +  -->
<!--   geom_errorbar(aes(ymin = lower, ymax = upper), width = NA, alpha = 0.5) +  -->
<!--   theme_bw(base_size = 14) + -->
<!--   labs(title = "Abortion prevalence by marital status", x = "", y = "proportion of women reporting abortions")+ -->
<!--   coord_flip() -->
<!-- ``` -->
<!-- By region -->
<!-- ```{r} -->
<!-- prop_by_region %>%  -->
<!--   ggplot(aes(region_2, point, color = type)) + geom_point(size = 2) +  -->
<!--   geom_errorbar(aes(ymin = lower, ymax = upper), width = NA, alpha = 0.5) +  -->
<!--   theme_bw(base_size = 14) + -->
<!--   labs(title = "Abortion prevalence by region", x = "", y = "proportion of women reporting abortions") -->
<!-- ``` -->
</div>
</div>
<div id="concluding-remarks-and-next-steps" class="section level2" number="16.6">
<h2><span class="header-section-number">16.6</span> Concluding remarks and next steps</h2>
<p>In general, MRP is a good way to accomplish specific aims, but it’s not without trade-offs. If you have a good quality survey, then it may be a way to speak to disaggregated aspects of it. Or if you are concerned about uncertainty then it is a good way to think about that. If you have a biased survey then it’s a great place to start, but it’s not a panacea.</p>
<p>There’s not a lot of work that’s been done with it, so there’s plenty of scope for exciting work from a variety of approaches:</p>
<ul>
<li>From a more statistical perspective, there is a lot of work to do in terms of thinking through how survey design and modelling approaches interact and the extent to which we are underestimating uncertainty. I’m also very interested in thinking through the implications of small samples and uncertainty in the post-stratification dataset. There’s an awful lot to do in terms of thinking through what the appropriate model is to use, and how do we even evaluate what ‘appropriate’ means here? Those with statistical interests, should probably go next to <span class="citation"><a href="references-1.html#ref-gao2021improving" role="doc-biblioref">Gao et al.</a> (<a href="references-1.html#ref-gao2021improving" role="doc-biblioref">2021</a>)</span> as well as pretty much anything by <a href="http://www-personal.umich.edu/~yajuan/">Yajuan Si</a>, but <span class="citation"><a href="references-1.html#ref-si2020use" role="doc-biblioref">Si</a> (<a href="references-1.html#ref-si2020use" role="doc-biblioref">2020</a>)</span> would be a starting point.</li>
<li>There’s a lot to be done from a sociology perspective in terms of survey responses and how we can better design our surveys, knowing they are going to be used for MRP and putting respect for our respondents first.</li>
<li>From a political science perspective, we just have very little idea of the conditions under which we will have the stable preferences and relationships that are required for MRP to be accurate, and further understanding how this relates to uncertainty in survey design. For those with political science interests, a natural next step would be to go through <span class="citation"><a href="references-1.html#ref-lauderdale2020model" role="doc-biblioref">Lauderdale et al.</a> (<a href="references-1.html#ref-lauderdale2020model" role="doc-biblioref">2020</a>)</span> or <span class="citation"><a href="references-1.html#ref-ghitza2020voter" role="doc-biblioref">Ghitza and Gelman</a> (<a href="references-1.html#ref-ghitza2020voter" role="doc-biblioref">2020</a>)</span>.</li>
<li>Economists might be interested to think about how we could use MRP to better understand the inflation and unemployment rates at local levels.</li>
<li>From a statistical software side of things, we really need to develop better packages around this.</li>
<li>It’s from an information side of things, that I’m most excited about MRP. How do we best store and protect our datasets, yet retain the ability to have them correspond with each other? How do we put the levels together in a way that is meaningful? To what extent do people appreciate uncertainty estimates and how can we better communicate these estimates?</li>
</ul>
<p>More generally, we could pretty much use MRP anywhere we have samples. Determining the conditions under which we actually should, is the work of whole generations.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>I’d like to acknowledge and thank Lauren Kennedy and <a href="https://www.monicaalexander.com">Monica Alexander</a>, through whose generous sharing of code, data, and countless conversations my thoughts about MRP have developed.<a href="multilevel-regression-with-post-stratification.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>You can work out which coefficients to be pass to gather_draws by using tidybayes::get_variables(model). (In this example I passed ‘b_.’ but the ones of interest to you may be different.)<a href="multilevel-regression-with-post-stratification.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>I thank <a href="http://www.chriswarshaw.com">Chris Warshaw</a> for putting me onto this dataset.<a href="multilevel-regression-with-post-stratification.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="causality-from-observational-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="text-as-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
