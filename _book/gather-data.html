<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Gather data | Telling Stories With Data</title>
  <meta name="description" content="This book is about learning how to tell stories with data." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Gather data | Telling Stories With Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is about learning how to tell stories with data." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Gather data | Telling Stories With Data" />
  
  <meta name="twitter:description" content="This book is about learning how to tell stories with data." />
  

<meta name="author" content="Rohan Alexander" />


<meta name="date" content="2021-03-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="interactive-communication.html"/>
<link rel="next" href="hunt-data.html"/>
<script src="libs/header-attrs-2.7.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/mapdeck-binding-0.3.4/mapdeck.js"></script>
<script src="libs/mpadeck_functions-0.0.1/mapdeck_functions.js"></script>
<script src="libs/deckgl-8.1.6/deckgl.min.js"></script>
<script src="libs/legend-0.0.1/legend.js"></script>
<script src="libs/title-0.0.1/title.js"></script>
<script src="libs/mapdeck_location-0.0.1/mapdeck_location.js"></script>
<script src="libs/mapdeck_colours-0.0.1/mapdeck_colours.js"></script>
<script src="libs/mapdeck_coordinates-0.0.1/mapdeck_coordinates.js"></script>
<link href="libs/mapboxgl-1.10.0/mapbox-gl.css" rel="stylesheet" />
<script src="libs/mapboxgl-1.10.0/mapbox-gl.js"></script>
<link href="libs/mapdeck-0.0.1/mapdeck.css" rel="stylesheet" />
<script src="libs/mpadeck-binding-0.3.4/mapdeck.js"></script>
<script src="libs/arc-1.0.0/arc.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Telling Stories With Data</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Essentials</b></span></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#welcome"><i class="fa fa-check"></i><b>1.1</b> Welcome</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#structure"><i class="fa fa-check"></i><b>1.2</b> Structure</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#on-telling-stories"><i class="fa fa-check"></i><b>1.3</b> On telling stories</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#telling-stories-with-data"><i class="fa fa-check"></i><b>1.4</b> Telling stories with data</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i><b>1.4.1</b> Software</a></li>
<li class="chapter" data-level="1.4.2" data-path="index.html"><a href="index.html#assumed-background"><i class="fa fa-check"></i><b>1.4.2</b> Assumed background</a></li>
<li class="chapter" data-level="1.4.3" data-path="index.html"><a href="index.html#structure-1"><i class="fa fa-check"></i><b>1.4.3</b> Structure</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.5</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.6</b> Contact</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html"><i class="fa fa-check"></i><b>2</b> Drinking from a fire hose</a>
<ul>
<li class="chapter" data-level="2.1" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#hello-world"><i class="fa fa-check"></i><b>2.1</b> Hello world</a></li>
<li class="chapter" data-level="2.2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#case-study---canadian-elections"><i class="fa fa-check"></i><b>2.2</b> Case study - Canadian elections</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#getting-started"><i class="fa fa-check"></i><b>2.2.1</b> Getting started</a></li>
<li class="chapter" data-level="2.2.2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#get-the-data"><i class="fa fa-check"></i><b>2.2.2</b> Get the data</a></li>
<li class="chapter" data-level="2.2.3" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#clean-the-data"><i class="fa fa-check"></i><b>2.2.3</b> Clean the data</a></li>
<li class="chapter" data-level="2.2.4" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#make-a-graph"><i class="fa fa-check"></i><b>2.2.4</b> Make a graph</a></li>
<li class="chapter" data-level="2.2.5" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#make-a-table"><i class="fa fa-check"></i><b>2.2.5</b> Make a table</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#case-study---toronto-homelessness"><i class="fa fa-check"></i><b>2.3</b> Case study - Toronto homelessness</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#getting-started-1"><i class="fa fa-check"></i><b>2.3.1</b> Getting started</a></li>
<li class="chapter" data-level="2.3.2" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#get-the-data-1"><i class="fa fa-check"></i><b>2.3.2</b> Get the data</a></li>
<li class="chapter" data-level="2.3.3" data-path="drinking-from-a-fire-hose.html"><a href="drinking-from-a-fire-hose.html#make-a-graph-1"><i class="fa fa-check"></i><b>2.3.3</b> Make a graph</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-essentials.html"><a href="r-essentials.html"><i class="fa fa-check"></i><b>3</b> R Essentials</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-essentials.html"><a href="r-essentials.html#r-essentials-1"><i class="fa fa-check"></i><b>3.1</b> R essentials</a></li>
<li class="chapter" data-level="3.2" data-path="r-essentials.html"><a href="r-essentials.html#social-impact"><i class="fa fa-check"></i><b>3.2</b> Social impact</a></li>
<li class="chapter" data-level="3.3" data-path="r-essentials.html"><a href="r-essentials.html#r-r-studio-and-r-studio-cloud"><i class="fa fa-check"></i><b>3.3</b> R, R Studio, and R Studio Cloud</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r-essentials.html"><a href="r-essentials.html#r"><i class="fa fa-check"></i><b>3.3.1</b> R</a></li>
<li class="chapter" data-level="3.3.2" data-path="r-essentials.html"><a href="r-essentials.html#r-studio"><i class="fa fa-check"></i><b>3.3.2</b> R Studio</a></li>
<li class="chapter" data-level="3.3.3" data-path="r-essentials.html"><a href="r-essentials.html#r-studio-cloud"><i class="fa fa-check"></i><b>3.3.3</b> R Studio Cloud</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="r-essentials.html"><a href="r-essentials.html#tidyverse-i"><i class="fa fa-check"></i><b>3.4</b> Tidyverse I</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="r-essentials.html"><a href="r-essentials.html#the-pipe"><i class="fa fa-check"></i><b>3.4.1</b> The pipe</a></li>
<li class="chapter" data-level="3.4.2" data-path="r-essentials.html"><a href="r-essentials.html#selecting"><i class="fa fa-check"></i><b>3.4.2</b> Selecting</a></li>
<li class="chapter" data-level="3.4.3" data-path="r-essentials.html"><a href="r-essentials.html#filtering"><i class="fa fa-check"></i><b>3.4.3</b> Filtering</a></li>
<li class="chapter" data-level="3.4.4" data-path="r-essentials.html"><a href="r-essentials.html#arranging"><i class="fa fa-check"></i><b>3.4.4</b> Arranging</a></li>
<li class="chapter" data-level="3.4.5" data-path="r-essentials.html"><a href="r-essentials.html#grouping"><i class="fa fa-check"></i><b>3.4.5</b> Grouping</a></li>
<li class="chapter" data-level="3.4.6" data-path="r-essentials.html"><a href="r-essentials.html#mutating"><i class="fa fa-check"></i><b>3.4.6</b> Mutating</a></li>
<li class="chapter" data-level="3.4.7" data-path="r-essentials.html"><a href="r-essentials.html#summarise"><i class="fa fa-check"></i><b>3.4.7</b> Summarise</a></li>
<li class="chapter" data-level="3.4.8" data-path="r-essentials.html"><a href="r-essentials.html#counting"><i class="fa fa-check"></i><b>3.4.8</b> Counting</a></li>
<li class="chapter" data-level="3.4.9" data-path="r-essentials.html"><a href="r-essentials.html#proportions"><i class="fa fa-check"></i><b>3.4.9</b> Proportions</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="r-essentials.html"><a href="r-essentials.html#base"><i class="fa fa-check"></i><b>3.5</b> Base</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="r-essentials.html"><a href="r-essentials.html#class"><i class="fa fa-check"></i><b>3.5.1</b> Class</a></li>
<li class="chapter" data-level="3.5.2" data-path="r-essentials.html"><a href="r-essentials.html#simulating-data"><i class="fa fa-check"></i><b>3.5.2</b> Simulating data</a></li>
<li class="chapter" data-level="3.5.3" data-path="r-essentials.html"><a href="r-essentials.html#functions"><i class="fa fa-check"></i><b>3.5.3</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="r-essentials.html"><a href="r-essentials.html#ggplot-i"><i class="fa fa-check"></i><b>3.6</b> ggplot I</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="r-essentials.html"><a href="r-essentials.html#main-features"><i class="fa fa-check"></i><b>3.6.1</b> Main features</a></li>
<li class="chapter" data-level="3.6.2" data-path="r-essentials.html"><a href="r-essentials.html#facets"><i class="fa fa-check"></i><b>3.6.2</b> Facets</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="r-essentials.html"><a href="r-essentials.html#tidyverse-ii"><i class="fa fa-check"></i><b>3.7</b> Tidyverse II</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="r-essentials.html"><a href="r-essentials.html#tibbles"><i class="fa fa-check"></i><b>3.7.1</b> Tibbles</a></li>
<li class="chapter" data-level="3.7.2" data-path="r-essentials.html"><a href="r-essentials.html#importing-data"><i class="fa fa-check"></i><b>3.7.2</b> Importing data</a></li>
<li class="chapter" data-level="3.7.3" data-path="r-essentials.html"><a href="r-essentials.html#joining-data"><i class="fa fa-check"></i><b>3.7.3</b> Joining data</a></li>
<li class="chapter" data-level="3.7.4" data-path="r-essentials.html"><a href="r-essentials.html#strings"><i class="fa fa-check"></i><b>3.7.4</b> Strings</a></li>
<li class="chapter" data-level="3.7.5" data-path="r-essentials.html"><a href="r-essentials.html#pivot"><i class="fa fa-check"></i><b>3.7.5</b> Pivot</a></li>
<li class="chapter" data-level="3.7.6" data-path="r-essentials.html"><a href="r-essentials.html#factors"><i class="fa fa-check"></i><b>3.7.6</b> Factors</a></li>
<li class="chapter" data-level="3.7.7" data-path="r-essentials.html"><a href="r-essentials.html#cases"><i class="fa fa-check"></i><b>3.7.7</b> Cases</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>4</b> Workflow</a>
<ul>
<li class="chapter" data-level="4.1" data-path="workflow.html"><a href="workflow.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="workflow.html"><a href="workflow.html#r-markdown"><i class="fa fa-check"></i><b>4.2</b> R Markdown</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="workflow.html"><a href="workflow.html#getting-started-2"><i class="fa fa-check"></i><b>4.2.1</b> Getting started</a></li>
<li class="chapter" data-level="4.2.2" data-path="workflow.html"><a href="workflow.html#basic-commands"><i class="fa fa-check"></i><b>4.2.2</b> Basic commands</a></li>
<li class="chapter" data-level="4.2.3" data-path="workflow.html"><a href="workflow.html#r-chunks"><i class="fa fa-check"></i><b>4.2.3</b> R chunks</a></li>
<li class="chapter" data-level="4.2.4" data-path="workflow.html"><a href="workflow.html#abstracts-and-pdf-outputs"><i class="fa fa-check"></i><b>4.2.4</b> Abstracts and PDF outputs</a></li>
<li class="chapter" data-level="4.2.5" data-path="workflow.html"><a href="workflow.html#references"><i class="fa fa-check"></i><b>4.2.5</b> References</a></li>
<li class="chapter" data-level="4.2.6" data-path="workflow.html"><a href="workflow.html#cross-references"><i class="fa fa-check"></i><b>4.2.6</b> Cross-references</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="workflow.html"><a href="workflow.html#r-projects"><i class="fa fa-check"></i><b>4.3</b> R projects</a></li>
<li class="chapter" data-level="4.4" data-path="workflow.html"><a href="workflow.html#git-and-github"><i class="fa fa-check"></i><b>4.4</b> Git and GitHub</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="workflow.html"><a href="workflow.html#introduction-2"><i class="fa fa-check"></i><b>4.4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.4.2" data-path="workflow.html"><a href="workflow.html#git"><i class="fa fa-check"></i><b>4.4.2</b> Git</a></li>
<li class="chapter" data-level="4.4.3" data-path="workflow.html"><a href="workflow.html#github"><i class="fa fa-check"></i><b>4.4.3</b> GitHub</a></li>
<li class="chapter" data-level="4.4.4" data-path="workflow.html"><a href="workflow.html#using-git-within-rstudio"><i class="fa fa-check"></i><b>4.4.4</b> Using Git within RStudio</a></li>
<li class="chapter" data-level="4.4.5" data-path="workflow.html"><a href="workflow.html#next-steps"><i class="fa fa-check"></i><b>4.4.5</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="workflow.html"><a href="workflow.html#using-r-in-practice"><i class="fa fa-check"></i><b>4.5</b> Using R in practice</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="workflow.html"><a href="workflow.html#introduction-3"><i class="fa fa-check"></i><b>4.5.1</b> Introduction</a></li>
<li class="chapter" data-level="4.5.2" data-path="workflow.html"><a href="workflow.html#getting-help"><i class="fa fa-check"></i><b>4.5.2</b> Getting help</a></li>
<li class="chapter" data-level="4.5.3" data-path="workflow.html"><a href="workflow.html#mentality"><i class="fa fa-check"></i><b>4.5.3</b> Mentality</a></li>
<li class="chapter" data-level="4.5.4" data-path="workflow.html"><a href="workflow.html#code-comments"><i class="fa fa-check"></i><b>4.5.4</b> Code comments</a></li>
<li class="chapter" data-level="4.5.5" data-path="workflow.html"><a href="workflow.html#learning-more"><i class="fa fa-check"></i><b>4.5.5</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="workflow.html"><a href="workflow.html#developing-research-questions"><i class="fa fa-check"></i><b>4.6</b> Developing research questions</a></li>
</ul></li>
<li class="part"><span><b>II Communicate</b></span></li>
<li class="chapter" data-level="5" data-path="static-communication.html"><a href="static-communication.html"><i class="fa fa-check"></i><b>5</b> Static communication</a>
<ul>
<li class="chapter" data-level="5.1" data-path="static-communication.html"><a href="static-communication.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="static-communication.html"><a href="static-communication.html#graphs"><i class="fa fa-check"></i><b>5.2</b> Graphs</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="static-communication.html"><a href="static-communication.html#bar-chart"><i class="fa fa-check"></i><b>5.2.1</b> Bar chart</a></li>
<li class="chapter" data-level="5.2.2" data-path="static-communication.html"><a href="static-communication.html#scatter-plot"><i class="fa fa-check"></i><b>5.2.2</b> Scatter plot</a></li>
<li class="chapter" data-level="5.2.3" data-path="static-communication.html"><a href="static-communication.html#never-use-box-plots"><i class="fa fa-check"></i><b>5.2.3</b> Never use box plots</a></li>
<li class="chapter" data-level="5.2.4" data-path="static-communication.html"><a href="static-communication.html#other"><i class="fa fa-check"></i><b>5.2.4</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="static-communication.html"><a href="static-communication.html#tables"><i class="fa fa-check"></i><b>5.3</b> Tables</a></li>
<li class="chapter" data-level="5.4" data-path="static-communication.html"><a href="static-communication.html#maps"><i class="fa fa-check"></i><b>5.4</b> Maps</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="static-communication.html"><a href="static-communication.html#australian-polling-places"><i class="fa fa-check"></i><b>5.4.1</b> Australian polling places</a></li>
<li class="chapter" data-level="5.4.2" data-path="static-communication.html"><a href="static-communication.html#toronto-bike-parking"><i class="fa fa-check"></i><b>5.4.2</b> Toronto bike parking</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="static-communication.html"><a href="static-communication.html#writing"><i class="fa fa-check"></i><b>5.5</b> Writing</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="static-communication.html"><a href="static-communication.html#title-abstract-and-introduction"><i class="fa fa-check"></i><b>5.5.1</b> Title, abstract, and introduction</a></li>
<li class="chapter" data-level="5.5.2" data-path="static-communication.html"><a href="static-communication.html#figures-tables-equations-and-technical-terms"><i class="fa fa-check"></i><b>5.5.2</b> Figures, tables, equations, and technical terms</a></li>
<li class="chapter" data-level="5.5.3" data-path="static-communication.html"><a href="static-communication.html#on-brevity"><i class="fa fa-check"></i><b>5.5.3</b> On brevity</a></li>
<li class="chapter" data-level="5.5.4" data-path="static-communication.html"><a href="static-communication.html#other-1"><i class="fa fa-check"></i><b>5.5.4</b> Other</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactive-communication.html"><a href="interactive-communication.html"><i class="fa fa-check"></i><b>6</b> Interactive communication</a>
<ul>
<li class="chapter" data-level="6.1" data-path="interactive-communication.html"><a href="interactive-communication.html#making-a-website"><i class="fa fa-check"></i><b>6.1</b> Making a website</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="interactive-communication.html"><a href="interactive-communication.html#introduction-5"><i class="fa fa-check"></i><b>6.1.1</b> Introduction</a></li>
<li class="chapter" data-level="6.1.2" data-path="interactive-communication.html"><a href="interactive-communication.html#foundations"><i class="fa fa-check"></i><b>6.1.2</b> Foundations</a></li>
<li class="chapter" data-level="6.1.3" data-path="interactive-communication.html"><a href="interactive-communication.html#build-the-frame"><i class="fa fa-check"></i><b>6.1.3</b> Build the frame</a></li>
<li class="chapter" data-level="6.1.4" data-path="interactive-communication.html"><a href="interactive-communication.html#add-content"><i class="fa fa-check"></i><b>6.1.4</b> Add content</a></li>
<li class="chapter" data-level="6.1.5" data-path="interactive-communication.html"><a href="interactive-communication.html#making-your-website-public"><i class="fa fa-check"></i><b>6.1.5</b> Making your website public</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="interactive-communication.html"><a href="interactive-communication.html#interactive-maps"><i class="fa fa-check"></i><b>6.2</b> Interactive maps</a></li>
<li class="chapter" data-level="6.3" data-path="interactive-communication.html"><a href="interactive-communication.html#shiny"><i class="fa fa-check"></i><b>6.3</b> Shiny</a></li>
</ul></li>
<li class="part"><span><b>III Hunt gather and farm</b></span></li>
<li class="chapter" data-level="7" data-path="gather-data.html"><a href="gather-data.html"><i class="fa fa-check"></i><b>7</b> Gather data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="gather-data.html"><a href="gather-data.html#apis"><i class="fa fa-check"></i><b>7.1</b> APIs</a></li>
<li class="chapter" data-level="7.2" data-path="gather-data.html"><a href="gather-data.html#case-study---arxiv"><i class="fa fa-check"></i><b>7.2</b> Case study - arXiv</a></li>
<li class="chapter" data-level="7.3" data-path="gather-data.html"><a href="gather-data.html#case-study---rtweet"><i class="fa fa-check"></i><b>7.3</b> Case study - rtweet</a></li>
<li class="chapter" data-level="7.4" data-path="gather-data.html"><a href="gather-data.html#case-study---spotifyr"><i class="fa fa-check"></i><b>7.4</b> Case study - spotifyr</a></li>
<li class="chapter" data-level="7.5" data-path="gather-data.html"><a href="gather-data.html#scraping"><i class="fa fa-check"></i><b>7.5</b> Scraping</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="gather-data.html"><a href="gather-data.html#introduction-6"><i class="fa fa-check"></i><b>7.5.1</b> Introduction</a></li>
<li class="chapter" data-level="7.5.2" data-path="gather-data.html"><a href="gather-data.html#getting-started-3"><i class="fa fa-check"></i><b>7.5.2</b> Getting started</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="gather-data.html"><a href="gather-data.html#case-study---rohans-books"><i class="fa fa-check"></i><b>7.6</b> Case study - Rohan’s books</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="gather-data.html"><a href="gather-data.html#introduction-7"><i class="fa fa-check"></i><b>7.6.1</b> Introduction</a></li>
<li class="chapter" data-level="7.6.2" data-path="gather-data.html"><a href="gather-data.html#gather"><i class="fa fa-check"></i><b>7.6.2</b> Gather</a></li>
<li class="chapter" data-level="7.6.3" data-path="gather-data.html"><a href="gather-data.html#clean"><i class="fa fa-check"></i><b>7.6.3</b> Clean</a></li>
<li class="chapter" data-level="7.6.4" data-path="gather-data.html"><a href="gather-data.html#explore"><i class="fa fa-check"></i><b>7.6.4</b> Explore</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="gather-data.html"><a href="gather-data.html#case-study---canadian-prime-ministers"><i class="fa fa-check"></i><b>7.7</b> Case study - Canadian Prime Ministers</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="gather-data.html"><a href="gather-data.html#introduction-8"><i class="fa fa-check"></i><b>7.7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.7.2" data-path="gather-data.html"><a href="gather-data.html#gather-1"><i class="fa fa-check"></i><b>7.7.2</b> Gather</a></li>
<li class="chapter" data-level="7.7.3" data-path="gather-data.html"><a href="gather-data.html#clean-1"><i class="fa fa-check"></i><b>7.7.3</b> Clean</a></li>
<li class="chapter" data-level="7.7.4" data-path="gather-data.html"><a href="gather-data.html#explore-1"><i class="fa fa-check"></i><b>7.7.4</b> Explore</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="gather-data.html"><a href="gather-data.html#pdfs"><i class="fa fa-check"></i><b>7.8</b> PDFs</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="gather-data.html"><a href="gather-data.html#introduction-9"><i class="fa fa-check"></i><b>7.8.1</b> Introduction</a></li>
<li class="chapter" data-level="7.8.2" data-path="gather-data.html"><a href="gather-data.html#getting-started-4"><i class="fa fa-check"></i><b>7.8.2</b> Getting started</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="gather-data.html"><a href="gather-data.html#case-study-us-total-fertility-rate-by-state-and-year-2000-2018"><i class="fa fa-check"></i><b>7.9</b> Case-study: US Total Fertility Rate, by state and year (2000-2018)</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="gather-data.html"><a href="gather-data.html#introduction-10"><i class="fa fa-check"></i><b>7.9.1</b> Introduction</a></li>
<li class="chapter" data-level="7.9.2" data-path="gather-data.html"><a href="gather-data.html#begin-with-an-end-in-mind"><i class="fa fa-check"></i><b>7.9.2</b> Begin with an end in mind</a></li>
<li class="chapter" data-level="7.9.3" data-path="gather-data.html"><a href="gather-data.html#start-simple-then-iterate."><i class="fa fa-check"></i><b>7.9.3</b> Start simple, then iterate.</a></li>
<li class="chapter" data-level="7.9.4" data-path="gather-data.html"><a href="gather-data.html#iterating"><i class="fa fa-check"></i><b>7.9.4</b> Iterating</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="gather-data.html"><a href="gather-data.html#case-study-kenyan-census-data"><i class="fa fa-check"></i><b>7.10</b> Case-study: Kenyan census data</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="gather-data.html"><a href="gather-data.html#set-up"><i class="fa fa-check"></i><b>7.10.1</b> Set-up</a></li>
<li class="chapter" data-level="7.10.2" data-path="gather-data.html"><a href="gather-data.html#extract"><i class="fa fa-check"></i><b>7.10.2</b> Extract</a></li>
<li class="chapter" data-level="7.10.3" data-path="gather-data.html"><a href="gather-data.html#clean-2"><i class="fa fa-check"></i><b>7.10.3</b> Clean</a></li>
<li class="chapter" data-level="7.10.4" data-path="gather-data.html"><a href="gather-data.html#check"><i class="fa fa-check"></i><b>7.10.4</b> Check</a></li>
<li class="chapter" data-level="7.10.5" data-path="gather-data.html"><a href="gather-data.html#tidy-up"><i class="fa fa-check"></i><b>7.10.5</b> Tidy-up</a></li>
<li class="chapter" data-level="7.10.6" data-path="gather-data.html"><a href="gather-data.html#make-monicas-dataset"><i class="fa fa-check"></i><b>7.10.6</b> Make Monica’s dataset</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="gather-data.html"><a href="gather-data.html#optical-character-recognition"><i class="fa fa-check"></i><b>7.11</b> Optical Character Recognition</a></li>
<li class="chapter" data-level="7.12" data-path="gather-data.html"><a href="gather-data.html#text"><i class="fa fa-check"></i><b>7.12</b> Text</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="gather-data.html"><a href="gather-data.html#introduction-11"><i class="fa fa-check"></i><b>7.12.1</b> Introduction</a></li>
<li class="chapter" data-level="7.12.2" data-path="gather-data.html"><a href="gather-data.html#getting-text-data"><i class="fa fa-check"></i><b>7.12.2</b> Getting text data</a></li>
<li class="chapter" data-level="7.12.3" data-path="gather-data.html"><a href="gather-data.html#preparing-text-datasets"><i class="fa fa-check"></i><b>7.12.3</b> Preparing text datasets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="hunt-data.html"><a href="hunt-data.html"><i class="fa fa-check"></i><b>8</b> Hunt data</a>
<ul>
<li class="chapter" data-level="8.1" data-path="hunt-data.html"><a href="hunt-data.html#experiments-and-randomised-controlled-trials"><i class="fa fa-check"></i><b>8.1</b> Experiments and randomised controlled trials</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="hunt-data.html"><a href="hunt-data.html#introduction-12"><i class="fa fa-check"></i><b>8.1.1</b> Introduction</a></li>
<li class="chapter" data-level="8.1.2" data-path="hunt-data.html"><a href="hunt-data.html#motivation-and-notation"><i class="fa fa-check"></i><b>8.1.2</b> Motivation and notation</a></li>
<li class="chapter" data-level="8.1.3" data-path="hunt-data.html"><a href="hunt-data.html#randomised-sampling"><i class="fa fa-check"></i><b>8.1.3</b> Randomised sampling</a></li>
<li class="chapter" data-level="8.1.4" data-path="hunt-data.html"><a href="hunt-data.html#anova"><i class="fa fa-check"></i><b>8.1.4</b> ANOVA</a></li>
<li class="chapter" data-level="8.1.5" data-path="hunt-data.html"><a href="hunt-data.html#treatment-and-control"><i class="fa fa-check"></i><b>8.1.5</b> Treatment and control</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="hunt-data.html"><a href="hunt-data.html#case-study---fishers-tea-party"><i class="fa fa-check"></i><b>8.2</b> Case study - Fisher’s tea party</a></li>
<li class="chapter" data-level="8.3" data-path="hunt-data.html"><a href="hunt-data.html#case-study---tuskegee-syphilis-study"><i class="fa fa-check"></i><b>8.3</b> Case study - Tuskegee Syphilis Study</a></li>
<li class="chapter" data-level="8.4" data-path="hunt-data.html"><a href="hunt-data.html#case-study---the-oregon-health-insurance-experiment"><i class="fa fa-check"></i><b>8.4</b> Case study - The Oregon Health Insurance Experiment</a></li>
<li class="chapter" data-level="8.5" data-path="hunt-data.html"><a href="hunt-data.html#case-study---student-coaching-how-far-can-technology-go"><i class="fa fa-check"></i><b>8.5</b> Case study - Student Coaching: How Far Can Technology Go?</a></li>
<li class="chapter" data-level="8.6" data-path="hunt-data.html"><a href="hunt-data.html#case-study---civic-honesty-around-the-globe"><i class="fa fa-check"></i><b>8.6</b> Case study - Civic Honesty Around The Globe</a></li>
<li class="chapter" data-level="8.7" data-path="hunt-data.html"><a href="hunt-data.html#ab-testing"><i class="fa fa-check"></i><b>8.7</b> A/B testing</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="hunt-data.html"><a href="hunt-data.html#introduction-13"><i class="fa fa-check"></i><b>8.7.1</b> Introduction</a></li>
<li class="chapter" data-level="8.7.2" data-path="hunt-data.html"><a href="hunt-data.html#delivery"><i class="fa fa-check"></i><b>8.7.2</b> Delivery</a></li>
<li class="chapter" data-level="8.7.3" data-path="hunt-data.html"><a href="hunt-data.html#instrumentation"><i class="fa fa-check"></i><b>8.7.3</b> Instrumentation</a></li>
<li class="chapter" data-level="8.7.4" data-path="hunt-data.html"><a href="hunt-data.html#randomisation-unit"><i class="fa fa-check"></i><b>8.7.4</b> Randomisation unit</a></li>
<li class="chapter" data-level="8.7.5" data-path="hunt-data.html"><a href="hunt-data.html#partnerships"><i class="fa fa-check"></i><b>8.7.5</b> Partnerships</a></li>
<li class="chapter" data-level="8.7.6" data-path="hunt-data.html"><a href="hunt-data.html#speed-vs-quality"><i class="fa fa-check"></i><b>8.7.6</b> Speed vs quality</a></li>
<li class="chapter" data-level="8.7.7" data-path="hunt-data.html"><a href="hunt-data.html#conflicting-priorities"><i class="fa fa-check"></i><b>8.7.7</b> Conflicting priorities</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="hunt-data.html"><a href="hunt-data.html#case-study---upworthy"><i class="fa fa-check"></i><b>8.8</b> Case study - Upworthy</a></li>
<li class="chapter" data-level="8.9" data-path="hunt-data.html"><a href="hunt-data.html#sampling-and-survey-essentials"><i class="fa fa-check"></i><b>8.9</b> Sampling and survey essentials</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="hunt-data.html"><a href="hunt-data.html#introduction-14"><i class="fa fa-check"></i><b>8.9.1</b> Introduction</a></li>
<li class="chapter" data-level="8.9.2" data-path="hunt-data.html"><a href="hunt-data.html#simple-random-sampling"><i class="fa fa-check"></i><b>8.9.2</b> Simple random sampling</a></li>
<li class="chapter" data-level="8.9.3" data-path="hunt-data.html"><a href="hunt-data.html#stratified-and-cluster-sampling"><i class="fa fa-check"></i><b>8.9.3</b> Stratified and cluster sampling</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="hunt-data.html"><a href="hunt-data.html#implementing-surveys"><i class="fa fa-check"></i><b>8.10</b> Implementing surveys</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="hunt-data.html"><a href="hunt-data.html#google"><i class="fa fa-check"></i><b>8.10.1</b> Google</a></li>
<li class="chapter" data-level="8.10.2" data-path="hunt-data.html"><a href="hunt-data.html#facebook"><i class="fa fa-check"></i><b>8.10.2</b> Facebook</a></li>
<li class="chapter" data-level="8.10.3" data-path="hunt-data.html"><a href="hunt-data.html#survey-monkey"><i class="fa fa-check"></i><b>8.10.3</b> Survey Monkey</a></li>
<li class="chapter" data-level="8.10.4" data-path="hunt-data.html"><a href="hunt-data.html#mechanical-turk"><i class="fa fa-check"></i><b>8.10.4</b> Mechanical Turk</a></li>
<li class="chapter" data-level="8.10.5" data-path="hunt-data.html"><a href="hunt-data.html#prolific"><i class="fa fa-check"></i><b>8.10.5</b> Prolific</a></li>
<li class="chapter" data-level="8.10.6" data-path="hunt-data.html"><a href="hunt-data.html#qualtrics"><i class="fa fa-check"></i><b>8.10.6</b> Qualtrics</a></li>
<li class="chapter" data-level="8.10.7" data-path="hunt-data.html"><a href="hunt-data.html#other-2"><i class="fa fa-check"></i><b>8.10.7</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="hunt-data.html"><a href="hunt-data.html#next-steps-1"><i class="fa fa-check"></i><b>8.11</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="farm-data.html"><a href="farm-data.html"><i class="fa fa-check"></i><b>9</b> Farm data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="farm-data.html"><a href="farm-data.html#open-government-data"><i class="fa fa-check"></i><b>9.1</b> Open Government Data</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="farm-data.html"><a href="farm-data.html#canadian-census"><i class="fa fa-check"></i><b>9.1.1</b> Canadian Census</a></li>
<li class="chapter" data-level="9.1.2" data-path="farm-data.html"><a href="farm-data.html#city-of-toronto-open-data-portal"><i class="fa fa-check"></i><b>9.1.2</b> City of Toronto Open Data Portal</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="farm-data.html"><a href="farm-data.html#electoral-studies"><i class="fa fa-check"></i><b>9.2</b> Electoral Studies</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="farm-data.html"><a href="farm-data.html#canadian-electoral-study"><i class="fa fa-check"></i><b>9.2.1</b> Canadian Electoral Study</a></li>
<li class="chapter" data-level="9.2.2" data-path="farm-data.html"><a href="farm-data.html#australian-electoral-study"><i class="fa fa-check"></i><b>9.2.2</b> Australian Electoral Study</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Clean</b></span></li>
<li class="chapter" data-level="10" data-path="cleaning-and-preparing-data.html"><a href="cleaning-and-preparing-data.html"><i class="fa fa-check"></i><b>10</b> Cleaning and preparing data</a></li>
<li class="chapter" data-level="11" data-path="storing-and-retrieving-data.html"><a href="storing-and-retrieving-data.html"><i class="fa fa-check"></i><b>11</b> Storing and retrieving data</a></li>
<li class="chapter" data-level="12" data-path="disseminating-and-protecting-data.html"><a href="disseminating-and-protecting-data.html"><i class="fa fa-check"></i><b>12</b> Disseminating and protecting data</a></li>
<li class="part"><span><b>V Model</b></span></li>
<li class="chapter" data-level="13" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>13</b> Exploratory data analysis</a>
<ul>
<li class="chapter" data-level="13.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-15"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#case-study---ttc-subway-delays"><i class="fa fa-check"></i><b>13.2</b> Case study - TTC subway delays</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-16"><i class="fa fa-check"></i><b>13.2.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#gather-the-data"><i class="fa fa-check"></i><b>13.2.2</b> Gather the data</a></li>
<li class="chapter" data-level="13.2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#sanity-checks"><i class="fa fa-check"></i><b>13.2.3</b> Sanity Checks</a></li>
<li class="chapter" data-level="13.2.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-values"><i class="fa fa-check"></i><b>13.2.4</b> Missing values</a></li>
<li class="chapter" data-level="13.2.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#duplicate-rows"><i class="fa fa-check"></i><b>13.2.5</b> Duplicate rows</a></li>
<li class="chapter" data-level="13.2.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-distributions"><i class="fa fa-check"></i><b>13.2.6</b> Visualizing distributions</a></li>
<li class="chapter" data-level="13.2.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#groups-and-small-counts"><i class="fa fa-check"></i><b>13.2.7</b> Groups and small counts</a></li>
<li class="chapter" data-level="13.2.8" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-time-series"><i class="fa fa-check"></i><b>13.2.8</b> Visualizing time series</a></li>
<li class="chapter" data-level="13.2.9" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-relationships"><i class="fa fa-check"></i><b>13.2.9</b> Visualizing relationships</a></li>
<li class="chapter" data-level="13.2.10" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#principal-components-analysis"><i class="fa fa-check"></i><b>13.2.10</b> Principal components analysis</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#case-study---opinions-about-a-casino-in-toronto"><i class="fa fa-check"></i><b>13.3</b> Case study - Opinions about a casino in Toronto</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-preparation"><i class="fa fa-check"></i><b>13.3.1</b> Data preparation</a></li>
<li class="chapter" data-level="13.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#some-visual-exploration-and-more-cleanup-of-course"><i class="fa fa-check"></i><b>13.3.2</b> Some visual exploration (and more cleanup, of course)</a></li>
<li class="chapter" data-level="13.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#getting-the-data-into-a-more-model-suitable-format"><i class="fa fa-check"></i><b>13.3.3</b> Getting the data into a more model-suitable format</a></li>
<li class="chapter" data-level="13.3.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#logistic-regression"><i class="fa fa-check"></i><b>13.3.4</b> Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#case-study---airbnb-listing-in-toronto"><i class="fa fa-check"></i><b>13.4</b> Case study - Airbnb listing in Toronto</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#essentials"><i class="fa fa-check"></i><b>13.4.1</b> Essentials</a></li>
<li class="chapter" data-level="13.4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#set-up-1"><i class="fa fa-check"></i><b>13.4.2</b> Set up</a></li>
<li class="chapter" data-level="13.4.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#get-data"><i class="fa fa-check"></i><b>13.4.3</b> Get data</a></li>
<li class="chapter" data-level="13.4.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#clean-data-1"><i class="fa fa-check"></i><b>13.4.4</b> Clean data</a></li>
<li class="chapter" data-level="13.4.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#explore-data"><i class="fa fa-check"></i><b>13.4.5</b> Explore data</a></li>
<li class="chapter" data-level="13.4.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#model-data"><i class="fa fa-check"></i><b>13.4.6</b> Model data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html"><i class="fa fa-check"></i><b>14</b> It’s Just A Linear Model</a>
<ul>
<li class="chapter" data-level="14.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview"><i class="fa fa-check"></i><b>14.1</b> Overview</a></li>
<li class="chapter" data-level="14.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#simple-linear-regression"><i class="fa fa-check"></i><b>14.2</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview-1"><i class="fa fa-check"></i><b>14.2.1</b> Overview</a></li>
<li class="chapter" data-level="14.2.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-base-r"><i class="fa fa-check"></i><b>14.2.2</b> Implementation in base R</a></li>
<li class="chapter" data-level="14.2.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#tidy-up-with-broom"><i class="fa fa-check"></i><b>14.2.3</b> Tidy up with broom</a></li>
<li class="chapter" data-level="14.2.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#testing-hypothesis"><i class="fa fa-check"></i><b>14.2.4</b> Testing hypothesis</a></li>
<li class="chapter" data-level="14.2.5" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#on-p-values"><i class="fa fa-check"></i><b>14.2.5</b> On p-values</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#multiple-linear-regression"><i class="fa fa-check"></i><b>14.3</b> Multiple linear regression</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#threats-to-validity-and-aspects-to-think-about"><i class="fa fa-check"></i><b>14.3.1</b> Threats to validity and aspects to think about</a></li>
<li class="chapter" data-level="14.3.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#more-credible-outputs"><i class="fa fa-check"></i><b>14.3.2</b> More credible outputs</a></li>
<li class="chapter" data-level="14.3.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-tidymodels"><i class="fa fa-check"></i><b>14.3.3</b> Implementation in <code>tidymodels</code></a></li>
<li class="chapter" data-level="14.3.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-rstanarm"><i class="fa fa-check"></i><b>14.3.4</b> Implementation in <code>rstanarm</code></a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#logistic-regression-2"><i class="fa fa-check"></i><b>14.4</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview-2"><i class="fa fa-check"></i><b>14.4.1</b> Overview</a></li>
<li class="chapter" data-level="14.4.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-base"><i class="fa fa-check"></i><b>14.4.2</b> Implementation in base</a></li>
<li class="chapter" data-level="14.4.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-tidymodels-1"><i class="fa fa-check"></i><b>14.4.3</b> Implementation in <code>tidymodels</code></a></li>
<li class="chapter" data-level="14.4.4" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-rstanarm-1"><i class="fa fa-check"></i><b>14.4.4</b> Implementation in <code>rstanarm</code></a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#poisson-regression"><i class="fa fa-check"></i><b>14.5</b> Poisson regression</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#overview-3"><i class="fa fa-check"></i><b>14.5.1</b> Overview</a></li>
<li class="chapter" data-level="14.5.2" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-base-1"><i class="fa fa-check"></i><b>14.5.2</b> Implementation in base</a></li>
<li class="chapter" data-level="14.5.3" data-path="its-just-a-linear-model.html"><a href="its-just-a-linear-model.html#implementation-in-tidymodels-2"><i class="fa fa-check"></i><b>14.5.3</b> Implementation in <code>tidymodels</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html"><i class="fa fa-check"></i><b>15</b> Causality from observational data</a>
<ul>
<li class="chapter" data-level="15.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-17"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#dags-and-trying-not-to-be-tricked-by-the-data"><i class="fa fa-check"></i><b>15.2</b> DAGs and trying not to be tricked by the data</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#dags-and-confounding"><i class="fa fa-check"></i><b>15.2.1</b> DAGs and confounding</a></li>
<li class="chapter" data-level="15.2.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#selection-and-measurement-bias"><i class="fa fa-check"></i><b>15.2.2</b> Selection and measurement bias</a></li>
<li class="chapter" data-level="15.2.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#two-common-paradoxes"><i class="fa fa-check"></i><b>15.2.3</b> Two common paradoxes</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#difference-in-differences"><i class="fa fa-check"></i><b>15.3</b> Difference in differences</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#matching-and-difference-in-differences"><i class="fa fa-check"></i><b>15.3.1</b> Matching and difference-in-differences</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974"><i class="fa fa-check"></i><b>15.4</b> Case study - Lower advertising revenue reduced French newspaper prices between 1960 and 1974</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-19"><i class="fa fa-check"></i><b>15.4.1</b> Introduction</a></li>
<li class="chapter" data-level="15.4.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#background"><i class="fa fa-check"></i><b>15.4.2</b> Background</a></li>
<li class="chapter" data-level="15.4.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#data"><i class="fa fa-check"></i><b>15.4.3</b> Data</a></li>
<li class="chapter" data-level="15.4.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#model"><i class="fa fa-check"></i><b>15.4.4</b> Model</a></li>
<li class="chapter" data-level="15.4.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#results"><i class="fa fa-check"></i><b>15.4.5</b> Results</a></li>
<li class="chapter" data-level="15.4.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#other-points"><i class="fa fa-check"></i><b>15.4.6</b> Other points</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---funding-of-clinical-trials-and-reported-drug-efficacy"><i class="fa fa-check"></i><b>15.5</b> Case study - Funding of Clinical Trials and Reported Drug Efficacy</a></li>
<li class="chapter" data-level="15.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#regression-discontinuity-design"><i class="fa fa-check"></i><b>15.6</b> Regression discontinuity design</a>
<ul>
<li class="chapter" data-level="15.6.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-20"><i class="fa fa-check"></i><b>15.6.1</b> Introduction</a></li>
<li class="chapter" data-level="15.6.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#simulated-example-1"><i class="fa fa-check"></i><b>15.6.2</b> Simulated example</a></li>
<li class="chapter" data-level="15.6.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#overlap"><i class="fa fa-check"></i><b>15.6.3</b> Overlap</a></li>
<li class="chapter" data-level="15.6.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#examples"><i class="fa fa-check"></i><b>15.6.4</b> Examples</a></li>
<li class="chapter" data-level="15.6.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#implementation"><i class="fa fa-check"></i><b>15.6.5</b> Implementation</a></li>
<li class="chapter" data-level="15.6.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#fuzzy-rdd"><i class="fa fa-check"></i><b>15.6.6</b> Fuzzy RDD</a></li>
<li class="chapter" data-level="15.6.7" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#threats-to-validity"><i class="fa fa-check"></i><b>15.6.7</b> Threats to validity</a></li>
<li class="chapter" data-level="15.6.8" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#weaknesses"><i class="fa fa-check"></i><b>15.6.8</b> Weaknesses</a></li>
</ul></li>
<li class="chapter" data-level="15.7" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---stiers-hooghe-and-dassonneville-2020"><i class="fa fa-check"></i><b>15.7</b> Case study - Stiers, Hooghe, and Dassonneville, 2020</a></li>
<li class="chapter" data-level="15.8" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---caughey-and-sekhon.-2011"><i class="fa fa-check"></i><b>15.8</b> Case study - Caughey, and Sekhon., 2011</a></li>
<li class="chapter" data-level="15.9" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#instrumental-variables"><i class="fa fa-check"></i><b>15.9</b> Instrumental variables</a>
<ul>
<li class="chapter" data-level="15.9.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#introduction-21"><i class="fa fa-check"></i><b>15.9.1</b> Introduction</a></li>
<li class="chapter" data-level="15.9.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#history"><i class="fa fa-check"></i><b>15.9.2</b> History</a></li>
<li class="chapter" data-level="15.9.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#simulated-example-2"><i class="fa fa-check"></i><b>15.9.3</b> Simulated example</a></li>
<li class="chapter" data-level="15.9.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#implementation-1"><i class="fa fa-check"></i><b>15.9.4</b> Implementation</a></li>
<li class="chapter" data-level="15.9.5" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#assumptions-1"><i class="fa fa-check"></i><b>15.9.5</b> Assumptions</a></li>
<li class="chapter" data-level="15.9.6" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#conclusion"><i class="fa fa-check"></i><b>15.9.6</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="15.10" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#case-study---effect-of-police-on-crime"><i class="fa fa-check"></i><b>15.10</b> Case study - Effect of Police on Crime</a>
<ul>
<li class="chapter" data-level="15.10.1" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#overview-4"><i class="fa fa-check"></i><b>15.10.1</b> Overview</a></li>
<li class="chapter" data-level="15.10.2" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#data-1"><i class="fa fa-check"></i><b>15.10.2</b> Data</a></li>
<li class="chapter" data-level="15.10.3" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#model-1"><i class="fa fa-check"></i><b>15.10.3</b> Model</a></li>
<li class="chapter" data-level="15.10.4" data-path="causality-from-observational-data.html"><a href="causality-from-observational-data.html#discussion"><i class="fa fa-check"></i><b>15.10.4</b> Discussion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="poll-of-polls.html"><a href="poll-of-polls.html"><i class="fa fa-check"></i><b>16</b> Poll of polls</a>
<ul>
<li class="chapter" data-level="16.1" data-path="poll-of-polls.html"><a href="poll-of-polls.html#introduction-22"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="multilevel-modelling-with-post-stratification.html"><a href="multilevel-modelling-with-post-stratification.html"><i class="fa fa-check"></i><b>17</b> Multilevel modelling with post-stratification</a>
<ul>
<li class="chapter" data-level="17.1" data-path="multilevel-modelling-with-post-stratification.html"><a href="multilevel-modelling-with-post-stratification.html#introduction-23"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="multilevel-modelling-with-post-stratification.html"><a href="multilevel-modelling-with-post-stratification.html#hello-world-1"><i class="fa fa-check"></i><b>17.2</b> Hello world</a></li>
<li class="chapter" data-level="17.3" data-path="multilevel-modelling-with-post-stratification.html"><a href="multilevel-modelling-with-post-stratification.html#your-turn"><i class="fa fa-check"></i><b>17.3</b> Your turn!</a></li>
<li class="chapter" data-level="17.4" data-path="multilevel-modelling-with-post-stratification.html"><a href="multilevel-modelling-with-post-stratification.html#extended-example"><i class="fa fa-check"></i><b>17.4</b> Extended example</a></li>
<li class="chapter" data-level="17.5" data-path="multilevel-modelling-with-post-stratification.html"><a href="multilevel-modelling-with-post-stratification.html#your-turn-1"><i class="fa fa-check"></i><b>17.5</b> Your turn!</a></li>
<li class="chapter" data-level="17.6" data-path="multilevel-modelling-with-post-stratification.html"><a href="multilevel-modelling-with-post-stratification.html#adding-layers"><i class="fa fa-check"></i><b>17.6</b> Adding layers</a></li>
<li class="chapter" data-level="17.7" data-path="multilevel-modelling-with-post-stratification.html"><a href="multilevel-modelling-with-post-stratification.html#communication"><i class="fa fa-check"></i><b>17.7</b> Communication</a></li>
<li class="chapter" data-level="17.8" data-path="multilevel-modelling-with-post-stratification.html"><a href="multilevel-modelling-with-post-stratification.html#concluding-remarks"><i class="fa fa-check"></i><b>17.8</b> Concluding remarks</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="text-as-data.html"><a href="text-as-data.html"><i class="fa fa-check"></i><b>18</b> Text as data</a>
<ul>
<li class="chapter" data-level="18.1" data-path="text-as-data.html"><a href="text-as-data.html#introduction-24"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="text-as-data.html"><a href="text-as-data.html#lasso-regression"><i class="fa fa-check"></i><b>18.2</b> Lasso regression</a></li>
<li class="chapter" data-level="18.3" data-path="text-as-data.html"><a href="text-as-data.html#topic-models"><i class="fa fa-check"></i><b>18.3</b> Topic models</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="text-as-data.html"><a href="text-as-data.html#overview-5"><i class="fa fa-check"></i><b>18.3.1</b> Overview</a></li>
<li class="chapter" data-level="18.3.2" data-path="text-as-data.html"><a href="text-as-data.html#document-generation-process"><i class="fa fa-check"></i><b>18.3.2</b> Document generation process</a></li>
<li class="chapter" data-level="18.3.3" data-path="text-as-data.html"><a href="text-as-data.html#analysis-process"><i class="fa fa-check"></i><b>18.3.3</b> Analysis process</a></li>
<li class="chapter" data-level="18.3.4" data-path="text-as-data.html"><a href="text-as-data.html#warnings-and-extensions"><i class="fa fa-check"></i><b>18.3.4</b> Warnings and extensions</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="text-as-data.html"><a href="text-as-data.html#word-embedding"><i class="fa fa-check"></i><b>18.4</b> Word embedding</a></li>
<li class="chapter" data-level="18.5" data-path="text-as-data.html"><a href="text-as-data.html#conclusion-1"><i class="fa fa-check"></i><b>18.5</b> Conclusion</a></li>
</ul></li>
<li class="part"><span><b>VI Scale</b></span></li>
<li class="chapter" data-level="19" data-path="cloud.html"><a href="cloud.html"><i class="fa fa-check"></i><b>19</b> Cloud</a>
<ul>
<li class="chapter" data-level="19.1" data-path="cloud.html"><a href="cloud.html#introduction-25"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
<li class="chapter" data-level="19.2" data-path="cloud.html"><a href="cloud.html#google-colab"><i class="fa fa-check"></i><b>19.2</b> Google Colab</a></li>
<li class="chapter" data-level="19.3" data-path="cloud.html"><a href="cloud.html#aws"><i class="fa fa-check"></i><b>19.3</b> AWS</a></li>
<li class="chapter" data-level="19.4" data-path="cloud.html"><a href="cloud.html#google-compute-engine"><i class="fa fa-check"></i><b>19.4</b> Google Compute Engine</a></li>
<li class="chapter" data-level="19.5" data-path="cloud.html"><a href="cloud.html#azure"><i class="fa fa-check"></i><b>19.5</b> Azure</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="deploy.html"><a href="deploy.html"><i class="fa fa-check"></i><b>20</b> Deploy</a>
<ul>
<li class="chapter" data-level="20.1" data-path="deploy.html"><a href="deploy.html#introduction-26"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
<li class="chapter" data-level="20.2" data-path="deploy.html"><a href="deploy.html#packages"><i class="fa fa-check"></i><b>20.2</b> Packages</a></li>
<li class="chapter" data-level="20.3" data-path="deploy.html"><a href="deploy.html#shiny-1"><i class="fa fa-check"></i><b>20.3</b> Shiny</a></li>
<li class="chapter" data-level="20.4" data-path="deploy.html"><a href="deploy.html#plumber-and-model-apis"><i class="fa fa-check"></i><b>20.4</b> Plumber and model APIs</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="deploy.html"><a href="deploy.html#hello-toronto"><i class="fa fa-check"></i><b>20.4.1</b> Hello Toronto</a></li>
<li class="chapter" data-level="20.4.2" data-path="deploy.html"><a href="deploy.html#local-model"><i class="fa fa-check"></i><b>20.4.2</b> Local model</a></li>
<li class="chapter" data-level="20.4.3" data-path="deploy.html"><a href="deploy.html#cloud-model"><i class="fa fa-check"></i><b>20.4.3</b> Cloud model</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Assessment</b></span></li>
<li class="chapter" data-level="21" data-path="papers.html"><a href="papers.html"><i class="fa fa-check"></i><b>21</b> Papers</a>
<ul>
<li class="chapter" data-level="21.1" data-path="papers.html"><a href="papers.html#mandatory-minimums"><i class="fa fa-check"></i><b>21.1</b> ‘Mandatory Minimums’</a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="papers.html"><a href="papers.html#task"><i class="fa fa-check"></i><b>21.1.1</b> Task</a></li>
<li class="chapter" data-level="21.1.2" data-path="papers.html"><a href="papers.html#guidance"><i class="fa fa-check"></i><b>21.1.2</b> Guidance</a></li>
<li class="chapter" data-level="21.1.3" data-path="papers.html"><a href="papers.html#check-offs-points"><i class="fa fa-check"></i><b>21.1.3</b> Check offs points</a></li>
<li class="chapter" data-level="21.1.4" data-path="papers.html"><a href="papers.html#faq"><i class="fa fa-check"></i><b>21.1.4</b> FAQ</a></li>
<li class="chapter" data-level="21.1.5" data-path="papers.html"><a href="papers.html#rubric"><i class="fa fa-check"></i><b>21.1.5</b> Rubric</a></li>
<li class="chapter" data-level="21.1.6" data-path="papers.html"><a href="papers.html#previous-examples"><i class="fa fa-check"></i><b>21.1.6</b> Previous examples</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="papers.html"><a href="papers.html#these-numbers-mean-dial-it-up"><i class="fa fa-check"></i><b>21.2</b> ‘These numbers mean dial it up’</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="papers.html"><a href="papers.html#task-1"><i class="fa fa-check"></i><b>21.2.1</b> Task</a></li>
<li class="chapter" data-level="21.2.2" data-path="papers.html"><a href="papers.html#guidance-1"><i class="fa fa-check"></i><b>21.2.2</b> Guidance</a></li>
<li class="chapter" data-level="21.2.3" data-path="papers.html"><a href="papers.html#check-offs-points-1"><i class="fa fa-check"></i><b>21.2.3</b> Check offs points</a></li>
<li class="chapter" data-level="21.2.4" data-path="papers.html"><a href="papers.html#faq-1"><i class="fa fa-check"></i><b>21.2.4</b> FAQ</a></li>
<li class="chapter" data-level="21.2.5" data-path="papers.html"><a href="papers.html#rubric-1"><i class="fa fa-check"></i><b>21.2.5</b> Rubric</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="papers.html"><a href="papers.html#the-short-list"><i class="fa fa-check"></i><b>21.3</b> ‘The Short List’</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="papers.html"><a href="papers.html#task-2"><i class="fa fa-check"></i><b>21.3.1</b> Task</a></li>
<li class="chapter" data-level="21.3.2" data-path="papers.html"><a href="papers.html#guidance-2"><i class="fa fa-check"></i><b>21.3.2</b> Guidance</a></li>
<li class="chapter" data-level="21.3.3" data-path="papers.html"><a href="papers.html#check-offs-points-2"><i class="fa fa-check"></i><b>21.3.3</b> Check offs points</a></li>
<li class="chapter" data-level="21.3.4" data-path="papers.html"><a href="papers.html#faq-2"><i class="fa fa-check"></i><b>21.3.4</b> FAQ</a></li>
<li class="chapter" data-level="21.3.5" data-path="papers.html"><a href="papers.html#rubric-2"><i class="fa fa-check"></i><b>21.3.5</b> Rubric</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="papers.html"><a href="papers.html#two-cathedrals"><i class="fa fa-check"></i><b>21.4</b> ‘Two Cathedrals’</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="papers.html"><a href="papers.html#task-3"><i class="fa fa-check"></i><b>21.4.1</b> Task</a></li>
<li class="chapter" data-level="21.4.2" data-path="papers.html"><a href="papers.html#guidance-3"><i class="fa fa-check"></i><b>21.4.2</b> Guidance</a></li>
<li class="chapter" data-level="21.4.3" data-path="papers.html"><a href="papers.html#peer-review-submission"><i class="fa fa-check"></i><b>21.4.3</b> Peer review submission</a></li>
<li class="chapter" data-level="21.4.4" data-path="papers.html"><a href="papers.html#conduct-peer-review"><i class="fa fa-check"></i><b>21.4.4</b> Conduct peer-review</a></li>
<li class="chapter" data-level="21.4.5" data-path="papers.html"><a href="papers.html#check-offs-points-3"><i class="fa fa-check"></i><b>21.4.5</b> Check offs points</a></li>
<li class="chapter" data-level="21.4.6" data-path="papers.html"><a href="papers.html#faq-3"><i class="fa fa-check"></i><b>21.4.6</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="papers.html"><a href="papers.html#a-proportional-response"><i class="fa fa-check"></i><b>21.5</b> ‘A Proportional Response’</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="papers.html"><a href="papers.html#task-4"><i class="fa fa-check"></i><b>21.5.1</b> Task</a></li>
<li class="chapter" data-level="21.5.2" data-path="papers.html"><a href="papers.html#recommended-steps"><i class="fa fa-check"></i><b>21.5.2</b> Recommended steps</a></li>
<li class="chapter" data-level="21.5.3" data-path="papers.html"><a href="papers.html#check-offs-points-4"><i class="fa fa-check"></i><b>21.5.3</b> Check offs points</a></li>
<li class="chapter" data-level="21.5.4" data-path="papers.html"><a href="papers.html#faq-4"><i class="fa fa-check"></i><b>21.5.4</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="21.6" data-path="papers.html"><a href="papers.html#mr-willis-of-ohio"><i class="fa fa-check"></i><b>21.6</b> ‘Mr Willis of Ohio’</a>
<ul>
<li class="chapter" data-level="21.6.1" data-path="papers.html"><a href="papers.html#task-5"><i class="fa fa-check"></i><b>21.6.1</b> Task</a></li>
<li class="chapter" data-level="21.6.2" data-path="papers.html"><a href="papers.html#recommended-steps-1"><i class="fa fa-check"></i><b>21.6.2</b> Recommended steps</a></li>
<li class="chapter" data-level="21.6.3" data-path="papers.html"><a href="papers.html#check-offs-points-5"><i class="fa fa-check"></i><b>21.6.3</b> Check offs points</a></li>
<li class="chapter" data-level="21.6.4" data-path="papers.html"><a href="papers.html#faq-5"><i class="fa fa-check"></i><b>21.6.4</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="21.7" data-path="papers.html"><a href="papers.html#five-votes-down"><i class="fa fa-check"></i><b>21.7</b> ‘Five Votes Down’</a>
<ul>
<li class="chapter" data-level="21.7.1" data-path="papers.html"><a href="papers.html#task-6"><i class="fa fa-check"></i><b>21.7.1</b> Task</a></li>
<li class="chapter" data-level="21.7.2" data-path="papers.html"><a href="papers.html#recommended-steps-2"><i class="fa fa-check"></i><b>21.7.2</b> Recommended steps</a></li>
<li class="chapter" data-level="21.7.3" data-path="papers.html"><a href="papers.html#check-offs-points-6"><i class="fa fa-check"></i><b>21.7.3</b> Check offs points</a></li>
<li class="chapter" data-level="21.7.4" data-path="papers.html"><a href="papers.html#faq-6"><i class="fa fa-check"></i><b>21.7.4</b> FAQ</a></li>
</ul></li>
<li class="chapter" data-level="21.8" data-path="papers.html"><a href="papers.html#whats-next"><i class="fa fa-check"></i><b>21.8</b> ‘What’s next?’</a>
<ul>
<li class="chapter" data-level="21.8.1" data-path="papers.html"><a href="papers.html#task-7"><i class="fa fa-check"></i><b>21.8.1</b> Task</a></li>
<li class="chapter" data-level="21.8.2" data-path="papers.html"><a href="papers.html#recommended-steps-3"><i class="fa fa-check"></i><b>21.8.2</b> Recommended steps</a></li>
<li class="chapter" data-level="21.8.3" data-path="papers.html"><a href="papers.html#check-offs-points-7"><i class="fa fa-check"></i><b>21.8.3</b> Check offs points</a></li>
<li class="chapter" data-level="21.8.4" data-path="papers.html"><a href="papers.html#faq-7"><i class="fa fa-check"></i><b>21.8.4</b> FAQ</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telling Stories With Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="gather-data" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Gather data</h1>
<p><em>Last updated: 2 February 2021.</em></p>
<p><strong>Recommended reading</strong></p>
<ul>
<li>Benoit, Kenneth, 2019, ‘Text as data: An overview,’ 17 July, <a href="https://kenbenoit.net/pdfs/28%20Benoit%20Text%20as%20Data%20draft%202.pdf" class="uri">https://kenbenoit.net/pdfs/28%20Benoit%20Text%20as%20Data%20draft%202.pdf</a>.</li>
<li>Bolton, Liza, 2019, ‘A quick look at museums per capita,’ 26 March, <a href="http://blog.dataembassy.co.nz/museums-per-capita/" class="uri">http://blog.dataembassy.co.nz/museums-per-capita/</a>.</li>
<li>Bryan, Jennifer, and Jim Hester, 2020, <em>What They Forgot to Teach You About R</em>, Chapter 7, <a href="https://rstats.wtf/index.html" class="uri">https://rstats.wtf/index.html</a>.</li>
<li>Clavelle, Tyler, 2017, ‘Using R to extract data from web APIs,’ 5 June, <a href="https://www.tylerclavelle.com/code/2017/randapis/" class="uri">https://www.tylerclavelle.com/code/2017/randapis/</a>.</li>
<li>Cooksey, Brian, 2014, ‘An Introduction to APIs,’ Zapier, 22 April, <a href="https://zapier.com/learn/apis/" class="uri">https://zapier.com/learn/apis/</a>.</li>
<li>Dogucu, Mine, and Mine Çetinkaya-Runde, 2020,‘Web Scraping in the Statistics and Data Science Curriculum: Challenges and Opportunities,’ 6 May.</li>
<li>Gelfand, Sharla, 2019, ‘Crying @ Sephora,’ 8 November, <a href="https://sharla.party/post/crying-sephora/" class="uri">https://sharla.party/post/crying-sephora/</a>.</li>
<li>Goldman, Shayna, 2019, ‘How Much Do NHL Players Really Make? Part 2: Taxes,’ <a href="https://hockey-graphs.com/2019/01/08/how-much-do-nhl-players-really-make-part-2-taxes/" class="uri">https://hockey-graphs.com/2019/01/08/how-much-do-nhl-players-really-make-part-2-taxes/</a>.</li>
<li>Graham, Shawn, 2019, ‘Scraping with rvest,’ 7 November, <a href="https://electricarchaeology.ca/2019/11/07/scraping-with-rvest/" class="uri">https://electricarchaeology.ca/2019/11/07/scraping-with-rvest/</a>.</li>
<li>Henze, Martin, 2020, ‘Web Scraping with rvest + Astro Throwback,’ 23 January, <a href="https://heads0rtai1s.github.io/2020/01/23/rvest-intro-astro/" class="uri">https://heads0rtai1s.github.io/2020/01/23/rvest-intro-astro/</a>.</li>
<li>Hudon, Caitlin, 2017, ‘’Blue Christmas: A data-driven search for the most depressing Christmas song,’ 22 December, <a href="https://caitlinhudon.com/2017/12/22/blue-christmas/" class="uri">https://caitlinhudon.com/2017/12/22/blue-christmas/</a>.</li>
<li>Luscombe, Alex, 2020, ‘A Gentle Introduction to Tesseract OCR,’ 3 June, <a href="https://alexluscombe.ca/post/ocr-tutorial/" class="uri">https://alexluscombe.ca/post/ocr-tutorial/</a>.</li>
<li>Luscombe, Alex, 2020, ‘Getting your .pdfs into R,’ 5 August, <a href="https://alexluscombe.ca/post/r-pdftools/" class="uri">https://alexluscombe.ca/post/r-pdftools/</a>.</li>
<li>Luscombe, Alex, 2020, ‘Parsing your .pdfs in R,’ 10 August, <a href="https://alexluscombe.ca/post/parsing-pdfs/" class="uri">https://alexluscombe.ca/post/parsing-pdfs/</a>.</li>
<li>Marshall, James, ‘HTML Made Really Easy,’ <a href="https://www.jmarshall.com/easy/html/" class="uri">https://www.jmarshall.com/easy/html/</a>.</li>
<li>Marshall, James, ‘HTTP Made Really Easy,’ <a href="https://www.jmarshall.com/easy/http/" class="uri">https://www.jmarshall.com/easy/http/</a>.</li>
<li>Nakagawara, Ryo, 2020, ‘Intro to {polite} Web Scraping of Soccer Data with R!’ 14 May, <a href="https://ryo-n7.github.io/2020-05-14-webscrape-soccer-data-with-R/" class="uri">https://ryo-n7.github.io/2020-05-14-webscrape-soccer-data-with-R/</a>.</li>
<li>Pavlik, Kaylin, 2020, ‘How do fiber types appear together in yarn blends?’ 17 February, <a href="https://www.kaylinpavlik.com/ravelry-yarn-fibers/" class="uri">https://www.kaylinpavlik.com/ravelry-yarn-fibers/</a>.</li>
<li>Silge, Julia and David Robinson, 2020, <em>Text Mining with R</em>, Chapters 1, 3, and 6, <a href="https://www.tidytextmining.com/" class="uri">https://www.tidytextmining.com/</a>.</li>
<li>Silge, Julia, 2017, ‘Scraping CRAN with rvest,’ 5 March, <a href="https://juliasilge.com/blog/scraping-cran/" class="uri">https://juliasilge.com/blog/scraping-cran/</a>.</li>
<li>Smale, David, 2020, ‘Daniel Johnston,’ <a href="https://davidsmale.netlify.com/portfolio/daniel-johnston/" class="uri">https://davidsmale.netlify.com/portfolio/daniel-johnston/</a>.</li>
<li>Taddy, Matt, 2019, <em>Business Data Science</em>, Chapter 8, pp. 231-259.</li>
<li>Wickham, Hadley, ‘Managing Secrets,’ <a href="https://cran.r-project.org/web/packages/httr/vignettes/secrets.html" class="uri">https://cran.r-project.org/web/packages/httr/vignettes/secrets.html</a>.</li>
<li>Wickham, Hadley, 2014, ‘rvest: easy web scraping with R,’ 24 November, <a href="https://blog.rstudio.com/2014/11/24/rvest-easy-web-scraping-with-r/" class="uri">https://blog.rstudio.com/2014/11/24/rvest-easy-web-scraping-with-r/</a>.</li>
<li>Wickham, Hadley, nd, ‘Getting started with httr,’ <a href="https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html" class="uri">https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html</a>.</li>
</ul>
<p><strong>Recommended viewing</strong></p>
<ul>
<li>D’Agostino McGowan, Lucy, 2020 ‘Harnessing the Power of the Web via R Clients for Web APIs,’ talk at ASA Joint Statistical Meeting 2018, <a href="https://www.lucymcgowan.com/talk/asa_joint_statistical_meeting_2018/" class="uri">https://www.lucymcgowan.com/talk/asa_joint_statistical_meeting_2018/</a>.</li>
<li>Tatman, Rachel, 2018, ‘Character Encoding and You,’ 21 February, <a href="https://youtu.be/2U9EHYqc59Y" class="uri">https://youtu.be/2U9EHYqc59Y</a>.</li>
</ul>
<p><strong>Key concepts/skills/etc</strong></p>
<ul>
<li>Use APIs where possible because the data provider has specified the data they would like to make available to you, and the conditions under which they are making it available.</li>
<li>Often R packages have been written to make it easier to use APIs.</li>
<li>Use R environments to manage your keys.</li>
<li>Using the verb GET (‘a GET request’) means providing a URL and the server will return something, using the verb POST (a POST request’) means providing some data and the server will deal with that data.</li>
<li>Cleaning data</li>
<li>Graphing data to tell a story</li>
<li>Respectfully scraping data</li>
<li>Approaching extracting text from PDFs as a workflow.</li>
<li>Planning what is needed at the start.</li>
<li>Starting small and then iterating.</li>
<li>Putting in place checks.</li>
<li>Gathering text data.</li>
<li>Preparing text datasets.</li>
</ul>
<p><strong>Key libraries</strong></p>
<ul>
<li><code>babynames</code></li>
<li><code>broom</code></li>
<li><code>dplyr</code></li>
<li><code>ggplot2</code></li>
<li><code>gutenbergr</code></li>
<li><code>janitor</code></li>
<li><code>jsonlite</code></li>
<li><code>pdftools</code></li>
<li><code>purrr</code></li>
<li><code>rtweet</code></li>
<li><code>rvest</code></li>
<li><code>spotifyr</code></li>
<li><code>stringi</code></li>
<li><code>tidymodels</code></li>
<li><code>tidytext</code></li>
<li><code>tidyverse</code></li>
<li><code>usethis</code></li>
</ul>
<p><strong>Key functions/etc</strong></p>
<ul>
<li><code>as_factor()</code></li>
<li><code>as_tibble()</code></li>
<li><code>bind_tf_idf()</code></li>
<li><code>c()</code></li>
<li><code>case_when()</code></li>
<li><code>cat()</code></li>
<li><code>edit_r_environ()</code></li>
<li><code>file()</code></li>
<li><code>fromJSON()</code></li>
<li><code>function()</code></li>
<li><code>GET()</code></li>
<li><code>get_artist_audio_features()</code></li>
<li><code>get_favorites()</code></li>
<li><code>get_my_top_artists_or_tracks()</code></li>
<li><code>html_node()</code></li>
<li><code>html_nodes()</code></li>
<li><code>html_text()</code></li>
<li><code>pdf_data()</code></li>
<li><code>pdf_text()</code></li>
<li><code>pmap_dfr()</code></li>
<li><code>read_html()</code></li>
<li><code>readRDS()</code></li>
<li><code>safely()</code></li>
<li><code>search_tweets()</code></li>
<li><code>sleep()</code></li>
<li><code>tesseract()</code></li>
<li><code>unnest_tokens()</code></li>
<li><code>walk2()</code></li>
<li><code>write_html()</code></li>
<li><code>write_lines()</code></li>
</ul>
<p><strong>Quiz</strong></p>
<ol style="list-style-type: decimal">
<li>In your own words, what is an API (write a paragraph or two)?</li>
<li>Find two APIs and discuss how you could use them to tell interesting stories (write a paragraph or two for each).</li>
<li>Find two APIs that have an R packages written around them. How could you use these to tell interesting stories? (Write a paragraph or two for each.)</li>
<li>What is the main argument to <code>httr::GET()</code> (pick one)?
<ol style="list-style-type: lower-alpha">
<li>‘url’</li>
<li>‘website’</li>
<li>‘domain’</li>
<li>‘location’</li>
</ol></li>
<li>Name three reasons why we should be respectful when getting scraping data from websites (write a paragraph or two).</li>
<li>What features of a website do we typically take advantage of when we parse the code (select all)?
<ol style="list-style-type: lower-alpha">
<li>HTML/CSS mark-up.</li>
<li>Cookies.</li>
<li>Facebook beacons.</li>
<li>Code comments.</li>
</ol></li>
<li>What are three advantages and three disadvantages of scraping compared with using an API (write a paragraph or two)?</li>
<li>What are three delimiters that could be useful when trying to bring order to the PDF that you read in as a character vector (write a paragraph or two)?</li>
<li>What do I need to put inside “SOMETHING_HERE” if I want to match regular expressions for a full stop i.e. “.” (hint: see the ‘strings’ cheat sheet) (pick one)?
<ol style="list-style-type: lower-alpha">
<li><code>.</code></li>
<li><code>\.</code></li>
<li><code>\\.</code></li>
<li><code>\\\.</code></li>
</ol></li>
<li>Name three reasons for sketching out what you want before starting to try to extract data from a PDF (write a paragraph or two for each).</li>
<li>If you are interested in demographic data then what are three checks that you might like to do? What are three if you are interested in economic data such as GDP, interest rates, and exchange rates? (Write an explanation for each.)</li>
<li>What does the <code>purrr</code> package do (select all)?
<ol style="list-style-type: lower-alpha">
<li>Enhances R’s functional programming toolkit.</li>
<li>Makes loops easier to code and read.</li>
<li>Checks the consistency of datasets.</li>
<li>Identifies issues in data structures and proposes replacements.</li>
</ol></li>
<li>Which of these are functions from the <code>purrr</code> package (select all)?
<ol style="list-style-type: lower-alpha">
<li><code>map()</code></li>
<li><code>walk()</code></li>
<li><code>run()</code></li>
<li><code>safely()</code></li>
</ol></li>
<li>Why should we use <code>safely()</code> when scraping data (pick one)?
<ol style="list-style-type: lower-alpha">
<li>To protect us from hackers.</li>
<li>To avoid side effects of pages with issues.</li>
<li>To slow down our scraping to an appropriate speed.</li>
</ol></li>
<li>What are some principles to follow when scraping (select all)?
<ol style="list-style-type: lower-alpha">
<li>Avoid it if possible</li>
<li>Follow the site’s guidance</li>
<li>Slow down</li>
<li>Use a scalpel not an axe.<br />
</li>
</ol></li>
<li>What is a robots.txt file (pick one)?
<ol style="list-style-type: lower-alpha">
<li>The instructions that Frankenstein followed.</li>
<li>Notes that web scrapers should follow when scraping.</li>
</ol></li>
<li>What is the html tag for an item in list (pick one)?
<ol style="list-style-type: lower-alpha">
<li><code>li</code></li>
<li><code>body</code></li>
<li><code>b</code></li>
<li><code>em</code></li>
</ol></li>
<li>If I have the following text data ‘rohan_alexander’ in a column called ‘names’ and want to split it into first name and surname based on the underbar what function should I use (pick one)?
<ol style="list-style-type: lower-alpha">
<li><code>separate()</code></li>
<li><code>slice()</code></li>
<li><code>spacing()</code></li>
<li><code>text_to_columns()</code></li>
</ol></li>
<li>Gather some data yourself using a method that is introduced here - APIs directly or via a wrapper package, web scraping, PDF parsing, OCR, or text. Write a few paragraphs about the data source, what you gathered, and how you went about it. What took longer than you expected? When did it become fun? What would you do differently next time you do this? Please include a link to your GitHub repo so I can see the code, but it won’t be strictly marked - this is more about encouraging you to have a go. (Start with something tiny and very specific, get that working, and then increase the scope - almost everything will be more difficult and time-consuming than you think - and don’t forget to plan it out before you start.)</li>
</ol>
<div id="apis" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> APIs</h2>
<p>In everyday language, and for our purposes, an Application Programming Interface (API) is simply a situation in which someone has set up specific files on their computer such that you can follow their instructions to get them. For instance, when you use a gif on Slack, Slack asks Giphy’s server for the appropriate gif, Giphy’s server gives that gif to Slack and then Slack inserts it into your chat. The way in which Slack and Giphy interact is determined by Giphy’s API. More strictly, an API is just an application that runs on a server that we access using the HTTP protocol.</p>
<p>In our case, we are going to focus on using APIs for gathering data. I’ll tailor the language that I use toward that:</p>
<blockquote>
<p>[a]n API is the tool that makes a website’s data digestible for a computer. Through it, a computer can view and edit data, just like a person can by loading pages and submitting forms.</p>
<p><span class="citation"><a href="references-1.html#ref-zapierapis" role="doc-biblioref">Cooksey</a> (<a href="references-1.html#ref-zapierapis" role="doc-biblioref">2014</a>)</span>, Chapter 1.</p>
</blockquote>
<p>For instance, you could go to <a href="https://www.google.ca/maps">Google Maps</a> and then scroll and click and drag to center the map on Canberra, Australia, or you could just paste this into your browser: <a href="https://www.google.ca/maps/@-35.2812958,149.1248113,16z" class="uri">https://www.google.ca/maps/@-35.2812958,149.1248113,16z</a>. You just used the Google Maps API.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> The result should be a map that looks something like Figure <a href="gather-data.html#fig:focuson2020">7.1</a> .</p>
<div class="figure"><span id="fig:focuson2020"></span>
<img src="figures/googlemaps.png" alt="Example of Google Maps, as at 25 January 2021." width="90%" />
<p class="caption">
Figure 7.1: Example of Google Maps, as at 25 January 2021.
</p>
</div>
<p>The advantage of using an API is that the data provider specifies exactly the data that they are willing to provide, and the terms under which they will provide it. These terms may include things like rate limits (i.e. how often you can ask for data), and what you can do with the data (e.g. maybe you’re not allowed to use it for commercial purposes, or to republish it, or whatever). Additionally, because the API is being provided specifically for you to use it, it is less likely to be subject to unexpected changes. Because of this it is ethically and legally clear that when an API is available you should try to use it.</p>
<p>We’re going to run through some case studies interacting with APIs in R. In the first we will deal directly with an API. That works and is a handy skill to have, but there are a lot of R packages that wrap around APIs making it easier for you to use an API within ‘familiar surroundings.’ I’ll also run through two fun APIs that have R packages built around them.</p>
</div>
<div id="case-study---arxiv" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Case study - arXiv</h2>
<p>In this section we introduce GET requests in which we use an API directly. We will use the <code>httr</code> package <span class="citation">(<a href="references-1.html#ref-citehttr" role="doc-biblioref">Wickham 2019a</a>)</span>. A GET request tries to obtain some specific data and the main argument is <code>url</code>. Exactly as before with the Google Maps example! In that case, the specific information was a map and some information about it.</p>
<p>For this example we’ll look at <a href="https://arxiv.org">arXiv</a>, which is a repository for academic articles before they go through peer-review. I’ll ask arXiv to return some information about a paper that I recently uploaded with a former student. The content that is returned will be a series of information about that paper.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="gather-data.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&#39;httr&#39;)</span></span>
<span id="cb225-2"><a href="gather-data.html#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb225-3"><a href="gather-data.html#cb225-3" aria-hidden="true" tabindex="-1"></a>arxiv <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="st">&#39;http://export.arxiv.org/api/query?id_list=2101.05225&#39;</span>)</span>
<span id="cb225-4"><a href="gather-data.html#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(arxiv)</span></code></pre></div>
<pre><code>## [1] &quot;response&quot;</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="gather-data.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">content</span>(arxiv, <span class="st">&quot;text&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb227-2"><a href="gather-data.html#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
## &lt;feed xmlns=&quot;http://www.w3.org/2005/Atom&quot;&gt;
##   &lt;link href=&quot;http://arxiv.org/api/query?search_query%3D%26id_list%3D2101.05225%26start%3D0%26max_results%3D10&quot; rel=&quot;self&quot; type=&quot;application/atom+xml&quot;/&gt;
##   &lt;title type=&quot;html&quot;&gt;ArXiv Query: search_query=&amp;amp;id_list=2101.05225&amp;amp;start=0&amp;amp;max_results=10&lt;/title&gt;
##   &lt;id&gt;http://arxiv.org/api/p9UZyl2Vt0cHwPSKinDSThE23qI&lt;/id&gt;
##   &lt;updated&gt;2021-04-06T00:00:00-04:00&lt;/updated&gt;
##   &lt;opensearch:totalResults xmlns:opensearch=&quot;http://a9.com/-/spec/opensearch/1.1/&quot;&gt;1&lt;/opensearch:totalResults&gt;
##   &lt;opensearch:startIndex xmlns:opensearch=&quot;http://a9.com/-/spec/opensearch/1.1/&quot;&gt;0&lt;/opensearch:startIndex&gt;
##   &lt;opensearch:itemsPerPage xmlns:opensearch=&quot;http://a9.com/-/spec/opensearch/1.1/&quot;&gt;10&lt;/opensearch:itemsPerPage&gt;
##   &lt;entry&gt;
##     &lt;id&gt;http://arxiv.org/abs/2101.05225v1&lt;/id&gt;
##     &lt;updated&gt;2021-01-13T17:37:07Z&lt;/updated&gt;
##     &lt;published&gt;2021-01-13T17:37:07Z&lt;/published&gt;
##     &lt;title&gt;On consistency scores in text data with an implementation in R&lt;/title&gt;
##     &lt;summary&gt;  In this paper, we introduce a reproducible cleaning process for the text
## extracted from PDFs using n-gram models. Our approach compares the originally
## extracted text with the text generated from, or expected by, these models using
## earlier text as stimulus. To guide this process, we introduce the notion of a
## consistency score, which refers to the proportion of text that is expected by
## the model. This is used to monitor changes during the cleaning process, and
## across different corpuses. We illustrate our process on text from the book Jane
## Eyre and introduce both a Shiny application and an R package to make our
## process easier for others to adopt.
## &lt;/summary&gt;
##     &lt;author&gt;
##       &lt;name&gt;Ke-Li Chiu&lt;/name&gt;
##     &lt;/author&gt;
##     &lt;author&gt;
##       &lt;name&gt;Rohan Alexander&lt;/name&gt;
##     &lt;/author&gt;
##     &lt;arxiv:comment xmlns:arxiv=&quot;http://arxiv.org/schemas/atom&quot;&gt;13 pages, 0 figures&lt;/arxiv:comment&gt;
##     &lt;link href=&quot;http://arxiv.org/abs/2101.05225v1&quot; rel=&quot;alternate&quot; type=&quot;text/html&quot;/&gt;
##     &lt;link title=&quot;pdf&quot; href=&quot;http://arxiv.org/pdf/2101.05225v1&quot; rel=&quot;related&quot; type=&quot;application/pdf&quot;/&gt;
##     &lt;arxiv:primary_category xmlns:arxiv=&quot;http://arxiv.org/schemas/atom&quot; term=&quot;cs.CL&quot; scheme=&quot;http://arxiv.org/schemas/atom&quot;/&gt;
##     &lt;category term=&quot;cs.CL&quot; scheme=&quot;http://arxiv.org/schemas/atom&quot;/&gt;
##   &lt;/entry&gt;
## &lt;/feed&gt;
## </code></pre>
<p>We get a variety of information about this paper including the title, abstract, and authors.</p>
</div>
<div id="case-study---rtweet" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Case study - rtweet</h2>
<p>Twitter is a rich source of text and other data. The Twitter API is the way in which Twitter ask that you interact with Twitter in order to gather these data. The <code>rtweet</code> package <span class="citation">(<a href="references-1.html#ref-rtweet-package" role="doc-biblioref">Kearney 2019</a>)</span> is built around this API and allows us to interact with it in ways that are similar to using any other R package. Initially all you need a regular Twitter account.</p>
<p>Get started by install the library if you need and then calling it.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="gather-data.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&#39;rtweet&#39;)</span></span>
<span id="cb229-2"><a href="gather-data.html#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rtweet)</span>
<span id="cb229-3"><a href="gather-data.html#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>To get started we need to authorise rtweet. We start that process by calling a function from the package.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="gather-data.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_favorites</span>(<span class="at">user =</span> <span class="st">&quot;RohanAlexander&quot;</span>)</span></code></pre></div>
<p>This will open a browser on your computer, and you will then have to log into your regular Twitter account as shown in Figure <a href="gather-data.html#fig:rtweetlogin">7.2</a>.</p>
<div class="figure"><span id="fig:rtweetlogin"></span>
<img src="figures/rtweet.png" alt="rtweet authorisation page" width="90%" />
<p class="caption">
Figure 7.2: rtweet authorisation page
</p>
</div>
<p>Once that is done we can actually get my favourites and then save them.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="gather-data.html#cb231-1" aria-hidden="true" tabindex="-1"></a>rohans_favs <span class="ot">&lt;-</span> <span class="fu">get_favorites</span>(<span class="st">&quot;RohanAlexander&quot;</span>)</span>
<span id="cb231-2"><a href="gather-data.html#cb231-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-3"><a href="gather-data.html#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(rohans_favs, <span class="st">&quot;dont_push/rohans_favs.rds&quot;</span>)</span></code></pre></div>
<p>And then looking at the most recent favourite, we can see it was when Professor Bolton tweeted about one of the stellar students in ISSC.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="gather-data.html#cb232-1" aria-hidden="true" tabindex="-1"></a>rohans_favs <span class="sc">%&gt;%</span> </span>
<span id="cb232-2"><a href="gather-data.html#cb232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(created_at)) <span class="sc">%&gt;%</span> </span>
<span id="cb232-3"><a href="gather-data.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb232-4"><a href="gather-data.html#cb232-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(screen_name, text)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   screen_name text                                                              
##   &lt;chr&gt;       &lt;chr&gt;                                                             
## 1 les_ja      I&#39;ve signed an offer letter, so I think I can formally announce: …</code></pre>
<p>Let’s look at who is tweeting about R, using one of the common R hashtags: #rstats. I’ve removed retweets so that we hopefully get some actual interesting projects.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="gather-data.html#cb234-1" aria-hidden="true" tabindex="-1"></a>rstats_tweets <span class="ot">&lt;-</span> <span class="fu">search_tweets</span>(</span>
<span id="cb234-2"><a href="gather-data.html#cb234-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">q =</span> <span class="st">&quot;#rstats&quot;</span>,</span>
<span id="cb234-3"><a href="gather-data.html#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">include_rts =</span> <span class="cn">FALSE</span></span>
<span id="cb234-4"><a href="gather-data.html#cb234-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb234-5"><a href="gather-data.html#cb234-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-6"><a href="gather-data.html#cb234-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(rstats_tweets, <span class="st">&quot;dont_push/rstats_tweets.rds&quot;</span>)</span></code></pre></div>
<p>And then have a look at them.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="gather-data.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rstats_tweets)</span></code></pre></div>
<pre><code>##  [1] &quot;user_id&quot;                 &quot;status_id&quot;              
##  [3] &quot;created_at&quot;              &quot;screen_name&quot;            
##  [5] &quot;text&quot;                    &quot;source&quot;                 
##  [7] &quot;display_text_width&quot;      &quot;reply_to_status_id&quot;     
##  [9] &quot;reply_to_user_id&quot;        &quot;reply_to_screen_name&quot;   
## [11] &quot;is_quote&quot;                &quot;is_retweet&quot;             
## [13] &quot;favorite_count&quot;          &quot;retweet_count&quot;          
## [15] &quot;quote_count&quot;             &quot;reply_count&quot;            
## [17] &quot;hashtags&quot;                &quot;symbols&quot;                
## [19] &quot;urls_url&quot;                &quot;urls_t.co&quot;              
## [21] &quot;urls_expanded_url&quot;       &quot;media_url&quot;              
## [23] &quot;media_t.co&quot;              &quot;media_expanded_url&quot;     
## [25] &quot;media_type&quot;              &quot;ext_media_url&quot;          
## [27] &quot;ext_media_t.co&quot;          &quot;ext_media_expanded_url&quot; 
## [29] &quot;ext_media_type&quot;          &quot;mentions_user_id&quot;       
## [31] &quot;mentions_screen_name&quot;    &quot;lang&quot;                   
## [33] &quot;quoted_status_id&quot;        &quot;quoted_text&quot;            
## [35] &quot;quoted_created_at&quot;       &quot;quoted_source&quot;          
## [37] &quot;quoted_favorite_count&quot;   &quot;quoted_retweet_count&quot;   
## [39] &quot;quoted_user_id&quot;          &quot;quoted_screen_name&quot;     
## [41] &quot;quoted_name&quot;             &quot;quoted_followers_count&quot; 
## [43] &quot;quoted_friends_count&quot;    &quot;quoted_statuses_count&quot;  
## [45] &quot;quoted_location&quot;         &quot;quoted_description&quot;     
## [47] &quot;quoted_verified&quot;         &quot;retweet_status_id&quot;      
## [49] &quot;retweet_text&quot;            &quot;retweet_created_at&quot;     
## [51] &quot;retweet_source&quot;          &quot;retweet_favorite_count&quot; 
## [53] &quot;retweet_retweet_count&quot;   &quot;retweet_user_id&quot;        
## [55] &quot;retweet_screen_name&quot;     &quot;retweet_name&quot;           
## [57] &quot;retweet_followers_count&quot; &quot;retweet_friends_count&quot;  
## [59] &quot;retweet_statuses_count&quot;  &quot;retweet_location&quot;       
## [61] &quot;retweet_description&quot;     &quot;retweet_verified&quot;       
## [63] &quot;place_url&quot;               &quot;place_name&quot;             
## [65] &quot;place_full_name&quot;         &quot;place_type&quot;             
## [67] &quot;country&quot;                 &quot;country_code&quot;           
## [69] &quot;geo_coords&quot;              &quot;coords_coords&quot;          
## [71] &quot;bbox_coords&quot;             &quot;status_url&quot;             
## [73] &quot;name&quot;                    &quot;location&quot;               
## [75] &quot;description&quot;             &quot;url&quot;                    
## [77] &quot;protected&quot;               &quot;followers_count&quot;        
## [79] &quot;friends_count&quot;           &quot;listed_count&quot;           
## [81] &quot;statuses_count&quot;          &quot;favourites_count&quot;       
## [83] &quot;account_created_at&quot;      &quot;verified&quot;               
## [85] &quot;profile_url&quot;             &quot;profile_expanded_url&quot;   
## [87] &quot;account_lang&quot;            &quot;profile_banner_url&quot;     
## [89] &quot;profile_background_url&quot;  &quot;profile_image_url&quot;</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="gather-data.html#cb237-1" aria-hidden="true" tabindex="-1"></a>rstats_tweets <span class="sc">%&gt;%</span> </span>
<span id="cb237-2"><a href="gather-data.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(screen_name, text) <span class="sc">%&gt;%</span> </span>
<span id="cb237-3"><a href="gather-data.html#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   screen_name    text                                                           
##   &lt;chr&gt;          &lt;chr&gt;                                                          
## 1 RahaPhD        &quot;#WFH multitasking woes:  I was just sitting here, working on …
## 2 AmandaKMontoya &quot;Teaching with the #PublishingPaidMe data this week in my intr…
## 3 digitalke1     &quot;130 #MachineLearning ProjectsSolved and Explained\n@ruben_arc…
## 4 digitalke1     &quot;#Infographic: 6 simple steps to effectively analyse data.\nVi…
## 5 dataclaudius   &quot;When Did the US Senate Best Reflect the US Population? via #r…
## 6 alexpghayes    &quot;has anyone written an #rstats package to interface with SNAP …</code></pre>
<p>There is a bunch of other things that you can do just using a regular user account, and if you’re interested then you should try the examples in the <code>rtweet</code> package documentation: <a href="https://rtweet.info/index.html" class="uri">https://rtweet.info/index.html</a>. But more is available once you register as a developer (<a href="https://developer.twitter.com/en/apply-for-access" class="uri">https://developer.twitter.com/en/apply-for-access</a>). The Twitter API document is surprisingly readable and you may enjoy some of it: <a href="https://developer.twitter.com/en/docs" class="uri">https://developer.twitter.com/en/docs</a>.</p>
<p>When I introduced APIs I said that the ‘data provider specifies exactly the data that they are willing to provide…’ and we have certainly been able to take advantage of what they provide But I continued ‘…and the terms under which they will provide it’ and here we haven’t done our part. In particular, I took some tweets and saved them. If I had pushed these to GitHub then it’s possible I may have accidently stored sensitive information if there happened to be some in the tweets. Or if I had taken enough tweets to start to do some reasonable statistical analysis then even if there wasn’t sensitive information I may have violated the terms if I had pushed those saved tweets to GitHub. Finally, I linked a Twitter user name, in this case <code>@Liza_Bolton</code> with Professor Bolton. I happened to ask her if this was okay, but if I hadn’t done that then I would have been violating the Twitter terms of service.</p>
<p>If you use Twitter data, please take a moment to look at the terms: <a href="https://developer.twitter.com/en/developer-terms/more-on-restricted-use-cases" class="uri">https://developer.twitter.com/en/developer-terms/more-on-restricted-use-cases</a>.</p>
</div>
<div id="case-study---spotifyr" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Case study - spotifyr</h2>
<p>For the next example I will introduce the <code>spotifyr</code> package <span class="citation">(<a href="references-1.html#ref-spotifyr" role="doc-biblioref">Thompson et al. 2020</a>)</span>. Again, this is a wrapper that has been developed around an API, in this case the Spotify API. You should install the package from the developer’s GitHub repo using <code>devtools</code> <span class="citation">(<a href="references-1.html#ref-citeDevtools" role="doc-biblioref">Wickham, Hester, and Chang 2020</a>)</span>.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="gather-data.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github(&#39;charlie86/spotifyr&#39;)</span></span>
<span id="cb239-2"><a href="gather-data.html#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spotifyr)</span></code></pre></div>
<p>In order to use this account you need a Spotify Developer Account, which you can set-up here: <a href="https://developer.spotify.com/dashboard/" class="uri">https://developer.spotify.com/dashboard/</a>. That’ll have you log in with your Spotify details and then accept their terms (it’s worth looking at some of these and I’ll follow up on a few below) as in Figure <a href="gather-data.html#fig:spotifyaccept">7.3</a>.</p>
<div class="figure"><span id="fig:spotifyaccept"></span>
<img src="figures/spotify.png" alt="rtweet authorisation page" width="90%" />
<p class="caption">
Figure 7.3: rtweet authorisation page
</p>
</div>
<p>What we need from here is a ‘Client ID’ and you can just fill out some basic details. In our case we probably ‘don’t know’ what we’re building, which means that Spotify requires us to use a non-commercial agreement, which is fine. In order to use the Spotify API we need a Client ID and a Client Secret.</p>
<p>These are things that you want to keep to yourself. There are a variety of ways of keeping this secret, (and my understanding is that a helpful package is on its way) but we’ll keep them in our System Environment. In this way, when we push to GitHub they won’t be included. To do this we need to be careful about the naming, because <code>spotifyr</code> will look in our environment for specifically named keys.</p>
<p>To do this we are going to use the <code>usethis</code> package <span class="citation"><a href="references-1.html#ref-citeusethis" role="doc-biblioref">Wickham and Bryan</a> (<a href="references-1.html#ref-citeusethis" role="doc-biblioref">2020</a>)</span>. If you don’t have that then please install it. There is a file called ‘.Renviron’ which we will open and add our secrets to. This file also controls things like your default library location and more information is available at <span class="citation"><a href="references-1.html#ref-renvironrstudio" role="doc-biblioref">Lopp</a> (<a href="references-1.html#ref-renvironrstudio" role="doc-biblioref">2017</a>)</span> and <span class="citation"><a href="references-1.html#ref-whattheyforgot" role="doc-biblioref">Jennifer Bryan and Hester</a> (<a href="references-1.html#ref-whattheyforgot" role="doc-biblioref">2020</a>)</span>.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="gather-data.html#cb240-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_r_environ</span>() </span></code></pre></div>
<p>When you run that function it will open a file. There you can add your Spotify secrets.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="gather-data.html#cb241-1" aria-hidden="true" tabindex="-1"></a>SPOTIFY_CLIENT_ID <span class="ot">=</span> <span class="st">&#39;PUT_YOUR_CLIENT_ID_HERE&#39;</span></span>
<span id="cb241-2"><a href="gather-data.html#cb241-2" aria-hidden="true" tabindex="-1"></a>SPOTIFY_CLIENT_SECRET <span class="ot">=</span> <span class="st">&#39;PUT_YOUR_SECRET_HERE&#39;</span></span></code></pre></div>
<p>Save your ‘.Renviron’ file, and then restart R (Session -&gt; Restart R). You can now draw on that variable when you need.</p>
<p>Some functions that require your secrets as arguments will now just work. For instance, we will get information about Radiohead using <code>get_artist_audio_features()</code>. One of the arguments is <code>authorization</code>, but as that is set to default to look at the R Environment, we don’t need to do anything further.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="gather-data.html#cb242-1" aria-hidden="true" tabindex="-1"></a>radiohead <span class="ot">&lt;-</span> <span class="fu">get_artist_audio_features</span>(<span class="st">&#39;radiohead&#39;</span>)</span>
<span id="cb242-2"><a href="gather-data.html#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(radiohead, <span class="st">&quot;inputs/radiohead.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="gather-data.html#cb243-1" aria-hidden="true" tabindex="-1"></a>radiohead <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;inputs/radiohead.rds&quot;</span>)</span>
<span id="cb243-2"><a href="gather-data.html#cb243-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-3"><a href="gather-data.html#cb243-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(radiohead)</span></code></pre></div>
<pre><code>##  [1] &quot;artist_name&quot;                  &quot;artist_id&quot;                   
##  [3] &quot;album_id&quot;                     &quot;album_type&quot;                  
##  [5] &quot;album_images&quot;                 &quot;album_release_date&quot;          
##  [7] &quot;album_release_year&quot;           &quot;album_release_date_precision&quot;
##  [9] &quot;danceability&quot;                 &quot;energy&quot;                      
## [11] &quot;key&quot;                          &quot;loudness&quot;                    
## [13] &quot;mode&quot;                         &quot;speechiness&quot;                 
## [15] &quot;acousticness&quot;                 &quot;instrumentalness&quot;            
## [17] &quot;liveness&quot;                     &quot;valence&quot;                     
## [19] &quot;tempo&quot;                        &quot;track_id&quot;                    
## [21] &quot;analysis_url&quot;                 &quot;time_signature&quot;              
## [23] &quot;artists&quot;                      &quot;available_markets&quot;           
## [25] &quot;disc_number&quot;                  &quot;duration_ms&quot;                 
## [27] &quot;explicit&quot;                     &quot;track_href&quot;                  
## [29] &quot;is_local&quot;                     &quot;track_name&quot;                  
## [31] &quot;track_preview_url&quot;            &quot;track_number&quot;                
## [33] &quot;type&quot;                         &quot;track_uri&quot;                   
## [35] &quot;external_urls.spotify&quot;        &quot;album_name&quot;                  
## [37] &quot;key_name&quot;                     &quot;mode_name&quot;                   
## [39] &quot;key_mode&quot;</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="gather-data.html#cb245-1" aria-hidden="true" tabindex="-1"></a>radiohead <span class="sc">%&gt;%</span> </span>
<span id="cb245-2"><a href="gather-data.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(artist_name, track_name, album_name) <span class="sc">%&gt;%</span> </span>
<span id="cb245-3"><a href="gather-data.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##   artist_name                               track_name
## 1   Radiohead                      Airbag - Remastered
## 2   Radiohead            Paranoid Android - Remastered
## 3   Radiohead Subterranean Homesick Alien - Remastered
## 4   Radiohead     Exit Music (For a Film) - Remastered
## 5   Radiohead                    Let Down - Remastered
## 6   Radiohead                Karma Police - Remastered
##                      album_name
## 1 OK Computer OKNOTOK 1997 2017
## 2 OK Computer OKNOTOK 1997 2017
## 3 OK Computer OKNOTOK 1997 2017
## 4 OK Computer OKNOTOK 1997 2017
## 5 OK Computer OKNOTOK 1997 2017
## 6 OK Computer OKNOTOK 1997 2017</code></pre>
<p>Let’s just make a quick graph looking at track length over time.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="gather-data.html#cb247-1" aria-hidden="true" tabindex="-1"></a>radiohead <span class="sc">%&gt;%</span> </span>
<span id="cb247-2"><a href="gather-data.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> album_release_year, <span class="at">y =</span> duration_ms)) <span class="sc">+</span></span>
<span id="cb247-3"><a href="gather-data.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-146-1.png" width="672" /></p>
<p>Just because we can, let’s settle an argument. I’ve always said that Radiohead of quite depressing, but they’re my wife’s favourite band. Let’s see how depressing they are. Spotify provides various information about each track, including ‘valence,’ which Spotify <a href="https://developer.spotify.com/documentation/web-api/reference/tracks/get-audio-features/">define</a> as ‘(a) measure from 0.0 to 1.0 describing the musical positiveness conveyed by a track. Tracks with high valence sound more positive (e.g. happy, cheerful, euphoric), while tracks with low valence sound more negative (e.g. sad, depressed, angry).’ Higher values are happier. Let’s compare someone who we know it likely to be happy - Taylor Swift - with Radiohead.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="gather-data.html#cb248-1" aria-hidden="true" tabindex="-1"></a>swifty <span class="ot">&lt;-</span> <span class="fu">get_artist_audio_features</span>(<span class="st">&#39;taylor swift&#39;</span>)</span>
<span id="cb248-2"><a href="gather-data.html#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(swifty, <span class="st">&quot;inputs/swifty.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="gather-data.html#cb249-1" aria-hidden="true" tabindex="-1"></a>swifty <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;inputs/swifty.rds&quot;</span>)</span>
<span id="cb249-2"><a href="gather-data.html#cb249-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-3"><a href="gather-data.html#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(swifty<span class="sc">$</span>artist_name, radiohead<span class="sc">$</span>artist_name),</span>
<span id="cb249-4"><a href="gather-data.html#cb249-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">year =</span> <span class="fu">c</span>(swifty<span class="sc">$</span>album_release_year, radiohead<span class="sc">$</span>album_release_year),</span>
<span id="cb249-5"><a href="gather-data.html#cb249-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">valence =</span> <span class="fu">c</span>(swifty<span class="sc">$</span>valence, radiohead<span class="sc">$</span>valence)</span>
<span id="cb249-6"><a href="gather-data.html#cb249-6" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">%&gt;%</span> </span>
<span id="cb249-7"><a href="gather-data.html#cb249-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> valence, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb249-8"><a href="gather-data.html#cb249-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb249-9"><a href="gather-data.html#cb249-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb249-10"><a href="gather-data.html#cb249-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year&quot;</span>,</span>
<span id="cb249-11"><a href="gather-data.html#cb249-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Valence&quot;</span>,</span>
<span id="cb249-12"><a href="gather-data.html#cb249-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;Name&quot;</span>) <span class="sc">+</span></span>
<span id="cb249-13"><a href="gather-data.html#cb249-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-148-1.png" width="672" /></p>
<p>Finally, for the sake of embarrassment, let’s look at our most played artists.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="gather-data.html#cb250-1" aria-hidden="true" tabindex="-1"></a>top_artists <span class="ot">&lt;-</span> <span class="fu">get_my_top_artists_or_tracks</span>(<span class="at">type =</span> <span class="st">&#39;artists&#39;</span>, <span class="at">time_range =</span> <span class="st">&#39;long_term&#39;</span>, <span class="at">limit =</span> <span class="dv">20</span>)</span>
<span id="cb250-2"><a href="gather-data.html#cb250-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-3"><a href="gather-data.html#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(top_artists, <span class="st">&quot;inputs/top_artists.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="gather-data.html#cb251-1" aria-hidden="true" tabindex="-1"></a>top_artists <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;inputs/top_artists.rds&quot;</span>)</span>
<span id="cb251-2"><a href="gather-data.html#cb251-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-3"><a href="gather-data.html#cb251-3" aria-hidden="true" tabindex="-1"></a>top_artists <span class="sc">%&gt;%</span> </span>
<span id="cb251-4"><a href="gather-data.html#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, popularity)</span></code></pre></div>
<pre><code>##                   name popularity
## 1            Radiohead         81
## 2  Bombay Bicycle Club         66
## 3                Drake        100
## 4        Glass Animals         74
## 5                JAY-Z         85
## 6        Laura Marling         65
## 7       Sufjan Stevens         75
## 8      Vampire Weekend         73
## 9     Sturgill Simpson         65
## 10          Nick Drake         66
## 11        Dire Straits         78
## 12               Lorde         80
## 13         Marian Hill         65
## 14       José González         68
## 15       Stevie Wonder         79
## 16          Disclosure         82
## 17      Ben Folds Five         52
## 18       Ainslie Wills         40
## 19            Coldplay         89
## 20               alt-J         75</code></pre>
<p>So pretty much my wife and I like what everyone else likes, with the exception of Ainslie Wills, who is an Australian and I suspect we used to listen to her when we were homesick.</p>
<p>How amazing that we live in a world that all that information is available with very little effort or cost.</p>
<p>Again, there is a lot more at the package’s website: <a href="https://www.rcharlie.com/spotifyr/" class="uri">https://www.rcharlie.com/spotifyr/</a>. A very nice little application of the Spotify API using some statistical analysis is <span class="citation"><a href="references-1.html#ref-kaylinpavlik" role="doc-biblioref">Pavlik</a> (<a href="references-1.html#ref-kaylinpavlik" role="doc-biblioref">2019</a>)</span>.</p>
<!-- ## NBA statistics -->
<!-- NBA: https://github.com/toddwschneider/ballr -->
<!-- ## tidyquant -->
<!-- Financial markets data: tidyquant -->
<!-- ## Danish statistics -->
<!-- https://cran.r-project.org/web/packages/danstat/vignettes/Introduction_to_danstat.html -->
</div>
<div id="scraping" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Scraping</h2>
<div id="introduction-6" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Introduction</h3>
<p>Web-scraping is a way to get data from websites into R. Rather than going to a website ourselves through a browser, we write code that does it for us. This opens up a lot of data to us, but on the other hand, it is not typically data that is being made available for these purposes and so it is important to be respectful of it. While generally not illegal, the specifics with regard to the legality of web-scraping depends on jurisdictions and the specifics of what you’re doing, and so it is also important to be mindful of this. And finally, web-scraping imposes a cost on the website host, and so it is important to reduce this to the extent that it’s possible.</p>
<p>That all said, web-scraping is an invaluable source of data. But they are typically datasets that can be created as a by-product of someone trying to achieve another aim. For instance, a retailer may have a website with their products and their prices. That has not been created deliberately as a source of data, but we can scrape it to create a dataset. As such, the following principles guide my web-scraping.</p>
<ol style="list-style-type: decimal">
<li>Avoid it. Try to use an API wherever possible.</li>
<li>Abide by their desires. Some websites have a file ‘robots.txt’ that contains information about what they are comfortable with scrapers doing, for instance ‘<a href="https://www.google.com/robots.txt" class="uri">https://www.google.com/robots.txt</a>.’ If they have one of these then you should read it and abide by it.</li>
<li>Reduce the impact.
<ul>
<li>Firstly, slow down your scraper, for instance, rather than having it visit the website every second, slow it down (using <code>sys.sleep()</code>). If you’re only after a few hundred files then why not just have it visit once a minute, running in the background overnight?</li>
<li>Secondly, consider the timing of when you run the scraper. For instance, if it’s a retailer then why not set your script to run from 10pm through to the morning, when fewer customers are likely to need the site? If it’s a government website and they have a big monthly release then why not avoid that day?</li>
</ul></li>
<li>Take only what you need. For instance, don’t scrape the entire of Wikipedia if all you need is to know the names of the 10 largest cities in Canada. This reduces the impact on their website and allows you to more easily justify what you are doing.</li>
<li>Only scrape once. Save everything as you go so that you don’t have to re-collect data. Similarly, once you have the data, you should keep that separate and not modify it. Of course, if you need data over time then you will need to go back, but this is different to needlessly re-scraping a page.</li>
<li>Don’t republish the pages that you scraped. (This is in contrast to datasets that you create from it.)</li>
<li>Take ownership and ask permission if possible. At a minimum level your scripts should have your contact details in them. Depending on the circumstances, it may be worthwhile asking for permission before you scrape.</li>
</ol>
</div>
<div id="getting-started-3" class="section level3" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Getting started</h3>
<p>Web-scraping is possible by taking advantage of the underlying structure of a webpage. We use patterns in the HTML/CSS to get the data that we want. To look at the underlying HTML/CSS you can either: 1) open a browser, right-click, and choose something like ‘Inspect’; or 2) save the website and then open it with a text editor rather than a browser.</p>
<p>HTML/CSS is a markup language comprised of matching tags. If you want text to be bold then you would use something like:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb253-1"><a href="gather-data.html#cb253-1" aria-hidden="true" tabindex="-1"></a>&lt;b<span class="op">&gt;</span>My bold text&lt;/b<span class="op">&gt;</span></span></code></pre></div>
<p>Similarly, if you want a list then you start and end the list as well as each item.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb254-1"><a href="gather-data.html#cb254-1" aria-hidden="true" tabindex="-1"></a>&lt;ul<span class="op">&gt;</span></span>
<span id="cb254-2"><a href="gather-data.html#cb254-2" aria-hidden="true" tabindex="-1"></a>  &lt;li<span class="op">&gt;</span>Learn webscraping&lt;/li<span class="op">&gt;</span></span>
<span id="cb254-3"><a href="gather-data.html#cb254-3" aria-hidden="true" tabindex="-1"></a>  &lt;li<span class="op">&gt;</span>Do data science&lt;/li<span class="op">&gt;</span></span>
<span id="cb254-4"><a href="gather-data.html#cb254-4" aria-hidden="true" tabindex="-1"></a>  &lt;li<span class="op">&gt;</span>Proft&lt;/li<span class="op">&gt;</span></span>
<span id="cb254-5"><a href="gather-data.html#cb254-5" aria-hidden="true" tabindex="-1"></a>&lt;/ul<span class="op">&gt;</span></span></code></pre></div>
<p>When scraping we will search for these tags.</p>
<p>To get started, this is some HTML/CSS from my website. Let’s say that we want to grab my name from it. We can see that the name is in bold, so we want to probably focus on that feature and extract it.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="gather-data.html#cb255-1" aria-hidden="true" tabindex="-1"></a>website_extract <span class="ot">&lt;-</span> <span class="st">&quot;&lt;p&gt;Hi, I’m &lt;b&gt;Rohan&lt;/b&gt; Alexander.&lt;/p&gt;&quot;</span></span></code></pre></div>
<p>We will use the <code>rvest</code> package <span class="citation"><a href="references-1.html#ref-citervest" role="doc-biblioref">Wickham</a> (<a href="references-1.html#ref-citervest" role="doc-biblioref">2019b</a>)</span>.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="gather-data.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;rvest&quot;)</span></span>
<span id="cb256-2"><a href="gather-data.html#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb256-3"><a href="gather-data.html#cb256-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-4"><a href="gather-data.html#cb256-4" aria-hidden="true" tabindex="-1"></a>rohans_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(website_extract)</span>
<span id="cb256-5"><a href="gather-data.html#cb256-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-6"><a href="gather-data.html#cb256-6" aria-hidden="true" tabindex="-1"></a>rohans_data</span></code></pre></div>
<pre><code>## {html_document}
## &lt;html&gt;
## [1] &lt;body&gt;&lt;p&gt;Hi, I’m &lt;b&gt;Rohan&lt;/b&gt; Alexander.&lt;/p&gt;&lt;/body&gt;</code></pre>
<p>The language used by <code>rvest</code> to look for tags is ‘node,’ so we will focus on bold nodes. By default <code>html_nodes()</code> returns the tags as well. We can focus on the text that they contain, using <code>html_text()</code>.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="gather-data.html#cb258-1" aria-hidden="true" tabindex="-1"></a>rohans_data <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="gather-data.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;b&quot;</span>)</span></code></pre></div>
<pre><code>## {xml_nodeset (1)}
## [1] &lt;b&gt;Rohan&lt;/b&gt;</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="gather-data.html#cb260-1" aria-hidden="true" tabindex="-1"></a>first_name <span class="ot">&lt;-</span> </span>
<span id="cb260-2"><a href="gather-data.html#cb260-2" aria-hidden="true" tabindex="-1"></a>  rohans_data <span class="sc">%&gt;%</span> </span>
<span id="cb260-3"><a href="gather-data.html#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;b&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb260-4"><a href="gather-data.html#cb260-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb260-5"><a href="gather-data.html#cb260-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-6"><a href="gather-data.html#cb260-6" aria-hidden="true" tabindex="-1"></a>first_name</span></code></pre></div>
<pre><code>## [1] &quot;Rohan&quot;</code></pre>
<p>The result is that we learn my first name.</p>
</div>
</div>
<div id="case-study---rohans-books" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Case study - Rohan’s books</h2>
<div id="introduction-7" class="section level3" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> Introduction</h3>
<p>In this case study we are going to scrape a list of books that I own, clean it, and look at the distribution of the first letters of author surnames. It is slightly more complicated than the example above, but the underlying approach is the same - download the website, look for the nodes of interest, extract the information, clean it.</p>
</div>
<div id="gather" class="section level3" number="7.6.2">
<h3><span class="header-section-number">7.6.2</span> Gather</h3>
<p>Again, the key library that we are using is the <code>rvest</code> library. This makes it easier to download a website, and to then navigate the html to find the aspects that we are interested in. You should create a new project in a new folder (File -&gt; New Project). Within that new folder you should make three new folders: <code>inputs</code>, <code>outputs</code>, and <code>scripts.</code></p>
<p>In the scripts folder you should write and save a script along these lines. This script loads the libraries that we need, then visits my website, and saves a local copy.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="gather-data.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Contact details ####</span></span>
<span id="cb262-2"><a href="gather-data.html#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Title: Get data from rohanalexander.com</span></span>
<span id="cb262-3"><a href="gather-data.html#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Purpose: This script gets data from Rohan&#39;s website about the books that he </span></span>
<span id="cb262-4"><a href="gather-data.html#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="co"># owns. It calls his website and then saves the dataset to inputs.</span></span>
<span id="cb262-5"><a href="gather-data.html#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Author: Rohan Alexander</span></span>
<span id="cb262-6"><a href="gather-data.html#cb262-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Contact: rohan.alexander@utoronto.ca</span></span>
<span id="cb262-7"><a href="gather-data.html#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Last updated: 20 May 2020</span></span>
<span id="cb262-8"><a href="gather-data.html#cb262-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-9"><a href="gather-data.html#cb262-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-10"><a href="gather-data.html#cb262-10" aria-hidden="true" tabindex="-1"></a><span class="do">#### Set up workspace ####</span></span>
<span id="cb262-11"><a href="gather-data.html#cb262-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb262-12"><a href="gather-data.html#cb262-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb262-13"><a href="gather-data.html#cb262-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-14"><a href="gather-data.html#cb262-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-15"><a href="gather-data.html#cb262-15" aria-hidden="true" tabindex="-1"></a><span class="do">#### Get html ####</span></span>
<span id="cb262-16"><a href="gather-data.html#cb262-16" aria-hidden="true" tabindex="-1"></a>rohans_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://rohanalexander.com/bookshelf.html&quot;</span>)</span>
<span id="cb262-17"><a href="gather-data.html#cb262-17" aria-hidden="true" tabindex="-1"></a><span class="co"># This takes a website as an input and will read it into R, in the same way that we </span></span>
<span id="cb262-18"><a href="gather-data.html#cb262-18" aria-hidden="true" tabindex="-1"></a><span class="co"># can read a, say, CSV into R.</span></span>
<span id="cb262-19"><a href="gather-data.html#cb262-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-20"><a href="gather-data.html#cb262-20" aria-hidden="true" tabindex="-1"></a><span class="fu">write_html</span>(rohans_data, <span class="st">&quot;inputs/my_website/raw_data.html&quot;</span>) </span>
<span id="cb262-21"><a href="gather-data.html#cb262-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Always save your raw dataset as soon as you get it so that you have a record </span></span>
<span id="cb262-22"><a href="gather-data.html#cb262-22" aria-hidden="true" tabindex="-1"></a><span class="co"># of it. This is the equivalent of, say, write_csv() that we have used earlier.</span></span></code></pre></div>
</div>
<div id="clean" class="section level3" number="7.6.3">
<h3><span class="header-section-number">7.6.3</span> Clean</h3>
<p>Now we need to navigate the HTML to get the aspects that we want, and to then put them into some sensible structure. I always try to get the data into a tibble as early as possible. While it’s possible to work with the nested data, I move to a tibble so that the usual verbs that I’m used to can be used.</p>
<p>In the scripts folder you should write and save a new R script along these lines. First, we need to add the top matter, read in the libraries and the data that we scraped.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="gather-data.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Contact details ####</span></span>
<span id="cb263-2"><a href="gather-data.html#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Title: Clean data from rohanaledander.com</span></span>
<span id="cb263-3"><a href="gather-data.html#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Purpose: This script cleans data that was downloaded in 01-get_data.R.</span></span>
<span id="cb263-4"><a href="gather-data.html#cb263-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Author: Rohan Alexander</span></span>
<span id="cb263-5"><a href="gather-data.html#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Contact: rohan.alexander@utoronto.ca</span></span>
<span id="cb263-6"><a href="gather-data.html#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-requisites: Need to have run 01_get_data.R and have saved the data.</span></span>
<span id="cb263-7"><a href="gather-data.html#cb263-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Last updated: 20 May 2020</span></span>
<span id="cb263-8"><a href="gather-data.html#cb263-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-9"><a href="gather-data.html#cb263-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-10"><a href="gather-data.html#cb263-10" aria-hidden="true" tabindex="-1"></a><span class="do">#### Set up workspace ####</span></span>
<span id="cb263-11"><a href="gather-data.html#cb263-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb263-12"><a href="gather-data.html#cb263-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb263-13"><a href="gather-data.html#cb263-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-14"><a href="gather-data.html#cb263-14" aria-hidden="true" tabindex="-1"></a>rohans_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;inputs/my_website/raw_data.html&quot;</span>)</span>
<span id="cb263-15"><a href="gather-data.html#cb263-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-16"><a href="gather-data.html#cb263-16" aria-hidden="true" tabindex="-1"></a>rohans_data</span></code></pre></div>
<pre><code>## {html_document}
## &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; lang=&quot;&quot; xml:lang=&quot;&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8 ...
## [2] &lt;body&gt;\n\n&lt;!--radix_placeholder_front_matter--&gt;\n\n&lt;script id=&quot;distill-fr ...</code></pre>
<p>Now we need to identify the data that we are interested in using html tags and convert it to a tibble. If you look at the website, then you should notice that we are likely trying to focus on list items (Figure <a href="gather-data.html#fig:rohansbooks">7.4</a>).</p>
<div class="figure"><span id="fig:rohansbooks"></span>
<img src="figures/rohansbooks.png" alt="Some of Rohan's books" width="90%" />
<p class="caption">
Figure 7.4: Some of Rohan’s books
</p>
</div>
<p>Let’s look at the source (Figure <a href="gather-data.html#fig:rohanssourceone">7.5</a>).</p>
<div class="figure"><span id="fig:rohanssourceone"></span>
<img src="figures/sourcetop.png" alt="Source code for top of the page" width="90%" />
<p class="caption">
Figure 7.5: Source code for top of the page
</p>
</div>
<p>There’s a lot of debris, but scrolling down we eventually get to a list (Figure <a href="gather-data.html#fig:rohanssourcetwo">7.6</a>).</p>
<div class="figure"><span id="fig:rohanssourcetwo"></span>
<img src="figures/sourcelist.png" alt="Source code for list" width="90%" />
<p class="caption">
Figure 7.6: Source code for list
</p>
</div>
<p>The tag for a list item is ‘li,’ so we modify the earlier code to focus on that and to get the text.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="gather-data.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Clean data ####</span></span>
<span id="cb265-2"><a href="gather-data.html#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the lines that have books on them based on the list html tag</span></span>
<span id="cb265-3"><a href="gather-data.html#cb265-3" aria-hidden="true" tabindex="-1"></a>text_data <span class="ot">&lt;-</span> rohans_data <span class="sc">%&gt;%</span></span>
<span id="cb265-4"><a href="gather-data.html#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;li&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb265-5"><a href="gather-data.html#cb265-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb265-6"><a href="gather-data.html#cb265-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-7"><a href="gather-data.html#cb265-7" aria-hidden="true" tabindex="-1"></a>all_books <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">books =</span> text_data)</span>
<span id="cb265-8"><a href="gather-data.html#cb265-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-9"><a href="gather-data.html#cb265-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_books)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 1
##   books                                                                         
##   &lt;chr&gt;                                                                         
## 1 &quot;-“A Little Life”, Hanya Yanighara. Recommended by Lauren.&quot;                   
## 2 &quot;“The Andromeda Strain”, Michael Crichton.&quot;                                   
## 3 &quot;“Is There Life After Housework”, Don Aslett.\nGot given this at the Museum o…
## 4 &quot;“The Chosen”, Chaim Potok.&quot;                                                  
## 5 &quot;“The Forsyth Saga”, John Galsworthy.&quot;                                        
## 6 &quot;“Freakonomics”, Steven Levitt and Stephen Dubner.&quot;</code></pre>
<p>We now need to clean the data. First we want to separate the title and the author</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="gather-data.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All content is just one string, so need to separate title and author</span></span>
<span id="cb267-2"><a href="gather-data.html#cb267-2" aria-hidden="true" tabindex="-1"></a>all_books <span class="ot">&lt;-</span></span>
<span id="cb267-3"><a href="gather-data.html#cb267-3" aria-hidden="true" tabindex="-1"></a>  all_books <span class="sc">%&gt;%</span></span>
<span id="cb267-4"><a href="gather-data.html#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(books, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;title&quot;</span>, <span class="st">&quot;author&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;”&quot;</span>)</span>
<span id="cb267-5"><a href="gather-data.html#cb267-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-6"><a href="gather-data.html#cb267-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove leading comma and clean up the titles a little</span></span>
<span id="cb267-7"><a href="gather-data.html#cb267-7" aria-hidden="true" tabindex="-1"></a>all_books <span class="ot">&lt;-</span></span>
<span id="cb267-8"><a href="gather-data.html#cb267-8" aria-hidden="true" tabindex="-1"></a>  all_books <span class="sc">%&gt;%</span></span>
<span id="cb267-9"><a href="gather-data.html#cb267-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">author =</span> <span class="fu">str_remove_all</span>(author, <span class="st">&quot;^, &quot;</span>),</span>
<span id="cb267-10"><a href="gather-data.html#cb267-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">author =</span> <span class="fu">str_squish</span>(author),</span>
<span id="cb267-11"><a href="gather-data.html#cb267-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="fu">str_remove</span>(title, <span class="st">&quot;“&quot;</span>),</span>
<span id="cb267-12"><a href="gather-data.html#cb267-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="fu">str_remove</span>(title, <span class="st">&quot;^-&quot;</span>)</span>
<span id="cb267-13"><a href="gather-data.html#cb267-13" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb267-14"><a href="gather-data.html#cb267-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-15"><a href="gather-data.html#cb267-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_books)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   title                  author                                                 
##   &lt;chr&gt;                  &lt;chr&gt;                                                  
## 1 A Little Life          Hanya Yanighara. Recommended by Lauren.                
## 2 The Andromeda Strain   Michael Crichton.                                      
## 3 Is There Life After H… Don Aslett. Got given this at the Museum of Clean in P…
## 4 The Chosen             Chaim Potok.                                           
## 5 The Forsyth Saga       John Galsworthy.                                       
## 6 Freakonomics           Steven Levitt and Stephen Dubner.</code></pre>
<p>Finally, some specific cleaning is needed.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="gather-data.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Some authors have comments after their name, so need to get rid of them, although there are some exceptions that will not work</span></span>
<span id="cb269-2"><a href="gather-data.html#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="co"># J. K. Rowling.</span></span>
<span id="cb269-3"><a href="gather-data.html#cb269-3" aria-hidden="true" tabindex="-1"></a><span class="co"># M. Mitchell Waldrop.</span></span>
<span id="cb269-4"><a href="gather-data.html#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="co"># David A. Price</span></span>
<span id="cb269-5"><a href="gather-data.html#cb269-5" aria-hidden="true" tabindex="-1"></a>all_books <span class="ot">&lt;-</span></span>
<span id="cb269-6"><a href="gather-data.html#cb269-6" aria-hidden="true" tabindex="-1"></a>  all_books <span class="sc">%&gt;%</span></span>
<span id="cb269-7"><a href="gather-data.html#cb269-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">author =</span> <span class="fu">str_replace_all</span>(author,</span>
<span id="cb269-8"><a href="gather-data.html#cb269-8" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">c</span>(<span class="st">&quot;J. K. Rowling.&quot;</span> <span class="ot">=</span> <span class="st">&quot;J K Rowling.&quot;</span>,</span>
<span id="cb269-9"><a href="gather-data.html#cb269-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;M. Mitchell Waldrop.&quot;</span> <span class="ot">=</span> <span class="st">&quot;M Mitchell Waldrop.&quot;</span>,</span>
<span id="cb269-10"><a href="gather-data.html#cb269-10" aria-hidden="true" tabindex="-1"></a>                                <span class="st">&quot;David A. Price&quot;</span> <span class="ot">=</span> <span class="st">&quot;David A Price&quot;</span>)</span>
<span id="cb269-11"><a href="gather-data.html#cb269-11" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb269-12"><a href="gather-data.html#cb269-12" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span></span>
<span id="cb269-13"><a href="gather-data.html#cb269-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(author, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;author_correct&quot;</span>, <span class="st">&quot;throw_away&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="at">extra =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb269-14"><a href="gather-data.html#cb269-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>throw_away) <span class="sc">%&gt;%</span></span>
<span id="cb269-15"><a href="gather-data.html#cb269-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">author =</span> author_correct)</span>
<span id="cb269-16"><a href="gather-data.html#cb269-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-17"><a href="gather-data.html#cb269-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Some books have multiple authors, so need to separate them</span></span>
<span id="cb269-18"><a href="gather-data.html#cb269-18" aria-hidden="true" tabindex="-1"></a><span class="co"># One has multiple authors:</span></span>
<span id="cb269-19"><a href="gather-data.html#cb269-19" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;Daniela Witten, Gareth James, Robert Tibshirani, and Trevor Hastie&quot;</span></span>
<span id="cb269-20"><a href="gather-data.html#cb269-20" aria-hidden="true" tabindex="-1"></a>all_books <span class="ot">&lt;-</span></span>
<span id="cb269-21"><a href="gather-data.html#cb269-21" aria-hidden="true" tabindex="-1"></a>  all_books <span class="sc">%&gt;%</span></span>
<span id="cb269-22"><a href="gather-data.html#cb269-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">author =</span> <span class="fu">str_replace</span>(author,</span>
<span id="cb269-23"><a href="gather-data.html#cb269-23" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Daniela Witten, Gareth James, Robert Tibshirani, and Trevor Hastie&quot;</span>,</span>
<span id="cb269-24"><a href="gather-data.html#cb269-24" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;Daniela Witten and Gareth James and Robert Tibshirani and Trevor Hastie&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb269-25"><a href="gather-data.html#cb269-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(author, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;author_first&quot;</span>, <span class="st">&quot;author_second&quot;</span>, <span class="st">&quot;author_third&quot;</span>, <span class="st">&quot;author_fourth&quot;</span>), <span class="at">sep =</span> <span class="st">&quot; and &quot;</span>, <span class="at">fill =</span> <span class="st">&quot;right&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb269-26"><a href="gather-data.html#cb269-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;author_&quot;</span>),</span>
<span id="cb269-27"><a href="gather-data.html#cb269-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;author_position&quot;</span>,</span>
<span id="cb269-28"><a href="gather-data.html#cb269-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;author&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb269-29"><a href="gather-data.html#cb269-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>author_position) <span class="sc">%&gt;%</span></span>
<span id="cb269-30"><a href="gather-data.html#cb269-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(author))</span>
<span id="cb269-31"><a href="gather-data.html#cb269-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-32"><a href="gather-data.html#cb269-32" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all_books)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   title                         author          
##   &lt;chr&gt;                         &lt;chr&gt;           
## 1 A Little Life                 Hanya Yanighara 
## 2 The Andromeda Strain          Michael Crichton
## 3 Is There Life After Housework Don Aslett      
## 4 The Chosen                    Chaim Potok     
## 5 The Forsyth Saga              John Galsworthy 
## 6 Freakonomics                  Steven Levitt</code></pre>
<p>It looks there is some at the end because I have a best of. I’ll just get rid of those manually because it’s not the focus.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="gather-data.html#cb271-1" aria-hidden="true" tabindex="-1"></a>all_books <span class="ot">&lt;-</span> </span>
<span id="cb271-2"><a href="gather-data.html#cb271-2" aria-hidden="true" tabindex="-1"></a>  all_books <span class="sc">%&gt;%</span> </span>
<span id="cb271-3"><a href="gather-data.html#cb271-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">118</span>)</span></code></pre></div>
</div>
<div id="explore" class="section level3" number="7.6.4">
<h3><span class="header-section-number">7.6.4</span> Explore</h3>
<p>Finally, just because we have the data now, so we may as well try to do something with it, let’s look at the distribution of the first letter of the author names.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="gather-data.html#cb272-1" aria-hidden="true" tabindex="-1"></a>all_books <span class="sc">%&gt;%</span> </span>
<span id="cb272-2"><a href="gather-data.html#cb272-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb272-3"><a href="gather-data.html#cb272-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">first_letter =</span> <span class="fu">str_sub</span>(author, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb272-4"><a href="gather-data.html#cb272-4" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb272-5"><a href="gather-data.html#cb272-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(first_letter) <span class="sc">%&gt;%</span> </span>
<span id="cb272-6"><a href="gather-data.html#cb272-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<pre><code>## # A tibble: 21 x 2
## # Groups:   first_letter [21]
##    first_letter     n
##    &lt;chr&gt;        &lt;int&gt;
##  1 &quot;&quot;               1
##  2 &quot;A&quot;              8
##  3 &quot;B&quot;              5
##  4 &quot;C&quot;              4
##  5 &quot;D&quot;             10
##  6 &quot;E&quot;              3
##  7 &quot;F&quot;              1
##  8 &quot;G&quot;             10
##  9 &quot;H&quot;              6
## 10 &quot;I&quot;              1
## # … with 11 more rows</code></pre>
</div>
</div>
<div id="case-study---canadian-prime-ministers" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Case study - Canadian Prime Ministers</h2>
<div id="introduction-8" class="section level3" number="7.7.1">
<h3><span class="header-section-number">7.7.1</span> Introduction</h3>
<p>In this case study we are interested in how long Canadian prime ministers lived, based on the year that they were born. We will scrape data from Wikipedia, clean it, and then make a graph.</p>
<p>The key library that we will use for scraping is <code>rvest</code>. This adds a lot of functions that will make life easier. That said, every time you scrape a website things will change. Each scrape will largely be bespoke, even if you can borrow some code from earlier projects that you have completed. It is completely normal to feel frustrated at times. It helps to begin with an end in mind.</p>
<p>To that end, let’s generate some simulated data. Ideally, we want a table that has a row for each prime minister, a column for their name, and a column each for the birth and death years. If they are still alive, then that death year can be empty. We know that birth and death years should be somewhere between 1700 and 1990, and that death year should be larger than birth year. Finally, we also know that the years should be integers, and the names should be characters. So, we want something that looks roughly like this:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="gather-data.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb274-2"><a href="gather-data.html#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb274-3"><a href="gather-data.html#cb274-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-4"><a href="gather-data.html#cb274-4" aria-hidden="true" tabindex="-1"></a>simulated_dataset <span class="ot">&lt;-</span> </span>
<span id="cb274-5"><a href="gather-data.html#cb274-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">prime_minister =</span> <span class="fu">sample</span>(<span class="at">x =</span> babynames <span class="sc">%&gt;%</span> <span class="fu">filter</span>(prop <span class="sc">&gt;</span> <span class="fl">0.01</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb274-6"><a href="gather-data.html#cb274-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">select</span>(name) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(), </span>
<span id="cb274-7"><a href="gather-data.html#cb274-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>),</span>
<span id="cb274-8"><a href="gather-data.html#cb274-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">birth_year =</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1700</span><span class="sc">:</span><span class="dv">1990</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb274-9"><a href="gather-data.html#cb274-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">years_lived =</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">50</span><span class="sc">:</span><span class="dv">100</span>), <span class="at">size =</span> <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb274-10"><a href="gather-data.html#cb274-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">death_year =</span> birth_year <span class="sc">+</span> years_lived) <span class="sc">%&gt;%</span> </span>
<span id="cb274-11"><a href="gather-data.html#cb274-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(prime_minister, birth_year, death_year, years_lived) <span class="sc">%&gt;%</span> </span>
<span id="cb274-12"><a href="gather-data.html#cb274-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(birth_year)</span>
<span id="cb274-13"><a href="gather-data.html#cb274-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-14"><a href="gather-data.html#cb274-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(simulated_dataset)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   prime_minister birth_year death_year years_lived
##   &lt;chr&gt;               &lt;int&gt;      &lt;int&gt;       &lt;int&gt;
## 1 Barbara              1714       1789          75
## 2 Scott                1721       1802          81
## 3 Marilyn              1726       1799          73
## 4 Gregory              1737       1800          63
## 5 Judy                 1748       1816          68
## 6 Jessica              1759       1828          69</code></pre>
<p>One of the advantages of generating a simulated dataset is that if you are working in groups then one person can start making the graph, using the simulated dataset, while the other person gathers the data. In terms of a graph, we want something like Figure <a href="gather-data.html#fig:pmsgraphexample">7.7</a>.</p>
<div class="figure"><span id="fig:pmsgraphexample"></span>
<img src="figures/IMG_4185.jpeg" alt="Sketch of planned graph." width="90%" />
<p class="caption">
Figure 7.7: Sketch of planned graph.
</p>
</div>
</div>
<div id="gather-1" class="section level3" number="7.7.2">
<h3><span class="header-section-number">7.7.2</span> Gather</h3>
<p>We are starting with a question that is of interest, which how long each Canadian prime minister lived. As such, we need to identify a source of data While there are likely to be plenty of data sources that have the births and deaths of each prime minister, we want one that we can trust, and as we are going to be scraping, we want one that has some structure to it. The Wikipedia page (<a href="https://en.wikipedia.org/wiki/List_of_prime_ministers_of_Canada" class="uri">https://en.wikipedia.org/wiki/List_of_prime_ministers_of_Canada</a>) fits both these criteria. As it is a popular page the information is more likely to be correct, and the data are available in a table.</p>
<p>We load the library and then we read in the data from the relevant page. The key function here is <code>read_html()</code>, which you can use in the same way as, say, <code>read_csv()</code>, except that it takes a html page as an input. Once you call <code>read_html()</code> then the page is downloaded to your own computer, and it is usually a good idea to save this, using <code>write_html()</code> as it is your raw data. Saving it also means that we don’t have to keep visiting the website when we want to start again with our cleaning, and so it is part of being polite. However, it is likely not our property (in the case of Wikipedia, we might be okay), and so you should probably not share it.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="gather-data.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code></pre></div>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="gather-data.html#cb277-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/List_of_prime_ministers_of_Canada&quot;</span>)</span>
<span id="cb277-2"><a href="gather-data.html#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_html</span>(raw_data, <span class="st">&quot;inputs/wiki/pms.html&quot;</span>) <span class="co"># Note that we save the file as a html file.</span></span></code></pre></div>
</div>
<div id="clean-1" class="section level3" number="7.7.3">
<h3><span class="header-section-number">7.7.3</span> Clean</h3>
<p>Websites are made up of html, which is a markup language. We are looking for patterns in the mark-up that we can use to help us get closer to the data that we want. This is an iterative process and requires a lot of trial and error. Even simple examples will take time. You can look at the html by using a browser, right clicking, and then selecting <code>view page source</code>. Similarly, you could open the html file using a text editor.</p>
<div id="by-inspection" class="section level4" number="7.7.3.1">
<h4><span class="header-section-number">7.7.3.1</span> By inspection</h4>
<p>We are looking for patterns that we can use to select the information that is of interest - names, birth year, and death year. When we look at the html it looks like there is something going on with <code>&lt;tr&gt;</code>, and then <code>&lt;td&gt;</code> (thanks to Thomas Rosenthal for identifying this). We select those nodes using <code>html_nodes()</code>, which takes the tags as an input. If you only want the first one then there is a singular version, <code>html_node()</code>.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="gather-data.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in our saved data</span></span>
<span id="cb278-2"><a href="gather-data.html#cb278-2" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;inputs/wiki/pms.html&quot;</span>)</span>
<span id="cb278-3"><a href="gather-data.html#cb278-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-4"><a href="gather-data.html#cb278-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We can parse tags in order</span></span>
<span id="cb278-5"><a href="gather-data.html#cb278-5" aria-hidden="true" tabindex="-1"></a>parse_data_inspection <span class="ot">&lt;-</span> </span>
<span id="cb278-6"><a href="gather-data.html#cb278-6" aria-hidden="true" tabindex="-1"></a>  raw_data <span class="sc">%&gt;%</span> </span>
<span id="cb278-7"><a href="gather-data.html#cb278-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;tr&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-8"><a href="gather-data.html#cb278-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;td&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-9"><a href="gather-data.html#cb278-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="co"># html_text removes any remaining html tags</span></span>
<span id="cb278-10"><a href="gather-data.html#cb278-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-11"><a href="gather-data.html#cb278-11" aria-hidden="true" tabindex="-1"></a><span class="co"># But this code does exactly the same thing - the nodes are just pushed into </span></span>
<span id="cb278-12"><a href="gather-data.html#cb278-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the one function call</span></span>
<span id="cb278-13"><a href="gather-data.html#cb278-13" aria-hidden="true" tabindex="-1"></a>parse_data_inspection <span class="ot">&lt;-</span> </span>
<span id="cb278-14"><a href="gather-data.html#cb278-14" aria-hidden="true" tabindex="-1"></a>  raw_data <span class="sc">%&gt;%</span> </span>
<span id="cb278-15"><a href="gather-data.html#cb278-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;tr td&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-16"><a href="gather-data.html#cb278-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>()</span>
<span id="cb278-17"><a href="gather-data.html#cb278-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-18"><a href="gather-data.html#cb278-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(parse_data_inspection)</span></code></pre></div>
<pre><code>## [1] &quot;Abbreviation key:&quot;                                                                                                                                                                                                                              
## [2] &quot;No.: Incumbent number, Min.: Ministry, Refs: References\n&quot;                                                                                                                                                                                      
## [3] &quot;Colour key:&quot;                                                                                                                                                                                                                                    
## [4] &quot;\n\n  Liberal Party of Canada\n \n  Historical Conservative parties (including Liberal-Conservative, Conservative (Historical),     Unionist, National Liberal and Conservative, Progressive Conservative) \n  Conservative Party of Canada\n\n&quot;
## [5] &quot;Provinces key:&quot;                                                                                                                                                                                                                                 
## [6] &quot;AB: Alberta, BC: British Columbia, MB: Manitoba, NS: Nova Scotia,ON: Ontario, QC: Quebec, SK: Saskatchewan\n&quot;</code></pre>
<p>At this point our data is in a character vector, we want to convert it to a table, and reduce the data down to just the information that we want. The key that is going to allow us to do this is the fact that there seems to be a blank line (which in html is denoted by <code>\n</code>) before the key information that we need. So, once we identify that line then we can filter to just the line below it!</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="gather-data.html#cb280-1" aria-hidden="true" tabindex="-1"></a>parsed_data <span class="ot">&lt;-</span> </span>
<span id="cb280-2"><a href="gather-data.html#cb280-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">raw_text =</span> parse_data_inspection) <span class="sc">%&gt;%</span> <span class="co"># Convert the character vector to a table</span></span>
<span id="cb280-3"><a href="gather-data.html#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_PM =</span> <span class="fu">if_else</span>(raw_text <span class="sc">==</span> <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># Look for the blank line that is </span></span>
<span id="cb280-4"><a href="gather-data.html#cb280-4" aria-hidden="true" tabindex="-1"></a>         <span class="co"># above the row that we want</span></span>
<span id="cb280-5"><a href="gather-data.html#cb280-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">is_PM =</span> <span class="fu">lag</span>(is_PM, <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="co"># Identify the actual row that we want</span></span>
<span id="cb280-6"><a href="gather-data.html#cb280-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_PM <span class="sc">==</span> <span class="dv">1</span>) <span class="co"># Just get the rows that we want</span></span>
<span id="cb280-7"><a href="gather-data.html#cb280-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb280-8"><a href="gather-data.html#cb280-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(parsed_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   raw_text                                                                 is_PM
##   &lt;chr&gt;                                                                    &lt;dbl&gt;
## 1 &quot;\nSir John A. MacDonald(1815–1891)MP for Kingston, ON\n&quot;                    1
## 2 &quot;\nAlexander Mackenzie(1822–1892)MP for Lambton, ON\n&quot;                       1
## 3 &quot;\nSir John A. MacDonald(1815–1891)MP for Victoria, BC until 1882MP for…     1
## 4 &quot;\nSir John Abbott(1821–1893)Senator for Quebec\n&quot;                           1
## 5 &quot;\nSir John Thompson(1845–1894)MP for Antigonish, NS\n&quot;                      1
## 6 &quot;\nSir Mackenzie Bowell(1823–1917)Senator for Ontario\n&quot;                     1</code></pre>
</div>
<div id="using-the-selector-gadget" class="section level4" number="7.7.3.2">
<h4><span class="header-section-number">7.7.3.2</span> Using the selector gadget</h4>
<p>If you are comfortable with html then you might be able to see patterns, but one tool that may help is the SelectorGadget: <a href="https://cran.r-project.org/web/packages/rvest/vignettes/selectorgadget.html" class="uri">https://cran.r-project.org/web/packages/rvest/vignettes/selectorgadget.html</a>. This allows you to pick and choose the elements that you want, and then gives you the input to give to <code>html_nodes()</code> (Figure <a href="gather-data.html#fig:selectorgadget">7.8</a>)</p>
<div class="figure"><span id="fig:selectorgadget"></span>
<img src="figures/selectorgadget.png" alt="Using the Selector Gadget to identify the tag, as at 13 March 2020." width="90%" />
<p class="caption">
Figure 7.8: Using the Selector Gadget to identify the tag, as at 13 March 2020.
</p>
</div>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="gather-data.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in our saved data</span></span>
<span id="cb282-2"><a href="gather-data.html#cb282-2" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;inputs/wiki/pms.html&quot;</span>)</span>
<span id="cb282-3"><a href="gather-data.html#cb282-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-4"><a href="gather-data.html#cb282-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We can parse tags in order</span></span>
<span id="cb282-5"><a href="gather-data.html#cb282-5" aria-hidden="true" tabindex="-1"></a>parse_data_selector_gadget <span class="ot">&lt;-</span> </span>
<span id="cb282-6"><a href="gather-data.html#cb282-6" aria-hidden="true" tabindex="-1"></a>  raw_data <span class="sc">%&gt;%</span> </span>
<span id="cb282-7"><a href="gather-data.html#cb282-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;td:nth-child(3)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-8"><a href="gather-data.html#cb282-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_text</span>() <span class="co"># html_text removes any remaining html tags</span></span>
<span id="cb282-9"><a href="gather-data.html#cb282-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-10"><a href="gather-data.html#cb282-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(parse_data_selector_gadget)</span></code></pre></div>
<pre><code>## [1] &quot;\nSir John A. MacDonald(1815–1891)MP for Kingston, ON\n&quot;                                                            
## [2] &quot;\nAlexander Mackenzie(1822–1892)MP for Lambton, ON\n&quot;                                                               
## [3] &quot;\nSir John A. MacDonald(1815–1891)MP for Victoria, BC until 1882MP for Carleton, ON until 1887MP for Kingston, ON\n&quot;
## [4] &quot;\nSir John Abbott(1821–1893)Senator for Quebec\n&quot;                                                                   
## [5] &quot;\nSir John Thompson(1845–1894)MP for Antigonish, NS\n&quot;                                                              
## [6] &quot;\nSir Mackenzie Bowell(1823–1917)Senator for Ontario\n&quot;</code></pre>
<p>In this case there is one prime minister - Robert Borden - who changed party and we would need to filter away that row: <code>\nUnionist Party\n"</code>.</p>
</div>
<div id="clean-data" class="section level4" number="7.7.3.3">
<h4><span class="header-section-number">7.7.3.3</span> Clean data</h4>
<p>Now that we have the parsed data, we need to clean it to match what we wanted. In particular we want a names column, as well as columns for birth year and death year. We will use <code>separate()</code> to take advantage of the fact that it looks like the dates are distinguished by brackets.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="gather-data.html#cb284-1" aria-hidden="true" tabindex="-1"></a>initial_clean <span class="ot">&lt;-</span> </span>
<span id="cb284-2"><a href="gather-data.html#cb284-2" aria-hidden="true" tabindex="-1"></a>  parsed_data <span class="sc">%&gt;%</span> </span>
<span id="cb284-3"><a href="gather-data.html#cb284-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(raw_text, </span>
<span id="cb284-4"><a href="gather-data.html#cb284-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;not_name&quot;</span>), </span>
<span id="cb284-5"><a href="gather-data.html#cb284-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">(&quot;</span>,</span>
<span id="cb284-6"><a href="gather-data.html#cb284-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="co"># The remove = FALSE option here means that we </span></span>
<span id="cb284-7"><a href="gather-data.html#cb284-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep the original column that we are separating.</span></span>
<span id="cb284-8"><a href="gather-data.html#cb284-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(not_name, </span>
<span id="cb284-9"><a href="gather-data.html#cb284-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;all_the_rest&quot;</span>), </span>
<span id="cb284-10"><a href="gather-data.html#cb284-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">)&quot;</span>,</span>
<span id="cb284-11"><a href="gather-data.html#cb284-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb284-12"><a href="gather-data.html#cb284-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-13"><a href="gather-data.html#cb284-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(initial_clean)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   raw_text           Name     not_name          Date  all_the_rest         is_PM
##   &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt;                &lt;dbl&gt;
## 1 &quot;\nSir John A. Ma… &quot;\nSir … &quot;1815–1891)MP fo… 1815… &quot;MP for Kingston, O…     1
## 2 &quot;\nAlexander Mack… &quot;\nAlex… &quot;1822–1892)MP fo… 1822… &quot;MP for Lambton, ON…     1
## 3 &quot;\nSir John A. Ma… &quot;\nSir … &quot;1815–1891)MP fo… 1815… &quot;MP for Victoria, B…     1
## 4 &quot;\nSir John Abbot… &quot;\nSir … &quot;1821–1893)Senat… 1821… &quot;Senator for Quebec…     1
## 5 &quot;\nSir John Thomp… &quot;\nSir … &quot;1845–1894)MP fo… 1845… &quot;MP for Antigonish,…     1
## 6 &quot;\nSir Mackenzie … &quot;\nSir … &quot;1823–1917)Senat… 1823… &quot;Senator for Ontari…     1</code></pre>
<p>Finally, we need to clean up the columns.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="gather-data.html#cb286-1" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="ot">&lt;-</span> </span>
<span id="cb286-2"><a href="gather-data.html#cb286-2" aria-hidden="true" tabindex="-1"></a>  initial_clean <span class="sc">%&gt;%</span> </span>
<span id="cb286-3"><a href="gather-data.html#cb286-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Name, Date) <span class="sc">%&gt;%</span> </span>
<span id="cb286-4"><a href="gather-data.html#cb286-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Date, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Birth&quot;</span>, <span class="st">&quot;Died&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;–&quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="co"># The </span></span>
<span id="cb286-5"><a href="gather-data.html#cb286-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PMs who have died have their birth and death years separated by a hyphen, but </span></span>
<span id="cb286-6"><a href="gather-data.html#cb286-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># you need to be careful with the hyphen as it seems to be a slightly odd type of </span></span>
<span id="cb286-7"><a href="gather-data.html#cb286-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hyphen and you need to copy/paste it.</span></span>
<span id="cb286-8"><a href="gather-data.html#cb286-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Birth =</span> <span class="fu">str_remove</span>(Birth, <span class="st">&quot;b. &quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># Alive PMs have slightly different format</span></span>
<span id="cb286-9"><a href="gather-data.html#cb286-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Date) <span class="sc">%&gt;%</span> </span>
<span id="cb286-10"><a href="gather-data.html#cb286-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Name =</span> <span class="fu">str_remove</span>(Name, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># Remove some html tags that remain</span></span>
<span id="cb286-11"><a href="gather-data.html#cb286-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(Birth, Died), <span class="sc">~</span><span class="fu">as.integer</span>(.)) <span class="sc">%&gt;%</span> <span class="co"># Change birth and death to integers</span></span>
<span id="cb286-12"><a href="gather-data.html#cb286-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age_at_Death =</span> Died <span class="sc">-</span> Birth) <span class="sc">%&gt;%</span>  <span class="co"># Add column of the number of years they lived</span></span>
<span id="cb286-13"><a href="gather-data.html#cb286-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="co"># Some of the PMs had two goes at it.</span></span>
<span id="cb286-14"><a href="gather-data.html#cb286-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-15"><a href="gather-data.html#cb286-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cleaned_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   Name                  Birth  Died Age_at_Death
##   &lt;chr&gt;                 &lt;int&gt; &lt;int&gt;        &lt;int&gt;
## 1 Sir John A. MacDonald  1815  1891           76
## 2 Alexander Mackenzie    1822  1892           70
## 3 Sir John Abbott        1821  1893           72
## 4 Sir John Thompson      1845  1894           49
## 5 Sir Mackenzie Bowell   1823  1917           94
## 6 Sir Charles Tupper     1821  1915           94</code></pre>
</div>
</div>
<div id="explore-1" class="section level3" number="7.7.4">
<h3><span class="header-section-number">7.7.4</span> Explore</h3>
<p>At this point we’d like to make a graph that illustrates how long each prime minister lived. If they are still alive then we would like them to run to the end, but we would like to colour them differently.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="gather-data.html#cb288-1" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="sc">%&gt;%</span> </span>
<span id="cb288-2"><a href="gather-data.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">still_alive =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Died), <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>),</span>
<span id="cb288-3"><a href="gather-data.html#cb288-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Died =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Died), <span class="fu">as.integer</span>(<span class="dv">2020</span>), Died)) <span class="sc">%&gt;%</span> </span>
<span id="cb288-4"><a href="gather-data.html#cb288-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Name =</span> <span class="fu">as_factor</span>(Name)) <span class="sc">%&gt;%</span> </span>
<span id="cb288-5"><a href="gather-data.html#cb288-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Birth, </span>
<span id="cb288-6"><a href="gather-data.html#cb288-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">xend =</span> Died,</span>
<span id="cb288-7"><a href="gather-data.html#cb288-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> Name,</span>
<span id="cb288-8"><a href="gather-data.html#cb288-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">yend =</span> Name, </span>
<span id="cb288-9"><a href="gather-data.html#cb288-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> still_alive)) <span class="sc">+</span></span>
<span id="cb288-10"><a href="gather-data.html#cb288-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>() <span class="sc">+</span></span>
<span id="cb288-11"><a href="gather-data.html#cb288-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Year of birth&quot;</span>,</span>
<span id="cb288-12"><a href="gather-data.html#cb288-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Prime minister&quot;</span>,</span>
<span id="cb288-13"><a href="gather-data.html#cb288-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;PM is alive&quot;</span>,</span>
<span id="cb288-14"><a href="gather-data.html#cb288-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Canadian Prime Minister, by year of birth&quot;</span>) <span class="sc">+</span></span>
<span id="cb288-15"><a href="gather-data.html#cb288-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb288-16"><a href="gather-data.html#cb288-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-171-1.png" width="672" /></p>
</div>
</div>
<div id="pdfs" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> PDFs</h2>
<div id="introduction-9" class="section level3" number="7.8.1">
<h3><span class="header-section-number">7.8.1</span> Introduction</h3>
<p>In contrast to an API, a PDF is usually only produced for human (not computer) consumption. The nice thing about PDFs is that they are static and constant. And it is nice that they make data available at all. But the trade-off is that:</p>
<ul>
<li>It is not overly useful to do larger-scale statistical analysis.</li>
<li>We don’t know how the PDF was put together so we don’t know whether we can trust it.</li>
<li>We can’t manipulate the data to get results that we are interested in.</li>
</ul>
<p>Indeed, sometimes governments publish data as PDFs because they don’t actually want you to be able to analyse it! Being able to get data from PDFs opens up a large number of datasets for you, some of which we’ll see in this chapter.</p>
<p>There are two important aspects to keep in mind when approaching a PDF with a mind to extracting data from it:</p>
<ol style="list-style-type: decimal">
<li>Begin with an end in mind. Planning and then literally sketching out what you want from a final dataset/graph/paper stops you wasting time and keeps you focused.</li>
<li>Start simple, then iterate. The quickest way to make a complicated model is often to first build a simple model and then complicate it. Start with just trying to get one page of the PDF working or even just one line. Then iterate from there.</li>
</ol>
<p>In this chapter we start by walking through several examples and then go through three case studies of varying difficulty.</p>
</div>
<div id="getting-started-4" class="section level3" number="7.8.2">
<h3><span class="header-section-number">7.8.2</span> Getting started</h3>
<p>Figure <a href="gather-data.html#fig:firstpdfexample">7.9</a> is a PDF that consists of just the first sentence from Jane Eyre taken from Project Gutenberg <span class="citation"><a href="references-1.html#ref-janeeyre" role="doc-biblioref">Bronte</a> (<a href="references-1.html#ref-janeeyre" role="doc-biblioref">1847</a>)</span>.</p>
<div class="figure"><span id="fig:firstpdfexample"></span>
<img src="inputs/pdfs/first_example.png" alt="First sentence of Jane Eyre" width="90%" />
<p class="caption">
Figure 7.9: First sentence of Jane Eyre
</p>
</div>
<p>We will use the package <code>pdftools</code> <span class="citation"><a href="references-1.html#ref-citepdftools" role="doc-biblioref">Ooms</a> (<a href="references-1.html#ref-citepdftools" role="doc-biblioref">2019a</a>)</span> to get the text in this one page PDF into R.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="gather-data.html#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;pdftools&quot;)</span></span>
<span id="cb289-2"><a href="gather-data.html#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdftools)</span>
<span id="cb289-3"><a href="gather-data.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb289-4"><a href="gather-data.html#cb289-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-5"><a href="gather-data.html#cb289-5" aria-hidden="true" tabindex="-1"></a>first_example <span class="ot">&lt;-</span> pdftools<span class="sc">::</span><span class="fu">pdf_text</span>(<span class="st">&quot;inputs/pdfs/first_example.pdf&quot;</span>)</span>
<span id="cb289-6"><a href="gather-data.html#cb289-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-7"><a href="gather-data.html#cb289-7" aria-hidden="true" tabindex="-1"></a>first_example</span></code></pre></div>
<pre><code>## [1] &quot;There was no possibility of taking a walk that day.&quot;</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="gather-data.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(first_example)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>We can see that the PDF has been correctly read in, as a character vector.</p>
<p>We will now try a slightly more complicated example that consists of the first few paragraphs of Jane Eyre (Figure <a href="gather-data.html#fig:secondpdfexample">7.10</a>). Also notice that now we have the chapter heading as well.</p>
<div class="figure"><span id="fig:secondpdfexample"></span>
<img src="inputs/pdfs/second_example.png" alt="First few paragraphs of Jane Eyre" width="90%" />
<p class="caption">
Figure 7.10: First few paragraphs of Jane Eyre
</p>
</div>
<p>We use the same function as before.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="gather-data.html#cb293-1" aria-hidden="true" tabindex="-1"></a>second_example <span class="ot">&lt;-</span> pdftools<span class="sc">::</span><span class="fu">pdf_text</span>(<span class="st">&quot;inputs/pdfs/second_example.pdf&quot;</span>)</span>
<span id="cb293-2"><a href="gather-data.html#cb293-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-3"><a href="gather-data.html#cb293-3" aria-hidden="true" tabindex="-1"></a>second_example</span></code></pre></div>
<pre><code>## [1] &quot;CHAPTER I\nThere was no possibility of taking a walk that day. We had been wandering, indeed, in the\nleafless shrubbery an hour in the morning; but since dinner (Mrs. Reed, when there was no\ncompany, dined early) the cold winter wind had brought with it clouds so sombre, and a rain so\npenetrating, that further out-door exercise was now out of the question.\nI was glad of it: I never liked long walks, especially on chilly afternoons: dreadful to me was the\ncoming home in the raw twilight, with nipped fingers and toes, and a heart saddened by the\nchidings of Bessie, the nurse, and humbled by the consciousness of my physical inferiority to\nEliza, John, and Georgiana Reed.\nThe said Eliza, John, and Georgiana were now clustered round their mama in the drawing-room:\nshe lay reclined on a sofa by the fireside, and with her darlings about her (for the time neither\nquarrelling nor crying) looked perfectly happy. Me, she had dispensed from joining the group;\nsaying, “She regretted to be under the necessity of keeping me at a distance; but that until she\nheard from Bessie, and could discover by her own observation, that I was endeavouring in good\nearnest to acquire a more sociable and childlike disposition, a more attractive and sprightly\nmanner—something lighter, franker, more natural, as it were—she really must exclude me from\nprivileges intended only for contented, happy, little children.”\n“What does Bessie say I have done?” I asked.\n“Jane, I don’t like cavillers or questioners; besides, there is something truly forbidding in a child\ntaking up her elders in that manner. Be seated somewhere; and until you can speak pleasantly,\nremain silent.”\nA breakfast-room adjoined the drawing-room, I slipped in there. It contained a bookcase: I soon\npossessed myself of a volume, taking care that it should be one stored with pictures. I mounted\ninto the window-seat: gathering up my feet, I sat cross-legged, like a Turk; and, having drawn the\nred moreen curtain nearly close, I was shrined in double retirement.\nFolds of scarlet drapery shut in my view to the right hand; to the left were the clear panes of\nglass, protecting, but not separating me from the drear November day. At intervals, while\nturning over the leaves of my book, I studied the aspect of that winter afternoon. Afar, it offered\na pale blank of mist and cloud; near a scene of wet lawn and storm-beat shrub, with ceaseless\nrain sweeping away wildly before a long and lamentable blast.\n&quot;</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="gather-data.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(second_example)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Again, we have a character vector. The end of each line is signalled by ‘\n,’ but other than that it looks pretty good.</p>
<p>Finally, we consider the first two pages.</p>
<p>We use the same function as before.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="gather-data.html#cb297-1" aria-hidden="true" tabindex="-1"></a>third_example <span class="ot">&lt;-</span> pdftools<span class="sc">::</span><span class="fu">pdf_text</span>(<span class="st">&quot;inputs/pdfs/third_example.pdf&quot;</span>)</span>
<span id="cb297-2"><a href="gather-data.html#cb297-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-3"><a href="gather-data.html#cb297-3" aria-hidden="true" tabindex="-1"></a>third_example</span></code></pre></div>
<pre><code>## [1] &quot;CHAPTER I\nThere was no possibility of taking a walk that day. We had been wandering, indeed, in the\nleafless shrubbery an hour in the morning; but since dinner (Mrs. Reed, when there was no\ncompany, dined early) the cold winter wind had brought with it clouds so sombre, and a rain so\npenetrating, that further out-door exercise was now out of the question.\nI was glad of it: I never liked long walks, especially on chilly afternoons: dreadful to me was the\ncoming home in the raw twilight, with nipped fingers and toes, and a heart saddened by the\nchidings of Bessie, the nurse, and humbled by the consciousness of my physical inferiority to\nEliza, John, and Georgiana Reed.\nThe said Eliza, John, and Georgiana were now clustered round their mama in the drawing-room:\nshe lay reclined on a sofa by the fireside, and with her darlings about her (for the time neither\nquarrelling nor crying) looked perfectly happy. Me, she had dispensed from joining the group;\nsaying, “She regretted to be under the necessity of keeping me at a distance; but that until she\nheard from Bessie, and could discover by her own observation, that I was endeavouring in good\nearnest to acquire a more sociable and childlike disposition, a more attractive and sprightly\nmanner—something lighter, franker, more natural, as it were—she really must exclude me from\nprivileges intended only for contented, happy, little children.”\n“What does Bessie say I have done?” I asked.\n“Jane, I don’t like cavillers or questioners; besides, there is something truly forbidding in a child\ntaking up her elders in that manner. Be seated somewhere; and until you can speak pleasantly,\nremain silent.”\nA breakfast-room adjoined the drawing-room, I slipped in there. It contained a bookcase: I soon\npossessed myself of a volume, taking care that it should be one stored with pictures. I mounted\ninto the window-seat: gathering up my feet, I sat cross-legged, like a Turk; and, having drawn the\nred moreen curtain nearly close, I was shrined in double retirement.\nFolds of scarlet drapery shut in my view to the right hand; to the left were the clear panes of\nglass, protecting, but not separating me from the drear November day. At intervals, while\nturning over the leaves of my book, I studied the aspect of that winter afternoon. Afar, it offered\na pale blank of mist and cloud; near a scene of wet lawn and storm-beat shrub, with ceaseless\nrain sweeping away wildly before a long and lamentable blast.\nI returned to my book—Bewick’s History of British Birds: the letterpress thereof I cared little\nfor, generally speaking; and yet there were certain introductory pages that, child as I was, I could\nnot pass quite as a blank. They were those which treat of the haunts of sea-fowl; of “the solitary\nrocks and promontories” by them only inhabited; of the coast of Norway, studded with isles from\nits southern extremity, the Lindeness, or Naze, to the North Cape—\n“Where the Northern Ocean, in vast whirls,\nBoils round the naked, melancholy isles\n&quot;
## [2] &quot;Of farthest Thule; and the Atlantic surge\nPours in among the stormy Hebrides.”\nNor could I pass unnoticed the suggestion of the bleak shores of Lapland, Siberia, Spitzbergen,\nNova Zembla, Iceland, Greenland, with “the vast sweep of the Arctic Zone, and those forlorn\nregions of dreary space,—that reservoir of frost and snow, where firm fields of ice, the\naccumulation of centuries of winters, glazed in Alpine heights above heights, surround the pole,\nand concentre the multiplied rigours of extreme cold.” Of these death-white realms I formed an\nidea of my own: shadowy, like all the half-comprehended notions that float dim through\nchildren’s brains, but strangely impressive. The words in these introductory pages connected\nthemselves with the succeeding vignettes, and gave significance to the rock standing up alone in\na sea of billow and spray; to the broken boat stranded on a desolate coast; to the cold and ghastly\nmoon glancing through bars of cloud at a wreck just sinking.\nI cannot tell what sentiment haunted the quite solitary churchyard, with its inscribed headstone;\nits gate, its two trees, its low horizon, girdled by a broken wall, and its newly-risen crescent,\nattesting the hour of eventide.\nThe two ships becalmed on a torpid sea, I believed to be marine phantoms.\nThe fiend pinning down the thief’s pack behind him, I passed over quickly: it was an object of\nterror.\nSo was the black horned thing seated aloof on a rock, surveying a distant crowd surrounding a\ngallows.\nEach picture told a story; mysterious often to my undeveloped understanding and imperfect\nfeelings, yet ever profoundly interesting: as interesting as the tales Bessie sometimes narrated on\nwinter evenings, when she chanced to be in good humour; and when, having brought her ironing-\ntable to the nursery hearth, she allowed us to sit about it, and while she got up Mrs. Reed’s lace\nfrills, and crimped her nightcap borders, fed our eager attention with passages of love and\nadventure taken from old fairy tales and other ballads; or (as at a later period I discovered) from\nthe pages of Pamela, and Henry, Earl of Moreland.\nWith Bewick on my knee, I was then happy: happy at least in my way. I feared nothing but\ninterruption, and that came too soon. The breakfast-room door opened.\n“Boh! Madam Mope!” cried the voice of John Reed; then he paused: he found the room\napparently empty.\n“Where the dickens is she!” he continued. “Lizzy! Georgy! (calling to his sisters) Joan is not\nhere: tell mama she is run out into the rain—bad animal!”\n“It is well I drew the curtain,” thought I; and I wished fervently he might not discover my hiding-\nplace: nor would John Reed have found it out himself; he was not quick either of vision or\nconception; but Eliza just put her head in at the door, and said at once—\n&quot;</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="gather-data.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(third_example)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Now, notice that the first page is the first element of the character vector and the second page is the second element.</p>
<p>As we’re most familiar with rectangular data we’ll try to get it into that format as quickly as possible. And then we can use our regular tools to deal with it.</p>
<p>First we want to convert the character vector into a tibble. At this point we may like to add page numbers as well.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="gather-data.html#cb301-1" aria-hidden="true" tabindex="-1"></a>jane_eyre <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">raw_text =</span> third_example,</span>
<span id="cb301-2"><a href="gather-data.html#cb301-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">page_number =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>))</span></code></pre></div>
<p>We probably now want to separate the lines so that each line is an observation. We can do that by looking for the ‘\n’ remembering that we need to escape the backslash as it’s a special character.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="gather-data.html#cb302-1" aria-hidden="true" tabindex="-1"></a>jane_eyre <span class="ot">&lt;-</span> <span class="fu">separate_rows</span>(jane_eyre, raw_text, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">n&quot;</span>, <span class="at">convert =</span> <span class="cn">FALSE</span>)</span>
<span id="cb302-2"><a href="gather-data.html#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(jane_eyre)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   raw_text                                                           page_number
##   &lt;chr&gt;                                                                    &lt;int&gt;
## 1 CHAPTER I                                                                    1
## 2 There was no possibility of taking a walk that day. We had been w…           1
## 3 leafless shrubbery an hour in the morning; but since dinner (Mrs.…           1
## 4 company, dined early) the cold winter wind had brought with it cl…           1
## 5 penetrating, that further out-door exercise was now out of the qu…           1
## 6 I was glad of it: I never liked long walks, especially on chilly …           1</code></pre>
</div>
</div>
<div id="case-study-us-total-fertility-rate-by-state-and-year-2000-2018" class="section level2" number="7.9">
<h2><span class="header-section-number">7.9</span> Case-study: US Total Fertility Rate, by state and year (2000-2018)</h2>
<div id="introduction-10" class="section level3" number="7.9.1">
<h3><span class="header-section-number">7.9.1</span> Introduction</h3>
<p>If you’re married to a demographer it is not too long until you are asked to look at a US Department of Health and Human Services Vital Statistics Report. In this case we are interested in trying to get the total fertility rate (the average number of births per woman assuming that woman experience the current age-specific fertility rates throughout their reproductive years)<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> for each state for nineteen years. Annoyingly, the US persists in only making this data available in PDFs, but it makes a nice case study.</p>
<p>In the case of the year 2000 the table that we are interested in is on page 40 of a PDF that is available <a href="https://www.cdc.gov/nchs/data/nvsr/nvsr50/nvsr50_05.pdf" class="uri">https://www.cdc.gov/nchs/data/nvsr/nvsr50/nvsr50_05.pdf</a> and it is the column labelled: “Total fertility rate” (Figure <a href="gather-data.html#fig:dhsexample">7.11</a>).</p>
<div class="figure"><span id="fig:dhsexample"></span>
<img src="figures/dhs_example.png" alt="Example Vital Statistics Report, from 2000" width="90%" />
<p class="caption">
Figure 7.11: Example Vital Statistics Report, from 2000
</p>
</div>
</div>
<div id="begin-with-an-end-in-mind" class="section level3" number="7.9.2">
<h3><span class="header-section-number">7.9.2</span> Begin with an end in mind</h3>
<p>The first step when getting data out of a PDF is to sketch out what you eventually want. A PDF typically contains a lot of information, and so it is handy to be very clear about what you need. This helps keep you focused, and prevents scope creep, but it is also helpful when thinking about data checks. Literally write down on paper what you have in mind.</p>
<p>In this case, what is needed is a table with a column for state, year and TFR (Figure <a href="gather-data.html#fig:tfrdesired">7.12</a>).</p>
<div class="figure"><span id="fig:tfrdesired"></span>
<img src="figures/tfr_desired.jpeg" alt="Desired output from the PDF" width="90%" />
<p class="caption">
Figure 7.12: Desired output from the PDF
</p>
</div>
</div>
<div id="start-simple-then-iterate." class="section level3" number="7.9.3">
<h3><span class="header-section-number">7.9.3</span> Start simple, then iterate.</h3>
<p>There are 19 different PDFs and we are interested in a particular column in a particular table in each of them. Unfortunately there is nothing magical about what is coming. This first step requires working out the link for each, and the page and column name that is of interest. In the end, this looks like this.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="gather-data.html#cb304-1" aria-hidden="true" tabindex="-1"></a>monicas_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;inputs/tfr_tables_info.csv&quot;</span>)</span>
<span id="cb304-2"><a href="gather-data.html#cb304-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-3"><a href="gather-data.html#cb304-3" aria-hidden="true" tabindex="-1"></a>monicas_data <span class="sc">%&gt;%</span> </span>
<span id="cb304-4"><a href="gather-data.html#cb304-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, page, table, column_name, url) <span class="sc">%&gt;%</span> </span>
<span id="cb304-5"><a href="gather-data.html#cb304-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#skmcfbdfyb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#skmcfbdfyb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#skmcfbdfyb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#skmcfbdfyb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#skmcfbdfyb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#skmcfbdfyb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#skmcfbdfyb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#skmcfbdfyb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#skmcfbdfyb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#skmcfbdfyb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#skmcfbdfyb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#skmcfbdfyb .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#skmcfbdfyb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#skmcfbdfyb .gt_from_md > :first-child {
  margin-top: 0;
}

#skmcfbdfyb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#skmcfbdfyb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#skmcfbdfyb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#skmcfbdfyb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#skmcfbdfyb .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#skmcfbdfyb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#skmcfbdfyb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#skmcfbdfyb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#skmcfbdfyb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#skmcfbdfyb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#skmcfbdfyb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#skmcfbdfyb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#skmcfbdfyb .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#skmcfbdfyb .gt_left {
  text-align: left;
}

#skmcfbdfyb .gt_center {
  text-align: center;
}

#skmcfbdfyb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#skmcfbdfyb .gt_font_normal {
  font-weight: normal;
}

#skmcfbdfyb .gt_font_bold {
  font-weight: bold;
}

#skmcfbdfyb .gt_font_italic {
  font-style: italic;
}

#skmcfbdfyb .gt_super {
  font-size: 65%;
}

#skmcfbdfyb .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="skmcfbdfyb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">page</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">table</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">column_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">url</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_right">2000</td>
      <td class="gt_row gt_right">40</td>
      <td class="gt_row gt_right">10</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr50/nvsr50_05.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2001</td>
      <td class="gt_row gt_right">41</td>
      <td class="gt_row gt_right">10</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr51/nvsr51_02.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2002</td>
      <td class="gt_row gt_right">46</td>
      <td class="gt_row gt_right">10</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr52/nvsr52_10.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2003</td>
      <td class="gt_row gt_right">45</td>
      <td class="gt_row gt_right">10</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr54/nvsr54_02.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2004</td>
      <td class="gt_row gt_right">52</td>
      <td class="gt_row gt_right">11</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr55/nvsr55_01.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2005</td>
      <td class="gt_row gt_right">52</td>
      <td class="gt_row gt_right">11</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr56/nvsr56_06.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2006</td>
      <td class="gt_row gt_right">49</td>
      <td class="gt_row gt_right">11</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr57/nvsr57_07.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2007</td>
      <td class="gt_row gt_right">41</td>
      <td class="gt_row gt_right">11</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr58/nvsr58_24.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2008</td>
      <td class="gt_row gt_right">43</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr59/nvsr59_01.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2009</td>
      <td class="gt_row gt_right">43</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr60/nvsr60_01.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2010</td>
      <td class="gt_row gt_right">42</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr61/nvsr61_01.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2011</td>
      <td class="gt_row gt_right">40</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr62/nvsr62_01.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2012</td>
      <td class="gt_row gt_right">38</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr62/nvsr62_09.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2013</td>
      <td class="gt_row gt_right">37</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr64/nvsr64_01.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2014</td>
      <td class="gt_row gt_right">38</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr64/nvsr64_12.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2015</td>
      <td class="gt_row gt_right">42</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr66/nvsr66_01.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2016</td>
      <td class="gt_row gt_right">29</td>
      <td class="gt_row gt_right">8</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr67/nvsr67_01.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2016</td>
      <td class="gt_row gt_right">30</td>
      <td class="gt_row gt_right">8</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr67/nvsr67_01.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2017</td>
      <td class="gt_row gt_right">23</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr67/nvsr67_08-508.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2017</td>
      <td class="gt_row gt_right">24</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr67/nvsr67_08-508.pdf</td>
    </tr>
    <tr>
      <td class="gt_row gt_right">2018</td>
      <td class="gt_row gt_right">23</td>
      <td class="gt_row gt_right">12</td>
      <td class="gt_row gt_left">Total fertility rate</td>
      <td class="gt_row gt_left">https://www.cdc.gov/nchs/data/nvsr/nvsr68/nvsr68_13-508.pdf</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>The first step is to get some code that works for one of them. I’ll step through the code in a lot more detail than normal because we’re going to use these pieces a lot.</p>
<p>We will choose the year 2000. We first download the data and save it.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="gather-data.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> monicas_data<span class="sc">$</span>url[<span class="dv">1</span>], </span>
<span id="cb305-2"><a href="gather-data.html#cb305-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="st">&quot;inputs/pdfs/dhs/year_2000.pdf&quot;</span>)</span></code></pre></div>
<p>We now want to read the PDF in as a character vector.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="gather-data.html#cb306-1" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> pdftools<span class="sc">::</span><span class="fu">pdf_text</span>(<span class="st">&quot;inputs/pdfs/dhs/year_2000.pdf&quot;</span>)</span></code></pre></div>
<p>Convert it to a tibble, so that we can use familiar verbs on it.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="gather-data.html#cb307-1" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">raw_data =</span> dhs_2000)</span>
<span id="cb307-2"><a href="gather-data.html#cb307-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-3"><a href="gather-data.html#cb307-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dhs_2000)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 1
##   raw_data                                                                      
##   &lt;chr&gt;                                                                         
## 1 &quot;Volume 50, Number 5                                                         …
## 2 &quot;2     National Vital Statistics Report, Vol. 50, No. 5, February 12, 2002\nH…
## 3 &quot;                                                                            …
## 4 &quot;4     National Vital Statistics Report, Vol. 50, No. 5, February 12, 2002\nD…
## 5 &quot;                                                                            …
## 6 &quot;6     National Vital Statistics Report, Vol. 50, No. 5, February 12, 2002\n …</code></pre>
<p>Grab the page that is of interest (remembering that each page is a element of the character vector, hence a row in the tibble).</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="gather-data.html#cb309-1" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> </span>
<span id="cb309-2"><a href="gather-data.html#cb309-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000 <span class="sc">%&gt;%</span> </span>
<span id="cb309-3"><a href="gather-data.html#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(monicas_data<span class="sc">$</span>page[<span class="dv">1</span>])</span>
<span id="cb309-4"><a href="gather-data.html#cb309-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-5"><a href="gather-data.html#cb309-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dhs_2000)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   raw_data                                                                      
##   &lt;chr&gt;                                                                         
## 1 &quot;40 National Vital Statistics Report, Vol. 50, No. 5, Revised May 15, 20022\n…</code></pre>
<p>Now we want to separate the rows.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="gather-data.html#cb311-1" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> </span>
<span id="cb311-2"><a href="gather-data.html#cb311-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000 <span class="sc">%&gt;%</span> </span>
<span id="cb311-3"><a href="gather-data.html#cb311-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(raw_data, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">n&quot;</span>, <span class="at">convert =</span> <span class="cn">FALSE</span>)</span>
<span id="cb311-4"><a href="gather-data.html#cb311-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-5"><a href="gather-data.html#cb311-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dhs_2000)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 1
##   raw_data                                                                      
##   &lt;chr&gt;                                                                         
## 1 40 National Vital Statistics Report, Vol. 50, No. 5, Revised May 15, 20022    
## 2 Table 10. Number of births, birth rates, fertility rates, total fertility rat…
## 3 United States, each State and territory, 2000                                 
## 4 [By place of residence. Birth rates are live births per 1,000 estimated popul…
## 5 estimated in each area; total fertility rates are sums of birth rates for 5-y…
## 6 age group estimated in each area]</code></pre>
<p>Now we are searching for patterns that we can use. (If you have a lot of tables that you are interested in grabbing from PDFs then it may also be worthwhile considering the tabulizer package which is specifically designed for that. The issue is that it depends on Java and I always seem to run into trouble when I need to use Java so I avoid it when I can.)</p>
<p>Let’s look at the first ten lines of content.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="gather-data.html#cb313-1" aria-hidden="true" tabindex="-1"></a>dhs_2000[<span class="dv">13</span><span class="sc">:</span><span class="dv">22</span>,]</span></code></pre></div>
<pre><code>## # A tibble: 10 x 1
##    raw_data                                                                     
##    &lt;chr&gt;                                                                        
##  1 United States 1 ......................................................      …
##  2 Alabama ...............................................................     …
##  3 Alaska ...................................................................  …
##  4 Arizona .................................................................   …
##  5 Arkansas ...............................................................    …
##  6 California ..............................................................   …
##  7 Colorado ...............................................................    …
##  8 Connecticut ...........................................................     …
##  9 Delaware ..............................................................     …
## 10 District of Columbia ..............................................         …</code></pre>
<p>It doesn’t get much better than this:</p>
<ol style="list-style-type: decimal">
<li>We have dots separating the states from the data.</li>
<li>We have a space between each of the columns.</li>
</ol>
<p>So we can now separate this in to separate columns. First we want to match on when there is at least two dots (remembering that the dot is a special character and so needs to be escaped).</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="gather-data.html#cb315-1" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> </span>
<span id="cb315-2"><a href="gather-data.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000 <span class="sc">%&gt;%</span> </span>
<span id="cb315-3"><a href="gather-data.html#cb315-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> raw_data, </span>
<span id="cb315-4"><a href="gather-data.html#cb315-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;data&quot;</span>), </span>
<span id="cb315-5"><a href="gather-data.html#cb315-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.{2,}&quot;</span>, </span>
<span id="cb315-6"><a href="gather-data.html#cb315-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>,</span>
<span id="cb315-7"><a href="gather-data.html#cb315-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">&quot;right&quot;</span></span>
<span id="cb315-8"><a href="gather-data.html#cb315-8" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb315-9"><a href="gather-data.html#cb315-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-10"><a href="gather-data.html#cb315-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dhs_2000)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   raw_data                              state                              data 
##   &lt;chr&gt;                                 &lt;chr&gt;                              &lt;chr&gt;
## 1 40 National Vital Statistics Report,… 40 National Vital Statistics Repo… &lt;NA&gt; 
## 2 Table 10. Number of births, birth ra… Table 10. Number of births, birth… &lt;NA&gt; 
## 3 United States, each State and territ… United States, each State and ter… &lt;NA&gt; 
## 4 [By place of residence. Birth rates … [By place of residence. Birth rat… &lt;NA&gt; 
## 5 estimated in each area; total fertil… estimated in each area; total fer… &lt;NA&gt; 
## 6 age group estimated in each area]     age group estimated in each area]  &lt;NA&gt;</code></pre>
<p>We get the expected warnings about the top and the bottom as they don’t have multiple dots.</p>
<p>(Another option here is to use the <code>pdf_data()</code> function which would allow us to use location rather than delimiters.)</p>
<p>We can now separate the data based on spaces. There is an inconsistent number of spaces, so we first squish any example of more than one space into just one.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="gather-data.html#cb317-1" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> </span>
<span id="cb317-2"><a href="gather-data.html#cb317-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000 <span class="sc">%&gt;%</span></span>
<span id="cb317-3"><a href="gather-data.html#cb317-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">str_squish</span>(data)) <span class="sc">%&gt;%</span> </span>
<span id="cb317-4"><a href="gather-data.html#cb317-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate</span>(<span class="at">col =</span> data, </span>
<span id="cb317-5"><a href="gather-data.html#cb317-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;number_of_births&quot;</span>, </span>
<span id="cb317-6"><a href="gather-data.html#cb317-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;birth_rate&quot;</span>, </span>
<span id="cb317-7"><a href="gather-data.html#cb317-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;fertility_rate&quot;</span>, </span>
<span id="cb317-8"><a href="gather-data.html#cb317-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;TFR&quot;</span>, </span>
<span id="cb317-9"><a href="gather-data.html#cb317-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;teen_births_all&quot;</span>, </span>
<span id="cb317-10"><a href="gather-data.html#cb317-10" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;teen_births_15_17&quot;</span>, </span>
<span id="cb317-11"><a href="gather-data.html#cb317-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;teen_births_18_19&quot;</span>), </span>
<span id="cb317-12"><a href="gather-data.html#cb317-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s&quot;</span>, </span>
<span id="cb317-13"><a href="gather-data.html#cb317-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span></span>
<span id="cb317-14"><a href="gather-data.html#cb317-14" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb317-15"><a href="gather-data.html#cb317-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-16"><a href="gather-data.html#cb317-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dhs_2000)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   raw_data      state     data  number_of_births birth_rate fertility_rate TFR  
##   &lt;chr&gt;         &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;
## 1 40 National … 40 Natio… &lt;NA&gt;  &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;           &lt;NA&gt; 
## 2 Table 10. Nu… Table 10… &lt;NA&gt;  &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;           &lt;NA&gt; 
## 3 United State… United S… &lt;NA&gt;  &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;           &lt;NA&gt; 
## 4 [By place of… [By plac… &lt;NA&gt;  &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;           &lt;NA&gt; 
## 5 estimated in… estimate… &lt;NA&gt;  &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;           &lt;NA&gt; 
## 6 age group es… age grou… &lt;NA&gt;  &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;           &lt;NA&gt; 
## # … with 3 more variables: teen_births_all &lt;chr&gt;, teen_births_15_17 &lt;chr&gt;,
## #   teen_births_18_19 &lt;chr&gt;</code></pre>
<p>This is all looking fairly great. The only thing left is to clean up.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="gather-data.html#cb319-1" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> </span>
<span id="cb319-2"><a href="gather-data.html#cb319-2" aria-hidden="true" tabindex="-1"></a>  dhs_2000 <span class="sc">%&gt;%</span> </span>
<span id="cb319-3"><a href="gather-data.html#cb319-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, TFR) <span class="sc">%&gt;%</span> </span>
<span id="cb319-4"><a href="gather-data.html#cb319-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">13</span><span class="sc">:</span><span class="dv">69</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb319-5"><a href="gather-data.html#cb319-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">2000</span>)</span>
<span id="cb319-6"><a href="gather-data.html#cb319-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-7"><a href="gather-data.html#cb319-7" aria-hidden="true" tabindex="-1"></a>dhs_2000</span></code></pre></div>
<pre><code>## # A tibble: 57 x 3
##    state                   TFR      year
##    &lt;chr&gt;                   &lt;chr&gt;   &lt;dbl&gt;
##  1 &quot;United States 1 &quot;      2,130.0  2000
##  2 &quot;Alabama &quot;              2,021.0  2000
##  3 &quot;Alaska &quot;               2,437.0  2000
##  4 &quot;Arizona &quot;              2,652.5  2000
##  5 &quot;Arkansas &quot;             2,140.0  2000
##  6 &quot;California &quot;           2,186.0  2000
##  7 &quot;Colorado &quot;             2,356.5  2000
##  8 &quot;Connecticut &quot;          1,931.5  2000
##  9 &quot;Delaware &quot;             2,014.0  2000
## 10 &quot;District of Columbia &quot; 1,975.5  2000
## # … with 47 more rows</code></pre>
<p>And we’re done for that year. Now we want to take these pieces, put them into a function and then run that function over all 19 years.</p>
</div>
<div id="iterating" class="section level3" number="7.9.4">
<h3><span class="header-section-number">7.9.4</span> Iterating</h3>
<div id="get-the-pdfs" class="section level4" number="7.9.4.1">
<h4><span class="header-section-number">7.9.4.1</span> Get the PDFs</h4>
<p>The first part is downloading each of the 19 PDFs that we need. We’re going to build on the code that we used before. That code was:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="gather-data.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> monicas_data<span class="sc">$</span>url[<span class="dv">1</span>], <span class="at">destfile =</span> <span class="st">&quot;inputs/pdfs/dhs/year_2000.pdf&quot;</span>)</span></code></pre></div>
<p>To modify this we need:</p>
<ol style="list-style-type: decimal">
<li>To have it iterate through each of the lines in the dataset that contains our CSVs (i.e. where it says 1, we want 1, then 2, then 3, etc.).</li>
<li>Where it has a filename, we need it to iterate through our desired filenames (i.e. year_2000, then year_2001, then year_2002, etc).</li>
<li>We’d like for it to do all of this in a way that is a little robust to errors. For instance, if one of the URLs is wrong or the internet drops out then we’d like it to just move onto the next PDF, and then warn us at the end that it missed one, not to stop. (This doesn’t really matter because it’s only 19 files, but it’s pretty easy to find yourself doing this for thousands of files).</li>
</ol>
<p>We will draw on the <code>purrr</code> package for this <span class="citation"><a href="references-1.html#ref-citepurrr" role="doc-biblioref">Henry and Wickham</a> (<a href="references-1.html#ref-citepurrr" role="doc-biblioref">2020</a>)</span>.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="gather-data.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb322-2"><a href="gather-data.html#cb322-2" aria-hidden="true" tabindex="-1"></a>monicas_data <span class="ot">&lt;-</span> </span>
<span id="cb322-3"><a href="gather-data.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  monicas_data <span class="sc">%&gt;%</span> </span>
<span id="cb322-4"><a href="gather-data.html#cb322-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pdf_name =</span> <span class="fu">paste0</span>(<span class="st">&quot;inputs/pdfs/dhs/year_&quot;</span>, year, <span class="st">&quot;.pdf&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="gather-data.html#cb323-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">walk2</span>(monicas_data<span class="sc">$</span>url, monicas_data<span class="sc">$</span>pdf_name, purrr<span class="sc">::</span><span class="fu">safely</span>(<span class="sc">~</span><span class="fu">download.file</span>(.x , .y)))</span></code></pre></div>
<p>What this code does it take the function <code>download.file()</code> and give it two arguments: <code>.x</code> and <code>.y</code>. The function <code>walk2()</code> then applies that function to the inputs that we give it, in this case the URLs columns is the <code>.x</code> and the pdf_names column is the <code>.y</code>. Finally, the <code>safely()</code> function means that if there are any failures then it just moves onto the next file instead of throwing an error.</p>
<p>We now have each of the PDFs saved and we can move onto getting the data from them.</p>
</div>
<div id="get-data-from-the-pdfs" class="section level4" number="7.9.4.2">
<h4><span class="header-section-number">7.9.4.2</span> Get data from the PDFs</h4>
<p>Now we need to get the data from the PDFs. As before, we’re going to build on the code that we used before. That code (overly condensed) was:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="gather-data.html#cb324-1" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> pdftools<span class="sc">::</span><span class="fu">pdf_text</span>(<span class="st">&quot;inputs/pdfs/dhs/year_2000.pdf&quot;</span>)</span>
<span id="cb324-2"><a href="gather-data.html#cb324-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-3"><a href="gather-data.html#cb324-3" aria-hidden="true" tabindex="-1"></a>dhs_2000 <span class="ot">&lt;-</span> </span>
<span id="cb324-4"><a href="gather-data.html#cb324-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">raw_data =</span> dhs_2000) <span class="sc">%&gt;%</span> </span>
<span id="cb324-5"><a href="gather-data.html#cb324-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(monicas_data<span class="sc">$</span>page[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb324-6"><a href="gather-data.html#cb324-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(raw_data, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">n&quot;</span>, <span class="at">convert =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb324-7"><a href="gather-data.html#cb324-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> raw_data, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;data&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.{2,}&quot;</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb324-8"><a href="gather-data.html#cb324-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">str_squish</span>(data)) <span class="sc">%&gt;%</span> </span>
<span id="cb324-9"><a href="gather-data.html#cb324-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> data, </span>
<span id="cb324-10"><a href="gather-data.html#cb324-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;number_of_births&quot;</span>, <span class="st">&quot;birth_rate&quot;</span>, <span class="st">&quot;fertility_rate&quot;</span>, <span class="st">&quot;TFR&quot;</span>, <span class="st">&quot;teen_births_all&quot;</span>, <span class="st">&quot;teen_births_15_17&quot;</span>, <span class="st">&quot;teen_births_18_19&quot;</span>), </span>
<span id="cb324-11"><a href="gather-data.html#cb324-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s&quot;</span>, </span>
<span id="cb324-12"><a href="gather-data.html#cb324-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb324-13"><a href="gather-data.html#cb324-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, TFR) <span class="sc">%&gt;%</span> </span>
<span id="cb324-14"><a href="gather-data.html#cb324-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">13</span><span class="sc">:</span><span class="dv">69</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb324-15"><a href="gather-data.html#cb324-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="dv">2000</span>)</span>
<span id="cb324-16"><a href="gather-data.html#cb324-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-17"><a href="gather-data.html#cb324-17" aria-hidden="true" tabindex="-1"></a>dhs_2000</span></code></pre></div>
<p>There are a bunch of aspects here that have been hardcoded, but the first thing that we want to iterate is the argument to <code>pdf_text()</code>, then the number in in <code>slice()</code> will also need to change (that is doing the work to get only the page that we are interested in).</p>
<p>Two aspects are hardcoded and these may need to be updated. In particular: 1) The separate only works if each of the tables has the same columns in the same order; and 2) the slice (which restricts the data to just the states) only works in this particular case. Finally, we add the year only at the end, whereas we’d need to bring that up earlier in the process.</p>
<p>We’ll start by writing a function that will go through all the files, grab the data, get the page of interest, and then expand the rows. We’ll then use a function from <code>purrr</code> to apply that function to all of the PDFs and to output a tibble.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="gather-data.html#cb325-1" aria-hidden="true" tabindex="-1"></a>get_pdf_convert_to_tibble <span class="ot">&lt;-</span> <span class="cf">function</span>(pdf_name, page, year){</span>
<span id="cb325-2"><a href="gather-data.html#cb325-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb325-3"><a href="gather-data.html#cb325-3" aria-hidden="true" tabindex="-1"></a>  dhs_table_of_interest <span class="ot">&lt;-</span> </span>
<span id="cb325-4"><a href="gather-data.html#cb325-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">raw_data =</span> pdftools<span class="sc">::</span><span class="fu">pdf_text</span>(pdf_name)) <span class="sc">%&gt;%</span> </span>
<span id="cb325-5"><a href="gather-data.html#cb325-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(page) <span class="sc">%&gt;%</span> </span>
<span id="cb325-6"><a href="gather-data.html#cb325-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_rows</span>(raw_data, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">n&quot;</span>, <span class="at">convert =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-7"><a href="gather-data.html#cb325-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(<span class="at">col =</span> raw_data, </span>
<span id="cb325-8"><a href="gather-data.html#cb325-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;data&quot;</span>), </span>
<span id="cb325-9"><a href="gather-data.html#cb325-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">sep =</span> <span class="st">&quot;[�|</span><span class="sc">\\</span><span class="st">.]</span><span class="sc">\\</span><span class="st">s+(?=[[:digit:]])&quot;</span>, </span>
<span id="cb325-10"><a href="gather-data.html#cb325-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb325-11"><a href="gather-data.html#cb325-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb325-12"><a href="gather-data.html#cb325-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">str_squish</span>(data),</span>
<span id="cb325-13"><a href="gather-data.html#cb325-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">year_of_data =</span> year)</span>
<span id="cb325-14"><a href="gather-data.html#cb325-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-15"><a href="gather-data.html#cb325-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Done with&quot;</span>, year))</span>
<span id="cb325-16"><a href="gather-data.html#cb325-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb325-17"><a href="gather-data.html#cb325-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dhs_table_of_interest)</span>
<span id="cb325-18"><a href="gather-data.html#cb325-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb325-19"><a href="gather-data.html#cb325-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-20"><a href="gather-data.html#cb325-20" aria-hidden="true" tabindex="-1"></a>raw_dhs_data <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">pmap_dfr</span>(monicas_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(pdf_name, page, year),</span>
<span id="cb325-21"><a href="gather-data.html#cb325-21" aria-hidden="true" tabindex="-1"></a>                                get_pdf_convert_to_tibble)</span></code></pre></div>
<pre><code>## [1] &quot;Done with 2000&quot;
## [1] &quot;Done with 2001&quot;
## [1] &quot;Done with 2002&quot;
## [1] &quot;Done with 2003&quot;
## [1] &quot;Done with 2004&quot;
## [1] &quot;Done with 2005&quot;
## [1] &quot;Done with 2006&quot;
## [1] &quot;Done with 2007&quot;
## [1] &quot;Done with 2008&quot;
## [1] &quot;Done with 2009&quot;
## [1] &quot;Done with 2010&quot;
## [1] &quot;Done with 2011&quot;
## [1] &quot;Done with 2012&quot;
## [1] &quot;Done with 2013&quot;
## [1] &quot;Done with 2014&quot;
## [1] &quot;Done with 2015&quot;
## [1] &quot;Done with 2016&quot;
## [1] &quot;Done with 2016&quot;
## [1] &quot;Done with 2017&quot;
## [1] &quot;Done with 2017&quot;
## [1] &quot;Done with 2018&quot;</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="gather-data.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw_dhs_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   raw_data                       state                        data  year_of_data
##   &lt;chr&gt;                          &lt;chr&gt;                        &lt;chr&gt;        &lt;dbl&gt;
## 1 40 National Vital Statistics … 40 National Vital Statistic… 50, …         2000
## 2 Table 10. Number of births, b… Table 10. Number of births,… &lt;NA&gt;          2000
## 3 United States, each State and… United States, each State a… &lt;NA&gt;          2000
## 4 [By place of residence. Birth… [By place of residence. Bir… &lt;NA&gt;          2000
## 5 estimated in each area; total… estimated in each area; tot… &lt;NA&gt;          2000
## 6 age group estimated in each a… age group estimated in each… &lt;NA&gt;          2000</code></pre>
<p>Now we need to clean up the state names and then filter on them.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="gather-data.html#cb329-1" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Alabama&quot;</span>, <span class="st">&quot;Alaska&quot;</span>, <span class="st">&quot;Arizona&quot;</span>, <span class="st">&quot;Arkansas&quot;</span>, <span class="st">&quot;California&quot;</span>, <span class="st">&quot;Colorado&quot;</span>, </span>
<span id="cb329-2"><a href="gather-data.html#cb329-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Connecticut&quot;</span>, <span class="st">&quot;Delaware&quot;</span>, <span class="st">&quot;Florida&quot;</span>, <span class="st">&quot;Georgia&quot;</span>, <span class="st">&quot;Hawaii&quot;</span>, <span class="st">&quot;Idaho&quot;</span>, </span>
<span id="cb329-3"><a href="gather-data.html#cb329-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Illinois&quot;</span>, <span class="st">&quot;Indiana&quot;</span>, <span class="st">&quot;Iowa&quot;</span>, <span class="st">&quot;Kansas&quot;</span>, <span class="st">&quot;Kentucky&quot;</span>, <span class="st">&quot;Louisiana&quot;</span>, </span>
<span id="cb329-4"><a href="gather-data.html#cb329-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Maine&quot;</span>, <span class="st">&quot;Maryland&quot;</span>, <span class="st">&quot;Massachusetts&quot;</span>, <span class="st">&quot;Michigan&quot;</span>, <span class="st">&quot;Minnesota&quot;</span>, </span>
<span id="cb329-5"><a href="gather-data.html#cb329-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Mississippi&quot;</span>, <span class="st">&quot;Missouri&quot;</span>, <span class="st">&quot;Montana&quot;</span>, <span class="st">&quot;Nebraska&quot;</span>, <span class="st">&quot;Nevada&quot;</span>, </span>
<span id="cb329-6"><a href="gather-data.html#cb329-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;New Hampshire&quot;</span>, <span class="st">&quot;New Jersey&quot;</span>, <span class="st">&quot;New Mexico&quot;</span>, <span class="st">&quot;New York&quot;</span>, <span class="st">&quot;North Carolina&quot;</span>, </span>
<span id="cb329-7"><a href="gather-data.html#cb329-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;North Dakota&quot;</span>, <span class="st">&quot;Ohio&quot;</span>, <span class="st">&quot;Oklahoma&quot;</span>, <span class="st">&quot;Oregon&quot;</span>, <span class="st">&quot;Pennsylvania&quot;</span>, </span>
<span id="cb329-8"><a href="gather-data.html#cb329-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Rhode Island&quot;</span>, <span class="st">&quot;South Carolina&quot;</span>, <span class="st">&quot;South Dakota&quot;</span>, <span class="st">&quot;Tennessee&quot;</span>, <span class="st">&quot;Texas&quot;</span>, </span>
<span id="cb329-9"><a href="gather-data.html#cb329-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Utah&quot;</span>, <span class="st">&quot;Vermont&quot;</span>, <span class="st">&quot;Virginia&quot;</span>, <span class="st">&quot;Washington&quot;</span>, <span class="st">&quot;West Virginia&quot;</span>, <span class="st">&quot;Wisconsin&quot;</span>, </span>
<span id="cb329-10"><a href="gather-data.html#cb329-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Wyoming&quot;</span>, <span class="st">&quot;District of Columbia&quot;</span>)</span>
<span id="cb329-11"><a href="gather-data.html#cb329-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-12"><a href="gather-data.html#cb329-12" aria-hidden="true" tabindex="-1"></a>raw_dhs_data <span class="ot">&lt;-</span> </span>
<span id="cb329-13"><a href="gather-data.html#cb329-13" aria-hidden="true" tabindex="-1"></a>  raw_dhs_data <span class="sc">%&gt;%</span> </span>
<span id="cb329-14"><a href="gather-data.html#cb329-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_remove_all</span>(state, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>),</span>
<span id="cb329-15"><a href="gather-data.html#cb329-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_remove_all</span>(state, <span class="st">&quot;�&quot;</span>),</span>
<span id="cb329-16"><a href="gather-data.html#cb329-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_remove_all</span>(state, <span class="st">&quot;&quot;</span>),</span>
<span id="cb329-17"><a href="gather-data.html#cb329-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_replace_all</span>(state, <span class="st">&quot;United States 1&quot;</span>, <span class="st">&quot;United States&quot;</span>),</span>
<span id="cb329-18"><a href="gather-data.html#cb329-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_replace_all</span>(state, <span class="st">&quot;United States1&quot;</span>, <span class="st">&quot;United States&quot;</span>),</span>
<span id="cb329-19"><a href="gather-data.html#cb329-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_replace_all</span>(state, <span class="st">&quot;United States 2&quot;</span>, <span class="st">&quot;United States&quot;</span>),</span>
<span id="cb329-20"><a href="gather-data.html#cb329-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_replace_all</span>(state, <span class="st">&quot;United States2&quot;</span>, <span class="st">&quot;United States&quot;</span>),</span>
<span id="cb329-21"><a href="gather-data.html#cb329-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> <span class="fu">str_replace_all</span>(state, <span class="st">&quot;United States²&quot;</span>, <span class="st">&quot;United States&quot;</span>),</span>
<span id="cb329-22"><a href="gather-data.html#cb329-22" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb329-23"><a href="gather-data.html#cb329-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_squish</span>(state)) <span class="sc">%&gt;%</span> </span>
<span id="cb329-24"><a href="gather-data.html#cb329-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> states)</span>
<span id="cb329-25"><a href="gather-data.html#cb329-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb329-26"><a href="gather-data.html#cb329-26" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw_dhs_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   raw_data                              state   data                year_of_data
##   &lt;chr&gt;                                 &lt;chr&gt;   &lt;chr&gt;                      &lt;dbl&gt;
## 1 Alabama ............................… Alabama 63,299 14.4 65.0 2…         2000
## 2 Alaska .............................… Alaska  9,974 16.0 74.6 2,…         2000
## 3 Arizona ............................… Arizona 85,273 17.5 84.4 2…         2000
## 4 Arkansas ...........................… Arkans… 37,783 14.7 69.1 2…         2000
## 5 California .........................… Califo… 531,959 15.8 70.7 …         2000
## 6 Colorado ...........................… Colora… 65,438 15.8 73.1 2…         2000</code></pre>
<p>The next step is to separate the data and get the correct column from it. We’re going to separate based on spaces once it is cleaned up.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="gather-data.html#cb331-1" aria-hidden="true" tabindex="-1"></a>raw_dhs_data <span class="ot">&lt;-</span> </span>
<span id="cb331-2"><a href="gather-data.html#cb331-2" aria-hidden="true" tabindex="-1"></a>  raw_dhs_data <span class="sc">%&gt;%</span> </span>
<span id="cb331-3"><a href="gather-data.html#cb331-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">str_remove_all</span>(data, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">*&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb331-4"><a href="gather-data.html#cb331-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(data, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;col_1&quot;</span>, <span class="st">&quot;col_2&quot;</span>, <span class="st">&quot;col_3&quot;</span>, <span class="st">&quot;col_4&quot;</span>, <span class="st">&quot;col_5&quot;</span>, </span>
<span id="cb331-5"><a href="gather-data.html#cb331-5" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;col_6&quot;</span>, <span class="st">&quot;col_7&quot;</span>, <span class="st">&quot;col_8&quot;</span>, <span class="st">&quot;col_9&quot;</span>, <span class="st">&quot;col_10&quot;</span>), </span>
<span id="cb331-6"><a href="gather-data.html#cb331-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot; &quot;</span>,</span>
<span id="cb331-7"><a href="gather-data.html#cb331-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">remove =</span> <span class="cn">FALSE</span>)</span>
<span id="cb331-8"><a href="gather-data.html#cb331-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(raw_dhs_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 14
##   raw_data    state data   col_1 col_2 col_3 col_4 col_5 col_6 col_7 col_8 col_9
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 Alabama ..… Alab… 63,29… 63,2… 14.4  65.0  2,02… 62.9  37.9  97.3  &lt;NA&gt;  &lt;NA&gt; 
## 2 Alaska ...… Alas… 9,974… 9,974 16.0  74.6  2,43… 42.4  23.6  69.4  &lt;NA&gt;  &lt;NA&gt; 
## 3 Arizona ..… Ariz… 85,27… 85,2… 17.5  84.4  2,65… 69.1  41.1  111.3 &lt;NA&gt;  &lt;NA&gt; 
## 4 Arkansas .… Arka… 37,78… 37,7… 14.7  69.1  2,14… 68.5  36.7  114.1 &lt;NA&gt;  &lt;NA&gt; 
## 5 California… Cali… 531,9… 531,… 15.8  70.7  2,18… 48.5  28.6  75.6  &lt;NA&gt;  &lt;NA&gt; 
## 6 Colorado .… Colo… 65,43… 65,4… 15.8  73.1  2,35… 49.2  28.6  79.8  &lt;NA&gt;  &lt;NA&gt; 
## # … with 2 more variables: col_10 &lt;chr&gt;, year_of_data &lt;dbl&gt;</code></pre>
<p>We can now grab the correct column.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="gather-data.html#cb333-1" aria-hidden="true" tabindex="-1"></a>tfr_data <span class="ot">&lt;-</span> </span>
<span id="cb333-2"><a href="gather-data.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  raw_dhs_data <span class="sc">%&gt;%</span> </span>
<span id="cb333-3"><a href="gather-data.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TFR =</span> <span class="fu">if_else</span>(year_of_data <span class="sc">&lt;</span> <span class="dv">2008</span>, col_4, col_3)) <span class="sc">%&gt;%</span> </span>
<span id="cb333-4"><a href="gather-data.html#cb333-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, year_of_data, TFR) <span class="sc">%&gt;%</span> </span>
<span id="cb333-5"><a href="gather-data.html#cb333-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">year =</span> year_of_data)</span>
<span id="cb333-6"><a href="gather-data.html#cb333-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tfr_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   state       year TFR    
##   &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;  
## 1 Alabama     2000 2,021.0
## 2 Alaska      2000 2,437.0
## 3 Arizona     2000 2,652.5
## 4 Arkansas    2000 2,140.0
## 5 California  2000 2,186.0
## 6 Colorado    2000 2,356.5</code></pre>
<p>Finally, we need to convert the case.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="gather-data.html#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tfr_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   state       year TFR    
##   &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;  
## 1 Alabama     2000 2,021.0
## 2 Alaska      2000 2,437.0
## 3 Arizona     2000 2,652.5
## 4 Arkansas    2000 2,140.0
## 5 California  2000 2,186.0
## 6 Colorado    2000 2,356.5</code></pre>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="gather-data.html#cb337-1" aria-hidden="true" tabindex="-1"></a>tfr_data <span class="ot">&lt;-</span> </span>
<span id="cb337-2"><a href="gather-data.html#cb337-2" aria-hidden="true" tabindex="-1"></a>  tfr_data <span class="sc">%&gt;%</span> </span>
<span id="cb337-3"><a href="gather-data.html#cb337-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TFR =</span> <span class="fu">str_remove_all</span>(TFR, <span class="st">&quot;,&quot;</span>),</span>
<span id="cb337-4"><a href="gather-data.html#cb337-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">TFR =</span> <span class="fu">as.numeric</span>(TFR))</span>
<span id="cb337-5"><a href="gather-data.html#cb337-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-6"><a href="gather-data.html#cb337-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tfr_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   state       year   TFR
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
## 1 Alabama     2000 2021 
## 2 Alaska      2000 2437 
## 3 Arizona     2000 2652.
## 4 Arkansas    2000 2140 
## 5 California  2000 2186 
## 6 Colorado    2000 2356.</code></pre>
<p>And run some checks.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="gather-data.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tfr_data %&gt;% </span></span>
<span id="cb339-2"><a href="gather-data.html#cb339-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   skimr::skim()</span></span></code></pre></div>
<p>In particular we want for there to be 51 states and for there to be 19 years.</p>
<p>And we’re done.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="gather-data.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tfr_data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   state       year   TFR
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
## 1 Alabama     2000 2021 
## 2 Alaska      2000 2437 
## 3 Arizona     2000 2652.
## 4 Arkansas    2000 2140 
## 5 California  2000 2186 
## 6 Colorado    2000 2356.</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="gather-data.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(tfr_data, <span class="st">&quot;outputs/monicas_tfr.csv&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="case-study-kenyan-census-data" class="section level2" number="7.10">
<h2><span class="header-section-number">7.10</span> Case-study: Kenyan census data</h2>
<p>The distribution of population by age, sex, and administrative unit from the 2019 Kenyan census can be downloaded here: <a href="https://www.knbs.or.ke/?wpdmpro=2019-kenya-population-and-housing-census-volume-iii-distribution-of-population-by-age-sex-and-administrative-units" class="uri">https://www.knbs.or.ke/?wpdmpro=2019-kenya-population-and-housing-census-volume-iii-distribution-of-population-by-age-sex-and-administrative-units</a>.</p>
<p>And while it is great that they make it easily available, and it is easy to look-up a particular result, it is not overly useful to do larger-scale data analysis, such as building a Bayesian hierarchical model.</p>
<p>In this section we will convert a PDF of Kenyan census results of counts, by age and sex, by county and sub-county, into a tidy dataset that can be analysed. I will draw on and introduce a bunch of handy packages including: <code>janitor</code> by <span class="citation"><a href="references-1.html#ref-janitor" role="doc-biblioref">Firke</a> (<a href="references-1.html#ref-janitor" role="doc-biblioref">2020</a>)</span>, <code>pdftools</code> by <span class="citation"><a href="references-1.html#ref-pdftools" role="doc-biblioref">Ooms</a> (<a href="references-1.html#ref-pdftools" role="doc-biblioref">2019b</a>)</span>, <code>tidyverse</code> by <span class="citation"><a href="references-1.html#ref-tidyverse" role="doc-biblioref">Wickham et al.</a> (<a href="references-1.html#ref-tidyverse" role="doc-biblioref">2019a</a>)</span>, and <code>stringi</code> by <span class="citation"><a href="references-1.html#ref-stringi" role="doc-biblioref">Gagolewski</a> (<a href="references-1.html#ref-stringi" role="doc-biblioref">2020</a>)</span>.</p>
<div id="set-up" class="section level3" number="7.10.1">
<h3><span class="header-section-number">7.10.1</span> Set-up</h3>
<p>To get started I need to load the necessary packages.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="gather-data.html#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb343-2"><a href="gather-data.html#cb343-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdftools)</span>
<span id="cb343-3"><a href="gather-data.html#cb343-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb343-4"><a href="gather-data.html#cb343-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringi)</span></code></pre></div>
<p>And then I need to read in the PDF that I want to convert.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="gather-data.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the PDF</span></span>
<span id="cb344-2"><a href="gather-data.html#cb344-2" aria-hidden="true" tabindex="-1"></a>all_content <span class="ot">&lt;-</span> pdftools<span class="sc">::</span><span class="fu">pdf_text</span>(<span class="st">&quot;inputs/pdfs/2019_Kenya_census.pdf&quot;</span>)</span></code></pre></div>
<p>The <code>pdf_text</code> function from <code>pdftools</code> is useful when you have a PDF and you want to read the content into R. For many recently produced PDFs it’ll work pretty well, but there are alternatives. If the PDF is an image, then it won’t work and you’ll need to turn to OCR.</p>
<p>You can see a page of the PDF here:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="gather-data.html#cb345-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&quot;figures/2020-04-10-screenshot-of-census.png&quot;</span>) </span></code></pre></div>
<p><img src="figures/2020-04-10-screenshot-of-census.png" width="85%" /></p>
</div>
<div id="extract" class="section level3" number="7.10.2">
<h3><span class="header-section-number">7.10.2</span> Extract</h3>
<p>The first challenge is to get the dataset into a format that we can more easily manipulate. The way that I am going to do this is to consider each page of the PDF and extract the relevant parts. To do this, I first write a function that I want to apply to each page.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="gather-data.html#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The function is going to take an input of a page</span></span>
<span id="cb346-2"><a href="gather-data.html#cb346-2" aria-hidden="true" tabindex="-1"></a>get_data <span class="ot">&lt;-</span> <span class="cf">function</span>(i){</span>
<span id="cb346-3"><a href="gather-data.html#cb346-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Just look at the page of interest</span></span>
<span id="cb346-4"><a href="gather-data.html#cb346-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Based on https://stackoverflow.com/questions/47793326/tabulize-function-in-r</span></span>
<span id="cb346-5"><a href="gather-data.html#cb346-5" aria-hidden="true" tabindex="-1"></a>  just_page_i <span class="ot">&lt;-</span> stringi<span class="sc">::</span><span class="fu">stri_split_lines</span>(all_content[[i]])[[<span class="dv">1</span>]] </span>
<span id="cb346-6"><a href="gather-data.html#cb346-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-7"><a href="gather-data.html#cb346-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Grab the name of the location</span></span>
<span id="cb346-8"><a href="gather-data.html#cb346-8" aria-hidden="true" tabindex="-1"></a>  area <span class="ot">&lt;-</span> just_page_i[<span class="dv">3</span>] <span class="sc">%&gt;%</span> <span class="fu">str_squish</span>()</span>
<span id="cb346-9"><a href="gather-data.html#cb346-9" aria-hidden="true" tabindex="-1"></a>  area <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(area)</span>
<span id="cb346-10"><a href="gather-data.html#cb346-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-11"><a href="gather-data.html#cb346-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Grab the type of table</span></span>
<span id="cb346-12"><a href="gather-data.html#cb346-12" aria-hidden="true" tabindex="-1"></a>  type_of_table <span class="ot">&lt;-</span> just_page_i[<span class="dv">2</span>] <span class="sc">%&gt;%</span> <span class="fu">str_squish</span>()</span>
<span id="cb346-13"><a href="gather-data.html#cb346-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-14"><a href="gather-data.html#cb346-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get rid of the top matter</span></span>
<span id="cb346-15"><a href="gather-data.html#cb346-15" aria-hidden="true" tabindex="-1"></a>  just_page_i_no_header <span class="ot">&lt;-</span> just_page_i[<span class="dv">5</span><span class="sc">:</span><span class="fu">length</span>(just_page_i)] <span class="co"># Just manually for now, but could create some rules if needed</span></span>
<span id="cb346-16"><a href="gather-data.html#cb346-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-17"><a href="gather-data.html#cb346-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get rid of the bottom matter</span></span>
<span id="cb346-18"><a href="gather-data.html#cb346-18" aria-hidden="true" tabindex="-1"></a>  just_page_i_no_header_no_footer <span class="ot">&lt;-</span> just_page_i_no_header[<span class="dv">1</span><span class="sc">:</span><span class="dv">62</span>] <span class="co"># Just manually for now, but could create some rules if needed</span></span>
<span id="cb346-19"><a href="gather-data.html#cb346-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-20"><a href="gather-data.html#cb346-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert into a tibble</span></span>
<span id="cb346-21"><a href="gather-data.html#cb346-21" aria-hidden="true" tabindex="-1"></a>  demography_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">all =</span> just_page_i_no_header_no_footer)</span>
<span id="cb346-22"><a href="gather-data.html#cb346-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-23"><a href="gather-data.html#cb346-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Split columns</span></span>
<span id="cb346-24"><a href="gather-data.html#cb346-24" aria-hidden="true" tabindex="-1"></a>  demography_data <span class="ot">&lt;-</span></span>
<span id="cb346-25"><a href="gather-data.html#cb346-25" aria-hidden="true" tabindex="-1"></a>    demography_data <span class="sc">%&gt;%</span></span>
<span id="cb346-26"><a href="gather-data.html#cb346-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">all =</span> <span class="fu">str_squish</span>(all)) <span class="sc">%&gt;%</span> <span class="co"># Any space more than two spaces is squished down to one</span></span>
<span id="cb346-27"><a href="gather-data.html#cb346-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">all =</span> <span class="fu">str_replace</span>(all, <span class="st">&quot;10 -14&quot;</span>, <span class="st">&quot;10-14&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb346-28"><a href="gather-data.html#cb346-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">all =</span> <span class="fu">str_replace</span>(all, <span class="st">&quot;Not Stated&quot;</span>, <span class="st">&quot;NotStated&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># Any space more than two spaces is squished down to one</span></span>
<span id="cb346-29"><a href="gather-data.html#cb346-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(<span class="at">col =</span> all,</span>
<span id="cb346-30"><a href="gather-data.html#cb346-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="st">&quot;total&quot;</span>, <span class="st">&quot;age_2&quot;</span>, <span class="st">&quot;male_2&quot;</span>, <span class="st">&quot;female_2&quot;</span>, <span class="st">&quot;total_2&quot;</span>),</span>
<span id="cb346-31"><a href="gather-data.html#cb346-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">sep =</span> <span class="st">&quot; &quot;</span>, <span class="co"># Just looking for a space. Seems to work fine because the tables are pretty nicely laid out</span></span>
<span id="cb346-32"><a href="gather-data.html#cb346-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">remove =</span> <span class="cn">TRUE</span>,</span>
<span id="cb346-33"><a href="gather-data.html#cb346-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">&quot;right&quot;</span></span>
<span id="cb346-34"><a href="gather-data.html#cb346-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb346-35"><a href="gather-data.html#cb346-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-36"><a href="gather-data.html#cb346-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># They are side by side at the moment, need to append to bottom</span></span>
<span id="cb346-37"><a href="gather-data.html#cb346-37" aria-hidden="true" tabindex="-1"></a>  demography_data_long <span class="ot">&lt;-</span></span>
<span id="cb346-38"><a href="gather-data.html#cb346-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(demography_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(age, male, female, total),</span>
<span id="cb346-39"><a href="gather-data.html#cb346-39" aria-hidden="true" tabindex="-1"></a>          demography_data <span class="sc">%&gt;%</span></span>
<span id="cb346-40"><a href="gather-data.html#cb346-40" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(age_2, male_2, female_2, total_2) <span class="sc">%&gt;%</span></span>
<span id="cb346-41"><a href="gather-data.html#cb346-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">age =</span> age_2, <span class="at">male =</span> male_2, <span class="at">female =</span> female_2, <span class="at">total =</span> total_2)</span>
<span id="cb346-42"><a href="gather-data.html#cb346-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb346-43"><a href="gather-data.html#cb346-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-44"><a href="gather-data.html#cb346-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># There is one row of NAs, so remove it</span></span>
<span id="cb346-45"><a href="gather-data.html#cb346-45" aria-hidden="true" tabindex="-1"></a>  demography_data_long <span class="ot">&lt;-</span> </span>
<span id="cb346-46"><a href="gather-data.html#cb346-46" aria-hidden="true" tabindex="-1"></a>    demography_data_long <span class="sc">%&gt;%</span> </span>
<span id="cb346-47"><a href="gather-data.html#cb346-47" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">remove_empty</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="st">&quot;rows&quot;</span>))</span>
<span id="cb346-48"><a href="gather-data.html#cb346-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-49"><a href="gather-data.html#cb346-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the area and the page</span></span>
<span id="cb346-50"><a href="gather-data.html#cb346-50" aria-hidden="true" tabindex="-1"></a>  demography_data_long<span class="sc">$</span>area <span class="ot">&lt;-</span> area</span>
<span id="cb346-51"><a href="gather-data.html#cb346-51" aria-hidden="true" tabindex="-1"></a>  demography_data_long<span class="sc">$</span>table <span class="ot">&lt;-</span> type_of_table</span>
<span id="cb346-52"><a href="gather-data.html#cb346-52" aria-hidden="true" tabindex="-1"></a>  demography_data_long<span class="sc">$</span>page <span class="ot">&lt;-</span> i</span>
<span id="cb346-53"><a href="gather-data.html#cb346-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-54"><a href="gather-data.html#cb346-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(just_page_i,</span>
<span id="cb346-55"><a href="gather-data.html#cb346-55" aria-hidden="true" tabindex="-1"></a>     i,</span>
<span id="cb346-56"><a href="gather-data.html#cb346-56" aria-hidden="true" tabindex="-1"></a>     area,</span>
<span id="cb346-57"><a href="gather-data.html#cb346-57" aria-hidden="true" tabindex="-1"></a>     type_of_table,</span>
<span id="cb346-58"><a href="gather-data.html#cb346-58" aria-hidden="true" tabindex="-1"></a>     just_page_i_no_header,</span>
<span id="cb346-59"><a href="gather-data.html#cb346-59" aria-hidden="true" tabindex="-1"></a>     just_page_i_no_header_no_footer,</span>
<span id="cb346-60"><a href="gather-data.html#cb346-60" aria-hidden="true" tabindex="-1"></a>     demography_data)</span>
<span id="cb346-61"><a href="gather-data.html#cb346-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb346-62"><a href="gather-data.html#cb346-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(demography_data_long)</span>
<span id="cb346-63"><a href="gather-data.html#cb346-63" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>At this point, I have a function that does what I need to each page of the PDF. I’m going to use the function <code>map_dfr</code> from the <code>purrr</code> package to apply that function to each page, and then combine all the outputs into one tibble.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="gather-data.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run through each relevant page and get the data</span></span>
<span id="cb347-2"><a href="gather-data.html#cb347-2" aria-hidden="true" tabindex="-1"></a>pages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">513</span>)</span>
<span id="cb347-3"><a href="gather-data.html#cb347-3" aria-hidden="true" tabindex="-1"></a>all_tables <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(pages, get_data)</span>
<span id="cb347-4"><a href="gather-data.html#cb347-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(pages, get_data, all_content)</span></code></pre></div>
</div>
<div id="clean-2" class="section level3" number="7.10.3">
<h3><span class="header-section-number">7.10.3</span> Clean</h3>
<p>I now need to clean the dataset to make it useful.</p>
<div id="values" class="section level4" number="7.10.3.1">
<h4><span class="header-section-number">7.10.3.1</span> Values</h4>
<p>The first step is to make the numbers into actual numbers, rather than characters. Before I can convert the type I need to remove anything that is not a number otherwise it’ll be converted into an NA. I first identify any values that are not numbers so that I can remove them.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="gather-data.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to convert male, female, and total to integers</span></span>
<span id="cb348-2"><a href="gather-data.html#cb348-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First find the characters that should not be in there</span></span>
<span id="cb348-3"><a href="gather-data.html#cb348-3" aria-hidden="true" tabindex="-1"></a>all_tables <span class="sc">%&gt;%</span> </span>
<span id="cb348-4"><a href="gather-data.html#cb348-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(male, female, total) <span class="sc">%&gt;%</span></span>
<span id="cb348-5"><a href="gather-data.html#cb348-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">&quot;[:digit:]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb348-6"><a href="gather-data.html#cb348-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">&quot;,&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb348-7"><a href="gather-data.html#cb348-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb348-8"><a href="gather-data.html#cb348-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">&quot;-&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb348-9"><a href="gather-data.html#cb348-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   male  female total
##   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;
## 1 &quot;&quot;    &quot;&quot;     &quot;&quot;   
## 2 &quot;Aug&quot; &quot;&quot;     &quot;&quot;   
## 3 &quot;Jun&quot; &quot;&quot;     &quot;&quot;</code></pre>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="gather-data.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We clearly need to remove &quot;,&quot;, &quot;_&quot;, and &quot;-&quot;. </span></span>
<span id="cb350-2"><a href="gather-data.html#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This also highlights a few issues on p. 185 that need to be manually adjusted</span></span>
<span id="cb350-3"><a href="gather-data.html#cb350-3" aria-hidden="true" tabindex="-1"></a><span class="co"># https://twitter.com/RohanAlexander/status/1244337583016022018</span></span>
<span id="cb350-4"><a href="gather-data.html#cb350-4" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>male[all_tables<span class="sc">$</span>male <span class="sc">==</span> <span class="st">&quot;23-Jun&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">4923</span></span>
<span id="cb350-5"><a href="gather-data.html#cb350-5" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>male[all_tables<span class="sc">$</span>male <span class="sc">==</span> <span class="st">&quot;15-Aug&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">4611</span></span></code></pre></div>
<p>While you could use the <code>janitor</code> package here, it is worthwhile at least first looking at what is going on because sometimes there is odd stuff that janitor (and other packages) will deal with, but not in a way that you want. In this case, they’ve used Excel or similar and this has converted a couple of their entries into dates. If we just took the numbers from the column then we’d have 23 and 15 here, but by inspecting the column we can use Excel to reverse the process and enter the correct values of 4,923 and 4,611, respectively.</p>
<p>Having identified everything that needs to be removed, we can do the actual removal and convert our character column of numbers to integers.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="gather-data.html#cb351-1" aria-hidden="true" tabindex="-1"></a>all_tables <span class="ot">&lt;-</span></span>
<span id="cb351-2"><a href="gather-data.html#cb351-2" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">%&gt;%</span></span>
<span id="cb351-3"><a href="gather-data.html#cb351-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(male, female, total), <span class="sc">~</span><span class="fu">str_remove_all</span>(., <span class="st">&quot;,&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># First get rid of commas</span></span>
<span id="cb351-4"><a href="gather-data.html#cb351-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(male, female, total), <span class="sc">~</span><span class="fu">str_replace</span>(., <span class="st">&quot;_&quot;</span>, <span class="st">&quot;0&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb351-5"><a href="gather-data.html#cb351-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(male, female, total), <span class="sc">~</span><span class="fu">str_replace</span>(., <span class="st">&quot;-&quot;</span>, <span class="st">&quot;0&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb351-6"><a href="gather-data.html#cb351-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(male, female, total), <span class="sc">~</span><span class="fu">as.integer</span>(.))</span></code></pre></div>
</div>
<div id="areas" class="section level4" number="7.10.3.2">
<h4><span class="header-section-number">7.10.3.2</span> Areas</h4>
<p>The next thing to clean is the areas. We know that there are 47 counties in Kenya, and a whole bunch of sub-counties. They give us a list on pages 19 to 22 of the PDF (document pages 7 to 10). However, this list is not complete, and there are a few minor issues that we’ll deal with later.</p>
<p>In any case, I first need to fix a few inconsistencies.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="gather-data.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix some area names</span></span>
<span id="cb352-2"><a href="gather-data.html#cb352-2" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>area[all_tables<span class="sc">$</span>area <span class="sc">==</span> <span class="st">&quot;Taita/ Taveta&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Taita/Taveta&quot;</span></span>
<span id="cb352-3"><a href="gather-data.html#cb352-3" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>area[all_tables<span class="sc">$</span>area <span class="sc">==</span> <span class="st">&quot;Elgeyo/ Marakwet&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Elgeyo/Marakwet&quot;</span></span>
<span id="cb352-4"><a href="gather-data.html#cb352-4" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>area[all_tables<span class="sc">$</span>area <span class="sc">==</span> <span class="st">&quot;Nairobi City&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Nairobi&quot;</span></span></code></pre></div>
<p>Kenya has 47 counties, each of which has sub-counties. The PDF has them arranged as the county data then the sub-counties, without designating which is which. We can use the names, to a certain extent, but in a handful of cases, there is a sub-county that has the same name as a county so we need to first fix that.</p>
<p>The PDF is made-up of three tables.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="gather-data.html#cb353-1" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>table <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## .
## Table 2.3: Distribution of Population by Age, Sex*, County and Sub- County 
##                                                                      48216 
##       Table 2.4a: Distribution of Rural Population by Age, Sex* and County 
##                                                                       5535 
##       Table 2.4b: Distribution of Urban Population by Age, Sex* and County 
##                                                                       5781</code></pre>
<p>So I can first get the names of the counties based on those first two tables and then reconcile them to get a list of the counties.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="gather-data.html#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a list of the counties </span></span>
<span id="cb355-2"><a href="gather-data.html#cb355-2" aria-hidden="true" tabindex="-1"></a>list_counties <span class="ot">&lt;-</span> </span>
<span id="cb355-3"><a href="gather-data.html#cb355-3" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">%&gt;%</span> </span>
<span id="cb355-4"><a href="gather-data.html#cb355-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Table 2.4a: Distribution of Rural Population by Age, Sex* and County&quot;</span>,</span>
<span id="cb355-5"><a href="gather-data.html#cb355-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Table 2.4b: Distribution of Urban Population by Age, Sex* and County&quot;</span>)</span>
<span id="cb355-6"><a href="gather-data.html#cb355-6" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb355-7"><a href="gather-data.html#cb355-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(area) <span class="sc">%&gt;%</span> </span>
<span id="cb355-8"><a href="gather-data.html#cb355-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
<p>As I hoped, there are 47 of them. But before I can add a flag based on those names, I need to deal with the sub-counties that share their name. We will do this based on the page, then looking it up and deciding which is the county page and which is the sub-county page.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="gather-data.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The following have the issue of the name being used for both a county and a sub-county:</span></span>
<span id="cb356-2"><a href="gather-data.html#cb356-2" aria-hidden="true" tabindex="-1"></a>all_tables <span class="sc">%&gt;%</span> </span>
<span id="cb356-3"><a href="gather-data.html#cb356-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">==</span> <span class="st">&quot;Table 2.3: Distribution of Population by Age, Sex*, County and Sub- County&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb356-4"><a href="gather-data.html#cb356-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Busia&quot;</span>,</span>
<span id="cb356-5"><a href="gather-data.html#cb356-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Garissa&quot;</span>,</span>
<span id="cb356-6"><a href="gather-data.html#cb356-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Homa Bay&quot;</span>,</span>
<span id="cb356-7"><a href="gather-data.html#cb356-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Isiolo&quot;</span>,</span>
<span id="cb356-8"><a href="gather-data.html#cb356-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Kiambu&quot;</span>,</span>
<span id="cb356-9"><a href="gather-data.html#cb356-9" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Machakos&quot;</span>,</span>
<span id="cb356-10"><a href="gather-data.html#cb356-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Makueni&quot;</span>,</span>
<span id="cb356-11"><a href="gather-data.html#cb356-11" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Samburu&quot;</span>,</span>
<span id="cb356-12"><a href="gather-data.html#cb356-12" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Siaya&quot;</span>,</span>
<span id="cb356-13"><a href="gather-data.html#cb356-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Tana River&quot;</span>,</span>
<span id="cb356-14"><a href="gather-data.html#cb356-14" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Vihiga&quot;</span>,</span>
<span id="cb356-15"><a href="gather-data.html#cb356-15" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;West Pokot&quot;</span>)</span>
<span id="cb356-16"><a href="gather-data.html#cb356-16" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb356-17"><a href="gather-data.html#cb356-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(area, page) <span class="sc">%&gt;%</span> </span>
<span id="cb356-18"><a href="gather-data.html#cb356-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
<pre><code>## # A tibble: 24 x 2
##    area        page
##    &lt;chr&gt;      &lt;int&gt;
##  1 Samburu       42
##  2 Tana River    53
##  3 Tana River    56
##  4 Garissa       65
##  5 Garissa       69
##  6 Isiolo        98
##  7 Isiolo       100
##  8 Machakos     149
##  9 Machakos     154
## 10 Makueni      159
## # … with 14 more rows</code></pre>
<p>Now we can add the flag for whether the area is a county and adjust for the ones that are troublesome,</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="gather-data.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add flag for whether it is a county or a sub-county</span></span>
<span id="cb358-2"><a href="gather-data.html#cb358-2" aria-hidden="true" tabindex="-1"></a>all_tables <span class="ot">&lt;-</span> </span>
<span id="cb358-3"><a href="gather-data.html#cb358-3" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">%&gt;%</span> </span>
<span id="cb358-4"><a href="gather-data.html#cb358-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_type =</span> <span class="fu">if_else</span>(area <span class="sc">%in%</span> list_counties<span class="sc">$</span>area, <span class="st">&quot;county&quot;</span>, <span class="st">&quot;sub-county&quot;</span>))</span>
<span id="cb358-5"><a href="gather-data.html#cb358-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix the flag for the ones that have their names used twice</span></span>
<span id="cb358-6"><a href="gather-data.html#cb358-6" aria-hidden="true" tabindex="-1"></a>all_tables <span class="ot">&lt;-</span> </span>
<span id="cb358-7"><a href="gather-data.html#cb358-7" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">%&gt;%</span> </span>
<span id="cb358-8"><a href="gather-data.html#cb358-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb358-9"><a href="gather-data.html#cb358-9" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Samburu&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">42</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-10"><a href="gather-data.html#cb358-10" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Tana River&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">56</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-11"><a href="gather-data.html#cb358-11" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Garissa&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">69</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-12"><a href="gather-data.html#cb358-12" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Isiolo&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">100</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-13"><a href="gather-data.html#cb358-13" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Machakos&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">154</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-14"><a href="gather-data.html#cb358-14" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Makueni&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">164</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-15"><a href="gather-data.html#cb358-15" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Kiambu&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">213</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-16"><a href="gather-data.html#cb358-16" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;West Pokot&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">233</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-17"><a href="gather-data.html#cb358-17" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Vihiga&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">333</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-18"><a href="gather-data.html#cb358-18" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Busia&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">353</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-19"><a href="gather-data.html#cb358-19" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Siaya&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">360</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-20"><a href="gather-data.html#cb358-20" aria-hidden="true" tabindex="-1"></a>    area <span class="sc">==</span> <span class="st">&quot;Homa Bay&quot;</span> <span class="sc">&amp;</span> page <span class="sc">==</span> <span class="dv">375</span> <span class="sc">~</span> <span class="st">&quot;sub-county&quot;</span>,</span>
<span id="cb358-21"><a href="gather-data.html#cb358-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> area_type</span>
<span id="cb358-22"><a href="gather-data.html#cb358-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb358-23"><a href="gather-data.html#cb358-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb358-24"><a href="gather-data.html#cb358-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-25"><a href="gather-data.html#cb358-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(list_counties)</span></code></pre></div>
</div>
<div id="ages" class="section level4" number="7.10.3.3">
<h4><span class="header-section-number">7.10.3.3</span> Ages</h4>
<p>Now we can deal with the ages.</p>
<p>First we need to fix some errors.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="gather-data.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up ages</span></span>
<span id="cb359-2"><a href="gather-data.html#cb359-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(all_tables<span class="sc">$</span>age) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## 
##     0   0-4     1    10 10-14 10-19 
##   484   484   484   484   482     1</code></pre>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="gather-data.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(all_tables<span class="sc">$</span>age) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Total&quot; &quot;0&quot;     &quot;1&quot;     &quot;2&quot;     &quot;3&quot;     &quot;4&quot;</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="gather-data.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looks like there should be 484, so need to follow up on some:</span></span>
<span id="cb363-2"><a href="gather-data.html#cb363-2" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">&quot;NotStated&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Not Stated&quot;</span></span>
<span id="cb363-3"><a href="gather-data.html#cb363-3" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">&quot;43594&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;5-9&quot;</span></span>
<span id="cb363-4"><a href="gather-data.html#cb363-4" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">&quot;43752&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;10-14&quot;</span></span>
<span id="cb363-5"><a href="gather-data.html#cb363-5" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">&quot;9-14&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;5-9&quot;</span></span>
<span id="cb363-6"><a href="gather-data.html#cb363-6" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">&quot;10-19&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;10-14&quot;</span></span></code></pre></div>
<p>The census has done some of the work of putting together age-groups for us, but we want to make it easy to just focus on the counts by single-year-age. As such I’ll add a flag as to the type of age it is: an age group, such as ages 0 to 5, or a single age, such as 1.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="gather-data.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a flag as to whether it&#39;s a summary or not</span></span>
<span id="cb364-2"><a href="gather-data.html#cb364-2" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age_type <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(all_tables<span class="sc">$</span>age, <span class="fu">c</span>(<span class="st">&quot;-&quot;</span>)), <span class="st">&quot;age-group&quot;</span>, <span class="st">&quot;single-year&quot;</span>)</span>
<span id="cb364-3"><a href="gather-data.html#cb364-3" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age_type <span class="ot">&lt;-</span> <span class="fu">if_else</span>(<span class="fu">str_detect</span>(all_tables<span class="sc">$</span>age, <span class="fu">c</span>(<span class="st">&quot;Total&quot;</span>)), <span class="st">&quot;age-group&quot;</span>, all_tables<span class="sc">$</span>age_type)</span></code></pre></div>
<p>At the moment, age is a character variable. We have a decision to make here, because we don’t want it to be a character variable (because it won’t graph properly), but we don’t want it to be a numeric, because there is <code>total</code> and also <code>100+</code> in there. For now, we’ll just make it into a factor, and at least that will be able to be nicely graphed.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="gather-data.html#cb365-1" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(all_tables<span class="sc">$</span>age)</span></code></pre></div>
</div>
</div>
<div id="check" class="section level3" number="7.10.4">
<h3><span class="header-section-number">7.10.4</span> Check</h3>
<div id="gender-sum" class="section level4" number="7.10.4.1">
<h4><span class="header-section-number">7.10.4.1</span> Gender sum</h4>
<p>Given the format of the data, at this point it is easy to check that <code>total</code> is the sum of <code>male</code> and <code>female</code>.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="gather-data.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the parts and the sums</span></span>
<span id="cb366-2"><a href="gather-data.html#cb366-2" aria-hidden="true" tabindex="-1"></a>follow_up <span class="ot">&lt;-</span> </span>
<span id="cb366-3"><a href="gather-data.html#cb366-3" aria-hidden="true" tabindex="-1"></a>  all_tables <span class="sc">%&gt;%</span> </span>
<span id="cb366-4"><a href="gather-data.html#cb366-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">check_sum =</span> male <span class="sc">+</span> female,</span>
<span id="cb366-5"><a href="gather-data.html#cb366-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">totals_match =</span> <span class="fu">if_else</span>(total <span class="sc">==</span> check_sum, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb366-6"><a href="gather-data.html#cb366-6" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb366-7"><a href="gather-data.html#cb366-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(totals_match <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<p>There is just one that seems wrong.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="gather-data.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There is just one that looks wrong</span></span>
<span id="cb367-2"><a href="gather-data.html#cb367-2" aria-hidden="true" tabindex="-1"></a>all_tables<span class="sc">$</span>male[all_tables<span class="sc">$</span>age <span class="sc">==</span> <span class="st">&quot;10&quot;</span> <span class="sc">&amp;</span> all_tables<span class="sc">$</span>page <span class="sc">==</span> <span class="dv">187</span>] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="dv">1</span>)</span>
<span id="cb367-3"><a href="gather-data.html#cb367-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-4"><a href="gather-data.html#cb367-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(follow_up)</span></code></pre></div>
</div>
<div id="rural-urban-split" class="section level4" number="7.10.4.2">
<h4><span class="header-section-number">7.10.4.2</span> Rural-urban split</h4>
<p>The census provides different tables for the total of each county and sub-county; and then within each county, for the number in an urban area in that county, and the number in a urban area in that county. Some counties only have an urban count, but we’d like to make sure that the sum of rural and urban counts equals the total count. This requires reshaping the data from a long to wide format.</p>
<p>First, construct different tables for each of the three. I just do it manually, but I could probably do this a nicer way.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="gather-data.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2.3</span></span>
<span id="cb368-2"><a href="gather-data.html#cb368-2" aria-hidden="true" tabindex="-1"></a>table_2_3 <span class="ot">&lt;-</span> all_tables <span class="sc">%&gt;%</span> </span>
<span id="cb368-3"><a href="gather-data.html#cb368-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">==</span> <span class="st">&quot;Table 2.3: Distribution of Population by Age, Sex*, County and Sub- County&quot;</span>)</span>
<span id="cb368-4"><a href="gather-data.html#cb368-4" aria-hidden="true" tabindex="-1"></a>table_2_4a <span class="ot">&lt;-</span> all_tables <span class="sc">%&gt;%</span> </span>
<span id="cb368-5"><a href="gather-data.html#cb368-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">==</span> <span class="st">&quot;Table 2.4a: Distribution of Rural Population by Age, Sex* and County&quot;</span>)</span>
<span id="cb368-6"><a href="gather-data.html#cb368-6" aria-hidden="true" tabindex="-1"></a>table_2_4b <span class="ot">&lt;-</span> all_tables <span class="sc">%&gt;%</span> </span>
<span id="cb368-7"><a href="gather-data.html#cb368-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(table <span class="sc">==</span> <span class="st">&quot;Table 2.4b: Distribution of Urban Population by Age, Sex* and County&quot;</span>)</span></code></pre></div>
<p>Having constructed the constituent parts, I now join then based on age, area, and whether it is a county.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="gather-data.html#cb369-1" aria-hidden="true" tabindex="-1"></a>both_2_4s <span class="ot">&lt;-</span> <span class="fu">full_join</span>(table_2_4a, table_2_4b, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;area&quot;</span>, <span class="st">&quot;area_type&quot;</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_rural&quot;</span>, <span class="st">&quot;_urban&quot;</span>))</span>
<span id="cb369-2"><a href="gather-data.html#cb369-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-3"><a href="gather-data.html#cb369-3" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">full_join</span>(table_2_3, both_2_4s, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;area&quot;</span>, <span class="st">&quot;area_type&quot;</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;_all&quot;</span>, <span class="st">&quot;_&quot;</span>))</span>
<span id="cb369-4"><a href="gather-data.html#cb369-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-5"><a href="gather-data.html#cb369-5" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> </span>
<span id="cb369-6"><a href="gather-data.html#cb369-6" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">%&gt;%</span> </span>
<span id="cb369-7"><a href="gather-data.html#cb369-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">page =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&#39;Total from p. {page}, rural from p. {page_rural}, urban from p. {page_urban}&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb369-8"><a href="gather-data.html#cb369-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>page, <span class="sc">-</span>page_rural, <span class="sc">-</span>page_urban,</span>
<span id="cb369-9"><a href="gather-data.html#cb369-9" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>table, <span class="sc">-</span>table_rural, <span class="sc">-</span>table_urban,</span>
<span id="cb369-10"><a href="gather-data.html#cb369-10" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>age_type_rural, <span class="sc">-</span>age_type_urban</span>
<span id="cb369-11"><a href="gather-data.html#cb369-11" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb369-12"><a href="gather-data.html#cb369-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-13"><a href="gather-data.html#cb369-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(both_2_4s, table_2_3, table_2_4a, table_2_4b)</span></code></pre></div>
<p>We can now check that the sum of rural and urban is the same as the total.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="gather-data.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that the urban + rural = total</span></span>
<span id="cb370-2"><a href="gather-data.html#cb370-2" aria-hidden="true" tabindex="-1"></a>follow_up <span class="ot">&lt;-</span> </span>
<span id="cb370-3"><a href="gather-data.html#cb370-3" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">%&gt;%</span> </span>
<span id="cb370-4"><a href="gather-data.html#cb370-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_from_bits =</span> total_rural <span class="sc">+</span> total_urban,</span>
<span id="cb370-5"><a href="gather-data.html#cb370-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">check_total_is_rural_plus_urban =</span> <span class="fu">if_else</span>(total <span class="sc">==</span> total_from_bits, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb370-6"><a href="gather-data.html#cb370-6" aria-hidden="true" tabindex="-1"></a>         total_from_bits <span class="sc">-</span> total) <span class="sc">%&gt;%</span> </span>
<span id="cb370-7"><a href="gather-data.html#cb370-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(check_total_is_rural_plus_urban <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb370-8"><a href="gather-data.html#cb370-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-9"><a href="gather-data.html#cb370-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(follow_up)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 16
##   age       male female  total area  area_type age_type  male_rural female_rural
##   &lt;fct&gt;    &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;          &lt;int&gt;        &lt;int&gt;
## 1 Not St…     31     10     41 Naku… county    single-y…          8            6
## 2 Total   434287 441379 875666 Bomet county    age-group     420119       427576
## 3 Not St…      3      2      5 Bomet county    single-y…          2            1
## # … with 7 more variables: total_rural &lt;int&gt;, male_urban &lt;int&gt;,
## #   female_urban &lt;int&gt;, total_urban &lt;int&gt;, total_from_bits &lt;int&gt;,
## #   check_total_is_rural_plus_urban &lt;dbl&gt;, total_from_bits - total &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="gather-data.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(follow_up)</span></code></pre></div>
<p>There are just a few, but they only have a a difference of 1, so I’ll just move on.</p>
</div>
<div id="ages-sum-to-age-groups" class="section level4" number="7.10.4.3">
<h4><span class="header-section-number">7.10.4.3</span> Ages sum to age-groups</h4>
<p>Finally, I want to check that the single age counts sum to the age-groups.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="gather-data.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One last thing to check is that the ages sum to their age-groups.</span></span>
<span id="cb373-2"><a href="gather-data.html#cb373-2" aria-hidden="true" tabindex="-1"></a>follow_up <span class="ot">&lt;-</span> </span>
<span id="cb373-3"><a href="gather-data.html#cb373-3" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">%&gt;%</span> </span>
<span id="cb373-4"><a href="gather-data.html#cb373-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">groups =</span> <span class="fu">case_when</span>(age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;0-4&quot;</span>) <span class="sc">~</span> <span class="st">&quot;0-4&quot;</span>,</span>
<span id="cb373-5"><a href="gather-data.html#cb373-5" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;7&quot;</span>, <span class="st">&quot;8&quot;</span>, <span class="st">&quot;9&quot;</span>, <span class="st">&quot;5-9&quot;</span>) <span class="sc">~</span> <span class="st">&quot;5-9&quot;</span>,</span>
<span id="cb373-6"><a href="gather-data.html#cb373-6" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;10&quot;</span>, <span class="st">&quot;11&quot;</span>, <span class="st">&quot;12&quot;</span>, <span class="st">&quot;13&quot;</span>, <span class="st">&quot;14&quot;</span>, <span class="st">&quot;10-14&quot;</span>) <span class="sc">~</span> <span class="st">&quot;10-14&quot;</span>,</span>
<span id="cb373-7"><a href="gather-data.html#cb373-7" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;15&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;17&quot;</span>, <span class="st">&quot;18&quot;</span>, <span class="st">&quot;19&quot;</span>, <span class="st">&quot;15-19&quot;</span>) <span class="sc">~</span> <span class="st">&quot;15-19&quot;</span>,</span>
<span id="cb373-8"><a href="gather-data.html#cb373-8" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;20&quot;</span>, <span class="st">&quot;21&quot;</span>, <span class="st">&quot;22&quot;</span>, <span class="st">&quot;23&quot;</span>, <span class="st">&quot;24&quot;</span>, <span class="st">&quot;20-24&quot;</span>) <span class="sc">~</span> <span class="st">&quot;20-24&quot;</span>,</span>
<span id="cb373-9"><a href="gather-data.html#cb373-9" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;25&quot;</span>, <span class="st">&quot;26&quot;</span>, <span class="st">&quot;27&quot;</span>, <span class="st">&quot;28&quot;</span>, <span class="st">&quot;29&quot;</span>, <span class="st">&quot;25-29&quot;</span>) <span class="sc">~</span> <span class="st">&quot;25-29&quot;</span>,</span>
<span id="cb373-10"><a href="gather-data.html#cb373-10" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;30&quot;</span>, <span class="st">&quot;31&quot;</span>, <span class="st">&quot;32&quot;</span>, <span class="st">&quot;33&quot;</span>, <span class="st">&quot;34&quot;</span>, <span class="st">&quot;30-34&quot;</span>) <span class="sc">~</span> <span class="st">&quot;30-34&quot;</span>,</span>
<span id="cb373-11"><a href="gather-data.html#cb373-11" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;35&quot;</span>, <span class="st">&quot;36&quot;</span>, <span class="st">&quot;37&quot;</span>, <span class="st">&quot;38&quot;</span>, <span class="st">&quot;39&quot;</span>, <span class="st">&quot;35-39&quot;</span>) <span class="sc">~</span> <span class="st">&quot;35-39&quot;</span>,</span>
<span id="cb373-12"><a href="gather-data.html#cb373-12" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;40&quot;</span>, <span class="st">&quot;41&quot;</span>, <span class="st">&quot;42&quot;</span>, <span class="st">&quot;43&quot;</span>, <span class="st">&quot;44&quot;</span>, <span class="st">&quot;40-44&quot;</span>) <span class="sc">~</span> <span class="st">&quot;40-44&quot;</span>,</span>
<span id="cb373-13"><a href="gather-data.html#cb373-13" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;45&quot;</span>, <span class="st">&quot;46&quot;</span>, <span class="st">&quot;47&quot;</span>, <span class="st">&quot;48&quot;</span>, <span class="st">&quot;49&quot;</span>, <span class="st">&quot;45-49&quot;</span>) <span class="sc">~</span> <span class="st">&quot;45-49&quot;</span>,</span>
<span id="cb373-14"><a href="gather-data.html#cb373-14" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;50&quot;</span>, <span class="st">&quot;51&quot;</span>, <span class="st">&quot;52&quot;</span>, <span class="st">&quot;53&quot;</span>, <span class="st">&quot;54&quot;</span>, <span class="st">&quot;50-54&quot;</span>) <span class="sc">~</span> <span class="st">&quot;50-54&quot;</span>,</span>
<span id="cb373-15"><a href="gather-data.html#cb373-15" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;55&quot;</span>, <span class="st">&quot;56&quot;</span>, <span class="st">&quot;57&quot;</span>, <span class="st">&quot;58&quot;</span>, <span class="st">&quot;59&quot;</span>, <span class="st">&quot;55-59&quot;</span>) <span class="sc">~</span> <span class="st">&quot;55-59&quot;</span>,</span>
<span id="cb373-16"><a href="gather-data.html#cb373-16" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;60&quot;</span>, <span class="st">&quot;61&quot;</span>, <span class="st">&quot;62&quot;</span>, <span class="st">&quot;63&quot;</span>, <span class="st">&quot;64&quot;</span>, <span class="st">&quot;60-64&quot;</span>) <span class="sc">~</span> <span class="st">&quot;60-64&quot;</span>,</span>
<span id="cb373-17"><a href="gather-data.html#cb373-17" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;65&quot;</span>, <span class="st">&quot;66&quot;</span>, <span class="st">&quot;67&quot;</span>, <span class="st">&quot;68&quot;</span>, <span class="st">&quot;69&quot;</span>, <span class="st">&quot;65-69&quot;</span>) <span class="sc">~</span> <span class="st">&quot;65-69&quot;</span>,</span>
<span id="cb373-18"><a href="gather-data.html#cb373-18" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;70&quot;</span>, <span class="st">&quot;71&quot;</span>, <span class="st">&quot;72&quot;</span>, <span class="st">&quot;73&quot;</span>, <span class="st">&quot;74&quot;</span>, <span class="st">&quot;70-74&quot;</span>) <span class="sc">~</span> <span class="st">&quot;70-74&quot;</span>,</span>
<span id="cb373-19"><a href="gather-data.html#cb373-19" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;75&quot;</span>, <span class="st">&quot;76&quot;</span>, <span class="st">&quot;77&quot;</span>, <span class="st">&quot;78&quot;</span>, <span class="st">&quot;79&quot;</span>, <span class="st">&quot;75-79&quot;</span>) <span class="sc">~</span> <span class="st">&quot;75-79&quot;</span>,</span>
<span id="cb373-20"><a href="gather-data.html#cb373-20" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;80&quot;</span>, <span class="st">&quot;81&quot;</span>, <span class="st">&quot;82&quot;</span>, <span class="st">&quot;83&quot;</span>, <span class="st">&quot;84&quot;</span>, <span class="st">&quot;80-84&quot;</span>) <span class="sc">~</span> <span class="st">&quot;80-84&quot;</span>,</span>
<span id="cb373-21"><a href="gather-data.html#cb373-21" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;85&quot;</span>, <span class="st">&quot;86&quot;</span>, <span class="st">&quot;87&quot;</span>, <span class="st">&quot;88&quot;</span>, <span class="st">&quot;89&quot;</span>, <span class="st">&quot;85-89&quot;</span>) <span class="sc">~</span> <span class="st">&quot;85-89&quot;</span>,</span>
<span id="cb373-22"><a href="gather-data.html#cb373-22" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;90&quot;</span>, <span class="st">&quot;91&quot;</span>, <span class="st">&quot;92&quot;</span>, <span class="st">&quot;93&quot;</span>, <span class="st">&quot;94&quot;</span>, <span class="st">&quot;90-94&quot;</span>) <span class="sc">~</span> <span class="st">&quot;90-94&quot;</span>,</span>
<span id="cb373-23"><a href="gather-data.html#cb373-23" aria-hidden="true" tabindex="-1"></a>                            age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;95&quot;</span>, <span class="st">&quot;96&quot;</span>, <span class="st">&quot;97&quot;</span>, <span class="st">&quot;98&quot;</span>, <span class="st">&quot;99&quot;</span>, <span class="st">&quot;95-99&quot;</span>) <span class="sc">~</span> <span class="st">&quot;95-99&quot;</span>,</span>
<span id="cb373-24"><a href="gather-data.html#cb373-24" aria-hidden="true" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Other&quot;</span>)</span>
<span id="cb373-25"><a href="gather-data.html#cb373-25" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb373-26"><a href="gather-data.html#cb373-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(area_type, area, groups) <span class="sc">%&gt;%</span> </span>
<span id="cb373-27"><a href="gather-data.html#cb373-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_sum =</span> <span class="fu">sum</span>(total, <span class="at">na.rm =</span> <span class="cn">FALSE</span>),</span>
<span id="cb373-28"><a href="gather-data.html#cb373-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">group_sum =</span> group_sum <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb373-29"><a href="gather-data.html#cb373-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">difference =</span> total <span class="sc">-</span> group_sum) <span class="sc">%&gt;%</span> </span>
<span id="cb373-30"><a href="gather-data.html#cb373-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb373-31"><a href="gather-data.html#cb373-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">==</span> groups) <span class="sc">%&gt;%</span> </span>
<span id="cb373-32"><a href="gather-data.html#cb373-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total <span class="sc">!=</span> group_sum) </span>
<span id="cb373-33"><a href="gather-data.html#cb373-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-34"><a href="gather-data.html#cb373-34" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(follow_up)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 16
##   age    male female total area       area_type age_type male_rural female_rural
##   &lt;fct&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;         &lt;int&gt;        &lt;int&gt;
## 1 0-4       1      5     6 Mt. Kenya… sub-coun… age-gro…         NA           NA
## 2 5-9       1      2     3 Mt. Kenya… sub-coun… age-gro…         NA           NA
## 3 10-14     6      0     6 Mt. Kenya… sub-coun… age-gro…         NA           NA
## 4 15-19     9      1    10 Mt. Kenya… sub-coun… age-gro…         NA           NA
## 5 20-24    21      4    25 Mt. Kenya… sub-coun… age-gro…         NA           NA
## 6 25-29    59      9    68 Mt. Kenya… sub-coun… age-gro…         NA           NA
## # … with 7 more variables: total_rural &lt;int&gt;, male_urban &lt;int&gt;,
## #   female_urban &lt;int&gt;, total_urban &lt;int&gt;, groups &lt;chr&gt;, group_sum &lt;dbl&gt;,
## #   difference &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="gather-data.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(follow_up)</span></code></pre></div>
<p>Mt. Kenya Forest, Aberdare Forest, Kakamega Forest are all slightly dodgy. I can’t see it in the documentation, but it looks like they have apportioned these between various countries. It’s understandable why they’d do this and it’s probably not a big deal, so I’ll just move on.</p>
</div>
</div>
<div id="tidy-up" class="section level3" number="7.10.5">
<h3><span class="header-section-number">7.10.5</span> Tidy-up</h3>
<p>Now that we are confident that everything is looking good, we can just convert it to long-format so that it is easy to work with.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="gather-data.html#cb376-1" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> </span>
<span id="cb376-2"><a href="gather-data.html#cb376-2" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">%&gt;%</span> </span>
<span id="cb376-3"><a href="gather-data.html#cb376-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">male_total =</span> male,</span>
<span id="cb376-4"><a href="gather-data.html#cb376-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">female_total =</span> female,</span>
<span id="cb376-5"><a href="gather-data.html#cb376-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_total =</span> total) <span class="sc">%&gt;%</span> </span>
<span id="cb376-6"><a href="gather-data.html#cb376-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(male_total, female_total, total_total, male_rural, female_rural, total_rural, male_urban, female_urban, total_urban),</span>
<span id="cb376-7"><a href="gather-data.html#cb376-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;type&quot;</span>,</span>
<span id="cb376-8"><a href="gather-data.html#cb376-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;number&quot;</span></span>
<span id="cb376-9"><a href="gather-data.html#cb376-9" aria-hidden="true" tabindex="-1"></a>               ) <span class="sc">%&gt;%</span> </span>
<span id="cb376-10"><a href="gather-data.html#cb376-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> type, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;part_of_area&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb376-11"><a href="gather-data.html#cb376-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(area, area_type, part_of_area, age, age_type, gender, number)</span>
<span id="cb376-12"><a href="gather-data.html#cb376-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-13"><a href="gather-data.html#cb376-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(all, <span class="at">path =</span> <span class="st">&quot;outputs/data/cleaned_kenya_2019_census.csv&quot;</span>)</span>
<span id="cb376-14"><a href="gather-data.html#cb376-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-15"><a href="gather-data.html#cb376-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(all)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   area    area_type part_of_area age   age_type  gender  number
##   &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;        &lt;fct&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;int&gt;
## 1 Mombasa county    total        Total age-group male    610257
## 2 Mombasa county    total        Total age-group female  598046
## 3 Mombasa county    total        Total age-group total  1208303
## 4 Mombasa county    rural        Total age-group male        NA
## 5 Mombasa county    rural        Total age-group female      NA
## 6 Mombasa county    rural        Total age-group total       NA</code></pre>
</div>
<div id="make-monicas-dataset" class="section level3" number="7.10.6">
<h3><span class="header-section-number">7.10.6</span> Make Monica’s dataset</h3>
<p>The original purpose of all of this was to make a table for Monica. She needed single-year counts, by gender, for the counties.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="gather-data.html#cb378-1" aria-hidden="true" tabindex="-1"></a>monicas_dataset <span class="ot">&lt;-</span> </span>
<span id="cb378-2"><a href="gather-data.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  all <span class="sc">%&gt;%</span> </span>
<span id="cb378-3"><a href="gather-data.html#cb378-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area_type <span class="sc">==</span> <span class="st">&quot;county&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb378-4"><a href="gather-data.html#cb378-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(part_of_area <span class="sc">==</span> <span class="st">&quot;total&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb378-5"><a href="gather-data.html#cb378-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age_type <span class="sc">==</span> <span class="st">&quot;single-year&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb378-6"><a href="gather-data.html#cb378-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(area, age, gender, number)</span>
<span id="cb378-7"><a href="gather-data.html#cb378-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-8"><a href="gather-data.html#cb378-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(monicas_dataset)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   area    age   gender number
##   &lt;chr&gt;   &lt;fct&gt; &lt;chr&gt;   &lt;int&gt;
## 1 Mombasa 0     male    15111
## 2 Mombasa 0     female  15009
## 3 Mombasa 0     total   30120
## 4 Mombasa 1     male    15805
## 5 Mombasa 1     female  15308
## 6 Mombasa 1     total   31113</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="gather-data.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(monicas_dataset, <span class="st">&quot;outputs/data/monicas_dataset.csv&quot;</span>)</span></code></pre></div>
<p>I’ll leave the fancy stats to Monica, but I’ll just make a quick graph of Nairobi.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="gather-data.html#cb381-1" aria-hidden="true" tabindex="-1"></a>monicas_dataset <span class="sc">%&gt;%</span> </span>
<span id="cb381-2"><a href="gather-data.html#cb381-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(area <span class="sc">==</span> <span class="st">&quot;Nairobi&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb381-3"><a href="gather-data.html#cb381-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb381-4"><a href="gather-data.html#cb381-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> number, <span class="at">fill =</span> gender), <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span> </span>
<span id="cb381-5"><a href="gather-data.html#cb381-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb381-6"><a href="gather-data.html#cb381-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">99</span>, <span class="at">by =</span> <span class="dv">5</span>), <span class="st">&quot;100+&quot;</span>)) <span class="sc">+</span></span>
<span id="cb381-7"><a href="gather-data.html#cb381-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()<span class="sc">+</span></span>
<span id="cb381-8"><a href="gather-data.html#cb381-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="sc">+</span></span>
<span id="cb381-9"><a href="gather-data.html#cb381-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Number&quot;</span>,</span>
<span id="cb381-10"><a href="gather-data.html#cb381-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Age&quot;</span>,</span>
<span id="cb381-11"><a href="gather-data.html#cb381-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Gender&quot;</span>,</span>
<span id="cb381-12"><a href="gather-data.html#cb381-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Distribution of age and gender in Nairobi in 2019&quot;</span>,</span>
<span id="cb381-13"><a href="gather-data.html#cb381-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Data source: 2019 Kenya Census&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-221-1.png" width="672" /></p>
</div>
</div>
<div id="optical-character-recognition" class="section level2" number="7.11">
<h2><span class="header-section-number">7.11</span> Optical Character Recognition</h2>
<p>All of the above is predicated on having a PDF that is already ‘digitized.’ But what if it is images? In that case you need to first use Optical Character Recognition (OCR). The go-to package is Tesseract <span class="citation">(<a href="references-1.html#ref-citetesseract" role="doc-biblioref">Ooms 2019c</a>)</span>. This is a R wrapper around the Tesseract open-source OCR engine.</p>
<p>Let’s see an example with a scan from the first page of Jane Eyre (Figure <a href="gather-data.html#fig:janescan">7.13</a>).</p>
<div class="figure"><span id="fig:janescan"></span>
<img src="figures/jane_scan.png" alt="Scan of first page of Jane Eyre." width="90%" />
<p class="caption">
Figure 7.13: Scan of first page of Jane Eyre.
</p>
</div>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="gather-data.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&#39;tesseract&#39;)</span></span>
<span id="cb382-2"><a href="gather-data.html#cb382-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tesseract)</span>
<span id="cb382-3"><a href="gather-data.html#cb382-3" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> tesseract<span class="sc">::</span><span class="fu">ocr</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;figures/jane_scan.png&quot;</span>), <span class="at">engine =</span> <span class="fu">tesseract</span>(<span class="st">&quot;eng&quot;</span>))</span>
<span id="cb382-4"><a href="gather-data.html#cb382-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(text)</span></code></pre></div>
<pre><code>## 1 THERE was no possibility of taking a walk that day. We had
## been wandering, indeed, in the leafless shrubbery an hour in
## the morning; but since dinner (Mrs Reed, when there was no com-
## pany, dined early) the cold winter wind had brought with it clouds
## so sombre, and a rain so penetrating, that further out-door exercise
## 
## was now out of the question.
## 
## I was glad of it: I never liked long walks, especially on chilly
## afternoons: dreadful to me was the coming home in the raw twi-
## light, with nipped fingers and toes, and a heart saddened by the
## chidings of Bessie, the nurse, and humbled by the consciousness of
## my physical inferiority to Eliza, John, and Georgiana Reed.
## 
## The said Eliza, John, and Georgiana were now clustered round
## their mama in the drawing-room: she lay reclined on a sofa by the
## fireside, and with her darlings about her (for the time neither quar-
## relling nor crying) looked perfectly happy. Me, she had dispensed
## from joining the group; saying, ‘She regretted to be under the
## necessity of keeping me at a distance; but that until she heard from
## Bessie, and could discover by her own observation that I was
## endeavouring in good earnest to acquire a more sociable and
## child-like disposition, a more attractive and sprightly manner—
## something lighter, franker, more natural as it were—she really
## must exclude me from privileges intended only for contented,
## happy, littie children.’
## 
## ‘What does Bessie say I have done?’ I asked.
## 
## ‘Jane, I don’t like cavillers or questioners: besides, there is
## something truly forbidding in a child taking up her elders in that
## manner. Be seated somewhere; and until you can speak pleasantly,
## remain silent.’
## 
## . Bs aT sae] eae
## 
## i; AN TCM TAN | Beal | Sees
## a) } ; | i)
## i i 4 | | A ae | i | eee eek?
## 
## a an eames yi | bee
## 1 nea elem | | oe pee
## i i ae BC i i Hale
## oul | ec hi
## pan || i re a al! |
## 
## ase } Oty 2 RIES ORT Sata ariel
## SEEN BE — =——_
## 15</code></pre>
</div>
<div id="text" class="section level2" number="7.12">
<h2><span class="header-section-number">7.12</span> Text</h2>
<p><em>Aspects of this section have been previously published.</em></p>
<div id="introduction-11" class="section level3" number="7.12.1">
<h3><span class="header-section-number">7.12.1</span> Introduction</h3>
<p>Text data is all around us, and in many cases is some of the earliest types of data that we are exposed to. Recent increases in computational power, the development of new methods, and the enormous availability of text, means that there has been a great deal of interest in using text as data. Initial methods tend to focus, essentially, on converting text into numbers and then analysing them using traditional methods. More recent methods have begun to take advantage of the structure that is inherent in text, to draw additional meaning. The difference is perhaps akin to a child who can group similar colors, compared with a child who knows what objects are; although both crocodiles and trees are green, and you can do something with that knowledge, you can do more by knowing that a crocodile could eat you, and a tree probably won’t.</p>
<p>In this section we cover a variety of techniques designed to equip you with the basics of using text as data. One of the great things about text data is that it is typically not generated for the purposes of our analysis. That’s great because it removes one of the unobservable variables that we typically have to worry about. The trade-off is that we typically have to do a bunch more work to get it into a form that we can work with.</p>
</div>
<div id="getting-text-data" class="section level3" number="7.12.2">
<h3><span class="header-section-number">7.12.2</span> Getting text data</h3>
<p>Text as data is an exciting tool to apply. But many guides assume that you already have a nice dataset. Because we’ve focused on workflow in these notes, we know that’s not likely to be true! In this section we will scrape some text from a website. We’ve already seen examples of scraping, but in general those were focused on exploiting tables in the website. Here we’re going to instead focus on paragraphs of text, hence we’ll focus on different html/css tags.</p>
<p>We’re going to us the <code>rvest</code> package to make it easier to scrape data. We’re also going to use the <code>purrr</code> package to apply a function to a bunch of different URLs. For those of you with a little bit of programming, this is an alternative to using a for loop. For those of you with a bit of CS, this is a package that adds functional programming to R.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="gather-data.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb384-2"><a href="gather-data.html#cb384-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb384-3"><a href="gather-data.html#cb384-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-4"><a href="gather-data.html#cb384-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Some websites</span></span>
<span id="cb384-5"><a href="gather-data.html#cb384-5" aria-hidden="true" tabindex="-1"></a>address_to_visit <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;https://www.rba.gov.au/monetary-policy/rba-board-minutes/2020/2020-03-03.html&quot;</span>,</span>
<span id="cb384-6"><a href="gather-data.html#cb384-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;https://www.rba.gov.au/monetary-policy/rba-board-minutes/2020/2020-02-04.html&quot;</span>,</span>
<span id="cb384-7"><a href="gather-data.html#cb384-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;https://www.rba.gov.au/monetary-policy/rba-board-minutes/2019/2019-12-03.html&quot;</span>,</span>
<span id="cb384-8"><a href="gather-data.html#cb384-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;https://www.rba.gov.au/monetary-policy/rba-board-minutes/2019/2019-11-05.html&quot;</span>,</span>
<span id="cb384-9"><a href="gather-data.html#cb384-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;https://www.rba.gov.au/monetary-policy/rba-board-minutes/2019/2019-10-01.html&quot;</span>,</span>
<span id="cb384-10"><a href="gather-data.html#cb384-10" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;https://www.rba.gov.au/monetary-policy/rba-board-minutes/2019/2019-09-03.html&quot;</span></span>
<span id="cb384-11"><a href="gather-data.html#cb384-11" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb384-12"><a href="gather-data.html#cb384-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-13"><a href="gather-data.html#cb384-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Save names</span></span>
<span id="cb384-14"><a href="gather-data.html#cb384-14" aria-hidden="true" tabindex="-1"></a>save_name <span class="ot">&lt;-</span> address_to_visit <span class="sc">%&gt;%</span> </span>
<span id="cb384-15"><a href="gather-data.html#cb384-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove</span>(<span class="st">&quot;https://www.rba.gov.au/monetary-policy/rba-board-minutes/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb384-16"><a href="gather-data.html#cb384-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove</span>(<span class="st">&quot;.html&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb384-17"><a href="gather-data.html#cb384-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove</span>(<span class="st">&quot;20[:digit:]{2}/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb384-18"><a href="gather-data.html#cb384-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_c</span>(<span class="st">&quot;inputs/rba/&quot;</span>, ., <span class="st">&quot;.csv&quot;</span>)</span></code></pre></div>
<p>Create the function that will visit address_to_visit and save to save_name files.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="gather-data.html#cb385-1" aria-hidden="true" tabindex="-1"></a>visit_address_and_save_content <span class="ot">&lt;-</span></span>
<span id="cb385-2"><a href="gather-data.html#cb385-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(name_of_address_to_visit,</span>
<span id="cb385-3"><a href="gather-data.html#cb385-3" aria-hidden="true" tabindex="-1"></a>           name_of_file_to_save_as) {</span>
<span id="cb385-4"><a href="gather-data.html#cb385-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The function takes two inputs</span></span>
<span id="cb385-5"><a href="gather-data.html#cb385-5" aria-hidden="true" tabindex="-1"></a>    name_of_address_to_visit <span class="ot">&lt;-</span> address_to_visit[<span class="dv">1</span>]</span>
<span id="cb385-6"><a href="gather-data.html#cb385-6" aria-hidden="true" tabindex="-1"></a>    name_of_file_to_save_as <span class="ot">&lt;-</span> save_name[<span class="dv">1</span>]</span>
<span id="cb385-7"><a href="gather-data.html#cb385-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-8"><a href="gather-data.html#cb385-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_html</span>(name_of_address_to_visit) <span class="sc">%&gt;%</span> <span class="co"># Go to the website and read the html</span></span>
<span id="cb385-9"><a href="gather-data.html#cb385-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_node</span>(<span class="st">&quot;#content&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># Find the content part</span></span>
<span id="cb385-10"><a href="gather-data.html#cb385-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_text</span>() <span class="sc">%&gt;%</span> <span class="co"># Extract the text of the content part</span></span>
<span id="cb385-11"><a href="gather-data.html#cb385-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write_lines</span>(name_of_file_to_save_as) <span class="co"># Save as a text file</span></span>
<span id="cb385-12"><a href="gather-data.html#cb385-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Done with&quot;</span>, name_of_address_to_visit, <span class="st">&quot;at&quot;</span>, <span class="fu">Sys.time</span>()))  </span>
<span id="cb385-13"><a href="gather-data.html#cb385-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Helpful so that you know progress when running it on all the records</span></span>
<span id="cb385-14"><a href="gather-data.html#cb385-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="fu">sample</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">60</span>, <span class="dv">1</span>)) <span class="co"># Space out each request by somewhere between </span></span>
<span id="cb385-15"><a href="gather-data.html#cb385-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 30 and 60 seconds each so that we don&#39;t overwhelm their server</span></span>
<span id="cb385-16"><a href="gather-data.html#cb385-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb385-17"><a href="gather-data.html#cb385-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb385-18"><a href="gather-data.html#cb385-18" aria-hidden="true" tabindex="-1"></a><span class="co"># If there is an error then ignore it and move to the next one</span></span>
<span id="cb385-19"><a href="gather-data.html#cb385-19" aria-hidden="true" tabindex="-1"></a>visit_address_and_save_content <span class="ot">&lt;-</span></span>
<span id="cb385-20"><a href="gather-data.html#cb385-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">safely</span>(visit_address_and_save_content)</span></code></pre></div>
<p>We now apply that function to our list of URLs.</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="gather-data.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Walk through the addresses and apply the function to each</span></span>
<span id="cb386-2"><a href="gather-data.html#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(address_to_visit,</span>
<span id="cb386-3"><a href="gather-data.html#cb386-3" aria-hidden="true" tabindex="-1"></a>      save_name,</span>
<span id="cb386-4"><a href="gather-data.html#cb386-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">visit_address_and_save_content</span>(.x, .y))</span></code></pre></div>
<p>The result is a bunch of files with saved text data.</p>
<p>In this case we used scraping, but there are, of course, many ways. We may be able to use APIs, for instance, In the case of the Airbnb dataset that we examined earlier in the notes. If you are lucky then it may simply be that there is a column that contains text data in your dataset.</p>
</div>
<div id="preparing-text-datasets" class="section level3" number="7.12.3">
<h3><span class="header-section-number">7.12.3</span> Preparing text datasets</h3>
<p><em>This section draws on Sharla Gelfand’s blog post, linked in the required readings.</em></p>
<p>As much as I would like to stick with Australian economics and politics examples, I realise that this is probably only of limited interest to most of you. As such, in this section we will consider a dataset of Sephora reviews. Please read Sharla’s blog post (<a href="https://sharla.party/post/crying-sephora/" class="uri">https://sharla.party/post/crying-sephora/</a>) for another take on this dataset.</p>
<p>In this section we assume that there is some text data that you have gathered. At this point we need to change it into a form that we can work with. For some applications this will be counts of words. For others it may be some variant of this. The dataset that we are going to use is from Sephora, was scraped by <a href="https://twitter.com/crabbage_/">Connie</a> and I originally became aware of it because of <a href="https://sharla.party/post/crying-sephora/">Sharla</a>.</p>
<p>First let’s read in the data.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="gather-data.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This code is taken from https://sharla.party/post/crying-sephora/</span></span>
<span id="cb387-2"><a href="gather-data.html#cb387-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb387-3"><a href="gather-data.html#cb387-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb387-4"><a href="gather-data.html#cb387-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb387-5"><a href="gather-data.html#cb387-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-6"><a href="gather-data.html#cb387-6" aria-hidden="true" tabindex="-1"></a>crying <span class="ot">&lt;-</span> </span>
<span id="cb387-7"><a href="gather-data.html#cb387-7" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(<span class="st">&quot;https://raw.githubusercontent.com/everestpipkin/datagardens/master/students/khanniie/5_newDataSet/crying_dataset.json&quot;</span>,</span>
<span id="cb387-8"><a href="gather-data.html#cb387-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">simplifyDataFrame =</span> <span class="cn">TRUE</span></span>
<span id="cb387-9"><a href="gather-data.html#cb387-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb387-10"><a href="gather-data.html#cb387-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-11"><a href="gather-data.html#cb387-11" aria-hidden="true" tabindex="-1"></a>crying <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(crying[[<span class="st">&quot;reviews&quot;</span>]])</span>
<span id="cb387-12"><a href="gather-data.html#cb387-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-13"><a href="gather-data.html#cb387-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crying)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   date   product_info$bra… $name $type $url    review_body   review_title  stars
##   &lt;chr&gt;  &lt;chr&gt;             &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;
## 1 29 Ma… Too Faced         Bett… Masc… https:… &quot;Now I can c… AWESOME       5 st…
## 2 29 Se… Too Faced         Bett… Masc… https:… &quot;This holds … if you&#39;re sa… 5 st…
## 3 23 Ma… Too Faced         Bett… Masc… https:… &quot;I just boug… Hate it       1 st…
## 4 15 Au… Too Faced         Bett… Masc… https:… &quot;To start of… Nearly perfe… 5 st…
## 5 21 Se… Too Faced         Bett… Masc… https:… &quot;This mascar… Amazing!!     5 st…
## 6 30 Ma… Too Faced         Bett… Masc… https:… &quot;Let&#39;s talk … Tricky but w… 5 st…
## # … with 1 more variable: userid &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="gather-data.html#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(crying)</span></code></pre></div>
<pre><code>## [1] &quot;date&quot;         &quot;product_info&quot; &quot;review_body&quot;  &quot;review_title&quot; &quot;stars&quot;       
## [6] &quot;userid&quot;</code></pre>
<p>We’ll focus on the <code>review_body</code> variable and the number of stars <code>stars</code> that the reviewer gave. Most of them are 5 stars, so we’ll just focus on whether or not the review is five stars.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="gather-data.html#cb391-1" aria-hidden="true" tabindex="-1"></a>crying <span class="ot">&lt;-</span> </span>
<span id="cb391-2"><a href="gather-data.html#cb391-2" aria-hidden="true" tabindex="-1"></a>  crying <span class="sc">%&gt;%</span> </span>
<span id="cb391-3"><a href="gather-data.html#cb391-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(review_body, stars) <span class="sc">%&gt;%</span> </span>
<span id="cb391-4"><a href="gather-data.html#cb391-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stars =</span> <span class="fu">str_remove</span>(stars, <span class="st">&quot; stars?&quot;</span>),  <span class="co"># The question mark at the end means it&#39;l get rid of &#39;star&#39; and &#39;stars&#39;.</span></span>
<span id="cb391-5"><a href="gather-data.html#cb391-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">stars =</span> <span class="fu">as.integer</span>(stars)</span>
<span id="cb391-6"><a href="gather-data.html#cb391-6" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb391-7"><a href="gather-data.html#cb391-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">five_stars =</span> <span class="fu">if_else</span>(stars <span class="sc">==</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb391-8"><a href="gather-data.html#cb391-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb391-9"><a href="gather-data.html#cb391-9" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(crying<span class="sc">$</span>stars)</span></code></pre></div>
<pre><code>## 
##  1  2  3  4  5 
##  6  2  4 14 79</code></pre>
<p>In this example we are going to split everything into separate words. When we do this it is just searching for a space, and so what other types of elements are going to be considered ‘words?’</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="gather-data.html#cb393-1" aria-hidden="true" tabindex="-1"></a>crying_by_words <span class="ot">&lt;-</span> </span>
<span id="cb393-2"><a href="gather-data.html#cb393-2" aria-hidden="true" tabindex="-1"></a>  crying <span class="sc">%&gt;%</span></span>
<span id="cb393-3"><a href="gather-data.html#cb393-3" aria-hidden="true" tabindex="-1"></a>  tidytext<span class="sc">::</span><span class="fu">unnest_tokens</span>(word, review_body, <span class="at">token =</span> <span class="st">&quot;words&quot;</span>)</span>
<span id="cb393-4"><a href="gather-data.html#cb393-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-5"><a href="gather-data.html#cb393-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crying_by_words)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   stars five_stars word 
##   &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;
## 1     5          1 now  
## 2     5          1 i    
## 3     5          1 can  
## 4     5          1 cry  
## 5     5          1 all  
## 6     5          1 i</code></pre>
<p>We now want to count the number of times each word is used by each of the star classifications.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="gather-data.html#cb395-1" aria-hidden="true" tabindex="-1"></a>crying_by_words <span class="ot">&lt;-</span> </span>
<span id="cb395-2"><a href="gather-data.html#cb395-2" aria-hidden="true" tabindex="-1"></a>  crying_by_words <span class="sc">%&gt;%</span> </span>
<span id="cb395-3"><a href="gather-data.html#cb395-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stars, word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb395-4"><a href="gather-data.html#cb395-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-5"><a href="gather-data.html#cb395-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crying_by_words)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   stars word      n
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1     5 i       348
## 2     5 and     249
## 3     5 the     239
## 4     5 it      211
## 5     5 a       193
## 6     5 this    178</code></pre>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="gather-data.html#cb397-1" aria-hidden="true" tabindex="-1"></a>crying_by_words <span class="sc">%&gt;%</span> </span>
<span id="cb397-2"><a href="gather-data.html#cb397-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stars <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb397-3"><a href="gather-data.html#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   stars word      n
##   &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1     1 the      39
## 2     1 i        24
## 3     1 and      21
## 4     1 it       21
## 5     1 to       19
## 6     1 my       16</code></pre>
<p>So you can see that the most popular word for five star reviews is ‘i,’ and that the most popular word for one star reviews is ‘the.’</p>
<p>At this point, we can use the data to do a whole bunch of different things, but one nice measure to look at is term frequency e.g. in this case how many times is a word used in reviews with a particular star rating. The issue is that there are a lot of words that are commonly used regardless of context. As such, we may also like to look at the inverse document frequency in which we ‘penalise’ words that occur in many particular star ratings. For instance, ‘the’ probably occurs in both one star and five star reviews and so its idf is lower than ‘hate’ which probably only occurs in one star reviews. The term frequency–inverse document frequency (tf-idf) is then the product of these.</p>
<p>We can create this value using the <code>bind_tf_idf()</code> function from the <code>tidytext</code> package, and this will create a bunch of new columns, one for each word and star combination.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="gather-data.html#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This code, and the one in the next block, is from Julia Silge: https://juliasilge.com/blog/sherlock-holmes-stm/</span></span>
<span id="cb399-2"><a href="gather-data.html#cb399-2" aria-hidden="true" tabindex="-1"></a>crying_by_words_tf_idf <span class="ot">&lt;-</span> </span>
<span id="cb399-3"><a href="gather-data.html#cb399-3" aria-hidden="true" tabindex="-1"></a>  crying_by_words <span class="sc">%&gt;%</span></span>
<span id="cb399-4"><a href="gather-data.html#cb399-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(word, stars, n) <span class="sc">%&gt;%</span></span>
<span id="cb399-5"><a href="gather-data.html#cb399-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>tf_idf)</span>
<span id="cb399-6"><a href="gather-data.html#cb399-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-7"><a href="gather-data.html#cb399-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(crying_by_words_tf_idf)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   stars word              n      tf   idf tf_idf
##   &lt;int&gt; &lt;chr&gt;         &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1     2 below             1 0.00826  1.61 0.0133
## 2     2 boy               1 0.00826  1.61 0.0133
## 3     2 choice            1 0.00826  1.61 0.0133
## 4     2 contrary          1 0.00826  1.61 0.0133
## 5     2 exceptionally     1 0.00826  1.61 0.0133
## 6     2 migrates          1 0.00826  1.61 0.0133</code></pre>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="gather-data.html#cb401-1" aria-hidden="true" tabindex="-1"></a>crying_by_words_tf_idf <span class="sc">%&gt;%</span> </span>
<span id="cb401-2"><a href="gather-data.html#cb401-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stars) <span class="sc">%&gt;%</span></span>
<span id="cb401-3"><a href="gather-data.html#cb401-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb401-4"><a href="gather-data.html#cb401-4" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb401-5"><a href="gather-data.html#cb401-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">reorder_within</span>(word, tf_idf, stars)) <span class="sc">%&gt;%</span></span>
<span id="cb401-6"><a href="gather-data.html#cb401-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stars =</span> <span class="fu">as_factor</span>(stars)) <span class="sc">%&gt;%</span></span>
<span id="cb401-7"><a href="gather-data.html#cb401-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stars <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb401-8"><a href="gather-data.html#cb401-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(word, tf_idf, <span class="at">fill =</span> stars)) <span class="sc">+</span></span>
<span id="cb401-9"><a href="gather-data.html#cb401-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb401-10"><a href="gather-data.html#cb401-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(stars), <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb401-11"><a href="gather-data.html#cb401-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reordered</span>() <span class="sc">+</span></span>
<span id="cb401-12"><a href="gather-data.html#cb401-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb401-13"><a href="gather-data.html#cb401-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Word&quot;</span>, </span>
<span id="cb401-14"><a href="gather-data.html#cb401-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;tf-idf&quot;</span>) <span class="sc">+</span></span>
<span id="cb401-15"><a href="gather-data.html#cb401-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb401-16"><a href="gather-data.html#cb401-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="telling_stories_with_data_files/figure-html/unnamed-chunk-232-1.png" width="672" /></p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p>There are at least six great coffee shops shown just in this section of map including: Mocan &amp; Green Grout; The Cupping Room; Barrio Collective Coffee; Lonsdale Street Cafe; Two Before Ten; and Red Brick. There are also two coffee shops that I love but that most wouldn’t classify as ‘great’ including: The Street Theatre Cafe; and the CBE Cafe.<a href="gather-data.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>And if you’d like to know more about this then I’d recommend starting a PhD with <a href="https://www.monicaalexander.com/">Monica Alexander</a>.<a href="gather-data.html#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="interactive-communication.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="hunt-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
